# Comparing `tmp/finplot-1.9.4.tar.gz` & `tmp/finplot-1.9.5.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "finplot-1.9.4.tar", last modified: Wed Jan 31 09:11:51 2024, max compression
+gzip compressed data, was "finplot-1.9.5.tar", last modified: Mon May  6 19:30:57 2024, max compression
```

## Comparing `finplot-1.9.4.tar` & `finplot-1.9.5.tar`

### file list

```diff
@@ -1,17 +1,17 @@
-drwxrwxrwx   0        0        0        0 2024-01-31 09:11:51.464601 finplot-1.9.4/
--rw-rw-rw-   0        0        0     1092 2018-08-22 23:30:28.000000 finplot-1.9.4/LICENSE.txt
--rw-rw-rw-   0        0        0     3195 2024-01-31 09:11:51.464601 finplot-1.9.4/PKG-INFO
--rw-rw-rw-   0        0        0     2783 2021-05-22 08:27:11.000000 finplot-1.9.4/README.md
-drwxrwxrwx   0        0        0        0 2024-01-31 09:11:51.458604 finplot-1.9.4/finplot/
--rw-rw-rw-   0        0        0   120969 2024-01-10 22:38:13.000000 finplot-1.9.4/finplot/__init__.py
--rw-rw-rw-   0        0        0       23 2024-01-26 20:50:33.000000 finplot-1.9.4/finplot/_version.py
--rw-rw-rw-   0        0        0     1992 2023-02-11 18:57:39.000000 finplot-1.9.4/finplot/live.py
--rw-rw-rw-   0        0        0     1929 2022-09-01 21:08:58.000000 finplot-1.9.4/finplot/pdplot.py
-drwxrwxrwx   0        0        0        0 2024-01-31 09:11:51.463602 finplot-1.9.4/finplot.egg-info/
--rw-rw-rw-   0        0        0     3195 2024-01-31 09:11:51.000000 finplot-1.9.4/finplot.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      258 2024-01-31 09:11:51.000000 finplot-1.9.4/finplot.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2024-01-31 09:11:51.000000 finplot-1.9.4/finplot.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       75 2024-01-31 09:11:51.000000 finplot-1.9.4/finplot.egg-info/requires.txt
--rw-rw-rw-   0        0        0        8 2024-01-31 09:11:51.000000 finplot-1.9.4/finplot.egg-info/top_level.txt
--rw-rw-rw-   0        0        0       42 2024-01-31 09:11:51.464601 finplot-1.9.4/setup.cfg
--rw-rw-rw-   0        0        0      796 2023-05-26 21:03:00.000000 finplot-1.9.4/setup.py
+drwxrwxrwx   0        0        0        0 2024-05-06 19:30:57.182860 finplot-1.9.5/
+-rw-rw-rw-   0        0        0     1092 2018-08-22 23:30:28.000000 finplot-1.9.5/LICENSE.txt
+-rw-rw-rw-   0        0        0     3195 2024-05-06 19:30:57.181859 finplot-1.9.5/PKG-INFO
+-rw-rw-rw-   0        0        0     2783 2021-05-22 08:27:11.000000 finplot-1.9.5/README.md
+drwxrwxrwx   0        0        0        0 2024-05-06 19:30:57.175860 finplot-1.9.5/finplot/
+-rw-rw-rw-   0        0        0   122480 2024-04-12 09:30:30.000000 finplot-1.9.5/finplot/__init__.py
+-rw-rw-rw-   0        0        0       23 2024-05-06 19:29:12.000000 finplot-1.9.5/finplot/_version.py
+-rw-rw-rw-   0        0        0     1992 2023-02-11 18:57:39.000000 finplot-1.9.5/finplot/live.py
+-rw-rw-rw-   0        0        0     1929 2022-09-01 21:08:58.000000 finplot-1.9.5/finplot/pdplot.py
+drwxrwxrwx   0        0        0        0 2024-05-06 19:30:57.180860 finplot-1.9.5/finplot.egg-info/
+-rw-rw-rw-   0        0        0     3195 2024-05-06 19:30:56.000000 finplot-1.9.5/finplot.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      258 2024-05-06 19:30:56.000000 finplot-1.9.5/finplot.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2024-05-06 19:30:56.000000 finplot-1.9.5/finplot.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       75 2024-05-06 19:30:56.000000 finplot-1.9.5/finplot.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        8 2024-05-06 19:30:56.000000 finplot-1.9.5/finplot.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0       42 2024-05-06 19:30:57.182860 finplot-1.9.5/setup.cfg
+-rw-rw-rw-   0        0        0      796 2023-05-26 21:03:00.000000 finplot-1.9.5/setup.py
```

### Comparing `finplot-1.9.4/LICENSE.txt` & `finplot-1.9.5/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `finplot-1.9.4/PKG-INFO` & `finplot-1.9.5/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: finplot
-Version: 1.9.4
+Version: 1.9.5
 Summary: Finance plotting
 Home-page: https://github.com/highfestiva/finplot
 Author: Jonas Bystr√∂m
 Author-email: highfestiva@gmail.com
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: OS Independent
```

### Comparing `finplot-1.9.4/README.md` & `finplot-1.9.5/README.md`

 * *Files identical despite different names*

### Comparing `finplot-1.9.4/finplot/__init__.py` & `finplot-1.9.5/finplot/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -83,7479 +83,7573 @@
 00000520: 315d 2c20 5b32 3535 2c20 3531 2c20 3130  1], [255, 51, 10
 00000530: 322c 2035 315d 2c20 5b32 3535 2c20 3137  2, 51], [255, 17
 00000540: 382c 2037 362c 2035 315d 5d29 0d0a 666f  8, 76, 51]])..fo
 00000550: 7265 6772 6f75 6e64 203d 2027 2330 3030  reground = '#000
 00000560: 270d 0a62 6163 6b67 726f 756e 6420 3d20  '..background = 
 00000570: 2723 6666 6627 0d0a 6f64 645f 706c 6f74  '#fff'..odd_plot
 00000580: 5f62 6163 6b67 726f 756e 6420 3d20 2723  _background = '#
-00000590: 6561 6561 6561 270d 0a63 616e 646c 655f  eaeaea'..candle_
-000005a0: 6275 6c6c 5f63 6f6c 6f72 203d 2027 2332  bull_color = '#2
-000005b0: 3661 3639 6127 0d0a 6361 6e64 6c65 5f62  6a69a'..candle_b
-000005c0: 6561 725f 636f 6c6f 7220 3d20 2723 6566  ear_color = '#ef
-000005d0: 3533 3530 270d 0a63 616e 646c 655f 6275  5350'..candle_bu
-000005e0: 6c6c 5f62 6f64 795f 636f 6c6f 7220 3d20  ll_body_color = 
-000005f0: 6261 636b 6772 6f75 6e64 0d0a 6361 6e64  background..cand
-00000600: 6c65 5f62 6561 725f 626f 6479 5f63 6f6c  le_bear_body_col
-00000610: 6f72 203d 2063 616e 646c 655f 6265 6172  or = candle_bear
-00000620: 5f63 6f6c 6f72 0d0a 6361 6e64 6c65 5f73  _color..candle_s
-00000630: 6861 646f 775f 7769 6474 6820 3d20 310d  hadow_width = 1.
-00000640: 0a76 6f6c 756d 655f 6275 6c6c 5f63 6f6c  .volume_bull_col
-00000650: 6f72 203d 2027 2339 3264 3263 6327 0d0a  or = '#92d2cc'..
-00000660: 766f 6c75 6d65 5f62 6561 725f 636f 6c6f  volume_bear_colo
-00000670: 7220 3d20 2723 6637 6139 6137 270d 0a76  r = '#f7a9a7'..v
-00000680: 6f6c 756d 655f 6275 6c6c 5f62 6f64 795f  olume_bull_body_
-00000690: 636f 6c6f 7220 3d20 766f 6c75 6d65 5f62  color = volume_b
-000006a0: 756c 6c5f 636f 6c6f 720d 0a76 6f6c 756d  ull_color..volum
-000006b0: 655f 6e65 7574 7261 6c5f 636f 6c6f 7220  e_neutral_color 
-000006c0: 3d20 2723 6262 6227 0d0a 706f 635f 636f  = '#bbb'..poc_co
-000006d0: 6c6f 7220 3d20 2723 3030 3627 0d0a 6261  lor = '#006'..ba
-000006e0: 6e64 5f63 6f6c 6f72 203d 2027 2364 3264  nd_color = '#d2d
-000006f0: 6665 3627 0d0a 6372 6f73 735f 6861 6972  fe6'..cross_hair
-00000700: 5f63 6f6c 6f72 203d 2027 2330 3030 3727  _color = '#0007'
-00000710: 0d0a 6472 6177 5f6c 696e 655f 636f 6c6f  ..draw_line_colo
-00000720: 7220 3d20 2723 3030 3027 0d0a 6472 6177  r = '#000'..draw
-00000730: 5f64 6f6e 655f 636f 6c6f 7220 3d20 2723  _done_color = '#
-00000740: 3535 3527 0d0a 7369 676e 6966 6963 616e  555'..significan
-00000750: 745f 6465 6369 6d61 6c73 203d 2038 0d0a  t_decimals = 8..
-00000760: 7369 676e 6966 6963 616e 745f 6570 7320  significant_eps 
-00000770: 3d20 3165 2d38 0d0a 6d61 785f 6465 6369  = 1e-8..max_deci
-00000780: 6d61 6c73 203d 2031 300d 0a6d 6178 5f7a  mals = 10..max_z
-00000790: 6f6f 6d5f 706f 696e 7473 203d 2032 3020  oom_points = 20 
-000007a0: 2320 6e75 6d62 6572 206f 6620 7669 7369  # number of visi
-000007b0: 626c 6520 6361 6e64 6c65 7320 7768 656e  ble candles when
-000007c0: 206d 6178 696d 756d 207a 6f6f 6d65 6420   maximum zoomed 
-000007d0: 696e 0d0a 6178 6973 5f68 6569 6768 745f  in..axis_height_
-000007e0: 6661 6374 6f72 203d 207b 303a 2032 7d0d  factor = {0: 2}.
-000007f0: 0a63 6c61 6d70 5f67 7269 6420 3d20 5472  .clamp_grid = Tr
-00000800: 7565 0d0a 7269 6768 745f 6d61 7267 696e  ue..right_margin
-00000810: 5f63 616e 646c 6573 203d 2035 2023 2077  _candles = 5 # w
-00000820: 6869 7465 7370 6163 6520 6174 2074 6865  hitespace at the
-00000830: 2072 6967 6874 2d68 616e 6420 7369 6465   right-hand side
-00000840: 0d0a 7369 6465 5f6d 6172 6769 6e20 3d20  ..side_margin = 
-00000850: 302e 350d 0a6c 6f64 5f63 616e 646c 6573  0.5..lod_candles
-00000860: 203d 2033 3030 300d 0a6c 6f64 5f6c 6162   = 3000..lod_lab
-00000870: 656c 7320 3d20 3730 300d 0a63 6163 6865  els = 700..cache
-00000880: 5f63 616e 646c 655f 6661 6374 6f72 203d  _candle_factor =
-00000890: 2033 2023 2066 6163 746f 7220 6578 7472   3 # factor extr
-000008a0: 6120 6361 6e64 6c65 7320 7265 6e64 6572  a candles render
-000008b0: 6564 2074 6f20 6275 6666 6572 0d0a 795f  ed to buffer..y_
-000008c0: 7061 6420 3d20 302e 3033 2023 2033 2520  pad = 0.03 # 3% 
-000008d0: 7061 6464 696e 6720 6174 2074 6f70 2061  padding at top a
-000008e0: 6e64 2062 6f74 746f 6d20 6f66 2061 7574  nd bottom of aut
-000008f0: 6f7a 6f6f 6d20 706c 6f74 730d 0a79 5f6c  ozoom plots..y_l
-00000900: 6162 656c 5f77 6964 7468 203d 2036 350d  abel_width = 65.
-00000910: 0a74 696d 6573 7461 6d70 5f66 6f72 6d61  .timestamp_forma
-00000920: 7420 3d20 2725 592d 256d 2d25 6420 2548  t = '%Y-%m-%d %H
-00000930: 3a25 4d3a 2553 2e25 6627 0d0a 6469 7370  :%M:%S.%f'..disp
-00000940: 6c61 795f 7469 6d65 7a6f 6e65 203d 2074  lay_timezone = t
-00000950: 7a6c 6f63 616c 2829 2023 2064 6566 6175  zlocal() # defau
-00000960: 6c74 2074 6f20 6c6f 6361 6c0d 0a77 696e  lt to local..win
-00000970: 782c 7769 6e79 2c77 696e 772c 7769 6e68  x,winy,winw,winh
-00000980: 203d 2033 3030 2c31 3530 2c38 3030 2c34   = 300,150,800,4
-00000990: 3030 0d0a 7769 6e5f 7265 6372 6561 7465  00..win_recreate
-000009a0: 5f64 656c 7461 203d 2033 300d 0a6c 6f67  _delta = 30..log
-000009b0: 5f70 6c6f 745f 6f66 6673 6574 203d 202d  _plot_offset = -
-000009c0: 322e 3232 3232 3232 3265 2d31 3620 2320  2.2222222e-16 # 
-000009d0: 4920 636f 756c 6420 6669 6c65 2061 2062  I could file a b
-000009e0: 7567 2072 6570 6f72 742c 2070 726f 6261  ug report, proba
-000009f0: 626c 7920 696e 2050 7951 742c 2062 7574  bly in PyQt, but
-00000a00: 2074 6869 7320 6973 206d 6f72 6520 6675   this is more fu
-00000a10: 6e0d 0a23 2066 6f72 6d61 743a 206d 6f64  n..# format: mod
-00000a20: 652c 206d 696e 2d64 7572 6174 696f 6e2c  e, min-duration,
-00000a30: 2070 642d 6672 6571 2d66 6d74 2c20 7469   pd-freq-fmt, ti
-00000a40: 636b 2d73 7472 2d6c 656e 0d0a 7469 6d65  ck-str-len..time
-00000a50: 5f73 706c 6974 7320 3d20 5b28 2779 6561  _splits = [('yea
-00000a60: 7273 272c 2032 2a33 3635 2a32 342a 3630  rs', 2*365*24*60
-00000a70: 2a36 302c 2020 2759 5327 2c20 2034 292c  *60,  'YS',  4),
-00000a80: 2028 276d 6f6e 7468 7327 2c20 332a 3330   ('months', 3*30
-00000a90: 2a32 342a 3630 2a36 302c 2027 4d53 272c  *24*60*60, 'MS',
-00000aa0: 2031 3029 2c20 2827 7765 656b 7327 2c20   10), ('weeks', 
-00000ab0: 2020 332a 372a 3234 2a36 302a 3630 2c20    3*7*24*60*60, 
-00000ac0: 2757 2d4d 4f4e 272c 2031 3029 2c0d 0a20  'W-MON', 10),.. 
-00000ad0: 2020 2020 2020 2020 2020 2020 2020 2827                ('
-00000ae0: 6461 7973 272c 2020 2020 2020 332a 3234  days',      3*24
-00000af0: 2a36 302a 3630 2c20 2020 2744 272c 2031  *60*60,   'D', 1
-00000b00: 3029 2c20 2827 686f 7572 7327 2c20 2020  0), ('hours',   
-00000b10: 2020 2020 2039 2a36 302a 3630 2c20 2733       9*60*60, '3
-00000b20: 4827 2c20 3136 292c 2028 2768 6f75 7273  H', 16), ('hours
-00000b30: 272c 2020 2020 2020 2020 332a 3630 2a36  ',        3*60*6
-00000b40: 302c 2020 2020 2027 4827 2c20 3136 292c  0,     'H', 16),
-00000b50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00000b60: 2028 276d 696e 7574 6573 272c 2020 2020   ('minutes',    
-00000b70: 2020 2020 3435 2a36 302c 2027 3135 5427      45*60, '15T'
-00000b80: 2c20 3136 292c 2028 276d 696e 7574 6573  , 16), ('minutes
-00000b90: 272c 2020 2020 2020 2020 3135 2a36 302c  ',        15*60,
-00000ba0: 2027 3554 272c 2031 3629 2c20 2827 6d69   '5T', 16), ('mi
-00000bb0: 6e75 7465 7327 2c20 2020 2020 2020 2020  nutes',         
-00000bc0: 332a 3630 2c20 2020 2020 2754 272c 2031  3*60,     'T', 1
-00000bd0: 3629 2c0d 0a20 2020 2020 2020 2020 2020  6),..           
-00000be0: 2020 2020 2827 7365 636f 6e64 7327 2c20      ('seconds', 
-00000bf0: 2020 2020 2020 2020 2020 3435 2c20 2731            45, '1
-00000c00: 3553 272c 2031 3929 2c20 2827 7365 636f  5S', 19), ('seco
-00000c10: 6e64 7327 2c20 2020 2020 2020 2020 2020  nds',           
-00000c20: 3135 2c20 2735 5327 2c20 3139 292c 2028  15, '5S', 19), (
-00000c30: 2773 6563 6f6e 6473 272c 2020 2020 2020  'seconds',      
-00000c40: 2020 2020 2020 332c 2020 2020 2027 5327        3,     'S'
-00000c50: 2c20 3139 292c 0d0a 2020 2020 2020 2020  , 19),..        
-00000c60: 2020 2020 2020 2028 276d 696c 6c69 7365         ('millise
-00000c70: 636f 6e64 7327 2c20 2020 2020 2020 302c  conds',       0,
-00000c80: 2020 2027 4c27 2c20 3233 295d 0d0a 0d0a     'L', 23)]....
-00000c90: 6170 7020 3d20 4e6f 6e65 0d0a 7769 6e64  app = None..wind
-00000ca0: 6f77 7320 3d20 5b5d 2023 206e 6f20 6763  ows = [] # no gc
-00000cb0: 0d0a 7469 6d65 7273 203d 205b 5d20 2320  ..timers = [] # 
-00000cc0: 6e6f 2067 630d 0a73 6f75 6e64 7320 3d20  no gc..sounds = 
-00000cd0: 7b7d 2023 206e 6f20 6763 0d0a 6570 6f63  {} # no gc..epoc
-00000ce0: 685f 7065 7269 6f64 203d 2031 6533 300d  h_period = 1e30.
-00000cf0: 0a6c 6173 745f 6178 203d 204e 6f6e 6520  .last_ax = None 
-00000d00: 2320 616c 7761 7973 2061 7373 756d 6520  # always assume 
-00000d10: 7765 2077 616e 7420 746f 2070 6c6f 7420  we want to plot 
-00000d20: 696e 2074 6865 206c 6173 7420 6178 6973  in the last axis
-00000d30: 2c20 756e 6c65 7373 2065 7870 6c69 6369  , unless explici
-00000d40: 746c 7920 7370 6563 6966 6965 640d 0a6f  tly specified..o
-00000d50: 7665 726c 6179 5f61 7873 203d 205b 5d20  verlay_axs = [] 
-00000d60: 2320 666f 7220 6b65 6570 696e 6720 7472  # for keeping tr
-00000d70: 6163 6b20 6f66 2063 616e 646c 6573 7469  ack of candlesti
-00000d80: 636b 7320 696e 206f 7665 726c 6179 730d  cks in overlays.
-00000d90: 0a76 6965 7772 6573 746f 7265 203d 2046  .viewrestore = F
-00000da0: 616c 7365 0d0a 6b65 795f 6573 635f 636c  alse..key_esc_cl
-00000db0: 6f73 6520 3d20 5472 7565 2023 2045 5343  ose = True # ESC
-00000dc0: 206b 6579 2063 6c6f 7365 7320 7769 6e64   key closes wind
-00000dd0: 6f77 0d0a 6d61 7374 6572 5f64 6174 6120  ow..master_data 
-00000de0: 3d20 7b7d 0d0a 0d0a 0d0a 0d0a 6c65 7270  = {}........lerp
-00000df0: 203d 206c 616d 6264 6120 742c 612c 623a   = lambda t,a,b:
-00000e00: 2074 2a62 2b28 312d 7429 2a61 0d0a 0d0a   t*b+(1-t)*a....
-00000e10: 0d0a 0d0a 636c 6173 7320 4570 6f63 6841  ....class EpochA
-00000e20: 7869 7349 7465 6d28 7067 2e41 7869 7349  xisItem(pg.AxisI
-00000e30: 7465 6d29 3a0d 0a20 2020 2064 6566 205f  tem):..    def _
-00000e40: 5f69 6e69 745f 5f28 7365 6c66 2c20 7662  _init__(self, vb
-00000e50: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
-00000e60: 7329 3a0d 0a20 2020 2020 2020 2073 7570  s):..        sup
-00000e70: 6572 2829 2e5f 5f69 6e69 745f 5f28 2a61  er().__init__(*a
-00000e80: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
-00000e90: 2020 2020 2020 2020 7365 6c66 2e76 6220          self.vb 
-00000ea0: 3d20 7662 0d0a 0d0a 2020 2020 6465 6620  = vb....    def 
-00000eb0: 7469 636b 5374 7269 6e67 7328 7365 6c66  tickStrings(self
-00000ec0: 2c20 7661 6c75 6573 2c20 7363 616c 652c  , values, scale,
-00000ed0: 2073 7061 6369 6e67 293a 0d0a 2020 2020   spacing):..    
-00000ee0: 2020 2020 6966 2073 656c 662e 6d6f 6465      if self.mode
-00000ef0: 203d 3d20 276e 756d 273a 0d0a 2020 2020   == 'num':..    
-00000f00: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00000f10: 2725 6727 2576 2066 6f72 2076 2069 6e20  '%g'%v for v in 
-00000f20: 7661 6c75 6573 5d0d 0a20 2020 2020 2020  values]..       
-00000f30: 2063 6f6e 7620 3d20 5f78 3279 6561 7220   conv = _x2year 
-00000f40: 6966 2073 656c 662e 6d6f 6465 3d3d 2779  if self.mode=='y
-00000f50: 6561 7273 2720 656c 7365 205f 7832 6c6f  ears' else _x2lo
-00000f60: 6361 6c5f 740d 0a20 2020 2020 2020 2073  cal_t..        s
-00000f70: 7472 7320 3d20 5b63 6f6e 7628 7365 6c66  trs = [conv(self
-00000f80: 2e76 622e 6461 7461 7372 632c 2076 616c  .vb.datasrc, val
-00000f90: 7565 295b 305d 2066 6f72 2076 616c 7565  ue)[0] for value
-00000fa0: 2069 6e20 7661 6c75 6573 5d0d 0a20 2020   in values]..   
-00000fb0: 2020 2020 2069 6620 616c 6c28 5f69 735f       if all(_is_
-00000fc0: 7374 725f 6d69 646e 6967 6874 2873 2920  str_midnight(s) 
-00000fd0: 666f 7220 7320 696e 2073 7472 7320 6966  for s in strs if
-00000fe0: 2073 293a 2023 2061 6c6c 2061 7420 6d69   s): # all at mi
-00000ff0: 646e 6967 6874 202d 3e20 726f 756e 6420  dnight -> round 
-00001000: 746f 2064 6179 730d 0a20 2020 2020 2020  to days..       
-00001010: 2020 2020 2073 7472 7320 3d20 5b73 2e70       strs = [s.p
-00001020: 6172 7469 7469 6f6e 2827 2027 295b 305d  artition(' ')[0]
-00001030: 2066 6f72 2073 2069 6e20 7374 7273 5d0d   for s in strs].
-00001040: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00001050: 7374 7273 0d0a 0d0a 2020 2020 6465 6620  strs....    def 
-00001060: 7469 636b 5661 6c75 6573 2873 656c 662c  tickValues(self,
-00001070: 206d 696e 5661 6c2c 206d 6178 5661 6c2c   minVal, maxVal,
-00001080: 2073 697a 6529 3a0d 0a20 2020 2020 2020   size):..       
-00001090: 2073 656c 662e 6d6f 6465 203d 2027 6e75   self.mode = 'nu
-000010a0: 6d27 0d0a 2020 2020 2020 2020 6178 203d  m'..        ax =
-000010b0: 2073 656c 662e 7662 2e70 6172 656e 7428   self.vb.parent(
-000010c0: 290d 0a20 2020 2020 2020 2064 6174 6173  )..        datas
-000010d0: 7263 203d 205f 6765 745f 6461 7461 7372  rc = _get_datasr
-000010e0: 6328 6178 2c20 7265 7175 6972 653d 4661  c(ax, require=Fa
-000010f0: 6c73 6529 0d0a 2020 2020 2020 2020 6966  lse)..        if
-00001100: 2064 6174 6173 7263 2069 7320 4e6f 6e65   datasrc is None
-00001110: 206f 7220 6e6f 7420 7365 6c66 2e76 622e   or not self.vb.
-00001120: 785f 696e 6465 7865 643a 0d0a 2020 2020  x_indexed:..    
-00001130: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00001140: 7570 6572 2829 2e74 6963 6b56 616c 7565  uper().tickValue
-00001150: 7328 6d69 6e56 616c 2c20 6d61 7856 616c  s(minVal, maxVal
-00001160: 2c20 7369 7a65 290d 0a20 2020 2020 2020  , size)..       
-00001170: 2023 2063 616c 6375 6c61 7465 2069 6620   # calculate if 
-00001180: 7765 2075 7365 2079 6561 7273 2c20 6461  we use years, da
-00001190: 7973 2c20 6574 632e 0d0a 2020 2020 2020  ys, etc...      
-000011a0: 2020 7430 2c74 312c 5f2c 5f2c 5f20 3d20    t0,t1,_,_,_ = 
-000011b0: 6461 7461 7372 632e 6869 6c6f 286d 696e  datasrc.hilo(min
-000011c0: 5661 6c2c 206d 6178 5661 6c29 0d0a 2020  Val, maxVal)..  
-000011d0: 2020 2020 2020 7430 2c74 3120 3d20 7064        t0,t1 = pd
-000011e0: 2e74 6f5f 6461 7465 7469 6d65 2874 3029  .to_datetime(t0)
-000011f0: 2c20 7064 2e74 6f5f 6461 7465 7469 6d65  , pd.to_datetime
-00001200: 2874 3129 0d0a 2020 2020 2020 2020 6474  (t1)..        dt
-00001210: 7320 3d20 2874 312d 7430 292e 746f 7461  s = (t1-t0).tota
-00001220: 6c5f 7365 636f 6e64 7328 290d 0a20 2020  l_seconds()..   
-00001230: 2020 2020 2067 6678 5f77 6964 7468 203d       gfx_width =
-00001240: 2069 6e74 2873 697a 6529 0d0a 2020 2020   int(size)..    
-00001250: 2020 2020 666f 7220 6d6f 6465 2c20 6474      for mode, dt
-00001260: 742c 2066 7265 712c 2074 6963 6b6c 656e  t, freq, ticklen
-00001270: 2069 6e20 7469 6d65 5f73 706c 6974 733a   in time_splits:
-00001280: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00001290: 2064 7473 203e 2064 7474 3a0d 0a20 2020   dts > dtt:..   
-000012a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000012b0: 662e 6d6f 6465 203d 206d 6f64 650d 0a20  f.mode = mode.. 
-000012c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000012d0: 6573 6972 6564 5f74 6963 6b73 203d 2067  esired_ticks = g
-000012e0: 6678 5f77 6964 7468 202f 2028 2874 6963  fx_width / ((tic
-000012f0: 6b6c 656e 2b32 2920 2a20 3130 2920 2d20  klen+2) * 10) - 
-00001300: 3120 2320 616e 2061 7070 726f 7869 6d61  1 # an approxima
-00001310: 7469 6f6e 2069 7320 6669 6e65 0d0a 2020  tion is fine..  
-00001320: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00001330: 2073 656c 662e 7662 2e64 6174 6173 7263   self.vb.datasrc
-00001340: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00001350: 206e 6f74 2073 656c 662e 7662 2e64 6174   not self.vb.dat
-00001360: 6173 7263 2e69 735f 736d 6f6f 7468 5f74  asrc.is_smooth_t
-00001370: 696d 6528 293a 0d0a 2020 2020 2020 2020  ime():..        
-00001380: 2020 2020 2020 2020 2020 2020 6465 7369              desi
-00001390: 7265 645f 7469 636b 7320 2d3d 2031 2023  red_ticks -= 1 #
-000013a0: 206c 6561 7665 206d 6f72 6520 7370 6163   leave more spac
-000013b0: 6520 666f 7220 756e 6576 656e 6c79 2073  e for unevenly s
-000013c0: 7061 6365 6420 7469 636b 730d 0a20 2020  paced ticks..   
-000013d0: 2020 2020 2020 2020 2020 2020 2064 6573               des
-000013e0: 6972 6564 5f74 6963 6b73 203d 206d 6178  ired_ticks = max
-000013f0: 2864 6573 6972 6564 5f74 6963 6b73 2c20  (desired_ticks, 
-00001400: 3429 0d0a 2020 2020 2020 2020 2020 2020  4)..            
-00001410: 2020 2020 746f 5f6d 6964 6e69 6768 7420      to_midnight 
-00001420: 3d20 6672 6571 2069 6e20 2827 5953 272c  = freq in ('YS',
-00001430: 274d 5327 2c20 2757 2d4d 4f4e 272c 2027  'MS', 'W-MON', '
-00001440: 4427 290d 0a20 2020 2020 2020 2020 2020  D')..           
-00001450: 2020 2020 2074 7a20 3d20 6469 7370 6c61       tz = displa
-00001460: 795f 7469 6d65 7a6f 6e65 2069 6620 746f  y_timezone if to
-00001470: 5f6d 6964 6e69 6768 7420 656c 7365 204e  _midnight else N
-00001480: 6f6e 6520 2320 666f 7220 7368 6f72 7465  one # for shorte
-00001490: 7220 7469 6d65 6672 616d 6573 2c20 7469  r timeframes, ti
-000014a0: 6d65 7a6f 6e65 2073 6565 6d73 2062 7567  mezone seems bug
-000014b0: 6779 0d0a 2020 2020 2020 2020 2020 2020  gy..            
-000014c0: 2020 2020 726e 6720 3d20 7064 2e64 6174      rng = pd.dat
-000014d0: 655f 7261 6e67 6528 7430 2c20 7431 2c20  e_range(t0, t1, 
-000014e0: 747a 3d74 7a2c 206e 6f72 6d61 6c69 7a65  tz=tz, normalize
-000014f0: 3d74 6f5f 6d69 646e 6967 6874 2c20 6672  =to_midnight, fr
-00001500: 6571 3d66 7265 7129 0d0a 2020 2020 2020  eq=freq)..      
-00001510: 2020 2020 2020 2020 2020 7374 6570 7320            steps 
-00001520: 3d20 6c65 6e28 726e 6729 2069 6620 6c65  = len(rng) if le
-00001530: 6e28 726e 6729 2631 3d3d 3020 656c 7365  n(rng)&1==0 else
-00001540: 206c 656e 2872 6e67 292b 3120 2320 7265   len(rng)+1 # re
-00001550: 6475 6365 206a 6974 7465 7220 6265 7477  duce jitter betw
-00001560: 6565 6e20 652e 672e 2035 3c2d 2d3e 3130  een e.g. 5<-->10
-00001570: 2074 6963 6b73 2066 6f72 2072 6573 6f6c   ticks for resol
-00001580: 7574 696f 6e20 636c 6f73 6520 746f 206c  ution close to l
-00001590: 696d 6974 0d0a 2020 2020 2020 2020 2020  imit..          
-000015a0: 2020 2020 2020 7374 6570 203d 2069 6e74        step = int
-000015b0: 2873 7465 7073 2f64 6573 6972 6564 5f74  (steps/desired_t
-000015c0: 6963 6b73 2920 6f72 2031 0d0a 2020 2020  icks) or 1..    
-000015d0: 2020 2020 2020 2020 2020 2020 726e 6720              rng 
-000015e0: 3d20 726e 675b 3a3a 7374 6570 5d0d 0a20  = rng[::step].. 
-000015f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00001600: 6620 6e6f 7420 746f 5f6d 6964 6e69 6768  f not to_midnigh
-00001610: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-00001620: 2020 2020 2020 2020 7472 793a 2020 2020          try:    
-00001630: 726e 6720 3d20 726e 672e 726f 756e 6428  rng = rng.round(
-00001640: 6672 6571 3d66 7265 7129 0d0a 2020 2020  freq=freq)..    
-00001650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001660: 6578 6365 7074 3a20 7061 7373 0d0a 2020  except: pass..  
-00001670: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00001680: 203d 2073 656c 662e 7662 2e70 6172 656e   = self.vb.paren
-00001690: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-000016a0: 2020 2020 2072 6e67 203d 205f 7064 7469       rng = _pdti
-000016b0: 6d65 3269 6e64 6578 2861 783d 6178 2c20  me2index(ax=ax, 
-000016c0: 7473 3d70 642e 5365 7269 6573 2872 6e67  ts=pd.Series(rng
-000016d0: 292c 2072 6571 7569 7265 5f74 696d 653d  ), require_time=
-000016e0: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
-000016f0: 2020 2020 2020 2069 6e64 6963 6573 203d         indices =
-00001700: 205b 6365 696c 2869 2920 666f 7220 6920   [ceil(i) for i 
-00001710: 696e 2072 6e67 2069 6620 693e 2d31 6532  in rng if i>-1e2
-00001720: 3030 5d0d 0a20 2020 2020 2020 2020 2020  00]..           
-00001730: 2020 2020 2072 6574 7572 6e20 5b28 302c       return [(0,
-00001740: 2069 6e64 6963 6573 295d 0d0a 2020 2020   indices)]..    
-00001750: 2020 2020 7265 7475 726e 205b 2830 2c5b      return [(0,[
-00001760: 5d29 5d0d 0a0d 0a20 2020 2064 6566 2067  ])]....    def g
-00001770: 656e 6572 6174 6544 7261 7753 7065 6373  enerateDrawSpecs
-00001780: 2873 656c 662c 2070 293a 0d0a 2020 2020  (self, p):..    
-00001790: 2020 2020 7370 6563 7320 3d20 7375 7065      specs = supe
-000017a0: 7228 292e 6765 6e65 7261 7465 4472 6177  r().generateDraw
-000017b0: 5370 6563 7328 7029 0d0a 2020 2020 2020  Specs(p)..      
-000017c0: 2020 6966 2073 7065 6373 3a0d 0a20 2020    if specs:..   
-000017d0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000017e0: 7365 6c66 2e73 7479 6c65 5b27 7368 6f77  self.style['show
-000017f0: 5661 6c75 6573 275d 3a0d 0a20 2020 2020  Values']:..     
-00001800: 2020 2020 2020 2020 2020 2070 656e 2c70             pen,p
-00001810: 302c 7031 203d 2073 7065 6373 5b30 5d20  0,p1 = specs[0] 
-00001820: 2320 6178 6973 2073 7065 6373 0d0a 2020  # axis specs..  
-00001830: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-00001840: 6563 7320 3d20 5b28 5f6d 616b 6570 656e  ecs = [(_makepen
-00001850: 2827 2366 6666 3027 292c 7030 2c70 3129  ('#fff0'),p0,p1)
-00001860: 5d20 2b20 6c69 7374 2873 7065 6373 5b31  ] + list(specs[1
-00001870: 3a5d 2920 2320 646f 6e27 7420 6472 6177  :]) # don't draw
-00001880: 2061 7869 7320 6966 2068 6964 696e 6720   axis if hiding 
-00001890: 7661 6c75 6573 0d0a 2020 2020 2020 2020  values..        
-000018a0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000018b0: 2020 2020 2020 2020 2020 2023 2074 6872             # thr
-000018c0: 6f77 206f 7574 2074 6963 6b73 2074 6861  ow out ticks tha
-000018d0: 7420 6172 6520 6f75 7420 6f66 2062 6f75  t are out of bou
-000018e0: 6e64 730d 0a20 2020 2020 2020 2020 2020  nds..           
-000018f0: 2020 2020 2074 6578 745f 7370 6563 7320       text_specs 
-00001900: 3d20 7370 6563 735b 325d 0d0a 2020 2020  = specs[2]..    
-00001910: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00001920: 656e 2874 6578 745f 7370 6563 7329 203e  en(text_specs) >
-00001930: 3d20 343a 0d0a 2020 2020 2020 2020 2020  = 4:..          
-00001940: 2020 2020 2020 2020 2020 7265 6374 2c66            rect,f
-00001950: 6c61 6773 2c74 6578 7420 3d20 7465 7874  lags,text = text
-00001960: 5f73 7065 6373 5b30 5d0d 0a20 2020 2020  _specs[0]..     
-00001970: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00001980: 6620 7265 6374 2e6c 6566 7428 2920 3c20  f rect.left() < 
-00001990: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-000019a0: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-000019b0: 7465 7874 5f73 7065 6373 5b30 5d0d 0a20  text_specs[0].. 
-000019c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000019d0: 2020 2072 6563 742c 666c 6167 732c 7465     rect,flags,te
-000019e0: 7874 203d 2074 6578 745f 7370 6563 735b  xt = text_specs[
-000019f0: 2d31 5d0d 0a20 2020 2020 2020 2020 2020  -1]..           
-00001a00: 2020 2020 2020 2020 2069 6620 7265 6374           if rect
-00001a10: 2e72 6967 6874 2829 203e 2073 656c 662e  .right() > self.
-00001a20: 6765 6f6d 6574 7279 2829 2e77 6964 7468  geometry().width
-00001a30: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00001a40: 2020 2020 2020 2020 2020 2020 2064 656c               del
-00001a50: 2074 6578 745f 7370 6563 735b 2d31 5d0d   text_specs[-1].
-00001a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001a70: 2023 202e 2e2e 2061 6e64 2074 686f 7365   # ... and those
-00001a80: 2074 6861 7420 6f76 6572 6c61 700d 0a20   that overlap.. 
-00001a90: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-00001aa0: 203d 2031 6536 0d0a 2020 2020 2020 2020   = 1e6..        
-00001ab0: 2020 2020 2020 2020 666f 7220 692c 2872          for i,(r
-00001ac0: 6563 742c 666c 6167 732c 7465 7874 2920  ect,flags,text) 
-00001ad0: 696e 2072 6576 6572 7365 6428 6c69 7374  in reversed(list
-00001ae0: 2865 6e75 6d65 7261 7465 2874 6578 745f  (enumerate(text_
-00001af0: 7370 6563 7329 2929 3a0d 0a20 2020 2020  specs))):..     
-00001b00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00001b10: 6620 7265 6374 2e72 6967 6874 2829 203e  f rect.right() >
-00001b20: 3d20 783a 0d0a 2020 2020 2020 2020 2020  = x:..          
-00001b30: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00001b40: 6c20 7465 7874 5f73 7065 6373 5b69 5d0d  l text_specs[i].
-00001b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001b60: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00001b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001b80: 2020 2020 7820 3d20 7265 6374 2e6c 6566      x = rect.lef
-00001b90: 7428 290d 0a20 2020 2020 2020 2072 6574  t()..        ret
-00001ba0: 7572 6e20 7370 6563 730d 0a0d 0a0d 0a0d  urn specs.......
-00001bb0: 0a63 6c61 7373 2059 4178 6973 4974 656d  .class YAxisItem
-00001bc0: 2870 672e 4178 6973 4974 656d 293a 0d0a  (pg.AxisItem):..
-00001bd0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00001be0: 2873 656c 662c 2076 622c 202a 6172 6773  (self, vb, *args
-00001bf0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00001c00: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
-00001c10: 696e 6974 5f5f 282a 6172 6773 2c20 2a2a  init__(*args, **
-00001c20: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
-00001c30: 2073 656c 662e 7662 203d 2076 620d 0a20   self.vb = vb.. 
-00001c40: 2020 2020 2020 2073 656c 662e 6869 6465         self.hide
-00001c50: 5f73 7472 696e 6773 203d 2046 616c 7365  _strings = False
-00001c60: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00001c70: 7479 6c65 5b27 6175 746f 4578 7061 6e64  tyle['autoExpand
-00001c80: 5465 7874 5370 6163 6527 5d20 3d20 4661  TextSpace'] = Fa
-00001c90: 6c73 650d 0a20 2020 2020 2020 2073 656c  lse..        sel
-00001ca0: 662e 7374 796c 655b 2761 7574 6f52 6564  f.style['autoRed
-00001cb0: 7563 6554 6578 7453 7061 6365 275d 203d  uceTextSpace'] =
-00001cc0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00001cd0: 7365 6c66 2e6e 6578 745f 666d 7420 3d20  self.next_fmt = 
-00001ce0: 2725 6727 0d0a 0d0a 2020 2020 6465 6620  '%g'....    def 
-00001cf0: 7469 636b 5661 6c75 6573 2873 656c 662c  tickValues(self,
-00001d00: 206d 696e 5661 6c2c 206d 6178 5661 6c2c   minVal, maxVal,
-00001d10: 2073 697a 6529 3a0d 0a20 2020 2020 2020   size):..       
-00001d20: 2076 7320 3d20 7375 7065 7228 292e 7469   vs = super().ti
-00001d30: 636b 5661 6c75 6573 286d 696e 5661 6c2c  ckValues(minVal,
-00001d40: 206d 6178 5661 6c2c 2073 697a 6529 0d0a   maxVal, size)..
-00001d50: 2020 2020 2020 2020 6966 206c 656e 2876          if len(v
-00001d60: 7329 203c 2033 3a0d 0a20 2020 2020 2020  s) < 3:..       
-00001d70: 2020 2020 2072 6574 7572 6e20 7673 0d0a       return vs..
-00001d80: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00001d90: 656c 662e 666d 745f 7661 6c75 6573 2876  elf.fmt_values(v
-00001da0: 7329 0d0a 0d0a 2020 2020 6465 6620 6c6f  s)....    def lo
-00001db0: 6754 6963 6b56 616c 7565 7328 7365 6c66  gTickValues(self
-00001dc0: 2c20 6d69 6e56 616c 2c20 6d61 7856 616c  , minVal, maxVal
-00001dd0: 2c20 7369 7a65 2c20 7374 6454 6963 6b73  , size, stdTicks
-00001de0: 293a 0d0a 2020 2020 2020 2020 7631 203d  ):..        v1 =
-00001df0: 2069 6e74 2866 6c6f 6f72 286d 696e 5661   int(floor(minVa
-00001e00: 6c29 290d 0a20 2020 2020 2020 2076 3220  l))..        v2 
-00001e10: 3d20 696e 7428 6365 696c 286d 6178 5661  = int(ceil(maxVa
-00001e20: 6c29 290d 0a20 2020 2020 2020 206d 696e  l))..        min
-00001e30: 6f72 203d 205b 5d0d 0a20 2020 2020 2020  or = []..       
-00001e40: 2066 6f72 2076 2069 6e20 7261 6e67 6528   for v in range(
-00001e50: 7631 2c20 7632 293a 0d0a 2020 2020 2020  v1, v2):..      
-00001e60: 2020 2020 2020 6d69 6e6f 722e 6578 7465        minor.exte
-00001e70: 6e64 285b 762b 6c20 666f 7220 6c20 696e  nd([v+l for l in
-00001e80: 206e 702e 6c6f 6731 3028 6e70 2e6c 696e   np.log10(np.lin
-00001e90: 7370 6163 6528 312c 2039 2e39 2c20 3930  space(1, 9.9, 90
-00001ea0: 2929 5d29 0d0a 2020 2020 2020 2020 6d69  ))])..        mi
-00001eb0: 6e6f 7220 3d20 5b78 2066 6f72 2078 2069  nor = [x for x i
-00001ec0: 6e20 6d69 6e6f 7220 6966 2078 3e6d 696e  n minor if x>min
-00001ed0: 5661 6c20 616e 6420 783c 6d61 7856 616c  Val and x<maxVal
-00001ee0: 5d0d 0a20 2020 2020 2020 2069 6620 6e6f  ]..        if no
-00001ef0: 7420 6d69 6e6f 723a 0d0a 2020 2020 2020  t minor:..      
-00001f00: 2020 2020 2020 6d69 6e6f 722e 6578 7465        minor.exte
-00001f10: 6e64 286e 702e 6765 6f6d 7370 6163 6528  nd(np.geomspace(
-00001f20: 6d69 6e56 616c 2c20 6d61 7856 616c 2c20  minVal, maxVal, 
-00001f30: 3729 5b31 3a2d 315d 290d 0a20 2020 2020  7)[1:-1])..     
-00001f40: 2020 2069 6620 6c65 6e28 6d69 6e6f 7229     if len(minor)
-00001f50: 203e 2031 303a 0d0a 2020 2020 2020 2020   > 10:..        
-00001f60: 2020 2020 6d69 6e6f 7220 3d20 6d69 6e6f      minor = mino
-00001f70: 725b 3a3a 6c65 6e28 6d69 6e6f 7229 2f2f  r[::len(minor)//
-00001f80: 355d 0d0a 2020 2020 2020 2020 7673 203d  5]..        vs =
-00001f90: 205b 284e 6f6e 652c 206d 696e 6f72 295d   [(None, minor)]
-00001fa0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00001fb0: 2073 656c 662e 666d 745f 7661 6c75 6573   self.fmt_values
-00001fc0: 2876 7329 0d0a 0d0a 2020 2020 6465 6620  (vs)....    def 
-00001fd0: 7469 636b 5374 7269 6e67 7328 7365 6c66  tickStrings(self
-00001fe0: 2c20 7661 6c75 6573 2c20 7363 616c 652c  , values, scale,
-00001ff0: 2073 7061 6369 6e67 293a 0d0a 2020 2020   spacing):..    
-00002000: 2020 2020 6966 2073 656c 662e 6869 6465      if self.hide
-00002010: 5f73 7472 696e 6773 3a0d 0a20 2020 2020  _strings:..     
-00002020: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
-00002030: 0d0a 2020 2020 2020 2020 7866 6f72 6d20  ..        xform 
-00002040: 3d20 7365 6c66 2e76 622e 7973 6361 6c65  = self.vb.yscale
-00002050: 2e78 666f 726d 0d0a 2020 2020 2020 2020  .xform..        
-00002060: 7265 7475 726e 205b 7365 6c66 2e6e 6578  return [self.nex
-00002070: 745f 666d 7425 7866 6f72 6d28 7661 6c75  t_fmt%xform(valu
-00002080: 6529 2066 6f72 2076 616c 7565 2069 6e20  e) for value in 
-00002090: 7661 6c75 6573 5d0d 0a0d 0a20 2020 2064  values]....    d
-000020a0: 6566 2066 6d74 5f76 616c 7565 7328 7365  ef fmt_values(se
-000020b0: 6c66 2c20 7673 293a 0d0a 2020 2020 2020  lf, vs):..      
-000020c0: 2020 7866 6f72 6d20 3d20 7365 6c66 2e76    xform = self.v
-000020d0: 622e 7973 6361 6c65 2e78 666f 726d 0d0a  b.yscale.xform..
-000020e0: 2020 2020 2020 2020 6773 203d 205b 2725          gs = ['%
-000020f0: 6727 2578 666f 726d 2876 2920 666f 7220  g'%xform(v) for 
-00002100: 7620 696e 2076 735b 2d31 5d5b 315d 5d0d  v in vs[-1][1]].
-00002110: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00002120: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
-00002130: 2072 6574 7572 6e20 7673 0d0a 2020 2020   return vs..    
-00002140: 2020 2020 6966 2061 6e79 285b 2765 2720      if any(['e' 
-00002150: 696e 2067 2066 6f72 2067 2069 6e20 6773  in g for g in gs
-00002160: 5d29 3a0d 0a20 2020 2020 2020 2020 2020  ]):..           
-00002170: 206d 6178 6465 6320 3d20 6d61 7828 5b6c   maxdec = max([l
-00002180: 656e 2828 6729 2e70 6172 7469 7469 6f6e  en((g).partition
-00002190: 2827 2e27 295b 325d 2e70 6172 7469 7469  ('.')[2].partiti
-000021a0: 6f6e 2827 6527 295b 305d 2920 666f 7220  on('e')[0]) for 
-000021b0: 6720 696e 2067 7320 6966 2027 6527 2069  g in gs if 'e' i
-000021c0: 6e20 675d 290d 0a20 2020 2020 2020 2020  n g])..         
-000021d0: 2020 2073 656c 662e 6e65 7874 5f66 6d74     self.next_fmt
-000021e0: 203d 2027 2525 2e25 6965 2720 2520 6d61   = '%%.%ie' % ma
-000021f0: 7864 6563 0d0a 2020 2020 2020 2020 656c  xdec..        el
-00002200: 6966 2067 733a 0d0a 2020 2020 2020 2020  if gs:..        
-00002210: 2020 2020 6d61 7864 6563 203d 206d 6178      maxdec = max
-00002220: 285b 6c65 6e28 2867 292e 7061 7274 6974  ([len((g).partit
-00002230: 696f 6e28 272e 2729 5b32 5d29 2066 6f72  ion('.')[2]) for
-00002240: 2067 2069 6e20 6773 5d29 0d0a 2020 2020   g in gs])..    
-00002250: 2020 2020 2020 2020 7365 6c66 2e6e 6578          self.nex
-00002260: 745f 666d 7420 3d20 2725 252e 2569 6627  t_fmt = '%%.%if'
-00002270: 2025 206d 6178 6465 630d 0a20 2020 2020   % maxdec..     
-00002280: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00002290: 2020 2020 2020 7365 6c66 2e6e 6578 745f        self.next_
-000022a0: 666d 7420 3d20 2725 6727 0d0a 2020 2020  fmt = '%g'..    
-000022b0: 2020 2020 7265 7475 726e 2076 730d 0a0d      return vs...
-000022c0: 0a0d 0a0d 0a63 6c61 7373 2059 5363 616c  .....class YScal
-000022d0: 653a 0d0a 2020 2020 6465 6620 5f5f 696e  e:..    def __in
-000022e0: 6974 5f5f 2873 656c 662c 2073 6361 6c65  it__(self, scale
-000022f0: 7479 7065 2c20 7363 616c 6566 293a 0d0a  type, scalef):..
-00002300: 2020 2020 2020 2020 7365 6c66 2e73 6361          self.sca
-00002310: 6c65 7479 7065 203d 2073 6361 6c65 7479  letype = scalety
-00002320: 7065 0d0a 2020 2020 2020 2020 7365 6c66  pe..        self
-00002330: 2e73 6574 5f73 6361 6c65 2873 6361 6c65  .set_scale(scale
-00002340: 6629 0d0a 0d0a 2020 2020 6465 6620 7365  f)....    def se
-00002350: 745f 7363 616c 6528 7365 6c66 2c20 7363  t_scale(self, sc
-00002360: 616c 6529 3a0d 0a20 2020 2020 2020 2073  ale):..        s
-00002370: 656c 662e 7363 616c 6566 203d 2073 6361  elf.scalef = sca
-00002380: 6c65 0d0a 0d0a 2020 2020 6465 6620 7866  le....    def xf
-00002390: 6f72 6d28 7365 6c66 2c20 7929 3a0d 0a20  orm(self, y):.. 
-000023a0: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
-000023b0: 6361 6c65 7479 7065 203d 3d20 276c 6f67  caletype == 'log
-000023c0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-000023d0: 7920 3d20 3130 2a2a 790d 0a20 2020 2020  y = 10**y..     
-000023e0: 2020 2079 203d 2079 202a 2073 656c 662e     y = y * self.
-000023f0: 7363 616c 6566 0d0a 2020 2020 2020 2020  scalef..        
-00002400: 7265 7475 726e 2079 0d0a 0d0a 2020 2020  return y....    
-00002410: 6465 6620 696e 7678 666f 726d 2873 656c  def invxform(sel
-00002420: 662c 2079 2c20 7665 7269 6679 3d46 616c  f, y, verify=Fal
-00002430: 7365 293a 0d0a 2020 2020 2020 2020 7920  se):..        y 
-00002440: 2f3d 2073 656c 662e 7363 616c 6566 0d0a  /= self.scalef..
-00002450: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00002460: 7363 616c 6574 7970 6520 3d3d 2027 6c6f  scaletype == 'lo
-00002470: 6727 3a0d 0a20 2020 2020 2020 2020 2020  g':..           
-00002480: 2069 6620 7665 7269 6679 2061 6e64 2079   if verify and y
-00002490: 203c 3d20 303a 0d0a 2020 2020 2020 2020   <= 0:..        
-000024a0: 2020 2020 2020 2020 7265 7475 726e 202d          return -
-000024b0: 3165 3620 2f20 7365 6c66 2e73 6361 6c65  1e6 / self.scale
-000024c0: 660d 0a20 2020 2020 2020 2020 2020 2079  f..            y
-000024d0: 203d 206e 702e 6c6f 6731 3028 7929 0d0a   = np.log10(y)..
-000024e0: 2020 2020 2020 2020 7265 7475 726e 2079          return y
-000024f0: 0d0a 0d0a 0d0a 0d0a 636c 6173 7320 5061  ........class Pa
-00002500: 6e64 6173 4461 7461 536f 7572 6365 3a0d  ndasDataSource:.
-00002510: 0a20 2020 2027 2727 4361 6e64 6c65 2073  .    '''Candle s
-00002520: 7469 636b 733a 2063 7265 6174 6520 7769  ticks: create wi
-00002530: 7468 2066 6976 6520 636f 6c75 6d6e 733a  th five columns:
-00002540: 2074 696d 652c 206f 7065 6e2c 2063 6c6f   time, open, clo
-00002550: 7365 2c20 6869 2c20 6c6f 202d 2069 6e20  se, hi, lo - in 
-00002560: 7468 6174 206f 7264 6572 2e0d 0a20 2020  that order...   
-00002570: 2020 2020 566f 6c75 6d65 2062 6172 733a      Volume bars:
-00002580: 2063 7265 6174 6520 7769 7468 2074 6872   create with thr
-00002590: 6565 2063 6f6c 756d 6e73 3a20 7469 6d65  ee columns: time
-000025a0: 2c20 6f70 656e 2c20 636c 6f73 652c 2076  , open, close, v
-000025b0: 6f6c 756d 6520 2d20 696e 2074 6861 7420  olume - in that 
-000025c0: 6f72 6465 722e 0d0a 2020 2020 2020 2046  order...       F
-000025d0: 6f72 2061 6c6c 206f 7468 6572 2074 7970  or all other typ
-000025e0: 6573 2c20 7469 6d65 206e 6565 6473 2074  es, time needs t
-000025f0: 6f20 6265 2066 6972 7374 2c20 7573 7561  o be first, usua
-00002600: 6c6c 7920 666f 6c6c 6f77 6564 2062 7920  lly followed by 
-00002610: 6f6e 6520 6f72 206d 6f72 6520 592d 636f  one or more Y-co
-00002620: 6c75 6d6e 732e 2727 270d 0a20 2020 2064  lumns.'''..    d
-00002630: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00002640: 2c20 6466 293a 0d0a 2020 2020 2020 2020  , df):..        
-00002650: 6966 2074 7970 6528 6466 2e69 6e64 6578  if type(df.index
-00002660: 2920 3d3d 2070 642e 4461 7465 7469 6d65  ) == pd.Datetime
-00002670: 496e 6465 7820 6f72 2064 662e 696e 6465  Index or df.inde
-00002680: 785b 2d31 5d3e 3165 3820 6f72 2027 2e52  x[-1]>1e8 or '.R
-00002690: 616e 6765 496e 6465 7827 206e 6f74 2069  angeIndex' not i
-000026a0: 6e20 7374 7228 7479 7065 2864 662e 696e  n str(type(df.in
-000026b0: 6465 7829 293a 0d0a 2020 2020 2020 2020  dex)):..        
-000026c0: 2020 2020 6466 203d 2064 662e 7265 7365      df = df.rese
-000026d0: 745f 696e 6465 7828 290d 0a20 2020 2020  t_index()..     
-000026e0: 2020 2073 656c 662e 6466 203d 2064 662e     self.df = df.
-000026f0: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
-00002700: 2320 6d61 6e61 6765 2074 696d 6520 636f  # manage time co
-00002710: 6c75 6d6e 0d0a 2020 2020 2020 2020 6966  lumn..        if
-00002720: 205f 6861 735f 7469 6d65 636f 6c28 7365   _has_timecol(se
-00002730: 6c66 2e64 6629 3a0d 0a20 2020 2020 2020  lf.df):..       
-00002740: 2020 2020 2074 696d 6563 6f6c 203d 2073       timecol = s
-00002750: 656c 662e 6466 2e63 6f6c 756d 6e73 5b30  elf.df.columns[0
-00002760: 5d0d 0a20 2020 2020 2020 2020 2020 2064  ]..            d
-00002770: 7479 7065 203d 2073 7472 2864 665b 7469  type = str(df[ti
-00002780: 6d65 636f 6c5d 2e64 7479 7065 290d 0a20  mecol].dtype).. 
-00002790: 2020 2020 2020 2020 2020 2069 736e 756d             isnum
-000027a0: 203d 2028 2769 6e74 2720 696e 2064 7479   = ('int' in dty
-000027b0: 7065 206f 7220 2766 6c6f 6174 2720 696e  pe or 'float' in
-000027c0: 2064 7479 7065 2920 616e 6420 6466 5b74   dtype) and df[t
-000027d0: 696d 6563 6f6c 5d2e 696c 6f63 5b2d 315d  imecol].iloc[-1]
-000027e0: 203c 2031 6537 0d0a 2020 2020 2020 2020   < 1e7..        
-000027f0: 2020 2020 6966 206e 6f74 2069 736e 756d      if not isnum
-00002800: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00002810: 2020 2073 656c 662e 6466 5b74 696d 6563     self.df[timec
-00002820: 6f6c 5d20 3d20 5f70 6474 696d 6532 6570  ol] = _pdtime2ep
-00002830: 6f63 6828 6466 5b74 696d 6563 6f6c 5d29  och(df[timecol])
-00002840: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00002850: 6c66 2e73 7461 6e64 616c 6f6e 6520 3d20  lf.standalone = 
-00002860: 5f69 735f 7374 616e 6461 6c6f 6e65 2873  _is_standalone(s
-00002870: 656c 662e 6466 5b74 696d 6563 6f6c 5d29  elf.df[timecol])
+00000590: 6561 6561 6561 270d 0a67 7269 645f 616c  eaeaea'..grid_al
+000005a0: 7068 6120 3d20 302e 320d 0a63 616e 646c  pha = 0.2..candl
+000005b0: 655f 6275 6c6c 5f63 6f6c 6f72 203d 2027  e_bull_color = '
+000005c0: 2332 3661 3639 6127 0d0a 6361 6e64 6c65  #26a69a'..candle
+000005d0: 5f62 6561 725f 636f 6c6f 7220 3d20 2723  _bear_color = '#
+000005e0: 6566 3533 3530 270d 0a63 616e 646c 655f  ef5350'..candle_
+000005f0: 6275 6c6c 5f62 6f64 795f 636f 6c6f 7220  bull_body_color 
+00000600: 3d20 6261 636b 6772 6f75 6e64 0d0a 6361  = background..ca
+00000610: 6e64 6c65 5f62 6561 725f 626f 6479 5f63  ndle_bear_body_c
+00000620: 6f6c 6f72 203d 2063 616e 646c 655f 6265  olor = candle_be
+00000630: 6172 5f63 6f6c 6f72 0d0a 6361 6e64 6c65  ar_color..candle
+00000640: 5f73 6861 646f 775f 7769 6474 6820 3d20  _shadow_width = 
+00000650: 310d 0a76 6f6c 756d 655f 6275 6c6c 5f63  1..volume_bull_c
+00000660: 6f6c 6f72 203d 2027 2339 3264 3263 6327  olor = '#92d2cc'
+00000670: 0d0a 766f 6c75 6d65 5f62 6561 725f 636f  ..volume_bear_co
+00000680: 6c6f 7220 3d20 2723 6637 6139 6137 270d  lor = '#f7a9a7'.
+00000690: 0a76 6f6c 756d 655f 6275 6c6c 5f62 6f64  .volume_bull_bod
+000006a0: 795f 636f 6c6f 7220 3d20 766f 6c75 6d65  y_color = volume
+000006b0: 5f62 756c 6c5f 636f 6c6f 720d 0a76 6f6c  _bull_color..vol
+000006c0: 756d 655f 6e65 7574 7261 6c5f 636f 6c6f  ume_neutral_colo
+000006d0: 7220 3d20 2723 6262 6227 0d0a 706f 635f  r = '#bbb'..poc_
+000006e0: 636f 6c6f 7220 3d20 2723 3030 3627 0d0a  color = '#006'..
+000006f0: 6261 6e64 5f63 6f6c 6f72 203d 2027 2364  band_color = '#d
+00000700: 3264 6665 3627 0d0a 6372 6f73 735f 6861  2dfe6'..cross_ha
+00000710: 6972 5f63 6f6c 6f72 203d 2027 2330 3030  ir_color = '#000
+00000720: 3727 0d0a 6472 6177 5f6c 696e 655f 636f  7'..draw_line_co
+00000730: 6c6f 7220 3d20 2723 3030 3027 0d0a 6472  lor = '#000'..dr
+00000740: 6177 5f64 6f6e 655f 636f 6c6f 7220 3d20  aw_done_color = 
+00000750: 2723 3535 3527 0d0a 7369 676e 6966 6963  '#555'..signific
+00000760: 616e 745f 6465 6369 6d61 6c73 203d 2038  ant_decimals = 8
+00000770: 0d0a 7369 676e 6966 6963 616e 745f 6570  ..significant_ep
+00000780: 7320 3d20 3165 2d38 0d0a 6d61 785f 6465  s = 1e-8..max_de
+00000790: 6369 6d61 6c73 203d 2031 300d 0a6d 6178  cimals = 10..max
+000007a0: 5f7a 6f6f 6d5f 706f 696e 7473 203d 2032  _zoom_points = 2
+000007b0: 3020 2320 6e75 6d62 6572 206f 6620 7669  0 # number of vi
+000007c0: 7369 626c 6520 6361 6e64 6c65 7320 7768  sible candles wh
+000007d0: 656e 206d 6178 696d 756d 207a 6f6f 6d65  en maximum zoome
+000007e0: 6420 696e 0d0a 6178 6973 5f68 6569 6768  d in..axis_heigh
+000007f0: 745f 6661 6374 6f72 203d 207b 303a 2032  t_factor = {0: 2
+00000800: 7d0d 0a63 6c61 6d70 5f67 7269 6420 3d20  }..clamp_grid = 
+00000810: 5472 7565 0d0a 7269 6768 745f 6d61 7267  True..right_marg
+00000820: 696e 5f63 616e 646c 6573 203d 2035 2023  in_candles = 5 #
+00000830: 2077 6869 7465 7370 6163 6520 6174 2074   whitespace at t
+00000840: 6865 2072 6967 6874 2d68 616e 6420 7369  he right-hand si
+00000850: 6465 0d0a 7369 6465 5f6d 6172 6769 6e20  de..side_margin 
+00000860: 3d20 302e 350d 0a6c 6f64 5f63 616e 646c  = 0.5..lod_candl
+00000870: 6573 203d 2033 3030 300d 0a6c 6f64 5f6c  es = 3000..lod_l
+00000880: 6162 656c 7320 3d20 3730 300d 0a63 6163  abels = 700..cac
+00000890: 6865 5f63 616e 646c 655f 6661 6374 6f72  he_candle_factor
+000008a0: 203d 2033 2023 2066 6163 746f 7220 6578   = 3 # factor ex
+000008b0: 7472 6120 6361 6e64 6c65 7320 7265 6e64  tra candles rend
+000008c0: 6572 6564 2074 6f20 6275 6666 6572 0d0a  ered to buffer..
+000008d0: 795f 7061 6420 3d20 302e 3033 2023 2033  y_pad = 0.03 # 3
+000008e0: 2520 7061 6464 696e 6720 6174 2074 6f70  % padding at top
+000008f0: 2061 6e64 2062 6f74 746f 6d20 6f66 2061   and bottom of a
+00000900: 7574 6f7a 6f6f 6d20 706c 6f74 730d 0a79  utozoom plots..y
+00000910: 5f6c 6162 656c 5f77 6964 7468 203d 2036  _label_width = 6
+00000920: 350d 0a74 696d 6573 7461 6d70 5f66 6f72  5..timestamp_for
+00000930: 6d61 7420 3d20 2725 592d 256d 2d25 6420  mat = '%Y-%m-%d 
+00000940: 2548 3a25 4d3a 2553 2e25 6627 0d0a 6469  %H:%M:%S.%f'..di
+00000950: 7370 6c61 795f 7469 6d65 7a6f 6e65 203d  splay_timezone =
+00000960: 2074 7a6c 6f63 616c 2829 2023 2064 6566   tzlocal() # def
+00000970: 6175 6c74 2074 6f20 6c6f 6361 6c0d 0a74  ault to local..t
+00000980: 7275 6e63 6174 655f 7469 6d65 7374 616d  runcate_timestam
+00000990: 7020 3d20 5472 7565 0d0a 7769 6e78 2c77  p = True..winx,w
+000009a0: 696e 792c 7769 6e77 2c77 696e 6820 3d20  iny,winw,winh = 
+000009b0: 3330 302c 3135 302c 3830 302c 3430 300d  300,150,800,400.
+000009c0: 0a77 696e 5f72 6563 7265 6174 655f 6465  .win_recreate_de
+000009d0: 6c74 6120 3d20 3330 0d0a 6c6f 675f 706c  lta = 30..log_pl
+000009e0: 6f74 5f6f 6666 7365 7420 3d20 2d32 2e32  ot_offset = -2.2
+000009f0: 3232 3232 3232 652d 3136 2023 2049 2063  222222e-16 # I c
+00000a00: 6f75 6c64 2066 696c 6520 6120 6275 6720  ould file a bug 
+00000a10: 7265 706f 7274 2c20 7072 6f62 6162 6c79  report, probably
+00000a20: 2069 6e20 5079 5174 2c20 6275 7420 7468   in PyQt, but th
+00000a30: 6973 2069 7320 6d6f 7265 2066 756e 0d0a  is is more fun..
+00000a40: 2320 666f 726d 6174 3a20 6d6f 6465 2c20  # format: mode, 
+00000a50: 6d69 6e2d 6475 7261 7469 6f6e 2c20 7064  min-duration, pd
+00000a60: 2d66 7265 712d 666d 742c 2074 6963 6b2d  -freq-fmt, tick-
+00000a70: 7374 722d 6c65 6e0d 0a74 696d 655f 7370  str-len..time_sp
+00000a80: 6c69 7473 203d 205b 2827 7965 6172 7327  lits = [('years'
+00000a90: 2c20 322a 3336 352a 3234 2a36 302a 3630  , 2*365*24*60*60
+00000aa0: 2c20 2020 2027 5953 272c 2020 3429 2c20  ,    'YS',  4), 
+00000ab0: 2827 6d6f 6e74 6873 272c 2033 2a33 302a  ('months', 3*30*
+00000ac0: 3234 2a36 302a 3630 2c20 2020 274d 5327  24*60*60,   'MS'
+00000ad0: 2c20 3130 292c 2028 2777 6565 6b73 272c  , 10), ('weeks',
+00000ae0: 2020 2033 2a37 2a32 342a 3630 2a36 302c     3*7*24*60*60,
+00000af0: 2027 572d 4d4f 4e27 2c20 3130 292c 0d0a   'W-MON', 10),..
+00000b00: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00000b10: 2764 6179 7327 2c20 2020 2020 2033 2a32  'days',      3*2
+00000b20: 342a 3630 2a36 302c 2020 2020 2027 4427  4*60*60,     'D'
+00000b30: 2c20 3130 292c 2028 2768 6f75 7273 272c  , 10), ('hours',
+00000b40: 2020 2020 2020 2020 392a 3630 2a36 302c          9*60*60,
+00000b50: 2020 2027 3368 272c 2031 3629 2c20 2827     '3h', 16), ('
+00000b60: 686f 7572 7327 2c20 2020 2020 2020 2033  hours',        3
+00000b70: 2a36 302a 3630 2c20 2020 2020 2768 272c  *60*60,     'h',
+00000b80: 2031 3629 2c0d 0a20 2020 2020 2020 2020   16),..         
+00000b90: 2020 2020 2020 2827 6d69 6e75 7465 7327        ('minutes'
+00000ba0: 2c20 2020 2020 2020 2034 352a 3630 2c20  ,        45*60, 
+00000bb0: 2731 356d 696e 272c 2031 3629 2c20 2827  '15min', 16), ('
+00000bc0: 6d69 6e75 7465 7327 2c20 2020 2020 2020  minutes',       
+00000bd0: 2031 352a 3630 2c20 2735 6d69 6e27 2c20   15*60, '5min', 
+00000be0: 3136 292c 2028 276d 696e 7574 6573 272c  16), ('minutes',
+00000bf0: 2020 2020 2020 2020 2033 2a36 302c 2020           3*60,  
+00000c00: 2027 6d69 6e27 2c20 3136 292c 0d0a 2020   'min', 16),..  
+00000c10: 2020 2020 2020 2020 2020 2020 2028 2773               ('s
+00000c20: 6563 6f6e 6473 272c 2020 2020 2020 2020  econds',        
+00000c30: 2020 2034 352c 2020 2027 3135 7327 2c20     45,   '15s', 
+00000c40: 3139 292c 2028 2773 6563 6f6e 6473 272c  19), ('seconds',
+00000c50: 2020 2020 2020 2020 2020 2031 352c 2020             15,  
+00000c60: 2027 3573 272c 2031 3929 2c20 2827 7365   '5s', 19), ('se
+00000c70: 636f 6e64 7327 2c20 2020 2020 2020 2020  conds',         
+00000c80: 2020 2033 2c20 2020 2020 2773 272c 2031     3,     's', 1
+00000c90: 3929 2c0d 0a20 2020 2020 2020 2020 2020  9),..           
+00000ca0: 2020 2020 2827 6d69 6c6c 6973 6563 6f6e      ('millisecon
+00000cb0: 6473 272c 2020 2020 2020 2030 2c20 2020  ds',       0,   
+00000cc0: 2027 6d73 272c 2032 3329 5d0d 0a0d 0a61   'ms', 23)]....a
+00000cd0: 7070 203d 204e 6f6e 650d 0a77 696e 646f  pp = None..windo
+00000ce0: 7773 203d 205b 5d20 2320 6e6f 2067 630d  ws = [] # no gc.
+00000cf0: 0a74 696d 6572 7320 3d20 5b5d 2023 206e  .timers = [] # n
+00000d00: 6f20 6763 0d0a 736f 756e 6473 203d 207b  o gc..sounds = {
+00000d10: 7d20 2320 6e6f 2067 630d 0a65 706f 6368  } # no gc..epoch
+00000d20: 5f70 6572 696f 6420 3d20 3165 3330 0d0a  _period = 1e30..
+00000d30: 6c61 7374 5f61 7820 3d20 4e6f 6e65 2023  last_ax = None #
+00000d40: 2061 6c77 6179 7320 6173 7375 6d65 2077   always assume w
+00000d50: 6520 7761 6e74 2074 6f20 706c 6f74 2069  e want to plot i
+00000d60: 6e20 7468 6520 6c61 7374 2061 7869 732c  n the last axis,
+00000d70: 2075 6e6c 6573 7320 6578 706c 6963 6974   unless explicit
+00000d80: 6c79 2073 7065 6369 6669 6564 0d0a 6f76  ly specified..ov
+00000d90: 6572 6c61 795f 6178 7320 3d20 5b5d 2023  erlay_axs = [] #
+00000da0: 2066 6f72 206b 6565 7069 6e67 2074 7261   for keeping tra
+00000db0: 636b 206f 6620 6361 6e64 6c65 7374 6963  ck of candlestic
+00000dc0: 6b73 2069 6e20 6f76 6572 6c61 7973 0d0a  ks in overlays..
+00000dd0: 7669 6577 7265 7374 6f72 6520 3d20 4661  viewrestore = Fa
+00000de0: 6c73 650d 0a6b 6579 5f65 7363 5f63 6c6f  lse..key_esc_clo
+00000df0: 7365 203d 2054 7275 6520 2320 4553 4320  se = True # ESC 
+00000e00: 6b65 7920 636c 6f73 6573 2077 696e 646f  key closes windo
+00000e10: 770d 0a6d 6173 7465 725f 6461 7461 203d  w..master_data =
+00000e20: 207b 7d0d 0a0d 0a0d 0a0d 0a6c 6572 7020   {}........lerp 
+00000e30: 3d20 6c61 6d62 6461 2074 2c61 2c62 3a20  = lambda t,a,b: 
+00000e40: 742a 622b 2831 2d74 292a 610d 0a0d 0a0d  t*b+(1-t)*a.....
+00000e50: 0a0d 0a63 6c61 7373 2045 706f 6368 4178  ...class EpochAx
+00000e60: 6973 4974 656d 2870 672e 4178 6973 4974  isItem(pg.AxisIt
+00000e70: 656d 293a 0d0a 2020 2020 6465 6620 5f5f  em):..    def __
+00000e80: 696e 6974 5f5f 2873 656c 662c 2076 622c  init__(self, vb,
+00000e90: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+00000ea0: 293a 0d0a 2020 2020 2020 2020 7375 7065  ):..        supe
+00000eb0: 7228 292e 5f5f 696e 6974 5f5f 282a 6172  r().__init__(*ar
+00000ec0: 6773 2c20 2a2a 6b77 6172 6773 290d 0a20  gs, **kwargs).. 
+00000ed0: 2020 2020 2020 2073 656c 662e 7662 203d         self.vb =
+00000ee0: 2076 620d 0a0d 0a20 2020 2064 6566 2074   vb....    def t
+00000ef0: 6963 6b53 7472 696e 6773 2873 656c 662c  ickStrings(self,
+00000f00: 2076 616c 7565 732c 2073 6361 6c65 2c20   values, scale, 
+00000f10: 7370 6163 696e 6729 3a0d 0a20 2020 2020  spacing):..     
+00000f20: 2020 2069 6620 7365 6c66 2e6d 6f64 6520     if self.mode 
+00000f30: 3d3d 2027 6e75 6d27 3a0d 0a20 2020 2020  == 'num':..     
+00000f40: 2020 2020 2020 2072 6574 7572 6e20 5b27         return ['
+00000f50: 2567 2725 7620 666f 7220 7620 696e 2076  %g'%v for v in v
+00000f60: 616c 7565 735d 0d0a 2020 2020 2020 2020  alues]..        
+00000f70: 636f 6e76 203d 205f 7832 7965 6172 2069  conv = _x2year i
+00000f80: 6620 7365 6c66 2e6d 6f64 653d 3d27 7965  f self.mode=='ye
+00000f90: 6172 7327 2065 6c73 6520 5f78 326c 6f63  ars' else _x2loc
+00000fa0: 616c 5f74 0d0a 2020 2020 2020 2020 7374  al_t..        st
+00000fb0: 7273 203d 205b 636f 6e76 2873 656c 662e  rs = [conv(self.
+00000fc0: 7662 2e64 6174 6173 7263 2c20 7661 6c75  vb.datasrc, valu
+00000fd0: 6529 5b30 5d20 666f 7220 7661 6c75 6520  e)[0] for value 
+00000fe0: 696e 2076 616c 7565 735d 0d0a 2020 2020  in values]..    
+00000ff0: 2020 2020 6966 2061 6c6c 285f 6973 5f73      if all(_is_s
+00001000: 7472 5f6d 6964 6e69 6768 7428 7329 2066  tr_midnight(s) f
+00001010: 6f72 2073 2069 6e20 7374 7273 2069 6620  or s in strs if 
+00001020: 7329 3a20 2320 616c 6c20 6174 206d 6964  s): # all at mid
+00001030: 6e69 6768 7420 2d3e 2072 6f75 6e64 2074  night -> round t
+00001040: 6f20 6461 7973 0d0a 2020 2020 2020 2020  o days..        
+00001050: 2020 2020 7374 7273 203d 205b 732e 7061      strs = [s.pa
+00001060: 7274 6974 696f 6e28 2720 2729 5b30 5d20  rtition(' ')[0] 
+00001070: 666f 7220 7320 696e 2073 7472 735d 0d0a  for s in strs]..
+00001080: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00001090: 7472 730d 0a0d 0a20 2020 2064 6566 2074  trs....    def t
+000010a0: 6963 6b56 616c 7565 7328 7365 6c66 2c20  ickValues(self, 
+000010b0: 6d69 6e56 616c 2c20 6d61 7856 616c 2c20  minVal, maxVal, 
+000010c0: 7369 7a65 293a 0d0a 2020 2020 2020 2020  size):..        
+000010d0: 7365 6c66 2e6d 6f64 6520 3d20 276e 756d  self.mode = 'num
+000010e0: 270d 0a20 2020 2020 2020 2061 7820 3d20  '..        ax = 
+000010f0: 7365 6c66 2e76 622e 7061 7265 6e74 2829  self.vb.parent()
+00001100: 0d0a 2020 2020 2020 2020 6461 7461 7372  ..        datasr
+00001110: 6320 3d20 5f67 6574 5f64 6174 6173 7263  c = _get_datasrc
+00001120: 2861 782c 2072 6571 7569 7265 3d46 616c  (ax, require=Fal
+00001130: 7365 290d 0a20 2020 2020 2020 2069 6620  se)..        if 
+00001140: 6461 7461 7372 6320 6973 204e 6f6e 6520  datasrc is None 
+00001150: 6f72 206e 6f74 2073 656c 662e 7662 2e78  or not self.vb.x
+00001160: 5f69 6e64 6578 6564 3a0d 0a20 2020 2020  _indexed:..     
+00001170: 2020 2020 2020 2072 6574 7572 6e20 7375         return su
+00001180: 7065 7228 292e 7469 636b 5661 6c75 6573  per().tickValues
+00001190: 286d 696e 5661 6c2c 206d 6178 5661 6c2c  (minVal, maxVal,
+000011a0: 2073 697a 6529 0d0a 2020 2020 2020 2020   size)..        
+000011b0: 2320 6361 6c63 756c 6174 6520 6966 2077  # calculate if w
+000011c0: 6520 7573 6520 7965 6172 732c 2064 6179  e use years, day
+000011d0: 732c 2065 7463 2e0d 0a20 2020 2020 2020  s, etc...       
+000011e0: 2074 302c 7431 2c5f 2c5f 2c5f 203d 2064   t0,t1,_,_,_ = d
+000011f0: 6174 6173 7263 2e68 696c 6f28 6d69 6e56  atasrc.hilo(minV
+00001200: 616c 2c20 6d61 7856 616c 290d 0a20 2020  al, maxVal)..   
+00001210: 2020 2020 2074 302c 7431 203d 2070 642e       t0,t1 = pd.
+00001220: 746f 5f64 6174 6574 696d 6528 7430 292c  to_datetime(t0),
+00001230: 2070 642e 746f 5f64 6174 6574 696d 6528   pd.to_datetime(
+00001240: 7431 290d 0a20 2020 2020 2020 2064 7473  t1)..        dts
+00001250: 203d 2028 7431 2d74 3029 2e74 6f74 616c   = (t1-t0).total
+00001260: 5f73 6563 6f6e 6473 2829 0d0a 2020 2020  _seconds()..    
+00001270: 2020 2020 6766 785f 7769 6474 6820 3d20      gfx_width = 
+00001280: 696e 7428 7369 7a65 290d 0a20 2020 2020  int(size)..     
+00001290: 2020 2066 6f72 206d 6f64 652c 2064 7474     for mode, dtt
+000012a0: 2c20 6672 6571 2c20 7469 636b 6c65 6e20  , freq, ticklen 
+000012b0: 696e 2074 696d 655f 7370 6c69 7473 3a0d  in time_splits:.
+000012c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000012d0: 6474 7320 3e20 6474 743a 0d0a 2020 2020  dts > dtt:..    
+000012e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000012f0: 2e6d 6f64 6520 3d20 6d6f 6465 0d0a 2020  .mode = mode..  
+00001300: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00001310: 7369 7265 645f 7469 636b 7320 3d20 6766  sired_ticks = gf
+00001320: 785f 7769 6474 6820 2f20 2828 7469 636b  x_width / ((tick
+00001330: 6c65 6e2b 3229 202a 2031 3029 202d 2031  len+2) * 10) - 1
+00001340: 2023 2061 6e20 6170 7072 6f78 696d 6174   # an approximat
+00001350: 696f 6e20 6973 2066 696e 650d 0a20 2020  ion is fine..   
+00001360: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00001370: 7365 6c66 2e76 622e 6461 7461 7372 6320  self.vb.datasrc 
+00001380: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00001390: 6e6f 7420 7365 6c66 2e76 622e 6461 7461  not self.vb.data
+000013a0: 7372 632e 6973 5f73 6d6f 6f74 685f 7469  src.is_smooth_ti
+000013b0: 6d65 2829 3a0d 0a20 2020 2020 2020 2020  me():..         
+000013c0: 2020 2020 2020 2020 2020 2064 6573 6972             desir
+000013d0: 6564 5f74 6963 6b73 202d 3d20 3120 2320  ed_ticks -= 1 # 
+000013e0: 6c65 6176 6520 6d6f 7265 2073 7061 6365  leave more space
+000013f0: 2066 6f72 2075 6e65 7665 6e6c 7920 7370   for unevenly sp
+00001400: 6163 6564 2074 6963 6b73 0d0a 2020 2020  aced ticks..    
+00001410: 2020 2020 2020 2020 2020 2020 6465 7369              desi
+00001420: 7265 645f 7469 636b 7320 3d20 6d61 7828  red_ticks = max(
+00001430: 6465 7369 7265 645f 7469 636b 732c 2034  desired_ticks, 4
+00001440: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00001450: 2020 2074 6f5f 6d69 646e 6967 6874 203d     to_midnight =
+00001460: 2066 7265 7120 696e 2028 2759 5327 2c20   freq in ('YS', 
+00001470: 274d 5327 2c20 2757 2d4d 4f4e 272c 2027  'MS', 'W-MON', '
+00001480: 4427 290d 0a20 2020 2020 2020 2020 2020  D')..           
+00001490: 2020 2020 2074 7a20 3d20 6469 7370 6c61       tz = displa
+000014a0: 795f 7469 6d65 7a6f 6e65 2069 6620 746f  y_timezone if to
+000014b0: 5f6d 6964 6e69 6768 7420 656c 7365 204e  _midnight else N
+000014c0: 6f6e 6520 2320 666f 7220 7368 6f72 7465  one # for shorte
+000014d0: 7220 7469 6d65 6672 616d 6573 2c20 7469  r timeframes, ti
+000014e0: 6d65 7a6f 6e65 2073 6565 6d73 2062 7567  mezone seems bug
+000014f0: 6779 0d0a 2020 2020 2020 2020 2020 2020  gy..            
+00001500: 2020 2020 726e 6720 3d20 7064 2e64 6174      rng = pd.dat
+00001510: 655f 7261 6e67 6528 7430 2c20 7431 2c20  e_range(t0, t1, 
+00001520: 747a 3d74 7a2c 206e 6f72 6d61 6c69 7a65  tz=tz, normalize
+00001530: 3d74 6f5f 6d69 646e 6967 6874 2c20 6672  =to_midnight, fr
+00001540: 6571 3d66 7265 7129 0d0a 2020 2020 2020  eq=freq)..      
+00001550: 2020 2020 2020 2020 2020 7374 6570 7320            steps 
+00001560: 3d20 6c65 6e28 726e 6729 2069 6620 6c65  = len(rng) if le
+00001570: 6e28 726e 6729 2631 3d3d 3020 656c 7365  n(rng)&1==0 else
+00001580: 206c 656e 2872 6e67 292b 3120 2320 7265   len(rng)+1 # re
+00001590: 6475 6365 206a 6974 7465 7220 6265 7477  duce jitter betw
+000015a0: 6565 6e20 652e 672e 2035 3c2d 2d3e 3130  een e.g. 5<-->10
+000015b0: 2074 6963 6b73 2066 6f72 2072 6573 6f6c   ticks for resol
+000015c0: 7574 696f 6e20 636c 6f73 6520 746f 206c  ution close to l
+000015d0: 696d 6974 0d0a 2020 2020 2020 2020 2020  imit..          
+000015e0: 2020 2020 2020 7374 6570 203d 2069 6e74        step = int
+000015f0: 2873 7465 7073 2f64 6573 6972 6564 5f74  (steps/desired_t
+00001600: 6963 6b73 2920 6f72 2031 0d0a 2020 2020  icks) or 1..    
+00001610: 2020 2020 2020 2020 2020 2020 726e 6720              rng 
+00001620: 3d20 726e 675b 3a3a 7374 6570 5d0d 0a20  = rng[::step].. 
+00001630: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00001640: 6620 6e6f 7420 746f 5f6d 6964 6e69 6768  f not to_midnigh
+00001650: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00001660: 2020 2020 2020 2020 7472 793a 2020 2020          try:    
+00001670: 726e 6720 3d20 726e 672e 726f 756e 6428  rng = rng.round(
+00001680: 6672 6571 3d66 7265 7129 0d0a 2020 2020  freq=freq)..    
+00001690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016a0: 6578 6365 7074 3a20 7061 7373 0d0a 2020  except: pass..  
+000016b0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+000016c0: 203d 2073 656c 662e 7662 2e70 6172 656e   = self.vb.paren
+000016d0: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
+000016e0: 2020 2020 2072 6e67 203d 205f 7064 7469       rng = _pdti
+000016f0: 6d65 3269 6e64 6578 2861 783d 6178 2c20  me2index(ax=ax, 
+00001700: 7473 3d70 642e 5365 7269 6573 2872 6e67  ts=pd.Series(rng
+00001710: 292c 2072 6571 7569 7265 5f74 696d 653d  ), require_time=
+00001720: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+00001730: 2020 2020 2020 2069 6e64 6963 6573 203d         indices =
+00001740: 205b 6365 696c 2869 2920 666f 7220 6920   [ceil(i) for i 
+00001750: 696e 2072 6e67 2069 6620 693e 2d31 6532  in rng if i>-1e2
+00001760: 3030 5d0d 0a20 2020 2020 2020 2020 2020  00]..           
+00001770: 2020 2020 2072 6574 7572 6e20 5b28 302c       return [(0,
+00001780: 2069 6e64 6963 6573 295d 0d0a 2020 2020   indices)]..    
+00001790: 2020 2020 7265 7475 726e 205b 2830 2c5b      return [(0,[
+000017a0: 5d29 5d0d 0a0d 0a20 2020 2064 6566 2067  ])]....    def g
+000017b0: 656e 6572 6174 6544 7261 7753 7065 6373  enerateDrawSpecs
+000017c0: 2873 656c 662c 2070 293a 0d0a 2020 2020  (self, p):..    
+000017d0: 2020 2020 7370 6563 7320 3d20 7375 7065      specs = supe
+000017e0: 7228 292e 6765 6e65 7261 7465 4472 6177  r().generateDraw
+000017f0: 5370 6563 7328 7029 0d0a 2020 2020 2020  Specs(p)..      
+00001800: 2020 6966 2073 7065 6373 3a0d 0a20 2020    if specs:..   
+00001810: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00001820: 7365 6c66 2e73 7479 6c65 5b27 7368 6f77  self.style['show
+00001830: 5661 6c75 6573 275d 3a0d 0a20 2020 2020  Values']:..     
+00001840: 2020 2020 2020 2020 2020 2070 656e 2c70             pen,p
+00001850: 302c 7031 203d 2073 7065 6373 5b30 5d20  0,p1 = specs[0] 
+00001860: 2320 6178 6973 2073 7065 6373 0d0a 2020  # axis specs..  
+00001870: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+00001880: 6563 7320 3d20 5b28 5f6d 616b 6570 656e  ecs = [(_makepen
+00001890: 2827 2366 6666 3027 292c 7030 2c70 3129  ('#fff0'),p0,p1)
+000018a0: 5d20 2b20 6c69 7374 2873 7065 6373 5b31  ] + list(specs[1
+000018b0: 3a5d 2920 2320 646f 6e27 7420 6472 6177  :]) # don't draw
+000018c0: 2061 7869 7320 6966 2068 6964 696e 6720   axis if hiding 
+000018d0: 7661 6c75 6573 0d0a 2020 2020 2020 2020  values..        
+000018e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000018f0: 2020 2020 2020 2020 2020 2023 2074 6872             # thr
+00001900: 6f77 206f 7574 2074 6963 6b73 2074 6861  ow out ticks tha
+00001910: 7420 6172 6520 6f75 7420 6f66 2062 6f75  t are out of bou
+00001920: 6e64 730d 0a20 2020 2020 2020 2020 2020  nds..           
+00001930: 2020 2020 2074 6578 745f 7370 6563 7320       text_specs 
+00001940: 3d20 7370 6563 735b 325d 0d0a 2020 2020  = specs[2]..    
+00001950: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00001960: 656e 2874 6578 745f 7370 6563 7329 203e  en(text_specs) >
+00001970: 3d20 343a 0d0a 2020 2020 2020 2020 2020  = 4:..          
+00001980: 2020 2020 2020 2020 2020 7265 6374 2c66            rect,f
+00001990: 6c61 6773 2c74 6578 7420 3d20 7465 7874  lags,text = text
+000019a0: 5f73 7065 6373 5b30 5d0d 0a20 2020 2020  _specs[0]..     
+000019b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000019c0: 6620 7265 6374 2e6c 6566 7428 2920 3c20  f rect.left() < 
+000019d0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+000019e0: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+000019f0: 7465 7874 5f73 7065 6373 5b30 5d0d 0a20  text_specs[0].. 
+00001a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001a10: 2020 2072 6563 742c 666c 6167 732c 7465     rect,flags,te
+00001a20: 7874 203d 2074 6578 745f 7370 6563 735b  xt = text_specs[
+00001a30: 2d31 5d0d 0a20 2020 2020 2020 2020 2020  -1]..           
+00001a40: 2020 2020 2020 2020 2069 6620 7265 6374           if rect
+00001a50: 2e72 6967 6874 2829 203e 2073 656c 662e  .right() > self.
+00001a60: 6765 6f6d 6574 7279 2829 2e77 6964 7468  geometry().width
+00001a70: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+00001a80: 2020 2020 2020 2020 2020 2020 2064 656c               del
+00001a90: 2074 6578 745f 7370 6563 735b 2d31 5d0d   text_specs[-1].
+00001aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001ab0: 2023 202e 2e2e 2061 6e64 2074 686f 7365   # ... and those
+00001ac0: 2074 6861 7420 6f76 6572 6c61 700d 0a20   that overlap.. 
+00001ad0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00001ae0: 203d 2031 6536 0d0a 2020 2020 2020 2020   = 1e6..        
+00001af0: 2020 2020 2020 2020 666f 7220 692c 2872          for i,(r
+00001b00: 6563 742c 666c 6167 732c 7465 7874 2920  ect,flags,text) 
+00001b10: 696e 2072 6576 6572 7365 6428 6c69 7374  in reversed(list
+00001b20: 2865 6e75 6d65 7261 7465 2874 6578 745f  (enumerate(text_
+00001b30: 7370 6563 7329 2929 3a0d 0a20 2020 2020  specs))):..     
+00001b40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00001b50: 6620 7265 6374 2e72 6967 6874 2829 203e  f rect.right() >
+00001b60: 3d20 783a 0d0a 2020 2020 2020 2020 2020  = x:..          
+00001b70: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00001b80: 6c20 7465 7874 5f73 7065 6373 5b69 5d0d  l text_specs[i].
+00001b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001ba0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00001bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001bc0: 2020 2020 7820 3d20 7265 6374 2e6c 6566      x = rect.lef
+00001bd0: 7428 290d 0a20 2020 2020 2020 2072 6574  t()..        ret
+00001be0: 7572 6e20 7370 6563 730d 0a0d 0a0d 0a0d  urn specs.......
+00001bf0: 0a63 6c61 7373 2059 4178 6973 4974 656d  .class YAxisItem
+00001c00: 2870 672e 4178 6973 4974 656d 293a 0d0a  (pg.AxisItem):..
+00001c10: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00001c20: 2873 656c 662c 2076 622c 202a 6172 6773  (self, vb, *args
+00001c30: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00001c40: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
+00001c50: 696e 6974 5f5f 282a 6172 6773 2c20 2a2a  init__(*args, **
+00001c60: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
+00001c70: 2073 656c 662e 7662 203d 2076 620d 0a20   self.vb = vb.. 
+00001c80: 2020 2020 2020 2073 656c 662e 6869 6465         self.hide
+00001c90: 5f73 7472 696e 6773 203d 2046 616c 7365  _strings = False
+00001ca0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00001cb0: 7479 6c65 5b27 6175 746f 4578 7061 6e64  tyle['autoExpand
+00001cc0: 5465 7874 5370 6163 6527 5d20 3d20 4661  TextSpace'] = Fa
+00001cd0: 6c73 650d 0a20 2020 2020 2020 2073 656c  lse..        sel
+00001ce0: 662e 7374 796c 655b 2761 7574 6f52 6564  f.style['autoRed
+00001cf0: 7563 6554 6578 7453 7061 6365 275d 203d  uceTextSpace'] =
+00001d00: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00001d10: 7365 6c66 2e6e 6578 745f 666d 7420 3d20  self.next_fmt = 
+00001d20: 2725 6727 0d0a 0d0a 2020 2020 6465 6620  '%g'....    def 
+00001d30: 7469 636b 5661 6c75 6573 2873 656c 662c  tickValues(self,
+00001d40: 206d 696e 5661 6c2c 206d 6178 5661 6c2c   minVal, maxVal,
+00001d50: 2073 697a 6529 3a0d 0a20 2020 2020 2020   size):..       
+00001d60: 2076 7320 3d20 7375 7065 7228 292e 7469   vs = super().ti
+00001d70: 636b 5661 6c75 6573 286d 696e 5661 6c2c  ckValues(minVal,
+00001d80: 206d 6178 5661 6c2c 2073 697a 6529 0d0a   maxVal, size)..
+00001d90: 2020 2020 2020 2020 6966 206c 656e 2876          if len(v
+00001da0: 7329 203c 2033 3a0d 0a20 2020 2020 2020  s) < 3:..       
+00001db0: 2020 2020 2072 6574 7572 6e20 7673 0d0a       return vs..
+00001dc0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00001dd0: 656c 662e 666d 745f 7661 6c75 6573 2876  elf.fmt_values(v
+00001de0: 7329 0d0a 0d0a 2020 2020 6465 6620 6c6f  s)....    def lo
+00001df0: 6754 6963 6b56 616c 7565 7328 7365 6c66  gTickValues(self
+00001e00: 2c20 6d69 6e56 616c 2c20 6d61 7856 616c  , minVal, maxVal
+00001e10: 2c20 7369 7a65 2c20 7374 6454 6963 6b73  , size, stdTicks
+00001e20: 293a 0d0a 2020 2020 2020 2020 7631 203d  ):..        v1 =
+00001e30: 2069 6e74 2866 6c6f 6f72 286d 696e 5661   int(floor(minVa
+00001e40: 6c29 290d 0a20 2020 2020 2020 2076 3220  l))..        v2 
+00001e50: 3d20 696e 7428 6365 696c 286d 6178 5661  = int(ceil(maxVa
+00001e60: 6c29 290d 0a20 2020 2020 2020 206d 696e  l))..        min
+00001e70: 6f72 203d 205b 5d0d 0a20 2020 2020 2020  or = []..       
+00001e80: 2066 6f72 2076 2069 6e20 7261 6e67 6528   for v in range(
+00001e90: 7631 2c20 7632 293a 0d0a 2020 2020 2020  v1, v2):..      
+00001ea0: 2020 2020 2020 6d69 6e6f 722e 6578 7465        minor.exte
+00001eb0: 6e64 285b 762b 6c20 666f 7220 6c20 696e  nd([v+l for l in
+00001ec0: 206e 702e 6c6f 6731 3028 6e70 2e6c 696e   np.log10(np.lin
+00001ed0: 7370 6163 6528 312c 2039 2e39 2c20 3930  space(1, 9.9, 90
+00001ee0: 2929 5d29 0d0a 2020 2020 2020 2020 6d69  ))])..        mi
+00001ef0: 6e6f 7220 3d20 5b78 2066 6f72 2078 2069  nor = [x for x i
+00001f00: 6e20 6d69 6e6f 7220 6966 2078 3e6d 696e  n minor if x>min
+00001f10: 5661 6c20 616e 6420 783c 6d61 7856 616c  Val and x<maxVal
+00001f20: 5d0d 0a20 2020 2020 2020 2069 6620 6e6f  ]..        if no
+00001f30: 7420 6d69 6e6f 723a 0d0a 2020 2020 2020  t minor:..      
+00001f40: 2020 2020 2020 6d69 6e6f 722e 6578 7465        minor.exte
+00001f50: 6e64 286e 702e 6765 6f6d 7370 6163 6528  nd(np.geomspace(
+00001f60: 6d69 6e56 616c 2c20 6d61 7856 616c 2c20  minVal, maxVal, 
+00001f70: 3729 5b31 3a2d 315d 290d 0a20 2020 2020  7)[1:-1])..     
+00001f80: 2020 2069 6620 6c65 6e28 6d69 6e6f 7229     if len(minor)
+00001f90: 203e 2031 303a 0d0a 2020 2020 2020 2020   > 10:..        
+00001fa0: 2020 2020 6d69 6e6f 7220 3d20 6d69 6e6f      minor = mino
+00001fb0: 725b 3a3a 6c65 6e28 6d69 6e6f 7229 2f2f  r[::len(minor)//
+00001fc0: 355d 0d0a 2020 2020 2020 2020 7673 203d  5]..        vs =
+00001fd0: 205b 284e 6f6e 652c 206d 696e 6f72 295d   [(None, minor)]
+00001fe0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00001ff0: 2073 656c 662e 666d 745f 7661 6c75 6573   self.fmt_values
+00002000: 2876 7329 0d0a 0d0a 2020 2020 6465 6620  (vs)....    def 
+00002010: 7469 636b 5374 7269 6e67 7328 7365 6c66  tickStrings(self
+00002020: 2c20 7661 6c75 6573 2c20 7363 616c 652c  , values, scale,
+00002030: 2073 7061 6369 6e67 293a 0d0a 2020 2020   spacing):..    
+00002040: 2020 2020 6966 2073 656c 662e 6869 6465      if self.hide
+00002050: 5f73 7472 696e 6773 3a0d 0a20 2020 2020  _strings:..     
+00002060: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
+00002070: 0d0a 2020 2020 2020 2020 7866 6f72 6d20  ..        xform 
+00002080: 3d20 7365 6c66 2e76 622e 7973 6361 6c65  = self.vb.yscale
+00002090: 2e78 666f 726d 0d0a 2020 2020 2020 2020  .xform..        
+000020a0: 7265 7475 726e 205b 7365 6c66 2e6e 6578  return [self.nex
+000020b0: 745f 666d 7425 7866 6f72 6d28 7661 6c75  t_fmt%xform(valu
+000020c0: 6529 2066 6f72 2076 616c 7565 2069 6e20  e) for value in 
+000020d0: 7661 6c75 6573 5d0d 0a0d 0a20 2020 2064  values]....    d
+000020e0: 6566 2066 6d74 5f76 616c 7565 7328 7365  ef fmt_values(se
+000020f0: 6c66 2c20 7673 293a 0d0a 2020 2020 2020  lf, vs):..      
+00002100: 2020 7866 6f72 6d20 3d20 7365 6c66 2e76    xform = self.v
+00002110: 622e 7973 6361 6c65 2e78 666f 726d 0d0a  b.yscale.xform..
+00002120: 2020 2020 2020 2020 6773 203d 205b 2725          gs = ['%
+00002130: 6727 2578 666f 726d 2876 2920 666f 7220  g'%xform(v) for 
+00002140: 7620 696e 2076 735b 2d31 5d5b 315d 5d0d  v in vs[-1][1]].
+00002150: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00002160: 6773 3a0d 0a20 2020 2020 2020 2020 2020  gs:..           
+00002170: 2072 6574 7572 6e20 7673 0d0a 2020 2020   return vs..    
+00002180: 2020 2020 6966 2061 6e79 285b 2765 2720      if any(['e' 
+00002190: 696e 2067 2066 6f72 2067 2069 6e20 6773  in g for g in gs
+000021a0: 5d29 3a0d 0a20 2020 2020 2020 2020 2020  ]):..           
+000021b0: 206d 6178 6465 6320 3d20 6d61 7828 5b6c   maxdec = max([l
+000021c0: 656e 2828 6729 2e70 6172 7469 7469 6f6e  en((g).partition
+000021d0: 2827 2e27 295b 325d 2e70 6172 7469 7469  ('.')[2].partiti
+000021e0: 6f6e 2827 6527 295b 305d 2920 666f 7220  on('e')[0]) for 
+000021f0: 6720 696e 2067 7320 6966 2027 6527 2069  g in gs if 'e' i
+00002200: 6e20 675d 290d 0a20 2020 2020 2020 2020  n g])..         
+00002210: 2020 2073 656c 662e 6e65 7874 5f66 6d74     self.next_fmt
+00002220: 203d 2027 2525 2e25 6965 2720 2520 6d61   = '%%.%ie' % ma
+00002230: 7864 6563 0d0a 2020 2020 2020 2020 656c  xdec..        el
+00002240: 6966 2067 733a 0d0a 2020 2020 2020 2020  if gs:..        
+00002250: 2020 2020 6d61 7864 6563 203d 206d 6178      maxdec = max
+00002260: 285b 6c65 6e28 2867 292e 7061 7274 6974  ([len((g).partit
+00002270: 696f 6e28 272e 2729 5b32 5d29 2066 6f72  ion('.')[2]) for
+00002280: 2067 2069 6e20 6773 5d29 0d0a 2020 2020   g in gs])..    
+00002290: 2020 2020 2020 2020 7365 6c66 2e6e 6578          self.nex
+000022a0: 745f 666d 7420 3d20 2725 252e 2569 6627  t_fmt = '%%.%if'
+000022b0: 2025 206d 6178 6465 630d 0a20 2020 2020   % maxdec..     
+000022c0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000022d0: 2020 2020 2020 7365 6c66 2e6e 6578 745f        self.next_
+000022e0: 666d 7420 3d20 2725 6727 0d0a 2020 2020  fmt = '%g'..    
+000022f0: 2020 2020 7265 7475 726e 2076 730d 0a0d      return vs...
+00002300: 0a0d 0a0d 0a63 6c61 7373 2059 5363 616c  .....class YScal
+00002310: 653a 0d0a 2020 2020 6465 6620 5f5f 696e  e:..    def __in
+00002320: 6974 5f5f 2873 656c 662c 2073 6361 6c65  it__(self, scale
+00002330: 7479 7065 2c20 7363 616c 6566 293a 0d0a  type, scalef):..
+00002340: 2020 2020 2020 2020 7365 6c66 2e73 6361          self.sca
+00002350: 6c65 7479 7065 203d 2073 6361 6c65 7479  letype = scalety
+00002360: 7065 0d0a 2020 2020 2020 2020 7365 6c66  pe..        self
+00002370: 2e73 6574 5f73 6361 6c65 2873 6361 6c65  .set_scale(scale
+00002380: 6629 0d0a 0d0a 2020 2020 6465 6620 7365  f)....    def se
+00002390: 745f 7363 616c 6528 7365 6c66 2c20 7363  t_scale(self, sc
+000023a0: 616c 6529 3a0d 0a20 2020 2020 2020 2073  ale):..        s
+000023b0: 656c 662e 7363 616c 6566 203d 2073 6361  elf.scalef = sca
+000023c0: 6c65 0d0a 0d0a 2020 2020 6465 6620 7866  le....    def xf
+000023d0: 6f72 6d28 7365 6c66 2c20 7929 3a0d 0a20  orm(self, y):.. 
+000023e0: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
+000023f0: 6361 6c65 7479 7065 203d 3d20 276c 6f67  caletype == 'log
+00002400: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+00002410: 7920 3d20 3130 2a2a 790d 0a20 2020 2020  y = 10**y..     
+00002420: 2020 2079 203d 2079 202a 2073 656c 662e     y = y * self.
+00002430: 7363 616c 6566 0d0a 2020 2020 2020 2020  scalef..        
+00002440: 7265 7475 726e 2079 0d0a 0d0a 2020 2020  return y....    
+00002450: 6465 6620 696e 7678 666f 726d 2873 656c  def invxform(sel
+00002460: 662c 2079 2c20 7665 7269 6679 3d46 616c  f, y, verify=Fal
+00002470: 7365 293a 0d0a 2020 2020 2020 2020 7920  se):..        y 
+00002480: 2f3d 2073 656c 662e 7363 616c 6566 0d0a  /= self.scalef..
+00002490: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000024a0: 7363 616c 6574 7970 6520 3d3d 2027 6c6f  scaletype == 'lo
+000024b0: 6727 3a0d 0a20 2020 2020 2020 2020 2020  g':..           
+000024c0: 2069 6620 7665 7269 6679 2061 6e64 2079   if verify and y
+000024d0: 203c 3d20 303a 0d0a 2020 2020 2020 2020   <= 0:..        
+000024e0: 2020 2020 2020 2020 7265 7475 726e 202d          return -
+000024f0: 3165 3620 2f20 7365 6c66 2e73 6361 6c65  1e6 / self.scale
+00002500: 660d 0a20 2020 2020 2020 2020 2020 2079  f..            y
+00002510: 203d 206e 702e 6c6f 6731 3028 7929 0d0a   = np.log10(y)..
+00002520: 2020 2020 2020 2020 7265 7475 726e 2079          return y
+00002530: 0d0a 0d0a 0d0a 0d0a 636c 6173 7320 5061  ........class Pa
+00002540: 6e64 6173 4461 7461 536f 7572 6365 3a0d  ndasDataSource:.
+00002550: 0a20 2020 2027 2727 4361 6e64 6c65 2073  .    '''Candle s
+00002560: 7469 636b 733a 2063 7265 6174 6520 7769  ticks: create wi
+00002570: 7468 2066 6976 6520 636f 6c75 6d6e 733a  th five columns:
+00002580: 2074 696d 652c 206f 7065 6e2c 2063 6c6f   time, open, clo
+00002590: 7365 2c20 6869 2c20 6c6f 202d 2069 6e20  se, hi, lo - in 
+000025a0: 7468 6174 206f 7264 6572 2e0d 0a20 2020  that order...   
+000025b0: 2020 2020 566f 6c75 6d65 2062 6172 733a      Volume bars:
+000025c0: 2063 7265 6174 6520 7769 7468 2074 6872   create with thr
+000025d0: 6565 2063 6f6c 756d 6e73 3a20 7469 6d65  ee columns: time
+000025e0: 2c20 6f70 656e 2c20 636c 6f73 652c 2076  , open, close, v
+000025f0: 6f6c 756d 6520 2d20 696e 2074 6861 7420  olume - in that 
+00002600: 6f72 6465 722e 0d0a 2020 2020 2020 2046  order...       F
+00002610: 6f72 2061 6c6c 206f 7468 6572 2074 7970  or all other typ
+00002620: 6573 2c20 7469 6d65 206e 6565 6473 2074  es, time needs t
+00002630: 6f20 6265 2066 6972 7374 2c20 7573 7561  o be first, usua
+00002640: 6c6c 7920 666f 6c6c 6f77 6564 2062 7920  lly followed by 
+00002650: 6f6e 6520 6f72 206d 6f72 6520 592d 636f  one or more Y-co
+00002660: 6c75 6d6e 732e 2727 270d 0a20 2020 2064  lumns.'''..    d
+00002670: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00002680: 2c20 6466 293a 0d0a 2020 2020 2020 2020  , df):..        
+00002690: 6966 2074 7970 6528 6466 2e69 6e64 6578  if type(df.index
+000026a0: 2920 3d3d 2070 642e 4461 7465 7469 6d65  ) == pd.Datetime
+000026b0: 496e 6465 7820 6f72 2064 662e 696e 6465  Index or df.inde
+000026c0: 785b 2d31 5d3e 3165 3820 6f72 2027 2e52  x[-1]>1e8 or '.R
+000026d0: 616e 6765 496e 6465 7827 206e 6f74 2069  angeIndex' not i
+000026e0: 6e20 7374 7228 7479 7065 2864 662e 696e  n str(type(df.in
+000026f0: 6465 7829 293a 0d0a 2020 2020 2020 2020  dex)):..        
+00002700: 2020 2020 6466 203d 2064 662e 7265 7365      df = df.rese
+00002710: 745f 696e 6465 7828 290d 0a20 2020 2020  t_index()..     
+00002720: 2020 2073 656c 662e 6466 203d 2064 662e     self.df = df.
+00002730: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
+00002740: 2320 6d61 6e61 6765 2074 696d 6520 636f  # manage time co
+00002750: 6c75 6d6e 0d0a 2020 2020 2020 2020 6966  lumn..        if
+00002760: 205f 6861 735f 7469 6d65 636f 6c28 7365   _has_timecol(se
+00002770: 6c66 2e64 6629 3a0d 0a20 2020 2020 2020  lf.df):..       
+00002780: 2020 2020 2074 696d 6563 6f6c 203d 2073       timecol = s
+00002790: 656c 662e 6466 2e63 6f6c 756d 6e73 5b30  elf.df.columns[0
+000027a0: 5d0d 0a20 2020 2020 2020 2020 2020 2064  ]..            d
+000027b0: 7479 7065 203d 2073 7472 2864 665b 7469  type = str(df[ti
+000027c0: 6d65 636f 6c5d 2e64 7479 7065 290d 0a20  mecol].dtype).. 
+000027d0: 2020 2020 2020 2020 2020 2069 736e 756d             isnum
+000027e0: 203d 2028 2769 6e74 2720 696e 2064 7479   = ('int' in dty
+000027f0: 7065 206f 7220 2766 6c6f 6174 2720 696e  pe or 'float' in
+00002800: 2064 7479 7065 2920 616e 6420 6466 5b74   dtype) and df[t
+00002810: 696d 6563 6f6c 5d2e 696c 6f63 5b2d 315d  imecol].iloc[-1]
+00002820: 203c 2031 6537 0d0a 2020 2020 2020 2020   < 1e7..        
+00002830: 2020 2020 6966 206e 6f74 2069 736e 756d      if not isnum
+00002840: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00002850: 2020 2073 656c 662e 6466 5b74 696d 6563     self.df[timec
+00002860: 6f6c 5d20 3d20 5f70 6474 696d 6532 6570  ol] = _pdtime2ep
+00002870: 6f63 6828 6466 5b74 696d 6563 6f6c 5d29  och(df[timecol])
 00002880: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00002890: 6c66 2e63 6f6c 5f64 6174 615f 6f66 6673  lf.col_data_offs
-000028a0: 6574 203d 2031 2023 206e 6f2e 206f 6620  et = 1 # no. of 
-000028b0: 7072 6563 6565 6469 6e67 2063 6f6c 756d  preceeding colum
-000028c0: 6e73 2066 6f72 206f 7468 6572 2070 6c6f  ns for other plo
-000028d0: 7473 2061 6e64 2074 696d 6520 636f 6c75  ts and time colu
-000028e0: 6d6e 0d0a 2020 2020 2020 2020 656c 7365  mn..        else
-000028f0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00002900: 656c 662e 7374 616e 6461 6c6f 6e65 203d  elf.standalone =
-00002910: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00002920: 2020 2020 7365 6c66 2e63 6f6c 5f64 6174      self.col_dat
-00002930: 615f 6f66 6673 6574 203d 2030 2023 206e  a_offset = 0 # n
-00002940: 6f2e 206f 6620 7072 6563 6565 6469 6e67  o. of preceeding
-00002950: 2063 6f6c 756d 6e73 2066 6f72 206f 7468   columns for oth
-00002960: 6572 2070 6c6f 7473 2061 6e64 2074 696d  er plots and tim
-00002970: 6520 636f 6c75 6d6e 0d0a 2020 2020 2020  e column..      
-00002980: 2020 2320 7365 7475 7020 6461 7461 2066    # setup data f
-00002990: 6f72 206a 6f69 6e69 6e67 2064 6174 6120  or joining data 
-000029a0: 736f 7572 6365 7320 616e 6420 7a6f 6f6d  sources and zoom
-000029b0: 696e 670d 0a20 2020 2020 2020 2073 656c  ing..        sel
-000029c0: 662e 7363 616c 655f 636f 6c73 203d 205b  f.scale_cols = [
-000029d0: 6920 666f 7220 6920 696e 2072 616e 6765  i for i in range
-000029e0: 2873 656c 662e 636f 6c5f 6461 7461 5f6f  (self.col_data_o
-000029f0: 6666 7365 742c 6c65 6e28 7365 6c66 2e64  ffset,len(self.d
-00002a00: 662e 636f 6c75 6d6e 7329 2920 6966 2073  f.columns)) if s
-00002a10: 656c 662e 6466 2e69 6c6f 635b 3a2c 695d  elf.df.iloc[:,i]
-00002a20: 2e64 7479 7065 213d 6f62 6a65 6374 5d0d  .dtype!=object].
-00002a30: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
-00002a40: 6368 655f 6869 6c6f 203d 204f 7264 6572  che_hilo = Order
-00002a50: 6564 4469 6374 2829 0d0a 2020 2020 2020  edDict()..      
-00002a60: 2020 7365 6c66 2e72 656e 616d 6573 203d    self.renames =
-00002a70: 207b 7d0d 0a20 2020 2020 2020 206e 6577   {}..        new
-00002a80: 636f 6c73 203d 205b 5d0d 0a20 2020 2020  cols = []..     
-00002a90: 2020 2066 6f72 2063 6f6c 2069 6e20 7365     for col in se
-00002aa0: 6c66 2e64 662e 636f 6c75 6d6e 733a 0d0a  lf.df.columns:..
-00002ab0: 2020 2020 2020 2020 2020 2020 6f6c 6463              oldc
-00002ac0: 6f6c 203d 2063 6f6c 0d0a 2020 2020 2020  ol = col..      
-00002ad0: 2020 2020 2020 7768 696c 6520 636f 6c20        while col 
-00002ae0: 696e 206e 6577 636f 6c73 3a0d 0a20 2020  in newcols:..   
-00002af0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-00002b00: 203d 2073 7472 2863 6f6c 292b 272b 270d   = str(col)+'+'.
-00002b10: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00002b20: 636f 6c73 2e61 7070 656e 6428 636f 6c29  cols.append(col)
-00002b30: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00002b40: 206f 6c64 636f 6c20 213d 2063 6f6c 3a0d   oldcol != col:.
-00002b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002b60: 2073 656c 662e 7265 6e61 6d65 735b 6f6c   self.renames[ol
-00002b70: 6463 6f6c 5d20 3d20 636f 6c0d 0a20 2020  dcol] = col..   
-00002b80: 2020 2020 2073 656c 662e 6466 2e63 6f6c       self.df.col
-00002b90: 756d 6e73 203d 206e 6577 636f 6c73 0d0a  umns = newcols..
-00002ba0: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
-00002bb0: 5f75 7064 6174 6520 3d20 6c61 6d62 6461  _update = lambda
-00002bc0: 2064 663a 2064 660d 0a20 2020 2020 2020   df: df..       
-00002bd0: 2073 656c 662e 706f 7374 5f75 7064 6174   self.post_updat
-00002be0: 6520 3d20 6c61 6d62 6461 2064 663a 2064  e = lambda df: d
-00002bf0: 660d 0a20 2020 2020 2020 2073 656c 662e  f..        self.
-00002c00: 5f70 6572 696f 6420 3d20 4e6f 6e65 0d0a  _period = None..
-00002c10: 2020 2020 2020 2020 7365 6c66 2e5f 736d          self._sm
-00002c20: 6f6f 7468 5f74 696d 6520 3d20 4e6f 6e65  ooth_time = None
-00002c30: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
-00002c40: 735f 7370 6172 7365 203d 2073 656c 662e  s_sparse = self.
-00002c50: 6466 5b73 656c 662e 6466 2e63 6f6c 756d  df[self.df.colum
-00002c60: 6e73 5b73 656c 662e 636f 6c5f 6461 7461  ns[self.col_data
-00002c70: 5f6f 6666 7365 745d 5d2e 6973 6e75 6c6c  _offset]].isnull
-00002c80: 2829 2e73 756d 2829 2e6d 6178 2829 203e  ().sum().max() >
-00002c90: 206c 656e 2873 656c 662e 6466 292f 2f32   len(self.df)//2
-00002ca0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00002cb0: 790d 0a20 2020 2064 6566 2070 6572 696f  y..    def perio
-00002cc0: 645f 6e73 2873 656c 6629 3a0d 0a20 2020  d_ns(self):..   
-00002cd0: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
-00002ce0: 2e64 6629 203c 3d20 313a 0d0a 2020 2020  .df) <= 1:..    
-00002cf0: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
-00002d00: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00002d10: 2073 656c 662e 5f70 6572 696f 643a 0d0a   self._period:..
-00002d20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00002d30: 2e5f 7065 7269 6f64 203d 2073 656c 662e  ._period = self.
-00002d40: 6361 6c63 5f70 6572 696f 645f 6e73 2829  calc_period_ns()
-00002d50: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00002d60: 2073 656c 662e 5f70 6572 696f 640d 0a0d   self._period...
-00002d70: 0a20 2020 2064 6566 2063 616c 635f 7065  .    def calc_pe
-00002d80: 7269 6f64 5f6e 7328 7365 6c66 2c20 6e3d  riod_ns(self, n=
-00002d90: 3130 302c 2064 656c 7461 3d6c 616d 6264  100, delta=lambd
-00002da0: 6120 6474 3a20 696e 7428 6474 2e6d 6564  a dt: int(dt.med
-00002db0: 6961 6e28 2929 293a 0d0a 2020 2020 2020  ian())):..      
-00002dc0: 2020 7469 6d65 636f 6c20 3d20 7365 6c66    timecol = self
-00002dd0: 2e64 662e 636f 6c75 6d6e 735b 305d 0d0a  .df.columns[0]..
-00002de0: 2020 2020 2020 2020 6474 696d 6573 203d          dtimes =
-00002df0: 2073 656c 662e 6466 5b74 696d 6563 6f6c   self.df[timecol
-00002e00: 5d2e 696c 6f63 5b30 3a6e 5d2e 6469 6666  ].iloc[0:n].diff
-00002e10: 2829 0d0a 2020 2020 2020 2020 6474 696d  ()..        dtim
-00002e20: 6573 203d 2064 7469 6d65 735b 6474 696d  es = dtimes[dtim
-00002e30: 6573 213d 305d 0d0a 2020 2020 2020 2020  es!=0]..        
-00002e40: 7265 7475 726e 2064 656c 7461 2864 7469  return delta(dti
-00002e50: 6d65 7329 2069 6620 6c65 6e28 6474 696d  mes) if len(dtim
-00002e60: 6573 293e 3120 656c 7365 2031 0d0a 0d0a  es)>1 else 1....
-00002e70: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
-00002e80: 2020 2064 6566 2069 6e64 6578 2873 656c     def index(sel
-00002e90: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-00002ea0: 7572 6e20 7365 6c66 2e64 662e 696e 6465  urn self.df.inde
-00002eb0: 780d 0a0d 0a20 2020 2040 7072 6f70 6572  x....    @proper
-00002ec0: 7479 0d0a 2020 2020 6465 6620 7828 7365  ty..    def x(se
-00002ed0: 6c66 293a 0d0a 2020 2020 2020 2020 7469  lf):..        ti
-00002ee0: 6d65 636f 6c20 3d20 7365 6c66 2e64 662e  mecol = self.df.
-00002ef0: 636f 6c75 6d6e 735b 305d 0d0a 2020 2020  columns[0]..    
-00002f00: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00002f10: 6466 5b74 696d 6563 6f6c 5d0d 0a0d 0a20  df[timecol].... 
-00002f20: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-00002f30: 2020 6465 6620 7928 7365 6c66 293a 0d0a    def y(self):..
-00002f40: 2020 2020 2020 2020 636f 6c20 3d20 7365          col = se
-00002f50: 6c66 2e64 662e 636f 6c75 6d6e 735b 7365  lf.df.columns[se
-00002f60: 6c66 2e63 6f6c 5f64 6174 615f 6f66 6673  lf.col_data_offs
-00002f70: 6574 5d0d 0a20 2020 2020 2020 2072 6574  et]..        ret
-00002f80: 7572 6e20 7365 6c66 2e64 665b 636f 6c5d  urn self.df[col]
-00002f90: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00002fa0: 790d 0a20 2020 2064 6566 207a 2873 656c  y..    def z(sel
-00002fb0: 6629 3a0d 0a20 2020 2020 2020 2063 6f6c  f):..        col
-00002fc0: 203d 2073 656c 662e 6466 2e63 6f6c 756d   = self.df.colum
-00002fd0: 6e73 5b73 656c 662e 636f 6c5f 6461 7461  ns[self.col_data
-00002fe0: 5f6f 6666 7365 742b 315d 0d0a 2020 2020  _offset+1]..    
-00002ff0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00003000: 6466 5b63 6f6c 5d0d 0a0d 0a20 2020 2040  df[col]....    @
-00003010: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-00003020: 6620 786c 656e 2873 656c 6629 3a0d 0a20  f xlen(self):.. 
-00003030: 2020 2020 2020 2072 6574 7572 6e20 6c65         return le
-00003040: 6e28 7365 6c66 2e64 6629 0d0a 0d0a 2020  n(self.df)....  
-00003050: 2020 6465 6620 6361 6c63 5f73 6967 6e69    def calc_signi
-00003060: 6669 6361 6e74 5f64 6563 696d 616c 7328  ficant_decimals(
-00003070: 7365 6c66 2c20 6675 6c6c 293a 0d0a 2020  self, full):..  
-00003080: 2020 2020 2020 6465 6620 666c 6f61 745f        def float_
-00003090: 726f 756e 6428 6629 3a0d 0a20 2020 2020  round(f):..     
-000030a0: 2020 2020 2020 2072 6574 7572 6e20 666c         return fl
-000030b0: 6f61 7428 2725 2e33 6527 2566 2920 2320  oat('%.3e'%f) # 
-000030c0: 302e 3030 3939 3937 3438 202d 3e20 302e  0.00999748 -> 0.
-000030d0: 3031 0d0a 2020 2020 2020 2020 6465 6620  01..        def 
-000030e0: 7265 6d61 696e 6465 725f 6f6b 2861 2c20  remainder_ok(a, 
-000030f0: 6229 3a0d 0a20 2020 2020 2020 2020 2020  b):..           
-00003100: 2063 203d 2061 2025 2062 0d0a 2020 2020   c = a % b..    
-00003110: 2020 2020 2020 2020 6966 2063 202f 2062          if c / b
-00003120: 203e 2030 2e39 383a 2023 2072 656d 6169   > 0.98: # remai
-00003130: 6e64 6572 2061 6c6d 6f73 7420 7361 6d65  nder almost same
-00003140: 2061 7320 6465 6e6f 6d69 6e61 746f 720d   as denominator.
-00003150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003160: 2063 203d 2061 6273 2863 2d62 290d 0a20   c = abs(c-b).. 
-00003170: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00003180: 6e20 6320 3c20 622a 302e 3620 2320 6861  n c < b*0.6 # ha
-00003190: 6c66 2069 7320 6669 6e65 0d0a 2020 2020  lf is fine..    
-000031a0: 2020 2020 6465 6620 6361 6c63 5f73 6428      def calc_sd(
-000031b0: 7365 7229 3a0d 0a20 2020 2020 2020 2020  ser):..         
-000031c0: 2020 2073 6572 203d 2073 6572 2e69 6c6f     ser = ser.ilo
-000031d0: 635b 3a31 3030 305d 0d0a 2020 2020 2020  c[:1000]..      
-000031e0: 2020 2020 2020 6162 7364 6966 6620 3d20        absdiff = 
-000031f0: 7365 722e 6469 6666 2829 2e61 6273 2829  ser.diff().abs()
-00003200: 0d0a 2020 2020 2020 2020 2020 2020 6162  ..            ab
-00003210: 7364 6966 665b 6162 7364 6966 663c 3165  sdiff[absdiff<1e
-00003220: 2d33 305d 203d 206e 702e 666c 6f61 7433  -30] = np.float3
-00003230: 3228 3165 3330 290d 0a20 2020 2020 2020  2(1e30)..       
-00003240: 2020 2020 2073 6d61 6c6c 6573 745f 6469       smallest_di
-00003250: 6666 203d 2061 6273 6469 6666 2e6d 696e  ff = absdiff.min
-00003260: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00003270: 6966 2073 6d61 6c6c 6573 745f 6469 6666  if smallest_diff
-00003280: 203e 2031 6532 393a 2023 206a 7573 7420   > 1e29: # just 
-00003290: 3073 3f0d 0a20 2020 2020 2020 2020 2020  0s?..           
-000032a0: 2020 2020 2072 6574 7572 6e20 300d 0a20       return 0.. 
-000032b0: 2020 2020 2020 2020 2020 2073 6d61 6c6c             small
-000032c0: 6573 745f 6469 6666 203d 2066 6c6f 6174  est_diff = float
-000032d0: 5f72 6f75 6e64 2873 6d61 6c6c 6573 745f  _round(smallest_
-000032e0: 6469 6666 290d 0a20 2020 2020 2020 2020  diff)..         
-000032f0: 2020 2061 6273 7365 7220 3d20 7365 722e     absser = ser.
-00003300: 696c 6f63 5b3a 3130 305d 2e61 6273 2829  iloc[:100].abs()
-00003310: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00003320: 7220 5f20 696e 2072 616e 6765 2832 293a  r _ in range(2):
-00003330: 2023 2063 6865 636b 2069 6620 7765 2068   # check if we h
-00003340: 6176 6520 6120 7265 6d61 696e 6465 7220  ave a remainder 
-00003350: 7468 6174 2069 7320 6120 6265 7474 6572  that is a better
-00003360: 2065 7073 696c 6f6e 0d0a 2020 2020 2020   epsilon..      
-00003370: 2020 2020 2020 2020 2020 7265 6d61 696e            remain
-00003380: 6465 7220 3d20 5b66 6d6f 6428 762c 736d  der = [fmod(v,sm
-00003390: 616c 6c65 7374 5f64 6966 6629 2066 6f72  allest_diff) for
-000033a0: 2076 2069 6e20 6162 7373 6572 5d0d 0a20   v in absser].. 
-000033b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000033c0: 656d 6169 6e64 6572 203d 205b 7620 666f  emainder = [v fo
-000033d0: 7220 7620 696e 2072 656d 6169 6e64 6572  r v in remainder
-000033e0: 2069 6620 763e 736d 616c 6c65 7374 5f64   if v>smallest_d
-000033f0: 6966 662f 3230 5d0d 0a20 2020 2020 2020  iff/20]..       
-00003400: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00003410: 7265 6d61 696e 6465 723a 0d0a 2020 2020  remainder:..    
-00003420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003430: 6272 6561 6b0d 0a20 2020 2020 2020 2020  break..         
-00003440: 2020 2020 2020 2073 6d61 6c6c 6573 745f         smallest_
-00003450: 6469 6666 5f72 203d 206d 696e 2872 656d  diff_r = min(rem
-00003460: 6169 6e64 6572 290d 0a20 2020 2020 2020  ainder)..       
-00003470: 2020 2020 2020 2020 2069 6620 736d 616c           if smal
-00003480: 6c65 7374 5f64 6966 662a 302e 3035 203c  lest_diff*0.05 <
-00003490: 2073 6d61 6c6c 6573 745f 6469 6666 5f72   smallest_diff_r
-000034a0: 203c 2073 6d61 6c6c 6573 745f 6469 6666   < smallest_diff
-000034b0: 202a 2030 2e37 2061 6e64 2072 656d 6169   * 0.7 and remai
-000034c0: 6e64 6572 5f6f 6b28 736d 616c 6c65 7374  nder_ok(smallest
-000034d0: 5f64 6966 662c 2073 6d61 6c6c 6573 745f  _diff, smallest_
-000034e0: 6469 6666 5f72 293a 0d0a 2020 2020 2020  diff_r):..      
-000034f0: 2020 2020 2020 2020 2020 2020 2020 736d                sm
-00003500: 616c 6c65 7374 5f64 6966 6620 3d20 736d  allest_diff = sm
-00003510: 616c 6c65 7374 5f64 6966 665f 720d 0a20  allest_diff_r.. 
-00003520: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00003530: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00003540: 2020 2020 2020 2020 2020 6272 6561 6b0d            break.
-00003550: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00003560: 7572 6e20 736d 616c 6c65 7374 5f64 6966  urn smallest_dif
-00003570: 660d 0a20 2020 2020 2020 2064 6566 2063  f..        def c
-00003580: 616c 635f 6465 6328 7365 722c 2073 6d61  alc_dec(ser, sma
-00003590: 6c6c 6573 745f 6469 6666 293a 0d0a 2020  llest_diff):..  
-000035a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000035b0: 2066 756c 6c3a 2023 206c 696e 6520 706c   full: # line pl
-000035c0: 6f74 7320 7573 7561 6c6c 7920 6861 7665  ots usually have
-000035d0: 2065 7874 7265 6d65 2072 6573 6f6c 7574   extreme resolut
-000035e0: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
-000035f0: 2020 2020 2061 6273 6d61 7820 3d20 7365       absmax = se
-00003600: 722e 696c 6f63 5b3a 3330 305d 2e61 6273  r.iloc[:300].abs
-00003610: 2829 2e6d 6178 2829 0d0a 2020 2020 2020  ().max()..      
-00003620: 2020 2020 2020 2020 2020 7320 3d20 2725            s = '%
-00003630: 2e33 6527 2025 2061 6273 6d61 780d 0a20  .3e' % absmax.. 
-00003640: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00003650: 2023 2063 616e 646c 6573 0d0a 2020 2020   # candles..    
-00003660: 2020 2020 2020 2020 2020 2020 7320 3d20              s = 
-00003670: 2725 2e32 6527 2025 2073 6d61 6c6c 6573  '%.2e' % smalles
-00003680: 745f 6469 6666 0d0a 2020 2020 2020 2020  t_diff..        
-00003690: 2020 2020 6261 7365 2c5f 2c65 7870 203d      base,_,exp =
-000036a0: 2073 2e70 6172 7469 7469 6f6e 2827 6527   s.partition('e'
-000036b0: 290d 0a20 2020 2020 2020 2020 2020 2062  )..            b
-000036c0: 6173 6520 3d20 6261 7365 2e72 7374 7269  ase = base.rstri
-000036d0: 7028 2730 2729 0d0a 2020 2020 2020 2020  p('0')..        
-000036e0: 2020 2020 6578 7020 3d20 2d69 6e74 2865      exp = -int(e
-000036f0: 7870 290d 0a20 2020 2020 2020 2020 2020  xp)..           
-00003700: 206d 6178 5f62 6173 655f 6465 6369 6d61   max_base_decima
-00003710: 6c73 203d 206d 696e 2835 2c20 2d65 7870  ls = min(5, -exp
-00003720: 2b32 2920 6966 2065 7870 203c 2030 2065  +2) if exp < 0 e
-00003730: 6c73 6520 330d 0a20 2020 2020 2020 2020  lse 3..         
-00003740: 2020 2062 6173 655f 6465 6369 6d61 6c73     base_decimals
-00003750: 203d 206d 6178 2830 2c20 6d69 6e28 6d61   = max(0, min(ma
-00003760: 785f 6261 7365 5f64 6563 696d 616c 732c  x_base_decimals,
-00003770: 206c 656e 2862 6173 6529 2d32 2929 0d0a   len(base)-2))..
-00003780: 2020 2020 2020 2020 2020 2020 6465 6369              deci
-00003790: 6d61 6c73 203d 2065 7870 202b 2062 6173  mals = exp + bas
-000037a0: 655f 6465 6369 6d61 6c73 0d0a 2020 2020  e_decimals..    
-000037b0: 2020 2020 2020 2020 6465 6369 6d61 6c73          decimals
-000037c0: 203d 206d 6178 2830 2c20 6d69 6e28 6d61   = max(0, min(ma
-000037d0: 785f 6465 6369 6d61 6c73 2c20 6465 6369  x_decimals, deci
-000037e0: 6d61 6c73 2929 0d0a 2020 2020 2020 2020  mals))..        
-000037f0: 2020 2020 6966 206e 6f74 2066 756c 6c3a      if not full:
-00003800: 2023 2061 7070 6c79 2067 7269 6420 666f   # apply grid fo
-00003810: 7220 6c69 6e65 2070 6c6f 7473 206f 6e6c  r line plots onl
-00003820: 790d 0a20 2020 2020 2020 2020 2020 2020  y..             
-00003830: 2020 2073 6d61 6c6c 6573 745f 6469 6666     smallest_diff
-00003840: 203d 206d 6178 2831 302a 2a28 2d64 6563   = max(10**(-dec
-00003850: 696d 616c 7329 2c20 736d 616c 6c65 7374  imals), smallest
-00003860: 5f64 6966 6629 0d0a 2020 2020 2020 2020  _diff)..        
-00003870: 2020 2020 7265 7475 726e 2064 6563 696d      return decim
-00003880: 616c 732c 2073 6d61 6c6c 6573 745f 6469  als, smallest_di
-00003890: 6666 0d0a 2020 2020 2020 2020 2320 6669  ff..        # fi
-000038a0: 7273 7420 6361 6c63 756c 6174 6520 4550  rst calculate EP
-000038b0: 5320 666f 7220 7365 7269 6573 2030 2631  S for series 0&1
-000038c0: 2c20 7468 656e 2064 6f20 6465 6369 6d61  , then do decima
-000038d0: 6c73 0d0a 2020 2020 2020 2020 7364 7320  ls..        sds 
-000038e0: 3d20 5b63 616c 635f 7364 2873 656c 662e  = [calc_sd(self.
-000038f0: 7929 5d20 2320 6d69 6768 7420 6265 2061  y)] # might be a
-00003900: 6c6c 207a 6572 6f73 2066 6f72 2062 6172  ll zeros for bar
-00003910: 2063 6861 7274 730d 0a20 2020 2020 2020   charts..       
-00003920: 2069 6620 6c65 6e28 7365 6c66 2e73 6361   if len(self.sca
-00003930: 6c65 5f63 6f6c 7329 203e 2031 3a0d 0a20  le_cols) > 1:.. 
-00003940: 2020 2020 2020 2020 2020 2073 6473 2e61             sds.a
-00003950: 7070 656e 6428 6361 6c63 5f73 6428 7365  ppend(calc_sd(se
-00003960: 6c66 2e7a 2929 2023 2069 6620 6669 7273  lf.z)) # if firs
-00003970: 7420 6973 206f 7065 6e2c 2074 6869 7320  t is open, this 
-00003980: 6d69 6768 7420 6265 2063 6c6f 7365 0d0a  might be close..
-00003990: 2020 2020 2020 2020 7364 7320 3d20 5b73          sds = [s
-000039a0: 6420 666f 7220 7364 2069 6e20 7364 7320  d for sd in sds 
-000039b0: 6966 2073 643e 305d 0d0a 2020 2020 2020  if sd>0]..      
-000039c0: 2020 6269 675f 6469 6666 203d 206d 6178    big_diff = max
-000039d0: 2873 6473 290d 0a20 2020 2020 2020 2073  (sds)..        s
-000039e0: 6d61 6c6c 6573 745f 6469 6666 203d 206d  mallest_diff = m
-000039f0: 696e 285b 7364 2066 6f72 2073 6420 696e  in([sd for sd in
-00003a00: 2073 6473 2069 6620 7364 3e62 6967 5f64   sds if sd>big_d
-00003a10: 6966 662f 3130 305d 2920 2320 6669 6c74  iff/100]) # filt
-00003a20: 6572 206f 7574 2065 7874 7265 6d65 6c79  er out extremely
-00003a30: 2073 6d61 6c6c 2065 7073 696c 6f6e 730d   small epsilons.
-00003a40: 0a20 2020 2020 2020 2073 6572 203d 2073  .        ser = s
-00003a50: 656c 662e 7a20 6966 206c 656e 2873 656c  elf.z if len(sel
-00003a60: 662e 7363 616c 655f 636f 6c73 2920 3e20  f.scale_cols) > 
-00003a70: 3120 656c 7365 2073 656c 662e 790d 0a20  1 else self.y.. 
-00003a80: 2020 2020 2020 2072 6574 7572 6e20 6361         return ca
-00003a90: 6c63 5f64 6563 2873 6572 2c20 736d 616c  lc_dec(ser, smal
-00003aa0: 6c65 7374 5f64 6966 6629 0d0a 0d0a 2020  lest_diff)....  
-00003ab0: 2020 6465 6620 7570 6461 7465 5f69 6e69    def update_ini
-00003ac0: 745f 7828 7365 6c66 2c20 696e 6974 5f73  t_x(self, init_s
-00003ad0: 7465 7073 293a 0d0a 2020 2020 2020 2020  teps):..        
-00003ae0: 7365 6c66 2e69 6e69 745f 7830 2c20 7365  self.init_x0, se
-00003af0: 6c66 2e69 6e69 745f 7831 203d 205f 786d  lf.init_x1 = _xm
-00003b00: 696e 6d61 7828 7365 6c66 2c20 785f 696e  inmax(self, x_in
-00003b10: 6465 7865 643d 5472 7565 2c20 696e 6974  dexed=True, init
-00003b20: 5f73 7465 7073 3d69 6e69 745f 7374 6570  _steps=init_step
-00003b30: 7329 0d0a 0d0a 2020 2020 6465 6620 636c  s)....    def cl
-00003b40: 6f73 6573 745f 7469 6d65 2873 656c 662c  osest_time(self,
-00003b50: 2078 293a 0d0a 2020 2020 2020 2020 7469   x):..        ti
-00003b60: 6d65 636f 6c20 3d20 7365 6c66 2e64 662e  mecol = self.df.
-00003b70: 636f 6c75 6d6e 735b 305d 0d0a 2020 2020  columns[0]..    
-00003b80: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00003b90: 6466 2e6c 6f63 5b69 6e74 2878 292c 2074  df.loc[int(x), t
-00003ba0: 696d 6563 6f6c 5d0d 0a0d 0a20 2020 2064  imecol]....    d
-00003bb0: 6566 2074 696d 6562 6173 6564 2873 656c  ef timebased(sel
-00003bc0: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-00003bd0: 7572 6e20 7365 6c66 2e64 662e 696c 6f63  urn self.df.iloc
-00003be0: 5b2d 312c 305d 203e 2031 6537 0d0a 0d0a  [-1,0] > 1e7....
-00003bf0: 2020 2020 6465 6620 6973 5f73 6d6f 6f74      def is_smoot
-00003c00: 685f 7469 6d65 2873 656c 6629 3a0d 0a20  h_time(self):.. 
-00003c10: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00003c20: 736d 6f6f 7468 5f74 696d 6520 6973 204e  smooth_time is N
-00003c30: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00003c40: 2020 2320 6c65 7373 2074 6861 6e20 3125    # less than 1%
-00003c50: 2074 696d 6520 6465 6c74 6120 6973 2073   time delta is s
-00003c60: 6d6f 6f74 680d 0a20 2020 2020 2020 2020  mooth..         
-00003c70: 2020 2073 656c 662e 5f73 6d6f 6f74 685f     self._smooth_
-00003c80: 7469 6d65 203d 2073 656c 662e 7469 6d65  time = self.time
-00003c90: 6261 7365 6428 2920 616e 6420 286e 702e  based() and (np.
-00003ca0: 6162 7328 6e70 2e64 6966 6628 7365 6c66  abs(np.diff(self
-00003cb0: 2e78 2e76 616c 7565 735b 313a 3130 305d  .x.values[1:100]
-00003cc0: 295b 313a 5d2f 2f28 7365 6c66 2e70 6572  )[1:]//(self.per
-00003cd0: 696f 645f 6e73 2f2f 3130 3030 292d 3130  iod_ns//1000)-10
-00003ce0: 3030 2920 3c20 3130 292e 616c 6c28 290d  00) < 10).all().
-00003cf0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00003d00: 7365 6c66 2e5f 736d 6f6f 7468 5f74 696d  self._smooth_tim
-00003d10: 650d 0a0d 0a20 2020 2064 6566 2061 6464  e....    def add
-00003d20: 636f 6c73 2873 656c 662c 2064 6174 6173  cols(self, datas
-00003d30: 7263 293a 0d0a 2020 2020 2020 2020 6e65  rc):..        ne
-00003d40: 775f 7363 616c 655f 636f 6c73 203d 205b  w_scale_cols = [
-00003d50: 632b 6c65 6e28 7365 6c66 2e64 662e 636f  c+len(self.df.co
-00003d60: 6c75 6d6e 7329 2d64 6174 6173 7263 2e63  lumns)-datasrc.c
-00003d70: 6f6c 5f64 6174 615f 6f66 6673 6574 2066  ol_data_offset f
-00003d80: 6f72 2063 2069 6e20 6461 7461 7372 632e  or c in datasrc.
-00003d90: 7363 616c 655f 636f 6c73 5d0d 0a20 2020  scale_cols]..   
-00003da0: 2020 2020 2073 656c 662e 7363 616c 655f       self.scale_
-00003db0: 636f 6c73 202b 3d20 6e65 775f 7363 616c  cols += new_scal
-00003dc0: 655f 636f 6c73 0d0a 2020 2020 2020 2020  e_cols..        
-00003dd0: 6f72 6967 5f63 6f6c 5f64 6174 615f 636e  orig_col_data_cn
-00003de0: 7420 3d20 6c65 6e28 7365 6c66 2e64 662e  t = len(self.df.
-00003df0: 636f 6c75 6d6e 7329 0d0a 2020 2020 2020  columns)..      
-00003e00: 2020 6966 205f 6861 735f 7469 6d65 636f    if _has_timeco
-00003e10: 6c28 6461 7461 7372 632e 6466 293a 0d0a  l(datasrc.df):..
-00003e20: 2020 2020 2020 2020 2020 2020 7469 6d65              time
-00003e30: 636f 6c20 3d20 7365 6c66 2e64 662e 636f  col = self.df.co
-00003e40: 6c75 6d6e 735b 305d 0d0a 2020 2020 2020  lumns[0]..      
-00003e50: 2020 2020 2020 6466 203d 2073 656c 662e        df = self.
-00003e60: 6466 2e73 6574 5f69 6e64 6578 2874 696d  df.set_index(tim
-00003e70: 6563 6f6c 290d 0a20 2020 2020 2020 2020  ecol)..         
-00003e80: 2020 2074 696d 6563 6f6c 203d 2074 696d     timecol = tim
-00003e90: 6563 6f6c 2069 6620 7469 6d65 636f 6c20  ecol if timecol 
-00003ea0: 696e 2064 6174 6173 7263 2e64 662e 636f  in datasrc.df.co
-00003eb0: 6c75 6d6e 7320 656c 7365 2064 6174 6173  lumns else datas
-00003ec0: 7263 2e64 662e 636f 6c75 6d6e 735b 305d  rc.df.columns[0]
-00003ed0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-00003ee0: 7763 6f6c 7320 3d20 6461 7461 7372 632e  wcols = datasrc.
-00003ef0: 6466 2e73 6574 5f69 6e64 6578 2874 696d  df.set_index(tim
-00003f00: 6563 6f6c 290d 0a20 2020 2020 2020 2065  ecol)..        e
-00003f10: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00003f20: 2020 6466 203d 2073 656c 662e 6466 0d0a    df = self.df..
-00003f30: 2020 2020 2020 2020 2020 2020 6e65 7763              newc
-00003f40: 6f6c 7320 3d20 6461 7461 7372 632e 6466  ols = datasrc.df
-00003f50: 0d0a 2020 2020 2020 2020 636f 6c73 203d  ..        cols =
-00003f60: 206c 6973 7428 6e65 7763 6f6c 732e 636f   list(newcols.co
-00003f70: 6c75 6d6e 7329 0d0a 2020 2020 2020 2020  lumns)..        
-00003f80: 666f 7220 692c 636f 6c20 696e 2065 6e75  for i,col in enu
-00003f90: 6d65 7261 7465 2863 6f6c 7329 3a0d 0a20  merate(cols):.. 
-00003fa0: 2020 2020 2020 2020 2020 206f 6c64 5f63             old_c
-00003fb0: 6f6c 203d 2063 6f6c 0d0a 2020 2020 2020  ol = col..      
-00003fc0: 2020 2020 2020 7768 696c 6520 636f 6c20        while col 
-00003fd0: 696e 2073 656c 662e 6466 2e63 6f6c 756d  in self.df.colum
-00003fe0: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
-00003ff0: 2020 2020 2063 6f6c 735b 695d 203d 2063       cols[i] = c
-00004000: 6f6c 203d 2073 7472 2863 6f6c 292b 272b  ol = str(col)+'+
-00004010: 270d 0a20 2020 2020 2020 2020 2020 2069  '..            i
-00004020: 6620 6f6c 645f 636f 6c20 213d 2063 6f6c  f old_col != col
-00004030: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00004040: 2020 2064 6174 6173 7263 2e72 656e 616d     datasrc.renam
-00004050: 6573 5b6f 6c64 5f63 6f6c 5d20 3d20 636f  es[old_col] = co
-00004060: 6c0d 0a20 2020 2020 2020 206e 6577 636f  l..        newco
-00004070: 6c73 2e63 6f6c 756d 6e73 203d 2063 6f6c  ls.columns = col
-00004080: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
-00004090: 6466 203d 2064 662e 6a6f 696e 286e 6577  df = df.join(new
-000040a0: 636f 6c73 2c20 686f 773d 276f 7574 6572  cols, how='outer
-000040b0: 2729 0d0a 2020 2020 2020 2020 6966 205f  ')..        if _
-000040c0: 6861 735f 7469 6d65 636f 6c28 6461 7461  has_timecol(data
-000040d0: 7372 632e 6466 293a 0d0a 2020 2020 2020  src.df):..      
-000040e0: 2020 2020 2020 7365 6c66 2e64 662e 7265        self.df.re
-000040f0: 7365 745f 696e 6465 7828 696e 706c 6163  set_index(inplac
-00004100: 653d 5472 7565 290d 0a20 2020 2020 2020  e=True)..       
-00004110: 2064 6174 6173 7263 2e64 6620 3d20 7365   datasrc.df = se
-00004120: 6c66 2e64 6620 2320 7468 6579 2061 7265  lf.df # they are
-00004130: 2074 6865 2073 616d 6520 6e6f 770d 0a20   the same now.. 
-00004140: 2020 2020 2020 2064 6174 6173 7263 2e69         datasrc.i
-00004150: 6e69 745f 7830 203d 2073 656c 662e 696e  nit_x0 = self.in
-00004160: 6974 5f78 300d 0a20 2020 2020 2020 2064  it_x0..        d
-00004170: 6174 6173 7263 2e69 6e69 745f 7831 203d  atasrc.init_x1 =
-00004180: 2073 656c 662e 696e 6974 5f78 310d 0a20   self.init_x1.. 
-00004190: 2020 2020 2020 2064 6174 6173 7263 2e63         datasrc.c
-000041a0: 6f6c 5f64 6174 615f 6f66 6673 6574 203d  ol_data_offset =
-000041b0: 206f 7269 675f 636f 6c5f 6461 7461 5f63   orig_col_data_c
-000041c0: 6e74 0d0a 2020 2020 2020 2020 6461 7461  nt..        data
-000041d0: 7372 632e 7363 616c 655f 636f 6c73 203d  src.scale_cols =
-000041e0: 206e 6577 5f73 6361 6c65 5f63 6f6c 730d   new_scale_cols.
-000041f0: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
-00004200: 6368 655f 6869 6c6f 203d 204f 7264 6572  che_hilo = Order
-00004210: 6564 4469 6374 2829 0d0a 2020 2020 2020  edDict()..      
-00004220: 2020 7365 6c66 2e5f 7065 7269 6f64 203d    self._period =
-00004230: 2073 656c 662e 5f73 6d6f 6f74 685f 7469   self._smooth_ti
-00004240: 6d65 203d 204e 6f6e 650d 0a20 2020 2020  me = None..     
-00004250: 2020 2064 6174 6173 7263 2e5f 7065 7269     datasrc._peri
-00004260: 6f64 203d 2064 6174 6173 7263 2e5f 736d  od = datasrc._sm
-00004270: 6f6f 7468 5f74 696d 6520 3d20 4e6f 6e65  ooth_time = None
-00004280: 0d0a 2020 2020 2020 2020 6c64 6632 203d  ..        ldf2 =
-00004290: 206c 656e 2873 656c 662e 6466 2920 2f2f   len(self.df) //
-000042a0: 2032 0d0a 2020 2020 2020 2020 7365 6c66   2..        self
-000042b0: 2e69 735f 7370 6172 7365 203d 2073 656c  .is_sparse = sel
-000042c0: 662e 6973 5f73 7061 7273 6520 6f72 2073  f.is_sparse or s
-000042d0: 656c 662e 6466 5b73 656c 662e 6466 2e63  elf.df[self.df.c
-000042e0: 6f6c 756d 6e73 5b73 656c 662e 636f 6c5f  olumns[self.col_
-000042f0: 6461 7461 5f6f 6666 7365 745d 5d2e 6973  data_offset]].is
-00004300: 6e75 6c6c 2829 2e73 756d 2829 2e6d 6178  null().sum().max
-00004310: 2829 203e 206c 6466 320d 0a20 2020 2020  () > ldf2..     
-00004320: 2020 2064 6174 6173 7263 2e69 735f 7370     datasrc.is_sp
-00004330: 6172 7365 203d 2064 6174 6173 7263 2e69  arse = datasrc.i
-00004340: 735f 7370 6172 7365 206f 7220 6461 7461  s_sparse or data
-00004350: 7372 632e 6466 5b64 6174 6173 7263 2e64  src.df[datasrc.d
-00004360: 662e 636f 6c75 6d6e 735b 6461 7461 7372  f.columns[datasr
-00004370: 632e 636f 6c5f 6461 7461 5f6f 6666 7365  c.col_data_offse
-00004380: 745d 5d2e 6973 6e75 6c6c 2829 2e73 756d  t]].isnull().sum
-00004390: 2829 2e6d 6178 2829 203e 206c 6466 320d  ().max() > ldf2.
-000043a0: 0a0d 0a20 2020 2064 6566 2075 7064 6174  ...    def updat
-000043b0: 6528 7365 6c66 2c20 6461 7461 7372 6329  e(self, datasrc)
-000043c0: 3a0d 0a20 2020 2020 2020 2064 6620 3d20  :..        df = 
-000043d0: 7365 6c66 2e70 7265 5f75 7064 6174 6528  self.pre_update(
-000043e0: 7365 6c66 2e64 6629 0d0a 2020 2020 2020  self.df)..      
-000043f0: 2020 6f72 6967 5f63 6f6c 7320 3d20 6c69    orig_cols = li
-00004400: 7374 2864 662e 636f 6c75 6d6e 7329 0d0a  st(df.columns)..
-00004410: 2020 2020 2020 2020 7469 6d65 636f 6c2c          timecol,
-00004420: 6f72 6967 5f63 6f6c 7320 3d20 6f72 6967  orig_cols = orig
-00004430: 5f63 6f6c 735b 305d 2c6f 7269 675f 636f  _cols[0],orig_co
-00004440: 6c73 5b31 3a5d 0d0a 2020 2020 2020 2020  ls[1:]..        
-00004450: 6466 203d 2064 662e 7365 745f 696e 6465  df = df.set_inde
-00004460: 7828 7469 6d65 636f 6c29 0d0a 2020 2020  x(timecol)..    
-00004470: 2020 2020 696e 7075 745f 6466 203d 2064      input_df = d
-00004480: 6174 6173 7263 2e64 662e 7365 745f 696e  atasrc.df.set_in
-00004490: 6465 7828 6461 7461 7372 632e 6466 2e63  dex(datasrc.df.c
-000044a0: 6f6c 756d 6e73 5b30 5d29 0d0a 2020 2020  olumns[0])..    
-000044b0: 2020 2020 696e 7075 745f 6466 2e63 6f6c      input_df.col
-000044c0: 756d 6e73 203d 205b 7365 6c66 2e72 656e  umns = [self.ren
-000044d0: 616d 6573 2e67 6574 2863 6f6c 2c20 636f  ames.get(col, co
-000044e0: 6c29 2066 6f72 2063 6f6c 2069 6e20 696e  l) for col in in
-000044f0: 7075 745f 6466 2e63 6f6c 756d 6e73 5d0d  put_df.columns].
-00004500: 0a20 2020 2020 2020 2023 2070 6164 2069  .        # pad i
-00004510: 6e64 6578 2069 6620 7468 6520 696e 7075  ndex if the inpu
-00004520: 7420 6461 7461 2069 7320 6120 7375 622d  t data is a sub-
-00004530: 7365 740d 0a20 2020 2020 2020 206f 7574  set..        out
-00004540: 7075 745f 6466 203d 2070 642e 6d65 7267  put_df = pd.merg
-00004550: 6528 696e 7075 745f 6466 2c20 6466 5b5b  e(input_df, df[[
-00004560: 5d5d 2c20 686f 773d 276f 7574 6572 272c  ]], how='outer',
-00004570: 206c 6566 745f 696e 6465 783d 5472 7565   left_index=True
-00004580: 2c20 7269 6768 745f 696e 6465 783d 5472  , right_index=Tr
-00004590: 7565 290d 0a20 2020 2020 2020 2066 6f72  ue)..        for
-000045a0: 2063 6f6c 2069 6e20 6466 2e63 6f6c 756d   col in df.colum
-000045b0: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
-000045c0: 2069 6620 636f 6c20 6e6f 7420 696e 206f   if col not in o
-000045d0: 7574 7075 745f 6466 2e63 6f6c 756d 6e73  utput_df.columns
-000045e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000045f0: 2020 206f 7574 7075 745f 6466 5b63 6f6c     output_df[col
-00004600: 5d20 3d20 6466 5b63 6f6c 5d0d 0a20 2020  ] = df[col]..   
-00004610: 2020 2020 2023 2069 6620 6e65 6363 6573       # if necces
-00004620: 7361 7279 2c20 6375 7420 6f75 7420 756e  sary, cut out un
-00004630: 7761 6e74 6564 2064 6174 610d 0a20 2020  wanted data..   
-00004640: 2020 2020 2069 6620 6c65 6e28 696e 7075       if len(inpu
-00004650: 745f 6466 2920 3e20 3020 616e 6420 6c65  t_df) > 0 and le
-00004660: 6e28 6466 2920 3e20 303a 0d0a 2020 2020  n(df) > 0:..    
-00004670: 2020 2020 2020 2020 7374 6172 745f 6964          start_id
-00004680: 7820 3d20 656e 645f 6964 7820 3d20 4e6f  x = end_idx = No
-00004690: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-000046a0: 6966 2069 6e70 7574 5f64 662e 696e 6465  if input_df.inde
-000046b0: 785b 305d 203e 2064 662e 696e 6465 785b  x[0] > df.index[
-000046c0: 305d 3a0d 0a20 2020 2020 2020 2020 2020  0]:..           
-000046d0: 2020 2020 2073 7461 7274 5f69 6478 203d       start_idx =
-000046e0: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-000046f0: 6966 2069 6e70 7574 5f64 662e 696e 6465  if input_df.inde
-00004700: 785b 2d31 5d20 3c20 6466 2e69 6e64 6578  x[-1] < df.index
-00004710: 5b2d 315d 3a0d 0a20 2020 2020 2020 2020  [-1]:..         
-00004720: 2020 2020 2020 2065 6e64 5f69 6478 203d         end_idx =
-00004730: 202d 310d 0a20 2020 2020 2020 2020 2020   -1..           
-00004740: 2069 6620 7374 6172 745f 6964 7820 6973   if start_idx is
-00004750: 206e 6f74 204e 6f6e 6520 6f72 2065 6e64   not None or end
-00004760: 5f69 6478 2069 7320 6e6f 7420 4e6f 6e65  _idx is not None
-00004770: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00004780: 2020 206f 7574 7075 745f 6466 203d 206f     output_df = o
-00004790: 7574 7075 745f 6466 2e6c 6f63 5b69 6e70  utput_df.loc[inp
-000047a0: 7574 5f64 662e 696e 6465 785b 7374 6172  ut_df.index[star
-000047b0: 745f 6964 783a 656e 645f 6964 785d 2c20  t_idx:end_idx], 
-000047c0: 3a5d 0d0a 2020 2020 2020 2020 6f75 7470  :]..        outp
-000047d0: 7574 5f64 6620 3d20 7365 6c66 2e70 6f73  ut_df = self.pos
-000047e0: 745f 7570 6461 7465 286f 7574 7075 745f  t_update(output_
-000047f0: 6466 290d 0a20 2020 2020 2020 206f 7574  df)..        out
-00004800: 7075 745f 6466 203d 206f 7574 7075 745f  put_df = output_
-00004810: 6466 2e72 6573 6574 5f69 6e64 6578 2829  df.reset_index()
-00004820: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-00004830: 6620 3d20 6f75 7470 7574 5f64 665b 5b6f  f = output_df[[o
-00004840: 7574 7075 745f 6466 2e63 6f6c 756d 6e73  utput_df.columns
-00004850: 5b30 5d5d 2b6f 7269 675f 636f 6c73 5d20  [0]]+orig_cols] 
-00004860: 6966 206f 7269 675f 636f 6c73 2065 6c73  if orig_cols els
-00004870: 6520 6f75 7470 7574 5f64 660d 0a20 2020  e output_df..   
-00004880: 2020 2020 2073 656c 662e 696e 6974 5f78       self.init_x
-00004890: 3120 3d20 7365 6c66 2e78 6c65 6e20 2b20  1 = self.xlen + 
-000048a0: 7269 6768 745f 6d61 7267 696e 5f63 616e  right_margin_can
-000048b0: 646c 6573 202d 2073 6964 655f 6d61 7267  dles - side_marg
-000048c0: 696e 0d0a 2020 2020 2020 2020 7365 6c66  in..        self
-000048d0: 2e63 6163 6865 5f68 696c 6f20 3d20 4f72  .cache_hilo = Or
-000048e0: 6465 7265 6444 6963 7428 290d 0a20 2020  deredDict()..   
-000048f0: 2020 2020 2073 656c 662e 5f70 6572 696f       self._perio
-00004900: 6420 3d20 7365 6c66 2e5f 736d 6f6f 7468  d = self._smooth
-00004910: 5f74 696d 6520 3d20 4e6f 6e65 0d0a 0d0a  _time = None....
-00004920: 2020 2020 6465 6620 7365 745f 6466 2873      def set_df(s
-00004930: 656c 662c 2064 6629 3a0d 0a20 2020 2020  elf, df):..     
-00004940: 2020 2073 656c 662e 6466 203d 2064 660d     self.df = df.
-00004950: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
-00004960: 6368 655f 6869 6c6f 203d 204f 7264 6572  che_hilo = Order
-00004970: 6564 4469 6374 2829 0d0a 2020 2020 2020  edDict()..      
-00004980: 2020 7365 6c66 2e5f 7065 7269 6f64 203d    self._period =
-00004990: 2073 656c 662e 5f73 6d6f 6f74 685f 7469   self._smooth_ti
-000049a0: 6d65 203d 204e 6f6e 650d 0a0d 0a20 2020  me = None....   
-000049b0: 2064 6566 2068 696c 6f28 7365 6c66 2c20   def hilo(self, 
-000049c0: 7830 2c20 7831 293a 0d0a 2020 2020 2020  x0, x1):..      
-000049d0: 2020 2727 2752 6574 7572 6e20 6669 7665    '''Return five
-000049e0: 2076 616c 7565 7320 696e 2074 696d 6520   values in time 
-000049f0: 7261 6e67 653a 2074 302c 2074 312c 2068  range: t0, t1, h
-00004a00: 6967 6865 7374 2c20 6c6f 7765 7374 2c20  ighest, lowest, 
-00004a10: 6e75 6d62 6572 206f 6620 726f 7773 2e27  number of rows.'
-00004a20: 2727 0d0a 2020 2020 2020 2020 6966 2078  ''..        if x
-00004a30: 3020 3d3d 2078 313a 0d0a 2020 2020 2020  0 == x1:..      
-00004a40: 2020 2020 2020 7830 203d 2078 3120 3d20        x0 = x1 = 
-00004a50: 696e 7428 7831 290d 0a20 2020 2020 2020  int(x1)..       
-00004a60: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00004a70: 2020 2020 7830 2c78 3120 3d20 696e 7428      x0,x1 = int(
-00004a80: 7830 2b30 2e35 292c 696e 7428 7831 290d  x0+0.5),int(x1).
-00004a90: 0a20 2020 2020 2020 2071 7565 7279 203d  .        query =
-00004aa0: 2027 2569 2c25 6927 2025 2028 7830 2c78   '%i,%i' % (x0,x
-00004ab0: 3129 0d0a 2020 2020 2020 2020 6966 2071  1)..        if q
-00004ac0: 7565 7279 206e 6f74 2069 6e20 7365 6c66  uery not in self
-00004ad0: 2e63 6163 6865 5f68 696c 6f3a 0d0a 2020  .cache_hilo:..  
-00004ae0: 2020 2020 2020 2020 2020 7620 3d20 7365            v = se
-00004af0: 6c66 2e63 6163 6865 5f68 696c 6f5b 7175  lf.cache_hilo[qu
-00004b00: 6572 795d 203d 2073 656c 662e 5f68 696c  ery] = self._hil
-00004b10: 6f28 7830 2c20 7831 290d 0a20 2020 2020  o(x0, x1)..     
-00004b20: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00004b30: 2020 2020 2020 2320 7265 2d69 6e73 6572        # re-inser
-00004b40: 7420 746f 2072 6169 7365 2070 7269 6f0d  t to raise prio.
-00004b50: 0a20 2020 2020 2020 2020 2020 2076 203d  .            v =
-00004b60: 2073 656c 662e 6361 6368 655f 6869 6c6f   self.cache_hilo
-00004b70: 5b71 7565 7279 5d20 3d20 7365 6c66 2e63  [query] = self.c
-00004b80: 6163 6865 5f68 696c 6f2e 706f 7028 7175  ache_hilo.pop(qu
-00004b90: 6572 7929 0d0a 2020 2020 2020 2020 6966  ery)..        if
-00004ba0: 206c 656e 2873 656c 662e 6361 6368 655f   len(self.cache_
-00004bb0: 6869 6c6f 2920 3e20 3130 303a 2023 2064  hilo) > 100: # d
-00004bc0: 726f 7020 6966 2074 6f6f 206d 616e 790d  rop if too many.
-00004bd0: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-00004be0: 2073 656c 662e 6361 6368 655f 6869 6c6f   self.cache_hilo
-00004bf0: 5b6e 6578 7428 6974 6572 2873 656c 662e  [next(iter(self.
-00004c00: 6361 6368 655f 6869 6c6f 2929 5d0d 0a20  cache_hilo))].. 
-00004c10: 2020 2020 2020 2072 6574 7572 6e20 760d         return v.
-00004c20: 0a0d 0a20 2020 2064 6566 205f 6869 6c6f  ...    def _hilo
-00004c30: 2873 656c 662c 2078 302c 2078 3129 3a0d  (self, x0, x1):.
-00004c40: 0a20 2020 2020 2020 2064 6620 3d20 7365  .        df = se
-00004c50: 6c66 2e64 662e 6c6f 635b 7830 3a78 312c  lf.df.loc[x0:x1,
-00004c60: 203a 5d0d 0a20 2020 2020 2020 2069 6620   :]..        if 
-00004c70: 6e6f 7420 6c65 6e28 6466 293a 0d0a 2020  not len(df):..  
-00004c80: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00004c90: 2030 2c30 2c30 2c30 2c30 0d0a 2020 2020   0,0,0,0,0..    
-00004ca0: 2020 2020 7469 6d65 636f 6c20 3d20 6466      timecol = df
-00004cb0: 2e63 6f6c 756d 6e73 5b30 5d0d 0a20 2020  .columns[0]..   
-00004cc0: 2020 2020 2074 3020 3d20 6466 5b74 696d       t0 = df[tim
-00004cd0: 6563 6f6c 5d2e 696c 6f63 5b30 5d0d 0a20  ecol].iloc[0].. 
-00004ce0: 2020 2020 2020 2074 3120 3d20 6466 5b74         t1 = df[t
-00004cf0: 696d 6563 6f6c 5d2e 696c 6f63 5b2d 315d  imecol].iloc[-1]
-00004d00: 0d0a 2020 2020 2020 2020 7661 6c63 6f6c  ..        valcol
-00004d10: 7320 3d20 6466 2e63 6f6c 756d 6e73 5b73  s = df.columns[s
-00004d20: 656c 662e 7363 616c 655f 636f 6c73 5d0d  elf.scale_cols].
-00004d30: 0a20 2020 2020 2020 2068 6920 3d20 6466  .        hi = df
-00004d40: 5b76 616c 636f 6c73 5d2e 6d61 7828 292e  [valcols].max().
-00004d50: 6d61 7828 290d 0a20 2020 2020 2020 206c  max()..        l
-00004d60: 6f20 3d20 6466 5b76 616c 636f 6c73 5d2e  o = df[valcols].
-00004d70: 6d69 6e28 292e 6d69 6e28 290d 0a20 2020  min().min()..   
-00004d80: 2020 2020 2072 6574 7572 6e20 7430 2c74       return t0,t
-00004d90: 312c 6869 2c6c 6f2c 6c65 6e28 6466 290d  1,hi,lo,len(df).
-00004da0: 0a0d 0a20 2020 2064 6566 2072 6f77 7328  ...    def rows(
-00004db0: 7365 6c66 2c20 636f 6c63 6e74 2c20 7830  self, colcnt, x0
-00004dc0: 2c20 7831 2c20 7973 6361 6c65 2c20 6c6f  , x1, yscale, lo
-00004dd0: 643d 5472 7565 2c20 7265 7361 6d70 3d4e  d=True, resamp=N
-00004de0: 6f6e 6529 3a0d 0a20 2020 2020 2020 2064  one):..        d
-00004df0: 6620 3d20 7365 6c66 2e64 662e 6c6f 635b  f = self.df.loc[
-00004e00: 7830 3a78 312c 203a 5d0d 0a20 2020 2020  x0:x1, :]..     
-00004e10: 2020 2069 6620 7365 6c66 2e69 735f 7370     if self.is_sp
-00004e20: 6172 7365 3a0d 0a20 2020 2020 2020 2020  arse:..         
-00004e30: 2020 2064 6620 3d20 6466 2e6c 6f63 5b64     df = df.loc[d
-00004e40: 662e 696c 6f63 5b3a 2c73 656c 662e 636f  f.iloc[:,self.co
-00004e50: 6c5f 6461 7461 5f6f 6666 7365 745d 2e6e  l_data_offset].n
-00004e60: 6f74 6e61 2829 2c20 3a5d 0d0a 2020 2020  otna(), :]..    
-00004e70: 2020 2020 6f72 6967 6c65 6e20 3d20 6c65      origlen = le
-00004e80: 6e28 6466 290d 0a20 2020 2020 2020 2072  n(df)..        r
-00004e90: 6574 7572 6e20 7365 6c66 2e5f 726f 7773  eturn self._rows
-00004ea0: 2864 662c 2063 6f6c 636e 742c 2079 7363  (df, colcnt, ysc
-00004eb0: 616c 653d 7973 6361 6c65 2c20 6c6f 643d  ale=yscale, lod=
-00004ec0: 6c6f 642c 2072 6573 616d 703d 7265 7361  lod, resamp=resa
-00004ed0: 6d70 292c 206f 7269 676c 656e 0d0a 0d0a  mp), origlen....
-00004ee0: 2020 2020 6465 6620 5f72 6f77 7328 7365      def _rows(se
-00004ef0: 6c66 2c20 6466 2c20 636f 6c63 6e74 2c20  lf, df, colcnt, 
-00004f00: 7973 6361 6c65 2c20 6c6f 642c 2072 6573  yscale, lod, res
-00004f10: 616d 7029 3a0d 0a20 2020 2020 2020 2069  amp):..        i
-00004f20: 6620 6c6f 6420 616e 6420 6c65 6e28 6466  f lod and len(df
-00004f30: 2920 3e20 6c6f 645f 6361 6e64 6c65 733a  ) > lod_candles:
-00004f40: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00004f50: 2072 6573 616d 703a 0d0a 2020 2020 2020   resamp:..      
-00004f60: 2020 2020 2020 2020 2020 6466 203d 2073            df = s
-00004f70: 656c 662e 5f72 6573 616d 706c 6528 6466  elf._resample(df
-00004f80: 2c20 636f 6c63 6e74 2c20 7265 7361 6d70  , colcnt, resamp
-00004f90: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00004fa0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00004fb0: 2020 2020 2020 6466 203d 2064 662e 696c        df = df.il
-00004fc0: 6f63 5b3a 3a6c 656e 2864 6629 2f2f 6c6f  oc[::len(df)//lo
-00004fd0: 645f 6361 6e64 6c65 735d 0d0a 2020 2020  d_candles]..    
-00004fe0: 2020 2020 636f 6c63 6e74 202d 3d20 3120      colcnt -= 1 
-00004ff0: 2320 7469 6d65 2069 7320 616c 7761 7973  # time is always
-00005000: 2069 6d70 6c69 6564 0d0a 2020 2020 2020   implied..      
-00005010: 2020 636f 6c69 6478 7320 3d20 5b30 5d20    colidxs = [0] 
-00005020: 2b20 6c69 7374 2872 616e 6765 2873 656c  + list(range(sel
-00005030: 662e 636f 6c5f 6461 7461 5f6f 6666 7365  f.col_data_offse
-00005040: 742c 2073 656c 662e 636f 6c5f 6461 7461  t, self.col_data
-00005050: 5f6f 6666 7365 742b 636f 6c63 6e74 2929  _offset+colcnt))
-00005060: 0d0a 2020 2020 2020 2020 6466 7220 3d20  ..        dfr = 
-00005070: 6466 2e69 6c6f 635b 3a2c 636f 6c69 6478  df.iloc[:,colidx
-00005080: 735d 0d0a 2020 2020 2020 2020 6966 2079  s]..        if y
-00005090: 7363 616c 652e 7363 616c 6574 7970 6520  scale.scaletype 
-000050a0: 3d3d 2027 6c6f 6727 206f 7220 7973 6361  == 'log' or ysca
-000050b0: 6c65 2e73 6361 6c65 6620 213d 2031 3a0d  le.scalef != 1:.
-000050c0: 0a20 2020 2020 2020 2020 2020 2064 6672  .            dfr
-000050d0: 203d 2064 6672 2e63 6f70 7928 290d 0a20   = dfr.copy().. 
-000050e0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-000050f0: 2069 6e20 7261 6e67 6528 312c 2063 6f6c   in range(1, col
-00005100: 636e 742b 3129 3a0d 0a20 2020 2020 2020  cnt+1):..       
-00005110: 2020 2020 2020 2020 2063 6f6c 6e61 6d65           colname
-00005120: 203d 2064 6672 2e63 6f6c 756d 6e73 5b69   = dfr.columns[i
-00005130: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00005140: 2020 2069 6620 6466 725b 636f 6c6e 616d     if dfr[colnam
-00005150: 655d 2e64 7479 7065 2021 3d20 6f62 6a65  e].dtype != obje
-00005160: 6374 3a0d 0a20 2020 2020 2020 2020 2020  ct:..           
-00005170: 2020 2020 2020 2020 2064 6672 5b63 6f6c           dfr[col
-00005180: 6e61 6d65 5d20 3d20 7973 6361 6c65 2e69  name] = yscale.i
-00005190: 6e76 7866 6f72 6d28 6466 722e 696c 6f63  nvxform(dfr.iloc
-000051a0: 5b3a 2c69 5d29 0d0a 2020 2020 2020 2020  [:,i])..        
-000051b0: 7265 7475 726e 2064 6672 0d0a 0d0a 2020  return dfr....  
-000051c0: 2020 6465 6620 5f72 6573 616d 706c 6528    def _resample(
-000051d0: 7365 6c66 2c20 6466 2c20 636f 6c63 6e74  self, df, colcnt
-000051e0: 2c20 7265 7361 6d70 293a 0d0a 2020 2020  , resamp):..    
-000051f0: 2020 2020 6364 6f20 3d20 7365 6c66 2e63      cdo = self.c
-00005200: 6f6c 5f64 6174 615f 6f66 6673 6574 0d0a  ol_data_offset..
-00005210: 2020 2020 2020 2020 7361 6d70 6c65 5f72          sample_r
-00005220: 6174 6520 3d20 6c65 6e28 6466 2920 2a20  ate = len(df) * 
-00005230: 3520 2f2f 206c 6f64 5f63 616e 646c 6573  5 // lod_candles
-00005240: 0d0a 2020 2020 2020 2020 6f66 6673 6574  ..        offset
-00005250: 203d 206c 656e 2864 6629 2025 2073 616d   = len(df) % sam
-00005260: 706c 655f 7261 7465 0d0a 2020 2020 2020  ple_rate..      
-00005270: 2020 6466 6420 3d20 6466 5b5b 6466 2e63    dfd = df[[df.c
-00005280: 6f6c 756d 6e73 5b30 5d5d 2b5b 6466 2e63  olumns[0]]+[df.c
-00005290: 6f6c 756d 6e73 5b63 646f 5d5d 5d2e 696c  olumns[cdo]]].il
-000052a0: 6f63 5b6f 6666 7365 743a 3a73 616d 706c  oc[offset::sampl
-000052b0: 655f 7261 7465 5d0d 0a20 2020 2020 2020  e_rate]..       
-000052c0: 2063 203d 2064 665b 6466 2e63 6f6c 756d   c = df[df.colum
-000052d0: 6e73 5b63 646f 2b31 5d5d 2e69 6c6f 635b  ns[cdo+1]].iloc[
-000052e0: 6f66 6673 6574 2b73 616d 706c 655f 7261  offset+sample_ra
-000052f0: 7465 2d31 3a3a 7361 6d70 6c65 5f72 6174  te-1::sample_rat
-00005300: 655d 0d0a 2020 2020 2020 2020 632e 696e  e]..        c.in
-00005310: 6465 7820 2d3d 2073 616d 706c 655f 7261  dex -= sample_ra
-00005320: 7465 202d 2031 0d0a 2020 2020 2020 2020  te - 1..        
-00005330: 6466 645b 6466 2e63 6f6c 756d 6e73 5b63  dfd[df.columns[c
-00005340: 646f 2b31 5d5d 203d 2063 0d0a 2020 2020  do+1]] = c..    
-00005350: 2020 2020 6966 2072 6573 616d 7020 3d3d      if resamp ==
-00005360: 2027 6869 6c6f 273a 0d0a 2020 2020 2020   'hilo':..      
-00005370: 2020 2020 2020 6466 645b 6466 2e63 6f6c        dfd[df.col
-00005380: 756d 6e73 5b63 646f 2b32 5d5d 203d 2064  umns[cdo+2]] = d
-00005390: 665b 6466 2e63 6f6c 756d 6e73 5b63 646f  f[df.columns[cdo
-000053a0: 2b32 5d5d 2e72 6f6c 6c69 6e67 2873 616d  +2]].rolling(sam
-000053b0: 706c 655f 7261 7465 292e 6d61 7828 292e  ple_rate).max().
-000053c0: 7368 6966 7428 2d73 616d 706c 655f 7261  shift(-sample_ra
-000053d0: 7465 2b31 290d 0a20 2020 2020 2020 2020  te+1)..         
-000053e0: 2020 2064 6664 5b64 662e 636f 6c75 6d6e     dfd[df.column
-000053f0: 735b 6364 6f2b 335d 5d20 3d20 6466 5b64  s[cdo+3]] = df[d
-00005400: 662e 636f 6c75 6d6e 735b 6364 6f2b 335d  f.columns[cdo+3]
-00005410: 5d2e 726f 6c6c 696e 6728 7361 6d70 6c65  ].rolling(sample
-00005420: 5f72 6174 6529 2e6d 696e 2829 2e73 6869  _rate).min().shi
-00005430: 6674 282d 7361 6d70 6c65 5f72 6174 652b  ft(-sample_rate+
-00005440: 3129 0d0a 2020 2020 2020 2020 656c 7365  1)..        else
-00005450: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-00005460: 6664 5b64 662e 636f 6c75 6d6e 735b 6364  fd[df.columns[cd
-00005470: 6f2b 325d 5d20 3d20 6466 5b64 662e 636f  o+2]] = df[df.co
-00005480: 6c75 6d6e 735b 6364 6f2b 325d 5d2e 726f  lumns[cdo+2]].ro
-00005490: 6c6c 696e 6728 7361 6d70 6c65 5f72 6174  lling(sample_rat
-000054a0: 6529 2e73 756d 2829 2e73 6869 6674 282d  e).sum().shift(-
-000054b0: 7361 6d70 6c65 5f72 6174 652b 3129 0d0a  sample_rate+1)..
-000054c0: 2020 2020 2020 2020 2020 2020 6466 645b              dfd[
-000054d0: 6466 2e63 6f6c 756d 6e73 5b63 646f 2b33  df.columns[cdo+3
-000054e0: 5d5d 203d 2064 665b 6466 2e63 6f6c 756d  ]] = df[df.colum
-000054f0: 6e73 5b63 646f 2b33 5d5d 2e72 6f6c 6c69  ns[cdo+3]].rolli
-00005500: 6e67 2873 616d 706c 655f 7261 7465 292e  ng(sample_rate).
-00005510: 7375 6d28 292e 7368 6966 7428 2d73 616d  sum().shift(-sam
-00005520: 706c 655f 7261 7465 2b31 290d 0a20 2020  ple_rate+1)..   
-00005530: 2020 2020 2023 2061 7070 656e 6420 7472       # append tr
-00005540: 6169 6c69 6e67 2063 6f6c 756d 6e73 0d0a  ailing columns..
-00005550: 2020 2020 2020 2020 7472 6169 6c69 6e67          trailing
-00005560: 5f63 6f6c 6964 7820 3d20 6364 6f20 2b20  _colidx = cdo + 
-00005570: 340d 0a20 2020 2020 2020 2066 6f72 2069  4..        for i
-00005580: 2069 6e20 7261 6e67 6528 7472 6169 6c69   in range(traili
-00005590: 6e67 5f63 6f6c 6964 782c 2063 6f6c 636e  ng_colidx, colcn
-000055a0: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
-000055b0: 2063 6f6c 203d 2064 662e 636f 6c75 6d6e   col = df.column
-000055c0: 735b 695d 0d0a 2020 2020 2020 2020 2020  s[i]..          
-000055d0: 2020 6466 645b 636f 6c5d 203d 2064 665b    dfd[col] = df[
-000055e0: 636f 6c5d 2e69 6c6f 635b 6f66 6673 6574  col].iloc[offset
-000055f0: 3a3a 7361 6d70 6c65 5f72 6174 655d 0d0a  ::sample_rate]..
-00005600: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00005610: 6664 0d0a 0d0a 2020 2020 6465 6620 5f5f  fd....    def __
-00005620: 6571 5f5f 2873 656c 662c 206f 7468 6572  eq__(self, other
-00005630: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00005640: 726e 2069 6428 7365 6c66 2920 3d3d 2069  rn id(self) == i
-00005650: 6428 6f74 6865 7229 206f 7220 6964 2873  d(other) or id(s
-00005660: 656c 662e 6466 2920 3d3d 2069 6428 6f74  elf.df) == id(ot
-00005670: 6865 722e 6466 290d 0a0d 0a20 2020 2064  her.df)....    d
-00005680: 6566 205f 5f68 6173 685f 5f28 7365 6c66  ef __hash__(self
-00005690: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-000056a0: 726e 2069 6428 7365 6c66 290d 0a0d 0a0d  rn id(self).....
-000056b0: 0a63 6c61 7373 2046 696e 5769 6e64 6f77  .class FinWindow
-000056c0: 2870 672e 4772 6170 6869 6373 4c61 796f  (pg.GraphicsLayo
-000056d0: 7574 5769 6467 6574 293a 0d0a 2020 2020  utWidget):..    
-000056e0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-000056f0: 662c 2074 6974 6c65 2c20 2a2a 6b77 6172  f, title, **kwar
-00005700: 6773 293a 0d0a 2020 2020 2020 2020 676c  gs):..        gl
-00005710: 6f62 616c 2077 696e 782c 2077 696e 790d  obal winx, winy.
-00005720: 0a20 2020 2020 2020 2073 656c 662e 7469  .        self.ti
-00005730: 746c 6520 3d20 7469 746c 650d 0a20 2020  tle = title..   
-00005740: 2020 2020 2070 672e 6d6b 5141 7070 2829       pg.mkQApp()
-00005750: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
-00005760: 292e 5f5f 696e 6974 5f5f 282a 2a6b 7761  ).__init__(**kwa
-00005770: 7267 7329 0d0a 2020 2020 2020 2020 7365  rgs)..        se
-00005780: 6c66 2e73 6574 5769 6e64 6f77 5469 746c  lf.setWindowTitl
-00005790: 6528 7469 746c 6529 0d0a 2020 2020 2020  e(title)..      
-000057a0: 2020 7365 6c66 2e73 6574 4765 6f6d 6574    self.setGeomet
-000057b0: 7279 2877 696e 782c 2077 696e 792c 2077  ry(winx, winy, w
-000057c0: 696e 772c 2077 696e 6829 0d0a 2020 2020  inw, winh)..    
-000057d0: 2020 2020 7769 6e78 203d 2028 7769 6e78      winx = (winx
-000057e0: 2b77 696e 5f72 6563 7265 6174 655f 6465  +win_recreate_de
-000057f0: 6c74 6129 2025 2038 3030 0d0a 2020 2020  lta) % 800..    
-00005800: 2020 2020 7769 6e79 203d 2028 7769 6e79      winy = (winy
-00005810: 2b77 696e 5f72 6563 7265 6174 655f 6465  +win_recreate_de
-00005820: 6c74 6129 2025 2035 3030 0d0a 2020 2020  lta) % 500..    
-00005830: 2020 2020 7365 6c66 2e63 656e 7472 616c      self.central
-00005840: 5769 6467 6574 2e69 6e73 7461 6c6c 4576  Widget.installEv
-00005850: 656e 7446 696c 7465 7228 7365 6c66 290d  entFilter(self).
-00005860: 0a20 2020 2020 2020 2073 656c 662e 6369  .        self.ci
-00005870: 2e73 6574 436f 6e74 656e 7473 4d61 7267  .setContentsMarg
-00005880: 696e 7328 302c 2030 2c20 302c 2030 290d  ins(0, 0, 0, 0).
-00005890: 0a20 2020 2020 2020 2073 656c 662e 6369  .        self.ci
-000058a0: 2e73 6574 5370 6163 696e 6728 2d31 290d  .setSpacing(-1).
-000058b0: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
-000058c0: 6f73 696e 6720 3d20 4661 6c73 650d 0a0d  osing = False...
-000058d0: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
-000058e0: 2020 2020 6465 6620 6178 7328 7365 6c66      def axs(self
-000058f0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00005900: 726e 205b 6178 2066 6f72 2061 7820 696e  rn [ax for ax in
-00005910: 2073 656c 662e 6369 2e69 7465 6d73 2069   self.ci.items i
-00005920: 6620 6973 696e 7374 616e 6365 2861 782c  f isinstance(ax,
-00005930: 2070 672e 506c 6f74 4974 656d 295d 0d0a   pg.PlotItem)]..
-00005940: 0d0a 2020 2020 6465 6620 6175 746f 5261  ..    def autoRa
-00005950: 6e67 6545 6e61 626c 6564 2873 656c 6629  ngeEnabled(self)
-00005960: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-00005970: 6e20 5b54 7275 652c 2054 7275 655d 0d0a  n [True, True]..
-00005980: 0d0a 2020 2020 6465 6620 636c 6f73 6528  ..    def close(
-00005990: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-000059a0: 7365 6c66 2e63 6c6f 7369 6e67 203d 2054  self.closing = T
-000059b0: 7275 650d 0a20 2020 2020 2020 205f 7361  rue..        _sa
-000059c0: 7665 7769 6e64 6174 6128 7365 6c66 290d  vewindata(self).
-000059d0: 0a20 2020 2020 2020 205f 636c 6561 725f  .        _clear_
-000059e0: 7469 6d65 7273 2829 0d0a 2020 2020 2020  timers()..      
-000059f0: 2020 7265 7475 726e 2073 7570 6572 2829    return super()
-00005a00: 2e63 6c6f 7365 2829 0d0a 0d0a 2020 2020  .close()....    
-00005a10: 6465 6620 6576 656e 7446 696c 7465 7228  def eventFilter(
-00005a20: 7365 6c66 2c20 6f62 6a2c 2065 7629 3a0d  self, obj, ev):.
-00005a30: 0a20 2020 2020 2020 2069 6620 6576 2e74  .        if ev.t
-00005a40: 7970 6528 293d 3d20 5174 436f 7265 2e51  ype()== QtCore.Q
-00005a50: 4576 656e 742e 5479 7065 2e57 696e 646f  Event.Type.Windo
-00005a60: 7744 6561 6374 6976 6174 653a 0d0a 2020  wDeactivate:..  
-00005a70: 2020 2020 2020 2020 2020 5f73 6176 6577            _savew
-00005a80: 696e 6461 7461 2873 656c 6629 0d0a 2020  indata(self)..  
-00005a90: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00005aa0: 7365 0d0a 0d0a 2020 2020 6465 6620 7265  se....    def re
-00005ab0: 7369 7a65 4576 656e 7428 7365 6c66 2c20  sizeEvent(self, 
-00005ac0: 6576 293a 0d0a 2020 2020 2020 2020 2727  ev):..        ''
-00005ad0: 2757 6520 7265 7369 7a65 2061 6e64 2073  'We resize and s
-00005ae0: 6574 2074 6865 2074 6f70 2059 2061 7869  et the top Y axi
-00005af0: 7320 6c61 7267 6572 2061 6363 6f72 6469  s larger accordi
-00005b00: 6e67 2074 6f20 7468 6520 6178 6973 5f68  ng to the axis_h
-00005b10: 6569 6768 745f 6661 6374 6f72 2e0d 0a20  eight_factor... 
-00005b20: 2020 2020 2020 2020 2020 4e6f 2070 6f69            No poi
-00005b30: 6e74 2069 6e20 7472 7969 6e67 2074 6f20  nt in trying to 
-00005b40: 7573 6520 7468 6520 2272 6f77 2073 7472  use the "row str
-00005b50: 6574 6368 2066 6163 746f 7222 2069 6e20  etch factor" in 
-00005b60: 5174 2077 6869 6368 2069 7320 6272 6f6b  Qt which is brok
-00005b70: 656e 0d0a 2020 2020 2020 2020 2020 2062  en..           b
-00005b80: 6579 6f6e 6420 7265 7061 6972 2e27 2727  eyond repair.'''
-00005b90: 0d0a 2020 2020 2020 2020 6966 2065 7620  ..        if ev 
-00005ba0: 616e 6420 6e6f 7420 7365 6c66 2e63 6c6f  and not self.clo
-00005bb0: 7369 6e67 3a0d 0a20 2020 2020 2020 2020  sing:..         
-00005bc0: 2020 2061 7873 203d 2073 656c 662e 6178     axs = self.ax
-00005bd0: 730d 0a20 2020 2020 2020 2020 2020 206e  s..            n
-00005be0: 6577 5f77 696e 5f68 6569 6768 7420 3d20  ew_win_height = 
-00005bf0: 6576 2e73 697a 6528 292e 6865 6967 6874  ev.size().height
-00005c00: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00005c10: 6f6c 645f 7769 6e5f 6865 6967 6874 203d  old_win_height =
-00005c20: 2065 762e 6f6c 6453 697a 6528 292e 6865   ev.oldSize().he
-00005c30: 6967 6874 2829 2069 6620 6576 2e6f 6c64  ight() if ev.old
-00005c40: 5369 7a65 2829 2e68 6569 6768 7428 2920  Size().height() 
-00005c50: 3e20 3020 656c 7365 206e 6577 5f77 696e  > 0 else new_win
-00005c60: 5f68 6569 6768 740d 0a20 2020 2020 2020  _height..       
-00005c70: 2020 2020 2063 6c69 656e 745f 626f 7264       client_bord
-00005c80: 6572 7320 3d20 6f6c 645f 7769 6e5f 6865  ers = old_win_he
-00005c90: 6967 6874 202d 2073 756d 2861 782e 7662  ight - sum(ax.vb
-00005ca0: 2e73 697a 6528 292e 6865 6967 6874 2829  .size().height()
-00005cb0: 2066 6f72 2061 7820 696e 2061 7873 290d   for ax in axs).
-00005cc0: 0a20 2020 2020 2020 2020 2020 2063 6c69  .            cli
-00005cd0: 656e 745f 626f 7264 6572 7320 3d20 6d69  ent_borders = mi
-00005ce0: 6e28 6d61 7828 636c 6965 6e74 5f62 6f72  n(max(client_bor
-00005cf0: 6465 7273 2c20 3029 2c20 3330 2920 2320  ders, 0), 30) # 
-00005d00: 6872 6d0d 0a20 2020 2020 2020 2020 2020  hrm..           
-00005d10: 206e 6577 5f68 6569 6768 7420 3d20 6e65   new_height = ne
-00005d20: 775f 7769 6e5f 6865 6967 6874 202d 2063  w_win_height - c
-00005d30: 6c69 656e 745f 626f 7264 6572 730d 0a20  lient_borders.. 
-00005d40: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00005d50: 2c61 7820 696e 2065 6e75 6d65 7261 7465  ,ax in enumerate
-00005d60: 2861 7873 293a 0d0a 2020 2020 2020 2020  (axs):..        
-00005d70: 2020 2020 2020 2020 6a20 3d20 6178 6973          j = axis
-00005d80: 5f68 6569 6768 745f 6661 6374 6f72 2e67  _height_factor.g
-00005d90: 6574 2869 2c20 3129 0d0a 2020 2020 2020  et(i, 1)..      
-00005da0: 2020 2020 2020 2020 2020 6620 3d20 6a20            f = j 
-00005db0: 2f20 286c 656e 2861 7873 292b 7375 6d28  / (len(axs)+sum(
-00005dc0: 6178 6973 5f68 6569 6768 745f 6661 6374  axis_height_fact
-00005dd0: 6f72 2e76 616c 7565 7328 2929 2d6c 656e  or.values())-len
-00005de0: 2861 7869 735f 6865 6967 6874 5f66 6163  (axis_height_fac
-00005df0: 746f 7229 290d 0a20 2020 2020 2020 2020  tor))..         
-00005e00: 2020 2020 2020 2061 782e 7365 744d 696e         ax.setMin
-00005e10: 696d 756d 5369 7a65 2831 3030 2069 6620  imumSize(100 if 
-00005e20: 6a3e 3120 656c 7365 2035 302c 206e 6577  j>1 else 50, new
-00005e30: 5f68 6569 6768 742a 6629 0d0a 2020 2020  _height*f)..    
-00005e40: 2020 2020 7265 7475 726e 2073 7570 6572      return super
-00005e50: 2829 2e72 6573 697a 6545 7665 6e74 2865  ().resizeEvent(e
-00005e60: 7629 0d0a 0d0a 2020 2020 6465 6620 6c65  v)....    def le
-00005e70: 6176 6545 7665 6e74 2873 656c 662c 2065  aveEvent(self, e
-00005e80: 7629 3a0d 0a20 2020 2020 2020 2069 6620  v):..        if 
-00005e90: 6e6f 7420 7365 6c66 2e63 6c6f 7369 6e67  not self.closing
-00005ea0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00005eb0: 7570 6572 2829 2e6c 6561 7665 4576 656e  uper().leaveEven
-00005ec0: 7428 6576 290d 0a0d 0a0d 0a63 6c61 7373  t(ev)......class
-00005ed0: 2046 696e 4372 6f73 7348 6169 723a 0d0a   FinCrossHair:..
-00005ee0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00005ef0: 2873 656c 662c 2061 782c 2063 6f6c 6f72  (self, ax, color
-00005f00: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-00005f10: 2e61 7820 3d20 6178 0d0a 2020 2020 2020  .ax = ax..      
-00005f20: 2020 7365 6c66 2e78 203d 2030 0d0a 2020    self.x = 0..  
-00005f30: 2020 2020 2020 7365 6c66 2e79 203d 2030        self.y = 0
-00005f40: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00005f50: 6c61 6d70 5f78 203d 2030 0d0a 2020 2020  lamp_x = 0..    
-00005f60: 2020 2020 7365 6c66 2e63 6c61 6d70 5f79      self.clamp_y
-00005f70: 203d 2030 0d0a 2020 2020 2020 2020 7365   = 0..        se
-00005f80: 6c66 2e69 6e66 6f73 203d 205b 5d0d 0a20  lf.infos = [].. 
-00005f90: 2020 2020 2020 2070 656e 203d 2070 672e         pen = pg.
-00005fa0: 6d6b 5065 6e28 636f 6c6f 723d 636f 6c6f  mkPen(color=colo
-00005fb0: 722c 2073 7479 6c65 3d51 7443 6f72 652e  r, style=QtCore.
-00005fc0: 5174 2e50 656e 5374 796c 652e 4375 7374  Qt.PenStyle.Cust
-00005fd0: 6f6d 4461 7368 4c69 6e65 2c20 6461 7368  omDashLine, dash
-00005fe0: 3d5b 372c 2037 5d29 0d0a 2020 2020 2020  =[7, 7])..      
-00005ff0: 2020 7365 6c66 2e76 6c69 6e65 203d 2070    self.vline = p
-00006000: 672e 496e 6669 6e69 7465 4c69 6e65 2861  g.InfiniteLine(a
-00006010: 6e67 6c65 3d39 302c 206d 6f76 6162 6c65  ngle=90, movable
-00006020: 3d46 616c 7365 2c20 7065 6e3d 7065 6e29  =False, pen=pen)
-00006030: 0d0a 2020 2020 2020 2020 7365 6c66 2e68  ..        self.h
-00006040: 6c69 6e65 203d 2070 672e 496e 6669 6e69  line = pg.Infini
-00006050: 7465 4c69 6e65 2861 6e67 6c65 3d30 2c20  teLine(angle=0, 
-00006060: 6d6f 7661 626c 653d 4661 6c73 652c 2070  movable=False, p
-00006070: 656e 3d70 656e 290d 0a20 2020 2020 2020  en=pen)..       
-00006080: 2073 656c 662e 7874 6578 7420 3d20 7067   self.xtext = pg
-00006090: 2e54 6578 7449 7465 6d28 636f 6c6f 723d  .TextItem(color=
-000060a0: 636f 6c6f 722c 2061 6e63 686f 723d 2830  color, anchor=(0
-000060b0: 2c31 2929 0d0a 2020 2020 2020 2020 7365  ,1))..        se
-000060c0: 6c66 2e79 7465 7874 203d 2070 672e 5465  lf.ytext = pg.Te
-000060d0: 7874 4974 656d 2863 6f6c 6f72 3d63 6f6c  xtItem(color=col
-000060e0: 6f72 2c20 616e 6368 6f72 3d28 302c 3029  or, anchor=(0,0)
-000060f0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00006100: 766c 696e 652e 7365 745a 5661 6c75 6528  vline.setZValue(
-00006110: 3530 290d 0a20 2020 2020 2020 2073 656c  50)..        sel
-00006120: 662e 686c 696e 652e 7365 745a 5661 6c75  f.hline.setZValu
-00006130: 6528 3530 290d 0a20 2020 2020 2020 2073  e(50)..        s
-00006140: 656c 662e 7874 6578 742e 7365 745a 5661  elf.xtext.setZVa
-00006150: 6c75 6528 3530 290d 0a20 2020 2020 2020  lue(50)..       
-00006160: 2073 656c 662e 7974 6578 742e 7365 745a   self.ytext.setZ
-00006170: 5661 6c75 6528 3530 290d 0a20 2020 2020  Value(50)..     
-00006180: 2020 2073 656c 662e 7368 6f77 2829 0d0a     self.show()..
-00006190: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
-000061a0: 2873 656c 662c 2070 6f69 6e74 3d4e 6f6e  (self, point=Non
-000061b0: 6529 3a0d 0a20 2020 2020 2020 2069 6620  e):..        if 
-000061c0: 706f 696e 7420 6973 206e 6f74 204e 6f6e  point is not Non
-000061d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000061e0: 7365 6c66 2e78 2c73 656c 662e 7920 3d20  self.x,self.y = 
-000061f0: 782c 7920 3d20 706f 696e 742e 7828 292c  x,y = point.x(),
-00006200: 706f 696e 742e 7928 290d 0a20 2020 2020  point.y()..     
-00006210: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00006220: 2020 2020 2020 782c 7920 3d20 7365 6c66        x,y = self
-00006230: 2e78 2c73 656c 662e 790d 0a20 2020 2020  .x,self.y..     
-00006240: 2020 2078 2c79 203d 205f 636c 616d 705f     x,y = _clamp_
-00006250: 7879 2873 656c 662e 6178 2c20 782c 7929  xy(self.ax, x,y)
-00006260: 0d0a 2020 2020 2020 2020 6966 2078 203d  ..        if x =
-00006270: 3d20 7365 6c66 2e63 6c61 6d70 5f78 2061  = self.clamp_x a
-00006280: 6e64 2079 203d 3d20 7365 6c66 2e63 6c61  nd y == self.cla
-00006290: 6d70 5f79 3a0d 0a20 2020 2020 2020 2020  mp_y:..         
-000062a0: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
-000062b0: 2020 2073 656c 662e 636c 616d 705f 782c     self.clamp_x,
-000062c0: 7365 6c66 2e63 6c61 6d70 5f79 203d 2078  self.clamp_y = x
-000062d0: 2c79 0d0a 2020 2020 2020 2020 7365 6c66  ,y..        self
-000062e0: 2e76 6c69 6e65 2e73 6574 506f 7328 7829  .vline.setPos(x)
-000062f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e68  ..        self.h
-00006300: 6c69 6e65 2e73 6574 506f 7328 7929 0d0a  line.setPos(y)..
-00006310: 2020 2020 2020 2020 7365 6c66 2e78 7465          self.xte
-00006320: 7874 2e73 6574 506f 7328 782c 2079 290d  xt.setPos(x, y).
-00006330: 0a20 2020 2020 2020 2073 656c 662e 7974  .        self.yt
-00006340: 6578 742e 7365 7450 6f73 2878 2c20 7929  ext.setPos(x, y)
-00006350: 0d0a 2020 2020 2020 2020 726e 6720 3d20  ..        rng = 
-00006360: 7365 6c66 2e61 782e 7662 2e79 5f6d 6178  self.ax.vb.y_max
-00006370: 202d 2073 656c 662e 6178 2e76 622e 795f   - self.ax.vb.y_
-00006380: 6d69 6e0d 0a20 2020 2020 2020 2072 6e67  min..        rng
-00006390: 6d61 7820 3d20 6162 7328 7365 6c66 2e61  max = abs(self.a
-000063a0: 782e 7662 2e79 5f6d 696e 2920 2b20 726e  x.vb.y_min) + rn
-000063b0: 6720 2320 616e 7920 6170 7072 6f78 696d  g # any approxim
-000063c0: 6174 696f 6e20 6973 2066 696e 650d 0a20  ation is fine.. 
-000063d0: 2020 2020 2020 2073 642c 7365 203d 2028         sd,se = (
-000063e0: 7365 6c66 2e61 782e 7369 676e 6966 6963  self.ax.signific
-000063f0: 616e 745f 6465 6369 6d61 6c73 2c73 656c  ant_decimals,sel
-00006400: 662e 6178 2e73 6967 6e69 6669 6361 6e74  f.ax.significant
-00006410: 5f65 7073 2920 6966 2063 6c61 6d70 5f67  _eps) if clamp_g
-00006420: 7269 6420 656c 7365 2028 7369 676e 6966  rid else (signif
-00006430: 6963 616e 745f 6465 6369 6d61 6c73 2c73  icant_decimals,s
-00006440: 6967 6e69 6669 6361 6e74 5f65 7073 290d  ignificant_eps).
-00006450: 0a20 2020 2020 2020 2074 696d 6562 6173  .        timebas
-00006460: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
-00006470: 2020 2020 6966 2073 656c 662e 6178 2e76      if self.ax.v
-00006480: 622e 785f 696e 6465 7865 643a 0d0a 2020  b.x_indexed:..  
-00006490: 2020 2020 2020 2020 2020 7874 6578 742c            xtext,
-000064a0: 7469 6d65 6261 7365 6420 3d20 5f78 326c  timebased = _x2l
-000064b0: 6f63 616c 5f74 2873 656c 662e 6178 2e76  ocal_t(self.ax.v
-000064c0: 622e 6461 7461 7372 632c 2078 290d 0a20  b.datasrc, x).. 
-000064d0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000064e0: 2020 2020 2020 2020 2020 7874 6578 7420            xtext 
-000064f0: 3d20 5f72 6f75 6e64 5f74 6f5f 7369 676e  = _round_to_sign
-00006500: 6966 6963 616e 7428 726e 672c 2072 6e67  ificant(rng, rng
-00006510: 6d61 782c 2078 2c20 7364 2c20 7365 290d  max, x, sd, se).
-00006520: 0a20 2020 2020 2020 206c 696e 6561 725f  .        linear_
-00006530: 7920 3d20 790d 0a20 2020 2020 2020 2079  y = y..        y
-00006540: 203d 2073 656c 662e 6178 2e76 622e 7973   = self.ax.vb.ys
-00006550: 6361 6c65 2e78 666f 726d 2879 290d 0a20  cale.xform(y).. 
-00006560: 2020 2020 2020 2079 7465 7874 203d 205f         ytext = _
-00006570: 726f 756e 645f 746f 5f73 6967 6e69 6669  round_to_signifi
-00006580: 6361 6e74 2872 6e67 2c20 726e 676d 6178  cant(rng, rngmax
-00006590: 2c20 792c 2073 642c 2073 6529 0d0a 2020  , y, sd, se)..  
-000065a0: 2020 2020 2020 6966 206e 6f74 2074 696d        if not tim
-000065b0: 6562 6173 6564 3a0d 0a20 2020 2020 2020  ebased:..       
-000065c0: 2020 2020 2069 6620 7874 6578 743a 0d0a       if xtext:..
-000065d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065e0: 7874 6578 7420 3d20 2778 2027 202b 2078  xtext = 'x ' + x
-000065f0: 7465 7874 0d0a 2020 2020 2020 2020 2020  text..          
-00006600: 2020 7974 6578 7420 3d20 2779 2027 202b    ytext = 'y ' +
-00006610: 2079 7465 7874 0d0a 2020 2020 2020 2020   ytext..        
-00006620: 6661 725f 7269 6768 7420 3d20 7365 6c66  far_right = self
-00006630: 2e61 782e 7669 6577 5265 6374 2829 2e78  .ax.viewRect().x
-00006640: 2829 202b 2073 656c 662e 6178 2e76 6965  () + self.ax.vie
-00006650: 7752 6563 7428 292e 7769 6474 6828 292a  wRect().width()*
-00006660: 302e 390d 0a20 2020 2020 2020 2066 6172  0.9..        far
-00006670: 5f62 6f74 746f 6d20 3d20 7365 6c66 2e61  _bottom = self.a
-00006680: 782e 7669 6577 5265 6374 2829 2e79 2829  x.viewRect().y()
-00006690: 202b 2073 656c 662e 6178 2e76 6965 7752   + self.ax.viewR
-000066a0: 6563 7428 292e 6865 6967 6874 2829 2a30  ect().height()*0
-000066b0: 2e31 0d0a 2020 2020 2020 2020 636c 6f73  .1..        clos
-000066c0: 6532 7269 6768 7420 3d20 7820 3e20 6661  e2right = x > fa
-000066d0: 725f 7269 6768 740d 0a20 2020 2020 2020  r_right..       
-000066e0: 2063 6c6f 7365 3262 6f74 746f 6d20 3d20   close2bottom = 
-000066f0: 6c69 6e65 6172 5f79 203c 2066 6172 5f62  linear_y < far_b
-00006700: 6f74 746f 6d0d 0a20 2020 2020 2020 2074  ottom..        t
-00006710: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-00006720: 2066 6f72 2069 6e66 6f20 696e 2073 656c   for info in sel
-00006730: 662e 696e 666f 733a 0d0a 2020 2020 2020  f.infos:..      
-00006740: 2020 2020 2020 2020 2020 7874 6578 742c            xtext,
-00006750: 7974 6578 7420 3d20 696e 666f 2878 2c79  ytext = info(x,y
-00006760: 2c78 7465 7874 2c79 7465 7874 290d 0a20  ,xtext,ytext).. 
-00006770: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-00006780: 6365 7074 696f 6e20 6173 2065 3a0d 0a20  ception as e:.. 
-00006790: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000067a0: 2827 4372 6f73 7368 6169 7220 6572 726f  ('Crosshair erro
-000067b0: 723a 272c 2074 7970 6528 6529 2c20 6529  r:', type(e), e)
-000067c0: 0d0a 2020 2020 2020 2020 7370 6163 6520  ..        space 
-000067d0: 3d20 2720 2020 2020 2027 0d0a 2020 2020  = '      '..    
-000067e0: 2020 2020 6966 2063 6c6f 7365 3272 6967      if close2rig
-000067f0: 6874 3a0d 0a20 2020 2020 2020 2020 2020  ht:..           
-00006800: 2078 7465 7874 203d 2078 7465 7874 202b   xtext = xtext +
-00006810: 2073 7061 6365 0d0a 2020 2020 2020 2020   space..        
-00006820: 2020 2020 7974 6578 7420 3d20 7974 6578      ytext = ytex
-00006830: 7420 2b20 7370 6163 650d 0a20 2020 2020  t + space..     
-00006840: 2020 2020 2020 2078 616e 6368 6f72 203d         xanchor =
-00006850: 205b 312c 315d 0d0a 2020 2020 2020 2020   [1,1]..        
-00006860: 2020 2020 7961 6e63 686f 7220 3d20 5b31      yanchor = [1
-00006870: 2c30 5d0d 0a20 2020 2020 2020 2065 6c73  ,0]..        els
-00006880: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00006890: 7874 6578 7420 3d20 7370 6163 6520 2b20  xtext = space + 
-000068a0: 7874 6578 740d 0a20 2020 2020 2020 2020  xtext..         
-000068b0: 2020 2079 7465 7874 203d 2073 7061 6365     ytext = space
-000068c0: 202b 2079 7465 7874 0d0a 2020 2020 2020   + ytext..      
-000068d0: 2020 2020 2020 7861 6e63 686f 7220 3d20        xanchor = 
-000068e0: 5b30 2c31 5d0d 0a20 2020 2020 2020 2020  [0,1]..         
-000068f0: 2020 2079 616e 6368 6f72 203d 205b 302c     yanchor = [0,
-00006900: 305d 0d0a 2020 2020 2020 2020 6966 2063  0]..        if c
-00006910: 6c6f 7365 3262 6f74 746f 6d3a 0d0a 2020  lose2bottom:..  
-00006920: 2020 2020 2020 2020 2020 7974 6578 7420            ytext 
-00006930: 3d20 7974 6578 7420 2b20 7370 6163 650d  = ytext + space.
-00006940: 0a20 2020 2020 2020 2020 2020 2079 616e  .            yan
-00006950: 6368 6f72 203d 205b 312c 315d 0d0a 2020  chor = [1,1]..  
-00006960: 2020 2020 2020 2020 2020 6966 2063 6c6f            if clo
-00006970: 7365 3272 6967 6874 3a0d 0a20 2020 2020  se2right:..     
-00006980: 2020 2020 2020 2020 2020 2078 616e 6368             xanch
-00006990: 6f72 203d 205b 312c 325d 0d0a 2020 2020  or = [1,2]..    
-000069a0: 2020 2020 7365 6c66 2e78 7465 7874 2e73      self.xtext.s
-000069b0: 6574 416e 6368 6f72 2878 616e 6368 6f72  etAnchor(xanchor
-000069c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000069d0: 7974 6578 742e 7365 7441 6e63 686f 7228  ytext.setAnchor(
-000069e0: 7961 6e63 686f 7229 0d0a 2020 2020 2020  yanchor)..      
-000069f0: 2020 7365 6c66 2e78 7465 7874 2e73 6574    self.xtext.set
-00006a00: 5465 7874 2878 7465 7874 290d 0a20 2020  Text(xtext)..   
-00006a10: 2020 2020 2073 656c 662e 7974 6578 742e       self.ytext.
-00006a20: 7365 7454 6578 7428 7974 6578 7429 0d0a  setText(ytext)..
-00006a30: 0d0a 2020 2020 6465 6620 7368 6f77 2873  ..    def show(s
-00006a40: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
-00006a50: 656c 662e 6178 2e61 6464 4974 656d 2873  elf.ax.addItem(s
-00006a60: 656c 662e 766c 696e 652c 2069 676e 6f72  elf.vline, ignor
-00006a70: 6542 6f75 6e64 733d 5472 7565 290d 0a20  eBounds=True).. 
-00006a80: 2020 2020 2020 2073 656c 662e 6178 2e61         self.ax.a
-00006a90: 6464 4974 656d 2873 656c 662e 686c 696e  ddItem(self.hlin
-00006aa0: 652c 2069 676e 6f72 6542 6f75 6e64 733d  e, ignoreBounds=
-00006ab0: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
-00006ac0: 656c 662e 6178 2e61 6464 4974 656d 2873  elf.ax.addItem(s
-00006ad0: 656c 662e 7874 6578 742c 2069 676e 6f72  elf.xtext, ignor
-00006ae0: 6542 6f75 6e64 733d 5472 7565 290d 0a20  eBounds=True).. 
-00006af0: 2020 2020 2020 2073 656c 662e 6178 2e61         self.ax.a
-00006b00: 6464 4974 656d 2873 656c 662e 7974 6578  ddItem(self.ytex
-00006b10: 742c 2069 676e 6f72 6542 6f75 6e64 733d  t, ignoreBounds=
-00006b20: 5472 7565 290d 0a0d 0a20 2020 2064 6566  True)....    def
-00006b30: 2068 6964 6528 7365 6c66 293a 0d0a 2020   hide(self):..  
-00006b40: 2020 2020 2020 7365 6c66 2e61 782e 7265        self.ax.re
-00006b50: 6d6f 7665 4974 656d 2873 656c 662e 7874  moveItem(self.xt
-00006b60: 6578 7429 0d0a 2020 2020 2020 2020 7365  ext)..        se
-00006b70: 6c66 2e61 782e 7265 6d6f 7665 4974 656d  lf.ax.removeItem
-00006b80: 2873 656c 662e 7974 6578 7429 0d0a 2020  (self.ytext)..  
-00006b90: 2020 2020 2020 7365 6c66 2e61 782e 7265        self.ax.re
-00006ba0: 6d6f 7665 4974 656d 2873 656c 662e 766c  moveItem(self.vl
-00006bb0: 696e 6529 0d0a 2020 2020 2020 2020 7365  ine)..        se
-00006bc0: 6c66 2e61 782e 7265 6d6f 7665 4974 656d  lf.ax.removeItem
-00006bd0: 2873 656c 662e 686c 696e 6529 0d0a 0d0a  (self.hline)....
-00006be0: 0d0a 0d0a 636c 6173 7320 4669 6e4c 6567  ....class FinLeg
-00006bf0: 656e 6449 7465 6d28 7067 2e4c 6567 656e  endItem(pg.Legen
-00006c00: 6449 7465 6d29 3a0d 0a20 2020 2064 6566  dItem):..    def
-00006c10: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00006c20: 626f 7264 6572 5f63 6f6c 6f72 2c20 6669  border_color, fi
-00006c30: 6c6c 5f63 6f6c 6f72 2c20 2a2a 6b77 6172  ll_color, **kwar
-00006c40: 6773 293a 0d0a 2020 2020 2020 2020 7375  gs):..        su
-00006c50: 7065 7228 292e 5f5f 696e 6974 5f5f 282a  per().__init__(*
-00006c60: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
-00006c70: 2020 7365 6c66 2e6c 6179 6f75 742e 7365    self.layout.se
-00006c80: 7456 6572 7469 6361 6c53 7061 6369 6e67  tVerticalSpacing
-00006c90: 2832 290d 0a20 2020 2020 2020 2073 656c  (2)..        sel
-00006ca0: 662e 6c61 796f 7574 2e73 6574 486f 7269  f.layout.setHori
-00006cb0: 7a6f 6e74 616c 5370 6163 696e 6728 3230  zontalSpacing(20
-00006cc0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00006cd0: 6c61 796f 7574 2e73 6574 436f 6e74 656e  layout.setConten
-00006ce0: 7473 4d61 7267 696e 7328 322c 2032 2c20  tsMargins(2, 2, 
-00006cf0: 3130 2c20 3229 0d0a 2020 2020 2020 2020  10, 2)..        
-00006d00: 7365 6c66 2e62 6f72 6465 725f 636f 6c6f  self.border_colo
-00006d10: 7220 3d20 626f 7264 6572 5f63 6f6c 6f72  r = border_color
-00006d20: 0d0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
-00006d30: 696c 6c5f 636f 6c6f 7220 3d20 6669 6c6c  ill_color = fill
-00006d40: 5f63 6f6c 6f72 0d0a 0d0a 2020 2020 6465  _color....    de
-00006d50: 6620 7061 696e 7428 7365 6c66 2c20 702c  f paint(self, p,
-00006d60: 202a 6172 6773 293a 0d0a 2020 2020 2020   *args):..      
-00006d70: 2020 702e 7365 7450 656e 2870 672e 6d6b    p.setPen(pg.mk
-00006d80: 5065 6e28 7365 6c66 2e62 6f72 6465 725f  Pen(self.border_
-00006d90: 636f 6c6f 7229 290d 0a20 2020 2020 2020  color))..       
-00006da0: 2070 2e73 6574 4272 7573 6828 7067 2e6d   p.setBrush(pg.m
-00006db0: 6b42 7275 7368 2873 656c 662e 6669 6c6c  kBrush(self.fill
-00006dc0: 5f63 6f6c 6f72 2929 0d0a 2020 2020 2020  _color))..      
-00006dd0: 2020 702e 6472 6177 5265 6374 2873 656c    p.drawRect(sel
-00006de0: 662e 626f 756e 6469 6e67 5265 6374 2829  f.boundingRect()
-00006df0: 290d 0a0d 0a0d 0a0d 0a63 6c61 7373 2046  )........class F
-00006e00: 696e 506f 6c79 4c69 6e65 2870 672e 506f  inPolyLine(pg.Po
-00006e10: 6c79 4c69 6e65 524f 4929 3a0d 0a20 2020  lyLineROI):..   
-00006e20: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00006e30: 6c66 2c20 7662 2c20 2a61 7267 732c 202a  lf, vb, *args, *
-00006e40: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00006e50: 2020 2073 656c 662e 7662 203d 2076 6220     self.vb = vb 
-00006e60: 2320 696e 6974 2062 6566 6f72 6520 7061  # init before pa
-00006e70: 7265 6e74 2063 6f6e 7374 7275 6374 6f72  rent constructor
-00006e80: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
-00006e90: 6578 7473 203d 205b 5d0d 0a20 2020 2020  exts = []..     
-00006ea0: 2020 2073 7570 6572 2829 2e5f 5f69 6e69     super().__ini
-00006eb0: 745f 5f28 2a61 7267 732c 202a 2a6b 7761  t__(*args, **kwa
-00006ec0: 7267 7329 0d0a 0d0a 2020 2020 6465 6620  rgs)....    def 
-00006ed0: 6164 6453 6567 6d65 6e74 2873 656c 662c  addSegment(self,
-00006ee0: 2068 312c 2068 322c 2069 6e64 6578 3d4e   h1, h2, index=N
-00006ef0: 6f6e 6529 3a0d 0a20 2020 2020 2020 2073  one):..        s
-00006f00: 7570 6572 2829 2e61 6464 5365 676d 656e  uper().addSegmen
-00006f10: 7428 6831 2c20 6832 2c20 696e 6465 7829  t(h1, h2, index)
-00006f20: 0d0a 2020 2020 2020 2020 7465 7874 203d  ..        text =
-00006f30: 2070 672e 5465 7874 4974 656d 2863 6f6c   pg.TextItem(col
-00006f40: 6f72 3d64 7261 775f 6c69 6e65 5f63 6f6c  or=draw_line_col
-00006f50: 6f72 290d 0a20 2020 2020 2020 2074 6578  or)..        tex
-00006f60: 742e 7365 745a 5661 6c75 6528 3530 290d  t.setZValue(50).
-00006f70: 0a20 2020 2020 2020 2074 6578 742e 7365  .        text.se
-00006f80: 676d 656e 7420 3d20 7365 6c66 2e73 6567  gment = self.seg
-00006f90: 6d65 6e74 735b 2d31 2069 6620 696e 6465  ments[-1 if inde
-00006fa0: 7820 6973 204e 6f6e 6520 656c 7365 2069  x is None else i
-00006fb0: 6e64 6578 5d0d 0a20 2020 2020 2020 2069  ndex]..        i
-00006fc0: 6620 696e 6465 7820 6973 204e 6f6e 653a  f index is None:
-00006fd0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00006fe0: 6c66 2e74 6578 7473 2e61 7070 656e 6428  lf.texts.append(
-00006ff0: 7465 7874 290d 0a20 2020 2020 2020 2065  text)..        e
-00007000: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00007010: 2020 7365 6c66 2e74 6578 7473 2e69 6e73    self.texts.ins
-00007020: 6572 7428 696e 6465 782c 2074 6578 7429  ert(index, text)
-00007030: 0d0a 2020 2020 2020 2020 7365 6c66 2e75  ..        self.u
-00007040: 7064 6174 655f 7465 7874 2874 6578 7429  pdate_text(text)
-00007050: 0d0a 2020 2020 2020 2020 7365 6c66 2e76  ..        self.v
-00007060: 622e 6164 6449 7465 6d28 7465 7874 2c20  b.addItem(text, 
-00007070: 6967 6e6f 7265 426f 756e 6473 3d54 7275  ignoreBounds=Tru
-00007080: 6529 0d0a 0d0a 2020 2020 6465 6620 7265  e)....    def re
-00007090: 6d6f 7665 5365 676d 656e 7428 7365 6c66  moveSegment(self
-000070a0: 2c20 7365 6729 3a0d 0a20 2020 2020 2020  , seg):..       
-000070b0: 2073 7570 6572 2829 2e72 656d 6f76 6553   super().removeS
-000070c0: 6567 6d65 6e74 2873 6567 290d 0a20 2020  egment(seg)..   
-000070d0: 2020 2020 2066 6f72 2074 6578 7420 696e       for text in
-000070e0: 206c 6973 7428 7365 6c66 2e74 6578 7473   list(self.texts
-000070f0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00007100: 6966 2074 6578 742e 7365 676d 656e 7420  if text.segment 
-00007110: 3d3d 2073 6567 3a0d 0a20 2020 2020 2020  == seg:..       
-00007120: 2020 2020 2020 2020 2073 656c 662e 7662           self.vb
-00007130: 2e72 656d 6f76 6549 7465 6d28 7465 7874  .removeItem(text
-00007140: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00007150: 2020 2073 656c 662e 7465 7874 732e 7265     self.texts.re
-00007160: 6d6f 7665 2874 6578 7429 0d0a 0d0a 2020  move(text)....  
-00007170: 2020 6465 6620 7570 6461 7465 5f74 6578    def update_tex
-00007180: 7428 7365 6c66 2c20 7465 7874 293a 0d0a  t(self, text):..
-00007190: 2020 2020 2020 2020 6830 203d 2074 6578          h0 = tex
-000071a0: 742e 7365 676d 656e 742e 6861 6e64 6c65  t.segment.handle
-000071b0: 735b 305d 5b27 6974 656d 275d 0d0a 2020  s[0]['item']..  
-000071c0: 2020 2020 2020 6831 203d 2074 6578 742e        h1 = text.
-000071d0: 7365 676d 656e 742e 6861 6e64 6c65 735b  segment.handles[
-000071e0: 315d 5b27 6974 656d 275d 0d0a 2020 2020  1]['item']..    
-000071f0: 2020 2020 6469 6666 203d 2068 312e 706f      diff = h1.po
-00007200: 7328 2920 2d20 6830 2e70 6f73 2829 0d0a  s() - h0.pos()..
-00007210: 2020 2020 2020 2020 6966 2064 6966 662e          if diff.
-00007220: 7928 2920 3c20 303a 0d0a 2020 2020 2020  y() < 0:..      
-00007230: 2020 2020 2020 7465 7874 2e73 6574 416e        text.setAn
-00007240: 6368 6f72 2828 302e 352c 3029 290d 0a20  chor((0.5,0)).. 
-00007250: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00007260: 2020 2020 2020 2020 2020 7465 7874 2e73            text.s
-00007270: 6574 416e 6368 6f72 2828 302e 352c 3129  etAnchor((0.5,1)
-00007280: 290d 0a20 2020 2020 2020 2074 6578 742e  )..        text.
-00007290: 7365 7450 6f73 2868 312e 706f 7328 2929  setPos(h1.pos())
-000072a0: 0d0a 2020 2020 2020 2020 7465 7874 2e73  ..        text.s
-000072b0: 6574 5465 7874 285f 6472 6177 5f6c 696e  etText(_draw_lin
-000072c0: 655f 7365 676d 656e 745f 7465 7874 2873  e_segment_text(s
-000072d0: 656c 662c 2074 6578 742e 7365 676d 656e  elf, text.segmen
-000072e0: 742c 2068 302e 706f 7328 292c 2068 312e  t, h0.pos(), h1.
-000072f0: 706f 7328 2929 290d 0a0d 0a20 2020 2064  pos()))....    d
-00007300: 6566 2075 7064 6174 655f 7465 7874 7328  ef update_texts(
-00007310: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00007320: 666f 7220 7465 7874 2069 6e20 7365 6c66  for text in self
-00007330: 2e74 6578 7473 3a0d 0a20 2020 2020 2020  .texts:..       
-00007340: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-00007350: 5f74 6578 7428 7465 7874 290d 0a0d 0a20  _text(text).... 
-00007360: 2020 2064 6566 206d 6f76 6550 6f69 6e74     def movePoint
-00007370: 2873 656c 662c 2068 616e 646c 652c 2070  (self, handle, p
-00007380: 6f73 2c20 6d6f 6469 6669 6572 733d 5174  os, modifiers=Qt
-00007390: 436f 7265 2e51 742e 4b65 7962 6f61 7264  Core.Qt.Keyboard
-000073a0: 4d6f 6469 6669 6572 2c20 6669 6e69 7368  Modifier, finish
-000073b0: 3d54 7275 652c 2063 6f6f 7264 733d 2770  =True, coords='p
-000073c0: 6172 656e 7427 293a 0d0a 2020 2020 2020  arent'):..      
-000073d0: 2020 7375 7065 7228 292e 6d6f 7665 506f    super().movePo
-000073e0: 696e 7428 6861 6e64 6c65 2c20 706f 732c  int(handle, pos,
-000073f0: 206d 6f64 6966 6965 7273 2c20 6669 6e69   modifiers, fini
-00007400: 7368 2c20 636f 6f72 6473 290d 0a20 2020  sh, coords)..   
-00007410: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-00007420: 5f74 6578 7473 2829 0d0a 0d0a 2020 2020  _texts()....    
-00007430: 6465 6620 7365 676d 656e 7443 6c69 636b  def segmentClick
-00007440: 6564 2873 656c 662c 2073 6567 6d65 6e74  ed(self, segment
-00007450: 2c20 6576 3d4e 6f6e 652c 2070 6f73 3d4e  , ev=None, pos=N
-00007460: 6f6e 6529 3a0d 0a20 2020 2020 2020 2070  one):..        p
-00007470: 6f73 203d 2073 6567 6d65 6e74 2e6d 6170  os = segment.map
-00007480: 546f 5061 7265 6e74 2865 762e 706f 7328  ToParent(ev.pos(
-00007490: 2929 0d0a 2020 2020 2020 2020 706f 7320  ))..        pos 
-000074a0: 3d20 5f63 6c61 6d70 5f70 6f69 6e74 2873  = _clamp_point(s
-000074b0: 656c 662e 7662 2e70 6172 656e 7428 292c  elf.vb.parent(),
-000074c0: 2070 6f73 290d 0a20 2020 2020 2020 2073   pos)..        s
-000074d0: 7570 6572 2829 2e73 6567 6d65 6e74 436c  uper().segmentCl
-000074e0: 6963 6b65 6428 7365 676d 656e 742c 2070  icked(segment, p
-000074f0: 6f73 3d70 6f73 290d 0a20 2020 2020 2020  os=pos)..       
-00007500: 2073 656c 662e 7570 6461 7465 5f74 6578   self.update_tex
-00007510: 7473 2829 0d0a 0d0a 2020 2020 6465 6620  ts()....    def 
-00007520: 6164 6448 616e 646c 6528 7365 6c66 2c20  addHandle(self, 
-00007530: 696e 666f 2c20 696e 6465 783d 4e6f 6e65  info, index=None
-00007540: 293a 0d0a 2020 2020 2020 2020 6861 6e64  ):..        hand
-00007550: 6c65 203d 2073 7570 6572 2829 2e61 6464  le = super().add
-00007560: 4861 6e64 6c65 2869 6e66 6f2c 2069 6e64  Handle(info, ind
-00007570: 6578 290d 0a20 2020 2020 2020 2068 616e  ex)..        han
-00007580: 646c 652e 6d6f 7665 506f 696e 7420 3d20  dle.movePoint = 
-00007590: 7061 7274 6961 6c28 5f72 6f69 6861 6e64  partial(_roihand
-000075a0: 6c65 5f6d 6f76 655f 736e 6170 2c20 7365  le_move_snap, se
-000075b0: 6c66 2e76 622c 2068 616e 646c 652e 6d6f  lf.vb, handle.mo
-000075c0: 7665 506f 696e 7429 0d0a 2020 2020 2020  vePoint)..      
-000075d0: 2020 7265 7475 726e 2068 616e 646c 650d    return handle.
-000075e0: 0a0d 0a0d 0a63 6c61 7373 2046 696e 4c69  .....class FinLi
-000075f0: 6e65 2870 672e 4772 6170 6869 6373 4f62  ne(pg.GraphicsOb
-00007600: 6a65 6374 293a 0d0a 2020 2020 6465 6620  ject):..    def 
-00007610: 5f5f 696e 6974 5f5f 2873 656c 662c 2070  __init__(self, p
-00007620: 6f69 6e74 732c 2070 656e 293a 0d0a 2020  oints, pen):..  
-00007630: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
-00007640: 696e 6974 5f5f 2829 0d0a 2020 2020 2020  init__()..      
-00007650: 2020 7365 6c66 2e70 6f69 6e74 7320 3d20    self.points = 
-00007660: 706f 696e 7473 0d0a 2020 2020 2020 2020  points..        
-00007670: 7365 6c66 2e70 656e 203d 2070 656e 0d0a  self.pen = pen..
-00007680: 0d0a 2020 2020 6465 6620 7061 696e 7428  ..    def paint(
-00007690: 7365 6c66 2c20 702c 202a 6172 6773 293a  self, p, *args):
-000076a0: 0d0a 2020 2020 2020 2020 702e 7365 7450  ..        p.setP
-000076b0: 656e 2873 656c 662e 7065 6e29 0d0a 2020  en(self.pen)..  
-000076c0: 2020 2020 2020 702e 6472 6177 5061 7468        p.drawPath
-000076d0: 2873 656c 662e 7368 6170 6528 2929 0d0a  (self.shape())..
-000076e0: 0d0a 2020 2020 6465 6620 7368 6170 6528  ..    def shape(
-000076f0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00007700: 7020 3d20 5174 4775 692e 5150 6169 6e74  p = QtGui.QPaint
-00007710: 6572 5061 7468 2829 0d0a 2020 2020 2020  erPath()..      
-00007720: 2020 702e 6d6f 7665 546f 282a 7365 6c66    p.moveTo(*self
-00007730: 2e70 6f69 6e74 735b 305d 290d 0a20 2020  .points[0])..   
-00007740: 2020 2020 2070 2e6c 696e 6554 6f28 2a73       p.lineTo(*s
-00007750: 656c 662e 706f 696e 7473 5b31 5d29 0d0a  elf.points[1])..
-00007760: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00007770: 0d0a 0d0a 2020 2020 6465 6620 626f 756e  ....    def boun
-00007780: 6469 6e67 5265 6374 2873 656c 6629 3a0d  dingRect(self):.
-00007790: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000077a0: 7365 6c66 2e73 6861 7065 2829 2e62 6f75  self.shape().bou
-000077b0: 6e64 696e 6752 6563 7428 290d 0a0d 0a0d  ndingRect().....
-000077c0: 0a63 6c61 7373 2046 696e 456c 6c69 7073  .class FinEllips
-000077d0: 6528 7067 2e45 6c6c 6970 7365 524f 4929  e(pg.EllipseROI)
-000077e0: 3a0d 0a20 2020 2064 6566 2061 6464 526f  :..    def addRo
-000077f0: 7461 7465 4861 6e64 6c65 2873 656c 662c  tateHandle(self,
-00007800: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-00007810: 293a 0d0a 2020 2020 2020 2020 7061 7373  ):..        pass
-00007820: 0d0a 0d0a 0d0a 636c 6173 7320 4669 6e52  ......class FinR
-00007830: 6563 7428 7067 2e52 6563 7452 4f49 293a  ect(pg.RectROI):
-00007840: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00007850: 5f5f 2873 656c 662c 2061 782c 2062 7275  __(self, ax, bru
-00007860: 7368 2c20 2a61 7267 732c 202a 2a6b 7761  sh, *args, **kwa
-00007870: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
-00007880: 656c 662e 6178 203d 2061 780d 0a20 2020  elf.ax = ax..   
-00007890: 2020 2020 2073 656c 662e 6272 7573 6820       self.brush 
-000078a0: 3d20 6272 7573 680d 0a20 2020 2020 2020  = brush..       
-000078b0: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
-000078c0: 5f28 2a61 7267 732c 202a 2a6b 7761 7267  _(*args, **kwarg
-000078d0: 7329 0d0a 0d0a 2020 2020 6465 6620 7061  s)....    def pa
-000078e0: 696e 7428 7365 6c66 2c20 702c 202a 6172  int(self, p, *ar
-000078f0: 6773 293a 0d0a 2020 2020 2020 2020 7220  gs):..        r 
-00007900: 3d20 5174 436f 7265 2e51 5265 6374 4628  = QtCore.QRectF(
-00007910: 302c 2030 2c20 7365 6c66 2e73 7461 7465  0, 0, self.state
-00007920: 5b27 7369 7a65 275d 5b30 5d2c 2073 656c  ['size'][0], sel
-00007930: 662e 7374 6174 655b 2773 697a 6527 5d5b  f.state['size'][
-00007940: 315d 292e 6e6f 726d 616c 697a 6564 2829  1]).normalized()
-00007950: 0d0a 2020 2020 2020 2020 702e 7365 7450  ..        p.setP
-00007960: 656e 2873 656c 662e 6375 7272 656e 7450  en(self.currentP
-00007970: 656e 290d 0a20 2020 2020 2020 2070 2e73  en)..        p.s
-00007980: 6574 4272 7573 6828 7365 6c66 2e62 7275  etBrush(self.bru
-00007990: 7368 290d 0a20 2020 2020 2020 2070 2e74  sh)..        p.t
-000079a0: 7261 6e73 6c61 7465 2872 2e6c 6566 7428  ranslate(r.left(
-000079b0: 292c 2072 2e74 6f70 2829 290d 0a20 2020  ), r.top())..   
-000079c0: 2020 2020 2070 2e73 6361 6c65 2872 2e77       p.scale(r.w
-000079d0: 6964 7468 2829 2c20 722e 6865 6967 6874  idth(), r.height
-000079e0: 2829 290d 0a20 2020 2020 2020 2070 2e64  ())..        p.d
-000079f0: 7261 7752 6563 7428 302c 2030 2c20 312c  rawRect(0, 0, 1,
-00007a00: 2031 290d 0a0d 0a20 2020 2064 6566 2061   1)....    def a
-00007a10: 6464 5363 616c 6548 616e 646c 6528 7365  ddScaleHandle(se
-00007a20: 6c66 2c20 2a61 7267 732c 202a 2a6b 7761  lf, *args, **kwa
-00007a30: 7267 7329 3a0d 0a20 2020 2020 2020 2069  rgs):..        i
-00007a40: 6620 7365 6c66 2e72 6573 697a 6162 6c65  f self.resizable
-00007a50: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00007a60: 7570 6572 2829 2e61 6464 5363 616c 6548  uper().addScaleH
-00007a70: 616e 646c 6528 2a61 7267 732c 202a 2a6b  andle(*args, **k
-00007a80: 7761 7267 7329 0d0a 0d0a 0d0a 636c 6173  wargs)......clas
-00007a90: 7320 4669 6e56 6965 7742 6f78 2870 672e  s FinViewBox(pg.
-00007aa0: 5669 6577 426f 7829 3a0d 0a20 2020 2064  ViewBox):..    d
-00007ab0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00007ac0: 2c20 7769 6e2c 2069 6e69 745f 7374 6570  , win, init_step
-00007ad0: 733d 3330 302c 2079 7363 616c 653d 5953  s=300, yscale=YS
-00007ae0: 6361 6c65 2827 6c69 6e65 6172 272c 2031  cale('linear', 1
-00007af0: 292c 2076 5f7a 6f6f 6d5f 7363 616c 653d  ), v_zoom_scale=
-00007b00: 312c 202a 6172 6773 2c20 2a2a 6b77 6172  1, *args, **kwar
-00007b10: 6773 293a 0d0a 2020 2020 2020 2020 7375  gs):..        su
-00007b20: 7065 7228 292e 5f5f 696e 6974 5f5f 282a  per().__init__(*
-00007b30: 6172 6773 2c20 2a2a 6b77 6172 6773 290d  args, **kwargs).
-00007b40: 0a20 2020 2020 2020 2073 656c 662e 7769  .        self.wi
-00007b50: 6e20 3d20 7769 6e0d 0a20 2020 2020 2020  n = win..       
-00007b60: 2073 656c 662e 696e 6974 5f73 7465 7073   self.init_steps
-00007b70: 203d 2069 6e69 745f 7374 6570 730d 0a20   = init_steps.. 
-00007b80: 2020 2020 2020 2073 656c 662e 7973 6361         self.ysca
-00007b90: 6c65 203d 2079 7363 616c 650d 0a20 2020  le = yscale..   
-00007ba0: 2020 2020 2073 656c 662e 765f 7a6f 6f6d       self.v_zoom
-00007bb0: 5f73 6361 6c65 203d 2076 5f7a 6f6f 6d5f  _scale = v_zoom_
-00007bc0: 7363 616c 650d 0a20 2020 2020 2020 2073  scale..        s
-00007bd0: 656c 662e 6d61 7374 6572 5f76 6965 7762  elf.master_viewb
-00007be0: 6f78 203d 204e 6f6e 650d 0a20 2020 2020  ox = None..     
-00007bf0: 2020 2073 656c 662e 726f 6973 203d 205b     self.rois = [
-00007c00: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-00007c10: 7769 6e2e 5f69 734d 6f75 7365 4c65 6674  win._isMouseLeft
-00007c20: 4472 6167 203d 2046 616c 7365 0d0a 2020  Drag = False..  
-00007c30: 2020 2020 2020 7365 6c66 2e7a 6f6f 6d5f        self.zoom_
-00007c40: 6c69 7374 656e 6572 7320 3d20 7365 7428  listeners = set(
-00007c50: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00007c60: 7265 7365 7428 290d 0a0d 0a20 2020 2064  reset()....    d
-00007c70: 6566 2072 6573 6574 2873 656c 6629 3a0d  ef reset(self):.
-00007c80: 0a20 2020 2020 2020 2073 656c 662e 765f  .        self.v_
-00007c90: 7a6f 6f6d 5f62 6173 656c 696e 6520 3d20  zoom_baseline = 
-00007ca0: 302e 350d 0a20 2020 2020 2020 2073 656c  0.5..        sel
-00007cb0: 662e 765f 6175 746f 7a6f 6f6d 203d 2054  f.v_autozoom = T
-00007cc0: 7275 650d 0a20 2020 2020 2020 2073 656c  rue..        sel
-00007cd0: 662e 6d61 785f 7a6f 6f6d 5f70 6f69 6e74  f.max_zoom_point
-00007ce0: 735f 6620 3d20 310d 0a20 2020 2020 2020  s_f = 1..       
-00007cf0: 2073 656c 662e 795f 6d61 7820 3d20 3130   self.y_max = 10
-00007d00: 3030 0d0a 2020 2020 2020 2020 7365 6c66  00..        self
-00007d10: 2e79 5f6d 696e 203d 2030 0d0a 2020 2020  .y_min = 0..    
-00007d20: 2020 2020 7365 6c66 2e79 5f70 6f73 6974      self.y_posit
-00007d30: 6976 6520 3d20 5472 7565 0d0a 2020 2020  ive = True..    
-00007d40: 2020 2020 7365 6c66 2e78 5f69 6e64 6578      self.x_index
-00007d50: 6564 203d 2054 7275 650d 0a20 2020 2020  ed = True..     
-00007d60: 2020 2073 656c 662e 666f 7263 655f 7261     self.force_ra
-00007d70: 6e67 655f 7570 6461 7465 203d 2030 0d0a  nge_update = 0..
-00007d80: 2020 2020 2020 2020 7768 696c 6520 7365          while se
-00007d90: 6c66 2e72 6f69 733a 0d0a 2020 2020 2020  lf.rois:..      
-00007da0: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
-00007db0: 655f 6c61 7374 5f72 6f69 2829 0d0a 2020  e_last_roi()..  
-00007dc0: 2020 2020 2020 7365 6c66 2e64 7261 775f        self.draw_
-00007dd0: 6c69 6e65 203d 204e 6f6e 650d 0a20 2020  line = None..   
-00007de0: 2020 2020 2073 656c 662e 6472 6177 696e       self.drawin
-00007df0: 6720 3d20 4661 6c73 650d 0a20 2020 2020  g = False..     
-00007e00: 2020 2073 656c 662e 7374 616e 6461 6c6f     self.standalo
-00007e10: 6e65 7320 3d20 7365 7428 290d 0a20 2020  nes = set()..   
-00007e20: 2020 2020 2073 656c 662e 7570 6461 7469       self.updati
-00007e30: 6e67 5f6c 696e 6b65 6420 3d20 4661 6c73  ng_linked = Fals
-00007e40: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-00007e50: 7365 745f 6461 7461 7372 6328 4e6f 6e65  set_datasrc(None
-00007e60: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00007e70: 7365 744d 6f75 7365 456e 6162 6c65 6428  setMouseEnabled(
-00007e80: 783d 5472 7565 2c20 793d 4661 6c73 6529  x=True, y=False)
-00007e90: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00007ea0: 6574 5261 6e67 6528 5174 436f 7265 2e51  etRange(QtCore.Q
-00007eb0: 5265 6374 4628 7067 2e50 6f69 6e74 2830  RectF(pg.Point(0
-00007ec0: 2c20 3029 2c20 7067 2e50 6f69 6e74 2831  , 0), pg.Point(1
-00007ed0: 2c20 3129 2929 0d0a 0d0a 2020 2020 6465  , 1)))....    de
-00007ee0: 6620 7365 745f 6461 7461 7372 6328 7365  f set_datasrc(se
-00007ef0: 6c66 2c20 6461 7461 7372 6329 3a0d 0a20  lf, datasrc):.. 
-00007f00: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-00007f10: 7372 6320 3d20 6461 7461 7372 630d 0a20  src = datasrc.. 
-00007f20: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00007f30: 6c66 2e64 6174 6173 7263 3a0d 0a20 2020  lf.datasrc:..   
-00007f40: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00007f50: 0a20 2020 2020 2020 2064 6174 6173 7263  .        datasrc
-00007f60: 2e75 7064 6174 655f 696e 6974 5f78 2873  .update_init_x(s
-00007f70: 656c 662e 696e 6974 5f73 7465 7073 290d  elf.init_steps).
-00007f80: 0a0d 0a20 2020 2064 6566 2070 7265 5f70  ...    def pre_p
-00007f90: 726f 6365 7373 5f64 6174 6128 7365 6c66  rocess_data(self
-00007fa0: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
-00007fb0: 656c 662e 6461 7461 7372 6320 616e 6420  elf.datasrc and 
-00007fc0: 7365 6c66 2e64 6174 6173 7263 2e73 6361  self.datasrc.sca
-00007fd0: 6c65 5f63 6f6c 733a 0d0a 2020 2020 2020  le_cols:..      
-00007fe0: 2020 2020 2020 6466 203d 2073 656c 662e        df = self.
-00007ff0: 6461 7461 7372 632e 6466 2e69 6c6f 635b  datasrc.df.iloc[
-00008000: 3a2c 2073 656c 662e 6461 7461 7372 632e  :, self.datasrc.
-00008010: 7363 616c 655f 636f 6c73 5d0d 0a20 2020  scale_cols]..   
-00008020: 2020 2020 2020 2020 2073 656c 662e 795f           self.y_
-00008030: 6d61 7820 3d20 6466 2e6d 6178 2829 2e6d  max = df.max().m
-00008040: 6178 2829 0d0a 2020 2020 2020 2020 2020  ax()..          
-00008050: 2020 7365 6c66 2e79 5f6d 696e 203d 2064    self.y_min = d
-00008060: 662e 6d69 6e28 292e 6d69 6e28 290d 0a20  f.min().min().. 
-00008070: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00008080: 6c66 2e79 5f6d 696e 203c 3d20 303a 0d0a  lf.y_min <= 0:..
-00008090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080a0: 7365 6c66 2e79 5f70 6f73 6974 6976 6520  self.y_positive 
-000080b0: 3d20 4661 6c73 650d 0a0d 0a20 2020 2040  = False....    @
-000080c0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-000080d0: 6620 6461 7461 7372 635f 6f72 5f73 7461  f datasrc_or_sta
-000080e0: 6e64 616c 6f6e 6528 7365 6c66 293a 0d0a  ndalone(self):..
-000080f0: 2020 2020 2020 2020 6473 203d 2073 656c          ds = sel
-00008100: 662e 6461 7461 7372 630d 0a20 2020 2020  f.datasrc..     
-00008110: 2020 2069 6620 6e6f 7420 6473 2061 6e64     if not ds and
-00008120: 2073 656c 662e 7374 616e 6461 6c6f 6e65   self.standalone
+00002890: 6c66 2e73 7461 6e64 616c 6f6e 6520 3d20  lf.standalone = 
+000028a0: 5f69 735f 7374 616e 6461 6c6f 6e65 2873  _is_standalone(s
+000028b0: 656c 662e 6466 5b74 696d 6563 6f6c 5d29  elf.df[timecol])
+000028c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000028d0: 6c66 2e63 6f6c 5f64 6174 615f 6f66 6673  lf.col_data_offs
+000028e0: 6574 203d 2031 2023 206e 6f2e 206f 6620  et = 1 # no. of 
+000028f0: 7072 6563 6565 6469 6e67 2063 6f6c 756d  preceeding colum
+00002900: 6e73 2066 6f72 206f 7468 6572 2070 6c6f  ns for other plo
+00002910: 7473 2061 6e64 2074 696d 6520 636f 6c75  ts and time colu
+00002920: 6d6e 0d0a 2020 2020 2020 2020 656c 7365  mn..        else
+00002930: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00002940: 656c 662e 7374 616e 6461 6c6f 6e65 203d  elf.standalone =
+00002950: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00002960: 2020 2020 7365 6c66 2e63 6f6c 5f64 6174      self.col_dat
+00002970: 615f 6f66 6673 6574 203d 2030 2023 206e  a_offset = 0 # n
+00002980: 6f2e 206f 6620 7072 6563 6565 6469 6e67  o. of preceeding
+00002990: 2063 6f6c 756d 6e73 2066 6f72 206f 7468   columns for oth
+000029a0: 6572 2070 6c6f 7473 2061 6e64 2074 696d  er plots and tim
+000029b0: 6520 636f 6c75 6d6e 0d0a 2020 2020 2020  e column..      
+000029c0: 2020 2320 7365 7475 7020 6461 7461 2066    # setup data f
+000029d0: 6f72 206a 6f69 6e69 6e67 2064 6174 6120  or joining data 
+000029e0: 736f 7572 6365 7320 616e 6420 7a6f 6f6d  sources and zoom
+000029f0: 696e 670d 0a20 2020 2020 2020 2073 656c  ing..        sel
+00002a00: 662e 7363 616c 655f 636f 6c73 203d 205b  f.scale_cols = [
+00002a10: 6920 666f 7220 6920 696e 2072 616e 6765  i for i in range
+00002a20: 2873 656c 662e 636f 6c5f 6461 7461 5f6f  (self.col_data_o
+00002a30: 6666 7365 742c 6c65 6e28 7365 6c66 2e64  ffset,len(self.d
+00002a40: 662e 636f 6c75 6d6e 7329 2920 6966 2073  f.columns)) if s
+00002a50: 656c 662e 6466 2e69 6c6f 635b 3a2c 695d  elf.df.iloc[:,i]
+00002a60: 2e64 7479 7065 213d 6f62 6a65 6374 5d0d  .dtype!=object].
+00002a70: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
+00002a80: 6368 655f 6869 6c6f 203d 204f 7264 6572  che_hilo = Order
+00002a90: 6564 4469 6374 2829 0d0a 2020 2020 2020  edDict()..      
+00002aa0: 2020 7365 6c66 2e72 656e 616d 6573 203d    self.renames =
+00002ab0: 207b 7d0d 0a20 2020 2020 2020 206e 6577   {}..        new
+00002ac0: 636f 6c73 203d 205b 5d0d 0a20 2020 2020  cols = []..     
+00002ad0: 2020 2066 6f72 2063 6f6c 2069 6e20 7365     for col in se
+00002ae0: 6c66 2e64 662e 636f 6c75 6d6e 733a 0d0a  lf.df.columns:..
+00002af0: 2020 2020 2020 2020 2020 2020 6f6c 6463              oldc
+00002b00: 6f6c 203d 2063 6f6c 0d0a 2020 2020 2020  ol = col..      
+00002b10: 2020 2020 2020 7768 696c 6520 636f 6c20        while col 
+00002b20: 696e 206e 6577 636f 6c73 3a0d 0a20 2020  in newcols:..   
+00002b30: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00002b40: 203d 2073 7472 2863 6f6c 292b 272b 270d   = str(col)+'+'.
+00002b50: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00002b60: 636f 6c73 2e61 7070 656e 6428 636f 6c29  cols.append(col)
+00002b70: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00002b80: 206f 6c64 636f 6c20 213d 2063 6f6c 3a0d   oldcol != col:.
+00002b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002ba0: 2073 656c 662e 7265 6e61 6d65 735b 6f6c   self.renames[ol
+00002bb0: 6463 6f6c 5d20 3d20 636f 6c0d 0a20 2020  dcol] = col..   
+00002bc0: 2020 2020 2073 656c 662e 6466 2e63 6f6c       self.df.col
+00002bd0: 756d 6e73 203d 206e 6577 636f 6c73 0d0a  umns = newcols..
+00002be0: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
+00002bf0: 5f75 7064 6174 6520 3d20 6c61 6d62 6461  _update = lambda
+00002c00: 2064 663a 2064 660d 0a20 2020 2020 2020   df: df..       
+00002c10: 2073 656c 662e 706f 7374 5f75 7064 6174   self.post_updat
+00002c20: 6520 3d20 6c61 6d62 6461 2064 663a 2064  e = lambda df: d
+00002c30: 660d 0a20 2020 2020 2020 2073 656c 662e  f..        self.
+00002c40: 5f70 6572 696f 6420 3d20 4e6f 6e65 0d0a  _period = None..
+00002c50: 2020 2020 2020 2020 7365 6c66 2e5f 736d          self._sm
+00002c60: 6f6f 7468 5f74 696d 6520 3d20 4e6f 6e65  ooth_time = None
+00002c70: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
+00002c80: 735f 7370 6172 7365 203d 2073 656c 662e  s_sparse = self.
+00002c90: 6466 5b73 656c 662e 6466 2e63 6f6c 756d  df[self.df.colum
+00002ca0: 6e73 5b73 656c 662e 636f 6c5f 6461 7461  ns[self.col_data
+00002cb0: 5f6f 6666 7365 745d 5d2e 6973 6e75 6c6c  _offset]].isnull
+00002cc0: 2829 2e73 756d 2829 2e6d 6178 2829 203e  ().sum().max() >
+00002cd0: 206c 656e 2873 656c 662e 6466 292f 2f32   len(self.df)//2
+00002ce0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+00002cf0: 790d 0a20 2020 2064 6566 2070 6572 696f  y..    def perio
+00002d00: 645f 6e73 2873 656c 6629 3a0d 0a20 2020  d_ns(self):..   
+00002d10: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
+00002d20: 2e64 6629 203c 3d20 313a 0d0a 2020 2020  .df) <= 1:..    
+00002d30: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
+00002d40: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00002d50: 2073 656c 662e 5f70 6572 696f 643a 0d0a   self._period:..
+00002d60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002d70: 2e5f 7065 7269 6f64 203d 2073 656c 662e  ._period = self.
+00002d80: 6361 6c63 5f70 6572 696f 645f 6e73 2829  calc_period_ns()
+00002d90: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00002da0: 2073 656c 662e 5f70 6572 696f 640d 0a0d   self._period...
+00002db0: 0a20 2020 2064 6566 2063 616c 635f 7065  .    def calc_pe
+00002dc0: 7269 6f64 5f6e 7328 7365 6c66 2c20 6e3d  riod_ns(self, n=
+00002dd0: 3130 302c 2064 656c 7461 3d6c 616d 6264  100, delta=lambd
+00002de0: 6120 6474 3a20 696e 7428 6474 2e6d 6564  a dt: int(dt.med
+00002df0: 6961 6e28 2929 293a 0d0a 2020 2020 2020  ian())):..      
+00002e00: 2020 7469 6d65 636f 6c20 3d20 7365 6c66    timecol = self
+00002e10: 2e64 662e 636f 6c75 6d6e 735b 305d 0d0a  .df.columns[0]..
+00002e20: 2020 2020 2020 2020 6474 696d 6573 203d          dtimes =
+00002e30: 2073 656c 662e 6466 5b74 696d 6563 6f6c   self.df[timecol
+00002e40: 5d2e 696c 6f63 5b30 3a6e 5d2e 6469 6666  ].iloc[0:n].diff
+00002e50: 2829 0d0a 2020 2020 2020 2020 6474 696d  ()..        dtim
+00002e60: 6573 203d 2064 7469 6d65 735b 6474 696d  es = dtimes[dtim
+00002e70: 6573 213d 305d 0d0a 2020 2020 2020 2020  es!=0]..        
+00002e80: 7265 7475 726e 2064 656c 7461 2864 7469  return delta(dti
+00002e90: 6d65 7329 2069 6620 6c65 6e28 6474 696d  mes) if len(dtim
+00002ea0: 6573 293e 3120 656c 7365 2031 0d0a 0d0a  es)>1 else 1....
+00002eb0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00002ec0: 2020 2064 6566 2069 6e64 6578 2873 656c     def index(sel
+00002ed0: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+00002ee0: 7572 6e20 7365 6c66 2e64 662e 696e 6465  urn self.df.inde
+00002ef0: 780d 0a0d 0a20 2020 2040 7072 6f70 6572  x....    @proper
+00002f00: 7479 0d0a 2020 2020 6465 6620 7828 7365  ty..    def x(se
+00002f10: 6c66 293a 0d0a 2020 2020 2020 2020 7469  lf):..        ti
+00002f20: 6d65 636f 6c20 3d20 7365 6c66 2e64 662e  mecol = self.df.
+00002f30: 636f 6c75 6d6e 735b 305d 0d0a 2020 2020  columns[0]..    
+00002f40: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00002f50: 6466 5b74 696d 6563 6f6c 5d0d 0a0d 0a20  df[timecol].... 
+00002f60: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00002f70: 2020 6465 6620 7928 7365 6c66 293a 0d0a    def y(self):..
+00002f80: 2020 2020 2020 2020 636f 6c20 3d20 7365          col = se
+00002f90: 6c66 2e64 662e 636f 6c75 6d6e 735b 7365  lf.df.columns[se
+00002fa0: 6c66 2e63 6f6c 5f64 6174 615f 6f66 6673  lf.col_data_offs
+00002fb0: 6574 5d0d 0a20 2020 2020 2020 2072 6574  et]..        ret
+00002fc0: 7572 6e20 7365 6c66 2e64 665b 636f 6c5d  urn self.df[col]
+00002fd0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+00002fe0: 790d 0a20 2020 2064 6566 207a 2873 656c  y..    def z(sel
+00002ff0: 6629 3a0d 0a20 2020 2020 2020 2063 6f6c  f):..        col
+00003000: 203d 2073 656c 662e 6466 2e63 6f6c 756d   = self.df.colum
+00003010: 6e73 5b73 656c 662e 636f 6c5f 6461 7461  ns[self.col_data
+00003020: 5f6f 6666 7365 742b 315d 0d0a 2020 2020  _offset+1]..    
+00003030: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00003040: 6466 5b63 6f6c 5d0d 0a0d 0a20 2020 2040  df[col]....    @
+00003050: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+00003060: 6620 786c 656e 2873 656c 6629 3a0d 0a20  f xlen(self):.. 
+00003070: 2020 2020 2020 2072 6574 7572 6e20 6c65         return le
+00003080: 6e28 7365 6c66 2e64 6629 0d0a 0d0a 2020  n(self.df)....  
+00003090: 2020 6465 6620 6361 6c63 5f73 6967 6e69    def calc_signi
+000030a0: 6669 6361 6e74 5f64 6563 696d 616c 7328  ficant_decimals(
+000030b0: 7365 6c66 2c20 6675 6c6c 293a 0d0a 2020  self, full):..  
+000030c0: 2020 2020 2020 6465 6620 666c 6f61 745f        def float_
+000030d0: 726f 756e 6428 6629 3a0d 0a20 2020 2020  round(f):..     
+000030e0: 2020 2020 2020 2072 6574 7572 6e20 666c         return fl
+000030f0: 6f61 7428 2725 2e33 6527 2566 2920 2320  oat('%.3e'%f) # 
+00003100: 302e 3030 3939 3937 3438 202d 3e20 302e  0.00999748 -> 0.
+00003110: 3031 0d0a 2020 2020 2020 2020 6465 6620  01..        def 
+00003120: 7265 6d61 696e 6465 725f 6f6b 2861 2c20  remainder_ok(a, 
+00003130: 6229 3a0d 0a20 2020 2020 2020 2020 2020  b):..           
+00003140: 2063 203d 2061 2025 2062 0d0a 2020 2020   c = a % b..    
+00003150: 2020 2020 2020 2020 6966 2063 202f 2062          if c / b
+00003160: 203e 2030 2e39 383a 2023 2072 656d 6169   > 0.98: # remai
+00003170: 6e64 6572 2061 6c6d 6f73 7420 7361 6d65  nder almost same
+00003180: 2061 7320 6465 6e6f 6d69 6e61 746f 720d   as denominator.
+00003190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000031a0: 2063 203d 2061 6273 2863 2d62 290d 0a20   c = abs(c-b).. 
+000031b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000031c0: 6e20 6320 3c20 622a 302e 3620 2320 6861  n c < b*0.6 # ha
+000031d0: 6c66 2069 7320 6669 6e65 0d0a 2020 2020  lf is fine..    
+000031e0: 2020 2020 6465 6620 6361 6c63 5f73 6428      def calc_sd(
+000031f0: 7365 7229 3a0d 0a20 2020 2020 2020 2020  ser):..         
+00003200: 2020 2073 6572 203d 2073 6572 2e69 6c6f     ser = ser.ilo
+00003210: 635b 3a31 3030 305d 0d0a 2020 2020 2020  c[:1000]..      
+00003220: 2020 2020 2020 6162 7364 6966 6620 3d20        absdiff = 
+00003230: 7365 722e 6469 6666 2829 2e61 6273 2829  ser.diff().abs()
+00003240: 0d0a 2020 2020 2020 2020 2020 2020 6162  ..            ab
+00003250: 7364 6966 665b 6162 7364 6966 663c 3165  sdiff[absdiff<1e
+00003260: 2d33 305d 203d 206e 702e 666c 6f61 7433  -30] = np.float3
+00003270: 3228 3165 3330 290d 0a20 2020 2020 2020  2(1e30)..       
+00003280: 2020 2020 2073 6d61 6c6c 6573 745f 6469       smallest_di
+00003290: 6666 203d 2061 6273 6469 6666 2e6d 696e  ff = absdiff.min
+000032a0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+000032b0: 6966 2073 6d61 6c6c 6573 745f 6469 6666  if smallest_diff
+000032c0: 203e 2031 6532 393a 2023 206a 7573 7420   > 1e29: # just 
+000032d0: 3073 3f0d 0a20 2020 2020 2020 2020 2020  0s?..           
+000032e0: 2020 2020 2072 6574 7572 6e20 300d 0a20       return 0.. 
+000032f0: 2020 2020 2020 2020 2020 2073 6d61 6c6c             small
+00003300: 6573 745f 6469 6666 203d 2066 6c6f 6174  est_diff = float
+00003310: 5f72 6f75 6e64 2873 6d61 6c6c 6573 745f  _round(smallest_
+00003320: 6469 6666 290d 0a20 2020 2020 2020 2020  diff)..         
+00003330: 2020 2061 6273 7365 7220 3d20 7365 722e     absser = ser.
+00003340: 696c 6f63 5b3a 3130 305d 2e61 6273 2829  iloc[:100].abs()
+00003350: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00003360: 7220 5f20 696e 2072 616e 6765 2832 293a  r _ in range(2):
+00003370: 2023 2063 6865 636b 2069 6620 7765 2068   # check if we h
+00003380: 6176 6520 6120 7265 6d61 696e 6465 7220  ave a remainder 
+00003390: 7468 6174 2069 7320 6120 6265 7474 6572  that is a better
+000033a0: 2065 7073 696c 6f6e 0d0a 2020 2020 2020   epsilon..      
+000033b0: 2020 2020 2020 2020 2020 7265 6d61 696e            remain
+000033c0: 6465 7220 3d20 5b66 6d6f 6428 762c 736d  der = [fmod(v,sm
+000033d0: 616c 6c65 7374 5f64 6966 6629 2066 6f72  allest_diff) for
+000033e0: 2076 2069 6e20 6162 7373 6572 5d0d 0a20   v in absser].. 
+000033f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00003400: 656d 6169 6e64 6572 203d 205b 7620 666f  emainder = [v fo
+00003410: 7220 7620 696e 2072 656d 6169 6e64 6572  r v in remainder
+00003420: 2069 6620 763e 736d 616c 6c65 7374 5f64   if v>smallest_d
+00003430: 6966 662f 3230 5d0d 0a20 2020 2020 2020  iff/20]..       
+00003440: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00003450: 7265 6d61 696e 6465 723a 0d0a 2020 2020  remainder:..    
+00003460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003470: 6272 6561 6b0d 0a20 2020 2020 2020 2020  break..         
+00003480: 2020 2020 2020 2073 6d61 6c6c 6573 745f         smallest_
+00003490: 6469 6666 5f72 203d 206d 696e 2872 656d  diff_r = min(rem
+000034a0: 6169 6e64 6572 290d 0a20 2020 2020 2020  ainder)..       
+000034b0: 2020 2020 2020 2020 2069 6620 736d 616c           if smal
+000034c0: 6c65 7374 5f64 6966 662a 302e 3035 203c  lest_diff*0.05 <
+000034d0: 2073 6d61 6c6c 6573 745f 6469 6666 5f72   smallest_diff_r
+000034e0: 203c 2073 6d61 6c6c 6573 745f 6469 6666   < smallest_diff
+000034f0: 202a 2030 2e37 2061 6e64 2072 656d 6169   * 0.7 and remai
+00003500: 6e64 6572 5f6f 6b28 736d 616c 6c65 7374  nder_ok(smallest
+00003510: 5f64 6966 662c 2073 6d61 6c6c 6573 745f  _diff, smallest_
+00003520: 6469 6666 5f72 293a 0d0a 2020 2020 2020  diff_r):..      
+00003530: 2020 2020 2020 2020 2020 2020 2020 736d                sm
+00003540: 616c 6c65 7374 5f64 6966 6620 3d20 736d  allest_diff = sm
+00003550: 616c 6c65 7374 5f64 6966 665f 720d 0a20  allest_diff_r.. 
+00003560: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00003570: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00003580: 2020 2020 2020 2020 2020 6272 6561 6b0d            break.
+00003590: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000035a0: 7572 6e20 736d 616c 6c65 7374 5f64 6966  urn smallest_dif
+000035b0: 660d 0a20 2020 2020 2020 2064 6566 2063  f..        def c
+000035c0: 616c 635f 6465 6328 7365 722c 2073 6d61  alc_dec(ser, sma
+000035d0: 6c6c 6573 745f 6469 6666 293a 0d0a 2020  llest_diff):..  
+000035e0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000035f0: 2066 756c 6c3a 2023 206c 696e 6520 706c   full: # line pl
+00003600: 6f74 7320 7573 7561 6c6c 7920 6861 7665  ots usually have
+00003610: 2065 7874 7265 6d65 2072 6573 6f6c 7574   extreme resolut
+00003620: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
+00003630: 2020 2020 2061 6273 6d61 7820 3d20 7365       absmax = se
+00003640: 722e 696c 6f63 5b3a 3330 305d 2e61 6273  r.iloc[:300].abs
+00003650: 2829 2e6d 6178 2829 0d0a 2020 2020 2020  ().max()..      
+00003660: 2020 2020 2020 2020 2020 7320 3d20 2725            s = '%
+00003670: 2e33 6527 2025 2061 6273 6d61 780d 0a20  .3e' % absmax.. 
+00003680: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00003690: 2023 2063 616e 646c 6573 0d0a 2020 2020   # candles..    
+000036a0: 2020 2020 2020 2020 2020 2020 7320 3d20              s = 
+000036b0: 2725 2e32 6527 2025 2073 6d61 6c6c 6573  '%.2e' % smalles
+000036c0: 745f 6469 6666 0d0a 2020 2020 2020 2020  t_diff..        
+000036d0: 2020 2020 6261 7365 2c5f 2c65 7870 203d      base,_,exp =
+000036e0: 2073 2e70 6172 7469 7469 6f6e 2827 6527   s.partition('e'
+000036f0: 290d 0a20 2020 2020 2020 2020 2020 2062  )..            b
+00003700: 6173 6520 3d20 6261 7365 2e72 7374 7269  ase = base.rstri
+00003710: 7028 2730 2729 0d0a 2020 2020 2020 2020  p('0')..        
+00003720: 2020 2020 6578 7020 3d20 2d69 6e74 2865      exp = -int(e
+00003730: 7870 290d 0a20 2020 2020 2020 2020 2020  xp)..           
+00003740: 206d 6178 5f62 6173 655f 6465 6369 6d61   max_base_decima
+00003750: 6c73 203d 206d 696e 2835 2c20 2d65 7870  ls = min(5, -exp
+00003760: 2b32 2920 6966 2065 7870 203c 2030 2065  +2) if exp < 0 e
+00003770: 6c73 6520 330d 0a20 2020 2020 2020 2020  lse 3..         
+00003780: 2020 2062 6173 655f 6465 6369 6d61 6c73     base_decimals
+00003790: 203d 206d 6178 2830 2c20 6d69 6e28 6d61   = max(0, min(ma
+000037a0: 785f 6261 7365 5f64 6563 696d 616c 732c  x_base_decimals,
+000037b0: 206c 656e 2862 6173 6529 2d32 2929 0d0a   len(base)-2))..
+000037c0: 2020 2020 2020 2020 2020 2020 6465 6369              deci
+000037d0: 6d61 6c73 203d 2065 7870 202b 2062 6173  mals = exp + bas
+000037e0: 655f 6465 6369 6d61 6c73 0d0a 2020 2020  e_decimals..    
+000037f0: 2020 2020 2020 2020 6465 6369 6d61 6c73          decimals
+00003800: 203d 206d 6178 2830 2c20 6d69 6e28 6d61   = max(0, min(ma
+00003810: 785f 6465 6369 6d61 6c73 2c20 6465 6369  x_decimals, deci
+00003820: 6d61 6c73 2929 0d0a 2020 2020 2020 2020  mals))..        
+00003830: 2020 2020 6966 206e 6f74 2066 756c 6c3a      if not full:
+00003840: 2023 2061 7070 6c79 2067 7269 6420 666f   # apply grid fo
+00003850: 7220 6c69 6e65 2070 6c6f 7473 206f 6e6c  r line plots onl
+00003860: 790d 0a20 2020 2020 2020 2020 2020 2020  y..             
+00003870: 2020 2073 6d61 6c6c 6573 745f 6469 6666     smallest_diff
+00003880: 203d 206d 6178 2831 302a 2a28 2d64 6563   = max(10**(-dec
+00003890: 696d 616c 7329 2c20 736d 616c 6c65 7374  imals), smallest
+000038a0: 5f64 6966 6629 0d0a 2020 2020 2020 2020  _diff)..        
+000038b0: 2020 2020 7265 7475 726e 2064 6563 696d      return decim
+000038c0: 616c 732c 2073 6d61 6c6c 6573 745f 6469  als, smallest_di
+000038d0: 6666 0d0a 2020 2020 2020 2020 2320 6669  ff..        # fi
+000038e0: 7273 7420 6361 6c63 756c 6174 6520 4550  rst calculate EP
+000038f0: 5320 666f 7220 7365 7269 6573 2030 2631  S for series 0&1
+00003900: 2c20 7468 656e 2064 6f20 6465 6369 6d61  , then do decima
+00003910: 6c73 0d0a 2020 2020 2020 2020 7364 7320  ls..        sds 
+00003920: 3d20 5b63 616c 635f 7364 2873 656c 662e  = [calc_sd(self.
+00003930: 7929 5d20 2320 6d69 6768 7420 6265 2061  y)] # might be a
+00003940: 6c6c 207a 6572 6f73 2066 6f72 2062 6172  ll zeros for bar
+00003950: 2063 6861 7274 730d 0a20 2020 2020 2020   charts..       
+00003960: 2069 6620 6c65 6e28 7365 6c66 2e73 6361   if len(self.sca
+00003970: 6c65 5f63 6f6c 7329 203e 2031 3a0d 0a20  le_cols) > 1:.. 
+00003980: 2020 2020 2020 2020 2020 2073 6473 2e61             sds.a
+00003990: 7070 656e 6428 6361 6c63 5f73 6428 7365  ppend(calc_sd(se
+000039a0: 6c66 2e7a 2929 2023 2069 6620 6669 7273  lf.z)) # if firs
+000039b0: 7420 6973 206f 7065 6e2c 2074 6869 7320  t is open, this 
+000039c0: 6d69 6768 7420 6265 2063 6c6f 7365 0d0a  might be close..
+000039d0: 2020 2020 2020 2020 7364 7320 3d20 5b73          sds = [s
+000039e0: 6420 666f 7220 7364 2069 6e20 7364 7320  d for sd in sds 
+000039f0: 6966 2073 643e 305d 0d0a 2020 2020 2020  if sd>0]..      
+00003a00: 2020 6269 675f 6469 6666 203d 206d 6178    big_diff = max
+00003a10: 2873 6473 290d 0a20 2020 2020 2020 2073  (sds)..        s
+00003a20: 6d61 6c6c 6573 745f 6469 6666 203d 206d  mallest_diff = m
+00003a30: 696e 285b 7364 2066 6f72 2073 6420 696e  in([sd for sd in
+00003a40: 2073 6473 2069 6620 7364 3e62 6967 5f64   sds if sd>big_d
+00003a50: 6966 662f 3130 305d 2920 2320 6669 6c74  iff/100]) # filt
+00003a60: 6572 206f 7574 2065 7874 7265 6d65 6c79  er out extremely
+00003a70: 2073 6d61 6c6c 2065 7073 696c 6f6e 730d   small epsilons.
+00003a80: 0a20 2020 2020 2020 2073 6572 203d 2073  .        ser = s
+00003a90: 656c 662e 7a20 6966 206c 656e 2873 656c  elf.z if len(sel
+00003aa0: 662e 7363 616c 655f 636f 6c73 2920 3e20  f.scale_cols) > 
+00003ab0: 3120 656c 7365 2073 656c 662e 790d 0a20  1 else self.y.. 
+00003ac0: 2020 2020 2020 2072 6574 7572 6e20 6361         return ca
+00003ad0: 6c63 5f64 6563 2873 6572 2c20 736d 616c  lc_dec(ser, smal
+00003ae0: 6c65 7374 5f64 6966 6629 0d0a 0d0a 2020  lest_diff)....  
+00003af0: 2020 6465 6620 7570 6461 7465 5f69 6e69    def update_ini
+00003b00: 745f 7828 7365 6c66 2c20 696e 6974 5f73  t_x(self, init_s
+00003b10: 7465 7073 293a 0d0a 2020 2020 2020 2020  teps):..        
+00003b20: 7365 6c66 2e69 6e69 745f 7830 2c20 7365  self.init_x0, se
+00003b30: 6c66 2e69 6e69 745f 7831 203d 205f 786d  lf.init_x1 = _xm
+00003b40: 696e 6d61 7828 7365 6c66 2c20 785f 696e  inmax(self, x_in
+00003b50: 6465 7865 643d 5472 7565 2c20 696e 6974  dexed=True, init
+00003b60: 5f73 7465 7073 3d69 6e69 745f 7374 6570  _steps=init_step
+00003b70: 7329 0d0a 0d0a 2020 2020 6465 6620 636c  s)....    def cl
+00003b80: 6f73 6573 745f 7469 6d65 2873 656c 662c  osest_time(self,
+00003b90: 2078 293a 0d0a 2020 2020 2020 2020 7469   x):..        ti
+00003ba0: 6d65 636f 6c20 3d20 7365 6c66 2e64 662e  mecol = self.df.
+00003bb0: 636f 6c75 6d6e 735b 305d 0d0a 2020 2020  columns[0]..    
+00003bc0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00003bd0: 6466 2e6c 6f63 5b69 6e74 2878 292c 2074  df.loc[int(x), t
+00003be0: 696d 6563 6f6c 5d0d 0a0d 0a20 2020 2064  imecol]....    d
+00003bf0: 6566 2074 696d 6562 6173 6564 2873 656c  ef timebased(sel
+00003c00: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+00003c10: 7572 6e20 7365 6c66 2e64 662e 696c 6f63  urn self.df.iloc
+00003c20: 5b2d 312c 305d 203e 2031 6537 0d0a 0d0a  [-1,0] > 1e7....
+00003c30: 2020 2020 6465 6620 6973 5f73 6d6f 6f74      def is_smoot
+00003c40: 685f 7469 6d65 2873 656c 6629 3a0d 0a20  h_time(self):.. 
+00003c50: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00003c60: 736d 6f6f 7468 5f74 696d 6520 6973 204e  smooth_time is N
+00003c70: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00003c80: 2020 2320 6c65 7373 2074 6861 6e20 3125    # less than 1%
+00003c90: 2074 696d 6520 6465 6c74 6120 6973 2073   time delta is s
+00003ca0: 6d6f 6f74 680d 0a20 2020 2020 2020 2020  mooth..         
+00003cb0: 2020 2073 656c 662e 5f73 6d6f 6f74 685f     self._smooth_
+00003cc0: 7469 6d65 203d 2073 656c 662e 7469 6d65  time = self.time
+00003cd0: 6261 7365 6428 2920 616e 6420 286e 702e  based() and (np.
+00003ce0: 6162 7328 6e70 2e64 6966 6628 7365 6c66  abs(np.diff(self
+00003cf0: 2e78 2e76 616c 7565 735b 313a 3130 305d  .x.values[1:100]
+00003d00: 295b 313a 5d2f 2f28 7365 6c66 2e70 6572  )[1:]//(self.per
+00003d10: 696f 645f 6e73 2f2f 3130 3030 292d 3130  iod_ns//1000)-10
+00003d20: 3030 2920 3c20 3130 292e 616c 6c28 290d  00) < 10).all().
+00003d30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003d40: 7365 6c66 2e5f 736d 6f6f 7468 5f74 696d  self._smooth_tim
+00003d50: 650d 0a0d 0a20 2020 2064 6566 2061 6464  e....    def add
+00003d60: 636f 6c73 2873 656c 662c 2064 6174 6173  cols(self, datas
+00003d70: 7263 293a 0d0a 2020 2020 2020 2020 6e65  rc):..        ne
+00003d80: 775f 7363 616c 655f 636f 6c73 203d 205b  w_scale_cols = [
+00003d90: 632b 6c65 6e28 7365 6c66 2e64 662e 636f  c+len(self.df.co
+00003da0: 6c75 6d6e 7329 2d64 6174 6173 7263 2e63  lumns)-datasrc.c
+00003db0: 6f6c 5f64 6174 615f 6f66 6673 6574 2066  ol_data_offset f
+00003dc0: 6f72 2063 2069 6e20 6461 7461 7372 632e  or c in datasrc.
+00003dd0: 7363 616c 655f 636f 6c73 5d0d 0a20 2020  scale_cols]..   
+00003de0: 2020 2020 2073 656c 662e 7363 616c 655f       self.scale_
+00003df0: 636f 6c73 202b 3d20 6e65 775f 7363 616c  cols += new_scal
+00003e00: 655f 636f 6c73 0d0a 2020 2020 2020 2020  e_cols..        
+00003e10: 6f72 6967 5f63 6f6c 5f64 6174 615f 636e  orig_col_data_cn
+00003e20: 7420 3d20 6c65 6e28 7365 6c66 2e64 662e  t = len(self.df.
+00003e30: 636f 6c75 6d6e 7329 0d0a 2020 2020 2020  columns)..      
+00003e40: 2020 6966 205f 6861 735f 7469 6d65 636f    if _has_timeco
+00003e50: 6c28 6461 7461 7372 632e 6466 293a 0d0a  l(datasrc.df):..
+00003e60: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+00003e70: 636f 6c20 3d20 7365 6c66 2e64 662e 636f  col = self.df.co
+00003e80: 6c75 6d6e 735b 305d 0d0a 2020 2020 2020  lumns[0]..      
+00003e90: 2020 2020 2020 6466 203d 2073 656c 662e        df = self.
+00003ea0: 6466 2e73 6574 5f69 6e64 6578 2874 696d  df.set_index(tim
+00003eb0: 6563 6f6c 290d 0a20 2020 2020 2020 2020  ecol)..         
+00003ec0: 2020 2074 696d 6563 6f6c 203d 2074 696d     timecol = tim
+00003ed0: 6563 6f6c 2069 6620 7469 6d65 636f 6c20  ecol if timecol 
+00003ee0: 696e 2064 6174 6173 7263 2e64 662e 636f  in datasrc.df.co
+00003ef0: 6c75 6d6e 7320 656c 7365 2064 6174 6173  lumns else datas
+00003f00: 7263 2e64 662e 636f 6c75 6d6e 735b 305d  rc.df.columns[0]
+00003f10: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+00003f20: 7763 6f6c 7320 3d20 6461 7461 7372 632e  wcols = datasrc.
+00003f30: 6466 2e73 6574 5f69 6e64 6578 2874 696d  df.set_index(tim
+00003f40: 6563 6f6c 290d 0a20 2020 2020 2020 2065  ecol)..        e
+00003f50: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00003f60: 2020 6466 203d 2073 656c 662e 6466 0d0a    df = self.df..
+00003f70: 2020 2020 2020 2020 2020 2020 6e65 7763              newc
+00003f80: 6f6c 7320 3d20 6461 7461 7372 632e 6466  ols = datasrc.df
+00003f90: 0d0a 2020 2020 2020 2020 636f 6c73 203d  ..        cols =
+00003fa0: 206c 6973 7428 6e65 7763 6f6c 732e 636f   list(newcols.co
+00003fb0: 6c75 6d6e 7329 0d0a 2020 2020 2020 2020  lumns)..        
+00003fc0: 666f 7220 692c 636f 6c20 696e 2065 6e75  for i,col in enu
+00003fd0: 6d65 7261 7465 2863 6f6c 7329 3a0d 0a20  merate(cols):.. 
+00003fe0: 2020 2020 2020 2020 2020 206f 6c64 5f63             old_c
+00003ff0: 6f6c 203d 2063 6f6c 0d0a 2020 2020 2020  ol = col..      
+00004000: 2020 2020 2020 7768 696c 6520 636f 6c20        while col 
+00004010: 696e 2073 656c 662e 6466 2e63 6f6c 756d  in self.df.colum
+00004020: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
+00004030: 2020 2020 2063 6f6c 735b 695d 203d 2063       cols[i] = c
+00004040: 6f6c 203d 2073 7472 2863 6f6c 292b 272b  ol = str(col)+'+
+00004050: 270d 0a20 2020 2020 2020 2020 2020 2069  '..            i
+00004060: 6620 6f6c 645f 636f 6c20 213d 2063 6f6c  f old_col != col
+00004070: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00004080: 2020 2064 6174 6173 7263 2e72 656e 616d     datasrc.renam
+00004090: 6573 5b6f 6c64 5f63 6f6c 5d20 3d20 636f  es[old_col] = co
+000040a0: 6c0d 0a20 2020 2020 2020 206e 6577 636f  l..        newco
+000040b0: 6c73 2e63 6f6c 756d 6e73 203d 2063 6f6c  ls.columns = col
+000040c0: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
+000040d0: 6466 203d 2064 662e 6a6f 696e 286e 6577  df = df.join(new
+000040e0: 636f 6c73 2c20 686f 773d 276f 7574 6572  cols, how='outer
+000040f0: 2729 0d0a 2020 2020 2020 2020 6966 205f  ')..        if _
+00004100: 6861 735f 7469 6d65 636f 6c28 6461 7461  has_timecol(data
+00004110: 7372 632e 6466 293a 0d0a 2020 2020 2020  src.df):..      
+00004120: 2020 2020 2020 7365 6c66 2e64 662e 7265        self.df.re
+00004130: 7365 745f 696e 6465 7828 696e 706c 6163  set_index(inplac
+00004140: 653d 5472 7565 290d 0a20 2020 2020 2020  e=True)..       
+00004150: 2064 6174 6173 7263 2e64 6620 3d20 7365   datasrc.df = se
+00004160: 6c66 2e64 6620 2320 7468 6579 2061 7265  lf.df # they are
+00004170: 2074 6865 2073 616d 6520 6e6f 770d 0a20   the same now.. 
+00004180: 2020 2020 2020 2064 6174 6173 7263 2e69         datasrc.i
+00004190: 6e69 745f 7830 203d 2073 656c 662e 696e  nit_x0 = self.in
+000041a0: 6974 5f78 300d 0a20 2020 2020 2020 2064  it_x0..        d
+000041b0: 6174 6173 7263 2e69 6e69 745f 7831 203d  atasrc.init_x1 =
+000041c0: 2073 656c 662e 696e 6974 5f78 310d 0a20   self.init_x1.. 
+000041d0: 2020 2020 2020 2064 6174 6173 7263 2e63         datasrc.c
+000041e0: 6f6c 5f64 6174 615f 6f66 6673 6574 203d  ol_data_offset =
+000041f0: 206f 7269 675f 636f 6c5f 6461 7461 5f63   orig_col_data_c
+00004200: 6e74 0d0a 2020 2020 2020 2020 6461 7461  nt..        data
+00004210: 7372 632e 7363 616c 655f 636f 6c73 203d  src.scale_cols =
+00004220: 206e 6577 5f73 6361 6c65 5f63 6f6c 730d   new_scale_cols.
+00004230: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
+00004240: 6368 655f 6869 6c6f 203d 204f 7264 6572  che_hilo = Order
+00004250: 6564 4469 6374 2829 0d0a 2020 2020 2020  edDict()..      
+00004260: 2020 7365 6c66 2e5f 7065 7269 6f64 203d    self._period =
+00004270: 2073 656c 662e 5f73 6d6f 6f74 685f 7469   self._smooth_ti
+00004280: 6d65 203d 204e 6f6e 650d 0a20 2020 2020  me = None..     
+00004290: 2020 2064 6174 6173 7263 2e5f 7065 7269     datasrc._peri
+000042a0: 6f64 203d 2064 6174 6173 7263 2e5f 736d  od = datasrc._sm
+000042b0: 6f6f 7468 5f74 696d 6520 3d20 4e6f 6e65  ooth_time = None
+000042c0: 0d0a 2020 2020 2020 2020 6c64 6632 203d  ..        ldf2 =
+000042d0: 206c 656e 2873 656c 662e 6466 2920 2f2f   len(self.df) //
+000042e0: 2032 0d0a 2020 2020 2020 2020 7365 6c66   2..        self
+000042f0: 2e69 735f 7370 6172 7365 203d 2073 656c  .is_sparse = sel
+00004300: 662e 6973 5f73 7061 7273 6520 6f72 2073  f.is_sparse or s
+00004310: 656c 662e 6466 5b73 656c 662e 6466 2e63  elf.df[self.df.c
+00004320: 6f6c 756d 6e73 5b73 656c 662e 636f 6c5f  olumns[self.col_
+00004330: 6461 7461 5f6f 6666 7365 745d 5d2e 6973  data_offset]].is
+00004340: 6e75 6c6c 2829 2e73 756d 2829 2e6d 6178  null().sum().max
+00004350: 2829 203e 206c 6466 320d 0a20 2020 2020  () > ldf2..     
+00004360: 2020 2064 6174 6173 7263 2e69 735f 7370     datasrc.is_sp
+00004370: 6172 7365 203d 2064 6174 6173 7263 2e69  arse = datasrc.i
+00004380: 735f 7370 6172 7365 206f 7220 6461 7461  s_sparse or data
+00004390: 7372 632e 6466 5b64 6174 6173 7263 2e64  src.df[datasrc.d
+000043a0: 662e 636f 6c75 6d6e 735b 6461 7461 7372  f.columns[datasr
+000043b0: 632e 636f 6c5f 6461 7461 5f6f 6666 7365  c.col_data_offse
+000043c0: 745d 5d2e 6973 6e75 6c6c 2829 2e73 756d  t]].isnull().sum
+000043d0: 2829 2e6d 6178 2829 203e 206c 6466 320d  ().max() > ldf2.
+000043e0: 0a0d 0a20 2020 2064 6566 2075 7064 6174  ...    def updat
+000043f0: 6528 7365 6c66 2c20 6461 7461 7372 6329  e(self, datasrc)
+00004400: 3a0d 0a20 2020 2020 2020 2064 6620 3d20  :..        df = 
+00004410: 7365 6c66 2e70 7265 5f75 7064 6174 6528  self.pre_update(
+00004420: 7365 6c66 2e64 6629 0d0a 2020 2020 2020  self.df)..      
+00004430: 2020 6f72 6967 5f63 6f6c 7320 3d20 6c69    orig_cols = li
+00004440: 7374 2864 662e 636f 6c75 6d6e 7329 0d0a  st(df.columns)..
+00004450: 2020 2020 2020 2020 7469 6d65 636f 6c2c          timecol,
+00004460: 6f72 6967 5f63 6f6c 7320 3d20 6f72 6967  orig_cols = orig
+00004470: 5f63 6f6c 735b 305d 2c6f 7269 675f 636f  _cols[0],orig_co
+00004480: 6c73 5b31 3a5d 0d0a 2020 2020 2020 2020  ls[1:]..        
+00004490: 6466 203d 2064 662e 7365 745f 696e 6465  df = df.set_inde
+000044a0: 7828 7469 6d65 636f 6c29 0d0a 2020 2020  x(timecol)..    
+000044b0: 2020 2020 696e 7075 745f 6466 203d 2064      input_df = d
+000044c0: 6174 6173 7263 2e64 662e 7365 745f 696e  atasrc.df.set_in
+000044d0: 6465 7828 6461 7461 7372 632e 6466 2e63  dex(datasrc.df.c
+000044e0: 6f6c 756d 6e73 5b30 5d29 0d0a 2020 2020  olumns[0])..    
+000044f0: 2020 2020 696e 7075 745f 6466 2e63 6f6c      input_df.col
+00004500: 756d 6e73 203d 205b 7365 6c66 2e72 656e  umns = [self.ren
+00004510: 616d 6573 2e67 6574 2863 6f6c 2c20 636f  ames.get(col, co
+00004520: 6c29 2066 6f72 2063 6f6c 2069 6e20 696e  l) for col in in
+00004530: 7075 745f 6466 2e63 6f6c 756d 6e73 5d0d  put_df.columns].
+00004540: 0a20 2020 2020 2020 2023 2070 6164 2069  .        # pad i
+00004550: 6e64 6578 2069 6620 7468 6520 696e 7075  ndex if the inpu
+00004560: 7420 6461 7461 2069 7320 6120 7375 622d  t data is a sub-
+00004570: 7365 740d 0a20 2020 2020 2020 2069 6620  set..        if 
+00004580: 6c65 6e28 696e 7075 745f 6466 2920 3e20  len(input_df) > 
+00004590: 3020 616e 6420 6c65 6e28 6466 2920 3e20  0 and len(df) > 
+000045a0: 3020 616e 6420 286c 656e 2864 6629 2021  0 and (len(df) !
+000045b0: 3d20 6c65 6e28 696e 7075 745f 6466 2920  = len(input_df) 
+000045c0: 6f72 2069 6e70 7574 5f64 662e 696e 6465  or input_df.inde
+000045d0: 785b 2d31 5d20 213d 2064 662e 696e 6465  x[-1] != df.inde
+000045e0: 785b 2d31 5d29 3a0d 0a20 2020 2020 2020  x[-1]):..       
+000045f0: 2020 2020 206f 7574 7075 745f 6466 203d       output_df =
+00004600: 2070 642e 6d65 7267 6528 696e 7075 745f   pd.merge(input_
+00004610: 6466 2c20 6466 5b5b 5d5d 2c20 686f 773d  df, df[[]], how=
+00004620: 276f 7574 6572 272c 206c 6566 745f 696e  'outer', left_in
+00004630: 6465 783d 5472 7565 2c20 7269 6768 745f  dex=True, right_
+00004640: 696e 6465 783d 5472 7565 290d 0a20 2020  index=True)..   
+00004650: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00004660: 2020 2020 2020 2020 6f75 7470 7574 5f64          output_d
+00004670: 6620 3d20 696e 7075 745f 6466 0d0a 2020  f = input_df..  
+00004680: 2020 2020 2020 666f 7220 636f 6c20 696e        for col in
+00004690: 2064 662e 636f 6c75 6d6e 733a 0d0a 2020   df.columns:..  
+000046a0: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
+000046b0: 206e 6f74 2069 6e20 6f75 7470 7574 5f64   not in output_d
+000046c0: 662e 636f 6c75 6d6e 733a 0d0a 2020 2020  f.columns:..    
+000046d0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+000046e0: 7574 5f64 665b 636f 6c5d 203d 2064 665b  ut_df[col] = df[
+000046f0: 636f 6c5d 0d0a 2020 2020 2020 2020 2320  col]..        # 
+00004700: 6966 206e 6563 6365 7373 6172 792c 2063  if neccessary, c
+00004710: 7574 206f 7574 2075 6e77 616e 7465 6420  ut out unwanted 
+00004720: 6461 7461 0d0a 2020 2020 2020 2020 6966  data..        if
+00004730: 206c 656e 2869 6e70 7574 5f64 6629 203e   len(input_df) >
+00004740: 2030 2061 6e64 206c 656e 2864 6629 203e   0 and len(df) >
+00004750: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00004760: 2073 7461 7274 5f69 6478 203d 2065 6e64   start_idx = end
+00004770: 5f69 6478 203d 204e 6f6e 650d 0a20 2020  _idx = None..   
+00004780: 2020 2020 2020 2020 2069 6620 696e 7075           if inpu
+00004790: 745f 6466 2e69 6e64 6578 5b30 5d20 3e20  t_df.index[0] > 
+000047a0: 6466 2e69 6e64 6578 5b30 5d3a 0d0a 2020  df.index[0]:..  
+000047b0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000047c0: 6172 745f 6964 7820 3d20 300d 0a20 2020  art_idx = 0..   
+000047d0: 2020 2020 2020 2020 2069 6620 696e 7075           if inpu
+000047e0: 745f 6466 2e69 6e64 6578 5b2d 315d 203c  t_df.index[-1] <
+000047f0: 2064 662e 696e 6465 785b 2d31 5d3a 0d0a   df.index[-1]:..
+00004800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004810: 656e 645f 6964 7820 3d20 2d31 0d0a 2020  end_idx = -1..  
+00004820: 2020 2020 2020 2020 2020 6966 2073 7461            if sta
+00004830: 7274 5f69 6478 2069 7320 6e6f 7420 4e6f  rt_idx is not No
+00004840: 6e65 206f 7220 656e 645f 6964 7820 6973  ne or end_idx is
+00004850: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00004860: 2020 2020 2020 2020 2020 2020 656e 645f              end_
+00004870: 6964 7820 3d20 4e6f 6e65 2069 6620 656e  idx = None if en
+00004880: 645f 6964 7820 3d3d 202d 3120 656c 7365  d_idx == -1 else
+00004890: 2065 6e64 5f69 6478 0d0a 2020 2020 2020   end_idx..      
+000048a0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+000048b0: 5f64 6620 3d20 6f75 7470 7574 5f64 662e  _df = output_df.
+000048c0: 6c6f 635b 696e 7075 745f 6466 2e69 6e64  loc[input_df.ind
+000048d0: 6578 5b73 7461 7274 5f69 6478 3a65 6e64  ex[start_idx:end
+000048e0: 5f69 6478 5d2c 203a 5d0d 0a20 2020 2020  _idx], :]..     
+000048f0: 2020 206f 7574 7075 745f 6466 203d 2073     output_df = s
+00004900: 656c 662e 706f 7374 5f75 7064 6174 6528  elf.post_update(
+00004910: 6f75 7470 7574 5f64 6629 0d0a 2020 2020  output_df)..    
+00004920: 2020 2020 6f75 7470 7574 5f64 6620 3d20      output_df = 
+00004930: 6f75 7470 7574 5f64 662e 7265 7365 745f  output_df.reset_
+00004940: 696e 6465 7828 290d 0a20 2020 2020 2020  index()..       
+00004950: 2073 656c 662e 6466 203d 206f 7574 7075   self.df = outpu
+00004960: 745f 6466 5b5b 6f75 7470 7574 5f64 662e  t_df[[output_df.
+00004970: 636f 6c75 6d6e 735b 305d 5d2b 6f72 6967  columns[0]]+orig
+00004980: 5f63 6f6c 735d 2069 6620 6f72 6967 5f63  _cols] if orig_c
+00004990: 6f6c 7320 656c 7365 206f 7574 7075 745f  ols else output_
+000049a0: 6466 0d0a 2020 2020 2020 2020 7365 6c66  df..        self
+000049b0: 2e69 6e69 745f 7831 203d 2073 656c 662e  .init_x1 = self.
+000049c0: 786c 656e 202b 2072 6967 6874 5f6d 6172  xlen + right_mar
+000049d0: 6769 6e5f 6361 6e64 6c65 7320 2d20 7369  gin_candles - si
+000049e0: 6465 5f6d 6172 6769 6e0d 0a20 2020 2020  de_margin..     
+000049f0: 2020 2073 656c 662e 6361 6368 655f 6869     self.cache_hi
+00004a00: 6c6f 203d 204f 7264 6572 6564 4469 6374  lo = OrderedDict
+00004a10: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00004a20: 2e5f 7065 7269 6f64 203d 2073 656c 662e  ._period = self.
+00004a30: 5f73 6d6f 6f74 685f 7469 6d65 203d 204e  _smooth_time = N
+00004a40: 6f6e 650d 0a0d 0a20 2020 2064 6566 2073  one....    def s
+00004a50: 6574 5f64 6628 7365 6c66 2c20 6466 293a  et_df(self, df):
+00004a60: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+00004a70: 6620 3d20 6466 0d0a 2020 2020 2020 2020  f = df..        
+00004a80: 7365 6c66 2e63 6163 6865 5f68 696c 6f20  self.cache_hilo 
+00004a90: 3d20 4f72 6465 7265 6444 6963 7428 290d  = OrderedDict().
+00004aa0: 0a20 2020 2020 2020 2073 656c 662e 5f70  .        self._p
+00004ab0: 6572 696f 6420 3d20 7365 6c66 2e5f 736d  eriod = self._sm
+00004ac0: 6f6f 7468 5f74 696d 6520 3d20 4e6f 6e65  ooth_time = None
+00004ad0: 0d0a 0d0a 2020 2020 6465 6620 6869 6c6f  ....    def hilo
+00004ae0: 2873 656c 662c 2078 302c 2078 3129 3a0d  (self, x0, x1):.
+00004af0: 0a20 2020 2020 2020 2027 2727 5265 7475  .        '''Retu
+00004b00: 726e 2066 6976 6520 7661 6c75 6573 2069  rn five values i
+00004b10: 6e20 7469 6d65 2072 616e 6765 3a20 7430  n time range: t0
+00004b20: 2c20 7431 2c20 6869 6768 6573 742c 206c  , t1, highest, l
+00004b30: 6f77 6573 742c 206e 756d 6265 7220 6f66  owest, number of
+00004b40: 2072 6f77 732e 2727 270d 0a20 2020 2020   rows.'''..     
+00004b50: 2020 2069 6620 7830 203d 3d20 7831 3a0d     if x0 == x1:.
+00004b60: 0a20 2020 2020 2020 2020 2020 2078 3020  .            x0 
+00004b70: 3d20 7831 203d 2069 6e74 2878 3129 0d0a  = x1 = int(x1)..
+00004b80: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00004b90: 2020 2020 2020 2020 2020 2078 302c 7831             x0,x1
+00004ba0: 203d 2069 6e74 2878 302b 302e 3529 2c69   = int(x0+0.5),i
+00004bb0: 6e74 2878 3129 0d0a 2020 2020 2020 2020  nt(x1)..        
+00004bc0: 7175 6572 7920 3d20 2725 692c 2569 2720  query = '%i,%i' 
+00004bd0: 2520 2878 302c 7831 290d 0a20 2020 2020  % (x0,x1)..     
+00004be0: 2020 2069 6620 7175 6572 7920 6e6f 7420     if query not 
+00004bf0: 696e 2073 656c 662e 6361 6368 655f 6869  in self.cache_hi
+00004c00: 6c6f 3a0d 0a20 2020 2020 2020 2020 2020  lo:..           
+00004c10: 2076 203d 2073 656c 662e 6361 6368 655f   v = self.cache_
+00004c20: 6869 6c6f 5b71 7565 7279 5d20 3d20 7365  hilo[query] = se
+00004c30: 6c66 2e5f 6869 6c6f 2878 302c 2078 3129  lf._hilo(x0, x1)
+00004c40: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00004c50: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
+00004c60: 652d 696e 7365 7274 2074 6f20 7261 6973  e-insert to rais
+00004c70: 6520 7072 696f 0d0a 2020 2020 2020 2020  e prio..        
+00004c80: 2020 2020 7620 3d20 7365 6c66 2e63 6163      v = self.cac
+00004c90: 6865 5f68 696c 6f5b 7175 6572 795d 203d  he_hilo[query] =
+00004ca0: 2073 656c 662e 6361 6368 655f 6869 6c6f   self.cache_hilo
+00004cb0: 2e70 6f70 2871 7565 7279 290d 0a20 2020  .pop(query)..   
+00004cc0: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
+00004cd0: 2e63 6163 6865 5f68 696c 6f29 203e 2031  .cache_hilo) > 1
+00004ce0: 3030 3a20 2320 6472 6f70 2069 6620 746f  00: # drop if to
+00004cf0: 6f20 6d61 6e79 0d0a 2020 2020 2020 2020  o many..        
+00004d00: 2020 2020 6465 6c20 7365 6c66 2e63 6163      del self.cac
+00004d10: 6865 5f68 696c 6f5b 6e65 7874 2869 7465  he_hilo[next(ite
+00004d20: 7228 7365 6c66 2e63 6163 6865 5f68 696c  r(self.cache_hil
+00004d30: 6f29 295d 0d0a 2020 2020 2020 2020 7265  o))]..        re
+00004d40: 7475 726e 2076 0d0a 0d0a 2020 2020 6465  turn v....    de
+00004d50: 6620 5f68 696c 6f28 7365 6c66 2c20 7830  f _hilo(self, x0
+00004d60: 2c20 7831 293a 0d0a 2020 2020 2020 2020  , x1):..        
+00004d70: 6466 203d 2073 656c 662e 6466 2e6c 6f63  df = self.df.loc
+00004d80: 5b78 303a 7831 2c20 3a5d 0d0a 2020 2020  [x0:x1, :]..    
+00004d90: 2020 2020 6966 206e 6f74 206c 656e 2864      if not len(d
+00004da0: 6629 3a0d 0a20 2020 2020 2020 2020 2020  f):..           
+00004db0: 2072 6574 7572 6e20 302c 302c 302c 302c   return 0,0,0,0,
+00004dc0: 300d 0a20 2020 2020 2020 2074 696d 6563  0..        timec
+00004dd0: 6f6c 203d 2064 662e 636f 6c75 6d6e 735b  ol = df.columns[
+00004de0: 305d 0d0a 2020 2020 2020 2020 7430 203d  0]..        t0 =
+00004df0: 2064 665b 7469 6d65 636f 6c5d 2e69 6c6f   df[timecol].ilo
+00004e00: 635b 305d 0d0a 2020 2020 2020 2020 7431  c[0]..        t1
+00004e10: 203d 2064 665b 7469 6d65 636f 6c5d 2e69   = df[timecol].i
+00004e20: 6c6f 635b 2d31 5d0d 0a20 2020 2020 2020  loc[-1]..       
+00004e30: 2076 616c 636f 6c73 203d 2064 662e 636f   valcols = df.co
+00004e40: 6c75 6d6e 735b 7365 6c66 2e73 6361 6c65  lumns[self.scale
+00004e50: 5f63 6f6c 735d 0d0a 2020 2020 2020 2020  _cols]..        
+00004e60: 6869 203d 2064 665b 7661 6c63 6f6c 735d  hi = df[valcols]
+00004e70: 2e6d 6178 2829 2e6d 6178 2829 0d0a 2020  .max().max()..  
+00004e80: 2020 2020 2020 6c6f 203d 2064 665b 7661        lo = df[va
+00004e90: 6c63 6f6c 735d 2e6d 696e 2829 2e6d 696e  lcols].min().min
+00004ea0: 2829 0d0a 2020 2020 2020 2020 7265 7475  ()..        retu
+00004eb0: 726e 2074 302c 7431 2c68 692c 6c6f 2c6c  rn t0,t1,hi,lo,l
+00004ec0: 656e 2864 6629 0d0a 0d0a 2020 2020 6465  en(df)....    de
+00004ed0: 6620 726f 7773 2873 656c 662c 2063 6f6c  f rows(self, col
+00004ee0: 636e 742c 2078 302c 2078 312c 2079 7363  cnt, x0, x1, ysc
+00004ef0: 616c 652c 206c 6f64 3d54 7275 652c 2072  ale, lod=True, r
+00004f00: 6573 616d 703d 4e6f 6e65 293a 0d0a 2020  esamp=None):..  
+00004f10: 2020 2020 2020 6466 203d 2073 656c 662e        df = self.
+00004f20: 6466 2e6c 6f63 5b78 303a 7831 2c20 3a5d  df.loc[x0:x1, :]
+00004f30: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00004f40: 662e 6973 5f73 7061 7273 653a 0d0a 2020  f.is_sparse:..  
+00004f50: 2020 2020 2020 2020 2020 6466 203d 2064            df = d
+00004f60: 662e 6c6f 635b 6466 2e69 6c6f 635b 3a2c  f.loc[df.iloc[:,
+00004f70: 7365 6c66 2e63 6f6c 5f64 6174 615f 6f66  self.col_data_of
+00004f80: 6673 6574 5d2e 6e6f 746e 6128 292c 203a  fset].notna(), :
+00004f90: 5d0d 0a20 2020 2020 2020 206f 7269 676c  ]..        origl
+00004fa0: 656e 203d 206c 656e 2864 6629 0d0a 2020  en = len(df)..  
+00004fb0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00004fc0: 662e 5f72 6f77 7328 6466 2c20 636f 6c63  f._rows(df, colc
+00004fd0: 6e74 2c20 7973 6361 6c65 3d79 7363 616c  nt, yscale=yscal
+00004fe0: 652c 206c 6f64 3d6c 6f64 2c20 7265 7361  e, lod=lod, resa
+00004ff0: 6d70 3d72 6573 616d 7029 2c20 6f72 6967  mp=resamp), orig
+00005000: 6c65 6e0d 0a0d 0a20 2020 2064 6566 205f  len....    def _
+00005010: 726f 7773 2873 656c 662c 2064 662c 2063  rows(self, df, c
+00005020: 6f6c 636e 742c 2079 7363 616c 652c 206c  olcnt, yscale, l
+00005030: 6f64 2c20 7265 7361 6d70 293a 0d0a 2020  od, resamp):..  
+00005040: 2020 2020 2020 636f 6c63 6e74 202d 3d20        colcnt -= 
+00005050: 3120 2320 7469 6d65 2069 7320 616c 7761  1 # time is alwa
+00005060: 7973 2069 6d70 6c69 6564 0d0a 2020 2020  ys implied..    
+00005070: 2020 2020 636f 6c69 6478 7320 3d20 5b30      colidxs = [0
+00005080: 5d20 2b20 6c69 7374 2872 616e 6765 2873  ] + list(range(s
+00005090: 656c 662e 636f 6c5f 6461 7461 5f6f 6666  elf.col_data_off
+000050a0: 7365 742c 2073 656c 662e 636f 6c5f 6461  set, self.col_da
+000050b0: 7461 5f6f 6666 7365 742b 636f 6c63 6e74  ta_offset+colcnt
+000050c0: 2929 0d0a 2020 2020 2020 2020 6966 206c  ))..        if l
+000050d0: 6f64 2061 6e64 206c 656e 2864 6629 203e  od and len(df) >
+000050e0: 206c 6f64 5f63 616e 646c 6573 3a0d 0a20   lod_candles:.. 
+000050f0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+00005100: 7361 6d70 3a0d 0a20 2020 2020 2020 2020  samp:..         
+00005110: 2020 2020 2020 2064 6620 3d20 7365 6c66         df = self
+00005120: 2e5f 7265 7361 6d70 6c65 2864 662c 2063  ._resample(df, c
+00005130: 6f6c 636e 742c 2072 6573 616d 7029 0d0a  olcnt, resamp)..
+00005140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005150: 636f 6c69 6478 7320 3d20 4e6f 6e65 0d0a  colidxs = None..
+00005160: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00005170: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005180: 2020 2064 6620 3d20 6466 2e69 6c6f 635b     df = df.iloc[
+00005190: 3a3a 6c65 6e28 6466 292f 2f6c 6f64 5f63  ::len(df)//lod_c
+000051a0: 616e 646c 6573 5d0d 0a20 2020 2020 2020  andles]..       
+000051b0: 2064 6672 203d 2064 662e 696c 6f63 5b3a   dfr = df.iloc[:
+000051c0: 2c63 6f6c 6964 7873 5d20 6966 2063 6f6c  ,colidxs] if col
+000051d0: 6964 7873 2065 6c73 6520 6466 0d0a 2020  idxs else df..  
+000051e0: 2020 2020 2020 6966 2079 7363 616c 652e        if yscale.
+000051f0: 7363 616c 6574 7970 6520 3d3d 2027 6c6f  scaletype == 'lo
+00005200: 6727 206f 7220 7973 6361 6c65 2e73 6361  g' or yscale.sca
+00005210: 6c65 6620 213d 2031 3a0d 0a20 2020 2020  lef != 1:..     
+00005220: 2020 2020 2020 2064 6672 203d 2064 6672         dfr = dfr
+00005230: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
+00005240: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00005250: 6e67 6528 312c 2063 6f6c 636e 742b 3129  nge(1, colcnt+1)
+00005260: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005270: 2020 2063 6f6c 6e61 6d65 203d 2064 6672     colname = dfr
+00005280: 2e63 6f6c 756d 6e73 5b69 5d0d 0a20 2020  .columns[i]..   
+00005290: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000052a0: 6466 725b 636f 6c6e 616d 655d 2e64 7479  dfr[colname].dty
+000052b0: 7065 2021 3d20 6f62 6a65 6374 3a0d 0a20  pe != object:.. 
+000052c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052d0: 2020 2064 6672 5b63 6f6c 6e61 6d65 5d20     dfr[colname] 
+000052e0: 3d20 7973 6361 6c65 2e69 6e76 7866 6f72  = yscale.invxfor
+000052f0: 6d28 6466 722e 696c 6f63 5b3a 2c69 5d29  m(dfr.iloc[:,i])
+00005300: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00005310: 2064 6672 0d0a 0d0a 2020 2020 6465 6620   dfr....    def 
+00005320: 5f72 6573 616d 706c 6528 7365 6c66 2c20  _resample(self, 
+00005330: 6466 2c20 636f 6c63 6e74 2c20 7265 7361  df, colcnt, resa
+00005340: 6d70 293a 0d0a 2020 2020 2020 2020 6364  mp):..        cd
+00005350: 6f20 3d20 7365 6c66 2e63 6f6c 5f64 6174  o = self.col_dat
+00005360: 615f 6f66 6673 6574 0d0a 2020 2020 2020  a_offset..      
+00005370: 2020 7361 6d70 6c65 5f72 6174 6520 3d20    sample_rate = 
+00005380: 6c65 6e28 6466 2920 2a20 3520 2f2f 206c  len(df) * 5 // l
+00005390: 6f64 5f63 616e 646c 6573 0d0a 2020 2020  od_candles..    
+000053a0: 2020 2020 6f66 6673 6574 203d 206c 656e      offset = len
+000053b0: 2864 6629 2025 2073 616d 706c 655f 7261  (df) % sample_ra
+000053c0: 7465 0d0a 2020 2020 2020 2020 6466 6420  te..        dfd 
+000053d0: 3d20 6466 5b5b 6466 2e63 6f6c 756d 6e73  = df[[df.columns
+000053e0: 5b30 5d5d 2b5b 6466 2e63 6f6c 756d 6e73  [0]]+[df.columns
+000053f0: 5b63 646f 5d5d 5d2e 696c 6f63 5b6f 6666  [cdo]]].iloc[off
+00005400: 7365 743a 3a73 616d 706c 655f 7261 7465  set::sample_rate
+00005410: 5d0d 0a20 2020 2020 2020 2063 203d 2064  ]..        c = d
+00005420: 665b 6466 2e63 6f6c 756d 6e73 5b63 646f  f[df.columns[cdo
+00005430: 2b31 5d5d 2e69 6c6f 635b 6f66 6673 6574  +1]].iloc[offset
+00005440: 2b73 616d 706c 655f 7261 7465 2d31 3a3a  +sample_rate-1::
+00005450: 7361 6d70 6c65 5f72 6174 655d 0d0a 2020  sample_rate]..  
+00005460: 2020 2020 2020 632e 696e 6465 7820 2d3d        c.index -=
+00005470: 2073 616d 706c 655f 7261 7465 202d 2031   sample_rate - 1
+00005480: 0d0a 2020 2020 2020 2020 6466 645b 6466  ..        dfd[df
+00005490: 2e63 6f6c 756d 6e73 5b63 646f 2b31 5d5d  .columns[cdo+1]]
+000054a0: 203d 2063 0d0a 2020 2020 2020 2020 6966   = c..        if
+000054b0: 2072 6573 616d 7020 3d3d 2027 6869 6c6f   resamp == 'hilo
+000054c0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+000054d0: 6466 645b 6466 2e63 6f6c 756d 6e73 5b63  dfd[df.columns[c
+000054e0: 646f 2b32 5d5d 203d 2064 665b 6466 2e63  do+2]] = df[df.c
+000054f0: 6f6c 756d 6e73 5b63 646f 2b32 5d5d 2e72  olumns[cdo+2]].r
+00005500: 6f6c 6c69 6e67 2873 616d 706c 655f 7261  olling(sample_ra
+00005510: 7465 292e 6d61 7828 292e 7368 6966 7428  te).max().shift(
+00005520: 2d73 616d 706c 655f 7261 7465 2b31 290d  -sample_rate+1).
+00005530: 0a20 2020 2020 2020 2020 2020 2064 6664  .            dfd
+00005540: 5b64 662e 636f 6c75 6d6e 735b 6364 6f2b  [df.columns[cdo+
+00005550: 335d 5d20 3d20 6466 5b64 662e 636f 6c75  3]] = df[df.colu
+00005560: 6d6e 735b 6364 6f2b 335d 5d2e 726f 6c6c  mns[cdo+3]].roll
+00005570: 696e 6728 7361 6d70 6c65 5f72 6174 6529  ing(sample_rate)
+00005580: 2e6d 696e 2829 2e73 6869 6674 282d 7361  .min().shift(-sa
+00005590: 6d70 6c65 5f72 6174 652b 3129 0d0a 2020  mple_rate+1)..  
+000055a0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000055b0: 2020 2020 2020 2020 2064 6664 5b64 662e           dfd[df.
+000055c0: 636f 6c75 6d6e 735b 6364 6f2b 325d 5d20  columns[cdo+2]] 
+000055d0: 3d20 6466 5b64 662e 636f 6c75 6d6e 735b  = df[df.columns[
+000055e0: 6364 6f2b 325d 5d2e 726f 6c6c 696e 6728  cdo+2]].rolling(
+000055f0: 7361 6d70 6c65 5f72 6174 6529 2e73 756d  sample_rate).sum
+00005600: 2829 2e73 6869 6674 282d 7361 6d70 6c65  ().shift(-sample
+00005610: 5f72 6174 652b 3129 0d0a 2020 2020 2020  _rate+1)..      
+00005620: 2020 2020 2020 6466 645b 6466 2e63 6f6c        dfd[df.col
+00005630: 756d 6e73 5b63 646f 2b33 5d5d 203d 2064  umns[cdo+3]] = d
+00005640: 665b 6466 2e63 6f6c 756d 6e73 5b63 646f  f[df.columns[cdo
+00005650: 2b33 5d5d 2e72 6f6c 6c69 6e67 2873 616d  +3]].rolling(sam
+00005660: 706c 655f 7261 7465 292e 7375 6d28 292e  ple_rate).sum().
+00005670: 7368 6966 7428 2d73 616d 706c 655f 7261  shift(-sample_ra
+00005680: 7465 2b31 290d 0a20 2020 2020 2020 2023  te+1)..        #
+00005690: 2061 7070 656e 6420 7472 6169 6c69 6e67   append trailing
+000056a0: 2063 6f6c 756d 6e73 0d0a 2020 2020 2020   columns..      
+000056b0: 2020 7472 6169 6c69 6e67 5f63 6f6c 6964    trailing_colid
+000056c0: 7820 3d20 6364 6f20 2b20 340d 0a20 2020  x = cdo + 4..   
+000056d0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+000056e0: 6e67 6528 7472 6169 6c69 6e67 5f63 6f6c  nge(trailing_col
+000056f0: 6964 782c 2063 6f6c 636e 7429 3a0d 0a20  idx, colcnt):.. 
+00005700: 2020 2020 2020 2020 2020 2063 6f6c 203d             col =
+00005710: 2064 662e 636f 6c75 6d6e 735b 695d 0d0a   df.columns[i]..
+00005720: 2020 2020 2020 2020 2020 2020 6466 645b              dfd[
+00005730: 636f 6c5d 203d 2064 665b 636f 6c5d 2e69  col] = df[col].i
+00005740: 6c6f 635b 6f66 6673 6574 3a3a 7361 6d70  loc[offset::samp
+00005750: 6c65 5f72 6174 655d 0d0a 2020 2020 2020  le_rate]..      
+00005760: 2020 7265 7475 726e 2064 6664 0d0a 0d0a    return dfd....
+00005770: 2020 2020 6465 6620 5f5f 6571 5f5f 2873      def __eq__(s
+00005780: 656c 662c 206f 7468 6572 293a 0d0a 2020  elf, other):..  
+00005790: 2020 2020 2020 7265 7475 726e 2069 6428        return id(
+000057a0: 7365 6c66 2920 3d3d 2069 6428 6f74 6865  self) == id(othe
+000057b0: 7229 206f 7220 6964 2873 656c 662e 6466  r) or id(self.df
+000057c0: 2920 3d3d 2069 6428 6f74 6865 722e 6466  ) == id(other.df
+000057d0: 290d 0a0d 0a20 2020 2064 6566 205f 5f68  )....    def __h
+000057e0: 6173 685f 5f28 7365 6c66 293a 0d0a 2020  ash__(self):..  
+000057f0: 2020 2020 2020 7265 7475 726e 2069 6428        return id(
+00005800: 7365 6c66 290d 0a0d 0a0d 0a63 6c61 7373  self)......class
+00005810: 2046 696e 5769 6e64 6f77 2870 672e 4772   FinWindow(pg.Gr
+00005820: 6170 6869 6373 4c61 796f 7574 5769 6467  aphicsLayoutWidg
+00005830: 6574 293a 0d0a 2020 2020 6465 6620 5f5f  et):..    def __
+00005840: 696e 6974 5f5f 2873 656c 662c 2074 6974  init__(self, tit
+00005850: 6c65 2c20 2a2a 6b77 6172 6773 293a 0d0a  le, **kwargs):..
+00005860: 2020 2020 2020 2020 676c 6f62 616c 2077          global w
+00005870: 696e 782c 2077 696e 790d 0a20 2020 2020  inx, winy..     
+00005880: 2020 2073 656c 662e 7469 746c 6520 3d20     self.title = 
+00005890: 7469 746c 650d 0a20 2020 2020 2020 2070  title..        p
+000058a0: 672e 6d6b 5141 7070 2829 0d0a 2020 2020  g.mkQApp()..    
+000058b0: 2020 2020 7375 7065 7228 292e 5f5f 696e      super().__in
+000058c0: 6974 5f5f 282a 2a6b 7761 7267 7329 0d0a  it__(**kwargs)..
+000058d0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+000058e0: 5769 6e64 6f77 5469 746c 6528 7469 746c  WindowTitle(titl
+000058f0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00005900: 2e73 6574 4765 6f6d 6574 7279 2877 696e  .setGeometry(win
+00005910: 782c 2077 696e 792c 2077 696e 772c 2077  x, winy, winw, w
+00005920: 696e 6829 0d0a 2020 2020 2020 2020 7769  inh)..        wi
+00005930: 6e78 203d 2028 7769 6e78 2b77 696e 5f72  nx = (winx+win_r
+00005940: 6563 7265 6174 655f 6465 6c74 6129 2025  ecreate_delta) %
+00005950: 2038 3030 0d0a 2020 2020 2020 2020 7769   800..        wi
+00005960: 6e79 203d 2028 7769 6e79 2b77 696e 5f72  ny = (winy+win_r
+00005970: 6563 7265 6174 655f 6465 6c74 6129 2025  ecreate_delta) %
+00005980: 2035 3030 0d0a 2020 2020 2020 2020 7365   500..        se
+00005990: 6c66 2e63 656e 7472 616c 5769 6467 6574  lf.centralWidget
+000059a0: 2e69 6e73 7461 6c6c 4576 656e 7446 696c  .installEventFil
+000059b0: 7465 7228 7365 6c66 290d 0a20 2020 2020  ter(self)..     
+000059c0: 2020 2073 656c 662e 6369 2e73 6574 436f     self.ci.setCo
+000059d0: 6e74 656e 7473 4d61 7267 696e 7328 302c  ntentsMargins(0,
+000059e0: 2030 2c20 302c 2030 290d 0a20 2020 2020   0, 0, 0)..     
+000059f0: 2020 2073 656c 662e 6369 2e73 6574 5370     self.ci.setSp
+00005a00: 6163 696e 6728 2d31 290d 0a20 2020 2020  acing(-1)..     
+00005a10: 2020 2073 656c 662e 636c 6f73 696e 6720     self.closing 
+00005a20: 3d20 4661 6c73 650d 0a0d 0a20 2020 2040  = False....    @
+00005a30: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+00005a40: 6620 6178 7328 7365 6c66 293a 0d0a 2020  f axs(self):..  
+00005a50: 2020 2020 2020 7265 7475 726e 205b 6178        return [ax
+00005a60: 2066 6f72 2061 7820 696e 2073 656c 662e   for ax in self.
+00005a70: 6369 2e69 7465 6d73 2069 6620 6973 696e  ci.items if isin
+00005a80: 7374 616e 6365 2861 782c 2070 672e 506c  stance(ax, pg.Pl
+00005a90: 6f74 4974 656d 295d 0d0a 0d0a 2020 2020  otItem)]....    
+00005aa0: 6465 6620 6175 746f 5261 6e67 6545 6e61  def autoRangeEna
+00005ab0: 626c 6564 2873 656c 6629 3a0d 0a20 2020  bled(self):..   
+00005ac0: 2020 2020 2072 6574 7572 6e20 5b54 7275       return [Tru
+00005ad0: 652c 2054 7275 655d 0d0a 0d0a 2020 2020  e, True]....    
+00005ae0: 6465 6620 636c 6f73 6528 7365 6c66 293a  def close(self):
+00005af0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00005b00: 6c6f 7369 6e67 203d 2054 7275 650d 0a20  losing = True.. 
+00005b10: 2020 2020 2020 205f 7361 7665 7769 6e64         _savewind
+00005b20: 6174 6128 7365 6c66 290d 0a20 2020 2020  ata(self)..     
+00005b30: 2020 205f 636c 6561 725f 7469 6d65 7273     _clear_timers
+00005b40: 2829 0d0a 2020 2020 2020 2020 7265 7475  ()..        retu
+00005b50: 726e 2073 7570 6572 2829 2e63 6c6f 7365  rn super().close
+00005b60: 2829 0d0a 0d0a 2020 2020 6465 6620 6576  ()....    def ev
+00005b70: 656e 7446 696c 7465 7228 7365 6c66 2c20  entFilter(self, 
+00005b80: 6f62 6a2c 2065 7629 3a0d 0a20 2020 2020  obj, ev):..     
+00005b90: 2020 2069 6620 6576 2e74 7970 6528 293d     if ev.type()=
+00005ba0: 3d20 5174 436f 7265 2e51 4576 656e 742e  = QtCore.QEvent.
+00005bb0: 5479 7065 2e57 696e 646f 7744 6561 6374  Type.WindowDeact
+00005bc0: 6976 6174 653a 0d0a 2020 2020 2020 2020  ivate:..        
+00005bd0: 2020 2020 5f73 6176 6577 696e 6461 7461      _savewindata
+00005be0: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
+00005bf0: 7265 7475 726e 2046 616c 7365 0d0a 0d0a  return False....
+00005c00: 2020 2020 6465 6620 7265 7369 7a65 4576      def resizeEv
+00005c10: 656e 7428 7365 6c66 2c20 6576 293a 0d0a  ent(self, ev):..
+00005c20: 2020 2020 2020 2020 2727 2757 6520 7265          '''We re
+00005c30: 7369 7a65 2061 6e64 2073 6574 2074 6865  size and set the
+00005c40: 2074 6f70 2059 2061 7869 7320 6c61 7267   top Y axis larg
+00005c50: 6572 2061 6363 6f72 6469 6e67 2074 6f20  er according to 
+00005c60: 7468 6520 6178 6973 5f68 6569 6768 745f  the axis_height_
+00005c70: 6661 6374 6f72 2e0d 0a20 2020 2020 2020  factor...       
+00005c80: 2020 2020 4e6f 2070 6f69 6e74 2069 6e20      No point in 
+00005c90: 7472 7969 6e67 2074 6f20 7573 6520 7468  trying to use th
+00005ca0: 6520 2272 6f77 2073 7472 6574 6368 2066  e "row stretch f
+00005cb0: 6163 746f 7222 2069 6e20 5174 2077 6869  actor" in Qt whi
+00005cc0: 6368 2069 7320 6272 6f6b 656e 0d0a 2020  ch is broken..  
+00005cd0: 2020 2020 2020 2020 2062 6579 6f6e 6420           beyond 
+00005ce0: 7265 7061 6972 2e27 2727 0d0a 2020 2020  repair.'''..    
+00005cf0: 2020 2020 6966 2065 7620 616e 6420 6e6f      if ev and no
+00005d00: 7420 7365 6c66 2e63 6c6f 7369 6e67 3a0d  t self.closing:.
+00005d10: 0a20 2020 2020 2020 2020 2020 2061 7873  .            axs
+00005d20: 203d 2073 656c 662e 6178 730d 0a20 2020   = self.axs..   
+00005d30: 2020 2020 2020 2020 206e 6577 5f77 696e           new_win
+00005d40: 5f68 6569 6768 7420 3d20 6576 2e73 697a  _height = ev.siz
+00005d50: 6528 292e 6865 6967 6874 2829 0d0a 2020  e().height()..  
+00005d60: 2020 2020 2020 2020 2020 6f6c 645f 7769            old_wi
+00005d70: 6e5f 6865 6967 6874 203d 2065 762e 6f6c  n_height = ev.ol
+00005d80: 6453 697a 6528 292e 6865 6967 6874 2829  dSize().height()
+00005d90: 2069 6620 6576 2e6f 6c64 5369 7a65 2829   if ev.oldSize()
+00005da0: 2e68 6569 6768 7428 2920 3e20 3020 656c  .height() > 0 el
+00005db0: 7365 206e 6577 5f77 696e 5f68 6569 6768  se new_win_heigh
+00005dc0: 740d 0a20 2020 2020 2020 2020 2020 2063  t..            c
+00005dd0: 6c69 656e 745f 626f 7264 6572 7320 3d20  lient_borders = 
+00005de0: 6f6c 645f 7769 6e5f 6865 6967 6874 202d  old_win_height -
+00005df0: 2073 756d 2861 782e 7662 2e73 697a 6528   sum(ax.vb.size(
+00005e00: 292e 6865 6967 6874 2829 2066 6f72 2061  ).height() for a
+00005e10: 7820 696e 2061 7873 290d 0a20 2020 2020  x in axs)..     
+00005e20: 2020 2020 2020 2063 6c69 656e 745f 626f         client_bo
+00005e30: 7264 6572 7320 3d20 6d69 6e28 6d61 7828  rders = min(max(
+00005e40: 636c 6965 6e74 5f62 6f72 6465 7273 2c20  client_borders, 
+00005e50: 3029 2c20 3330 2920 2320 6872 6d0d 0a20  0), 30) # hrm.. 
+00005e60: 2020 2020 2020 2020 2020 206e 6577 5f68             new_h
+00005e70: 6569 6768 7420 3d20 6e65 775f 7769 6e5f  eight = new_win_
+00005e80: 6865 6967 6874 202d 2063 6c69 656e 745f  height - client_
+00005e90: 626f 7264 6572 730d 0a20 2020 2020 2020  borders..       
+00005ea0: 2020 2020 2066 6f72 2069 2c61 7820 696e       for i,ax in
+00005eb0: 2065 6e75 6d65 7261 7465 2861 7873 293a   enumerate(axs):
+00005ec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005ed0: 2020 6a20 3d20 6178 6973 5f68 6569 6768    j = axis_heigh
+00005ee0: 745f 6661 6374 6f72 2e67 6574 2869 2c20  t_factor.get(i, 
+00005ef0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+00005f00: 2020 2020 6620 3d20 6a20 2f20 286c 656e      f = j / (len
+00005f10: 2861 7873 292b 7375 6d28 6178 6973 5f68  (axs)+sum(axis_h
+00005f20: 6569 6768 745f 6661 6374 6f72 2e76 616c  eight_factor.val
+00005f30: 7565 7328 2929 2d6c 656e 2861 7869 735f  ues())-len(axis_
+00005f40: 6865 6967 6874 5f66 6163 746f 7229 290d  height_factor)).
+00005f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005f60: 2061 782e 7365 744d 696e 696d 756d 5369   ax.setMinimumSi
+00005f70: 7a65 2831 3030 2069 6620 6a3e 3120 656c  ze(100 if j>1 el
+00005f80: 7365 2035 302c 206e 6577 5f68 6569 6768  se 50, new_heigh
+00005f90: 742a 6629 0d0a 2020 2020 2020 2020 7265  t*f)..        re
+00005fa0: 7475 726e 2073 7570 6572 2829 2e72 6573  turn super().res
+00005fb0: 697a 6545 7665 6e74 2865 7629 0d0a 0d0a  izeEvent(ev)....
+00005fc0: 2020 2020 6465 6620 6c65 6176 6545 7665      def leaveEve
+00005fd0: 6e74 2873 656c 662c 2065 7629 3a0d 0a20  nt(self, ev):.. 
+00005fe0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+00005ff0: 6c66 2e63 6c6f 7369 6e67 3a0d 0a20 2020  lf.closing:..   
+00006000: 2020 2020 2020 2020 2073 7570 6572 2829           super()
+00006010: 2e6c 6561 7665 4576 656e 7428 6576 290d  .leaveEvent(ev).
+00006020: 0a0d 0a0d 0a63 6c61 7373 2046 696e 4372  .....class FinCr
+00006030: 6f73 7348 6169 723a 0d0a 2020 2020 6465  ossHair:..    de
+00006040: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00006050: 2061 782c 2063 6f6c 6f72 293a 0d0a 2020   ax, color):..  
+00006060: 2020 2020 2020 7365 6c66 2e61 7820 3d20        self.ax = 
+00006070: 6178 0d0a 2020 2020 2020 2020 7365 6c66  ax..        self
+00006080: 2e78 203d 2030 0d0a 2020 2020 2020 2020  .x = 0..        
+00006090: 7365 6c66 2e79 203d 2030 0d0a 2020 2020  self.y = 0..    
+000060a0: 2020 2020 7365 6c66 2e63 6c61 6d70 5f78      self.clamp_x
+000060b0: 203d 2030 0d0a 2020 2020 2020 2020 7365   = 0..        se
+000060c0: 6c66 2e63 6c61 6d70 5f79 203d 2030 0d0a  lf.clamp_y = 0..
+000060d0: 2020 2020 2020 2020 7365 6c66 2e69 6e66          self.inf
+000060e0: 6f73 203d 205b 5d0d 0a20 2020 2020 2020  os = []..       
+000060f0: 2070 656e 203d 2070 672e 6d6b 5065 6e28   pen = pg.mkPen(
+00006100: 636f 6c6f 723d 636f 6c6f 722c 2073 7479  color=color, sty
+00006110: 6c65 3d51 7443 6f72 652e 5174 2e50 656e  le=QtCore.Qt.Pen
+00006120: 5374 796c 652e 4375 7374 6f6d 4461 7368  Style.CustomDash
+00006130: 4c69 6e65 2c20 6461 7368 3d5b 372c 2037  Line, dash=[7, 7
+00006140: 5d29 0d0a 2020 2020 2020 2020 7365 6c66  ])..        self
+00006150: 2e76 6c69 6e65 203d 2070 672e 496e 6669  .vline = pg.Infi
+00006160: 6e69 7465 4c69 6e65 2861 6e67 6c65 3d39  niteLine(angle=9
+00006170: 302c 206d 6f76 6162 6c65 3d46 616c 7365  0, movable=False
+00006180: 2c20 7065 6e3d 7065 6e29 0d0a 2020 2020  , pen=pen)..    
+00006190: 2020 2020 7365 6c66 2e68 6c69 6e65 203d      self.hline =
+000061a0: 2070 672e 496e 6669 6e69 7465 4c69 6e65   pg.InfiniteLine
+000061b0: 2861 6e67 6c65 3d30 2c20 6d6f 7661 626c  (angle=0, movabl
+000061c0: 653d 4661 6c73 652c 2070 656e 3d70 656e  e=False, pen=pen
+000061d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000061e0: 7874 6578 7420 3d20 7067 2e54 6578 7449  xtext = pg.TextI
+000061f0: 7465 6d28 636f 6c6f 723d 636f 6c6f 722c  tem(color=color,
+00006200: 2061 6e63 686f 723d 2830 2c31 2929 0d0a   anchor=(0,1))..
+00006210: 2020 2020 2020 2020 7365 6c66 2e79 7465          self.yte
+00006220: 7874 203d 2070 672e 5465 7874 4974 656d  xt = pg.TextItem
+00006230: 2863 6f6c 6f72 3d63 6f6c 6f72 2c20 616e  (color=color, an
+00006240: 6368 6f72 3d28 302c 3029 290d 0a20 2020  chor=(0,0))..   
+00006250: 2020 2020 2073 656c 662e 766c 696e 652e       self.vline.
+00006260: 7365 745a 5661 6c75 6528 3530 290d 0a20  setZValue(50).. 
+00006270: 2020 2020 2020 2073 656c 662e 686c 696e         self.hlin
+00006280: 652e 7365 745a 5661 6c75 6528 3530 290d  e.setZValue(50).
+00006290: 0a20 2020 2020 2020 2073 656c 662e 7874  .        self.xt
+000062a0: 6578 742e 7365 745a 5661 6c75 6528 3530  ext.setZValue(50
+000062b0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000062c0: 7974 6578 742e 7365 745a 5661 6c75 6528  ytext.setZValue(
+000062d0: 3530 290d 0a20 2020 2020 2020 2073 656c  50)..        sel
+000062e0: 662e 7368 6f77 2829 0d0a 0d0a 2020 2020  f.show()....    
+000062f0: 6465 6620 7570 6461 7465 2873 656c 662c  def update(self,
+00006300: 2070 6f69 6e74 3d4e 6f6e 6529 3a0d 0a20   point=None):.. 
+00006310: 2020 2020 2020 2069 6620 706f 696e 7420         if point 
+00006320: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00006330: 2020 2020 2020 2020 2020 7365 6c66 2e78            self.x
+00006340: 2c73 656c 662e 7920 3d20 782c 7920 3d20  ,self.y = x,y = 
+00006350: 706f 696e 742e 7828 292c 706f 696e 742e  point.x(),point.
+00006360: 7928 290d 0a20 2020 2020 2020 2065 6c73  y()..        els
+00006370: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00006380: 782c 7920 3d20 7365 6c66 2e78 2c73 656c  x,y = self.x,sel
+00006390: 662e 790d 0a20 2020 2020 2020 2078 2c79  f.y..        x,y
+000063a0: 203d 205f 636c 616d 705f 7879 2873 656c   = _clamp_xy(sel
+000063b0: 662e 6178 2c20 782c 7929 0d0a 2020 2020  f.ax, x,y)..    
+000063c0: 2020 2020 6966 2078 203d 3d20 7365 6c66      if x == self
+000063d0: 2e63 6c61 6d70 5f78 2061 6e64 2079 203d  .clamp_x and y =
+000063e0: 3d20 7365 6c66 2e63 6c61 6d70 5f79 3a0d  = self.clamp_y:.
+000063f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00006400: 7572 6e0d 0a20 2020 2020 2020 2073 656c  urn..        sel
+00006410: 662e 636c 616d 705f 782c 7365 6c66 2e63  f.clamp_x,self.c
+00006420: 6c61 6d70 5f79 203d 2078 2c79 0d0a 2020  lamp_y = x,y..  
+00006430: 2020 2020 2020 7365 6c66 2e76 6c69 6e65        self.vline
+00006440: 2e73 6574 506f 7328 7829 0d0a 2020 2020  .setPos(x)..    
+00006450: 2020 2020 7365 6c66 2e68 6c69 6e65 2e73      self.hline.s
+00006460: 6574 506f 7328 7929 0d0a 2020 2020 2020  etPos(y)..      
+00006470: 2020 7365 6c66 2e78 7465 7874 2e73 6574    self.xtext.set
+00006480: 506f 7328 782c 2079 290d 0a20 2020 2020  Pos(x, y)..     
+00006490: 2020 2073 656c 662e 7974 6578 742e 7365     self.ytext.se
+000064a0: 7450 6f73 2878 2c20 7929 0d0a 2020 2020  tPos(x, y)..    
+000064b0: 2020 2020 726e 6720 3d20 7365 6c66 2e61      rng = self.a
+000064c0: 782e 7662 2e79 5f6d 6178 202d 2073 656c  x.vb.y_max - sel
+000064d0: 662e 6178 2e76 622e 795f 6d69 6e0d 0a20  f.ax.vb.y_min.. 
+000064e0: 2020 2020 2020 2072 6e67 6d61 7820 3d20         rngmax = 
+000064f0: 6162 7328 7365 6c66 2e61 782e 7662 2e79  abs(self.ax.vb.y
+00006500: 5f6d 696e 2920 2b20 726e 6720 2320 616e  _min) + rng # an
+00006510: 7920 6170 7072 6f78 696d 6174 696f 6e20  y approximation 
+00006520: 6973 2066 696e 650d 0a20 2020 2020 2020  is fine..       
+00006530: 2073 642c 7365 203d 2028 7365 6c66 2e61   sd,se = (self.a
+00006540: 782e 7369 676e 6966 6963 616e 745f 6465  x.significant_de
+00006550: 6369 6d61 6c73 2c73 656c 662e 6178 2e73  cimals,self.ax.s
+00006560: 6967 6e69 6669 6361 6e74 5f65 7073 2920  ignificant_eps) 
+00006570: 6966 2063 6c61 6d70 5f67 7269 6420 656c  if clamp_grid el
+00006580: 7365 2028 7369 676e 6966 6963 616e 745f  se (significant_
+00006590: 6465 6369 6d61 6c73 2c73 6967 6e69 6669  decimals,signifi
+000065a0: 6361 6e74 5f65 7073 290d 0a20 2020 2020  cant_eps)..     
+000065b0: 2020 2074 696d 6562 6173 6564 203d 2046     timebased = F
+000065c0: 616c 7365 0d0a 2020 2020 2020 2020 6966  alse..        if
+000065d0: 2073 656c 662e 6178 2e76 622e 785f 696e   self.ax.vb.x_in
+000065e0: 6465 7865 643a 0d0a 2020 2020 2020 2020  dexed:..        
+000065f0: 2020 2020 7874 6578 742c 7469 6d65 6261      xtext,timeba
+00006600: 7365 6420 3d20 5f78 326c 6f63 616c 5f74  sed = _x2local_t
+00006610: 2873 656c 662e 6178 2e76 622e 6461 7461  (self.ax.vb.data
+00006620: 7372 632c 2078 290d 0a20 2020 2020 2020  src, x)..       
+00006630: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00006640: 2020 2020 7874 6578 7420 3d20 5f72 6f75      xtext = _rou
+00006650: 6e64 5f74 6f5f 7369 676e 6966 6963 616e  nd_to_significan
+00006660: 7428 726e 672c 2072 6e67 6d61 782c 2078  t(rng, rngmax, x
+00006670: 2c20 7364 2c20 7365 290d 0a20 2020 2020  , sd, se)..     
+00006680: 2020 206c 696e 6561 725f 7920 3d20 790d     linear_y = y.
+00006690: 0a20 2020 2020 2020 2079 203d 2073 656c  .        y = sel
+000066a0: 662e 6178 2e76 622e 7973 6361 6c65 2e78  f.ax.vb.yscale.x
+000066b0: 666f 726d 2879 290d 0a20 2020 2020 2020  form(y)..       
+000066c0: 2079 7465 7874 203d 205f 726f 756e 645f   ytext = _round_
+000066d0: 746f 5f73 6967 6e69 6669 6361 6e74 2872  to_significant(r
+000066e0: 6e67 2c20 726e 676d 6178 2c20 792c 2073  ng, rngmax, y, s
+000066f0: 642c 2073 6529 0d0a 2020 2020 2020 2020  d, se)..        
+00006700: 6966 206e 6f74 2074 696d 6562 6173 6564  if not timebased
+00006710: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00006720: 6620 7874 6578 743a 0d0a 2020 2020 2020  f xtext:..      
+00006730: 2020 2020 2020 2020 2020 7874 6578 7420            xtext 
+00006740: 3d20 2778 2027 202b 2078 7465 7874 0d0a  = 'x ' + xtext..
+00006750: 2020 2020 2020 2020 2020 2020 7974 6578              ytex
+00006760: 7420 3d20 2779 2027 202b 2079 7465 7874  t = 'y ' + ytext
+00006770: 0d0a 2020 2020 2020 2020 6661 725f 7269  ..        far_ri
+00006780: 6768 7420 3d20 7365 6c66 2e61 782e 7669  ght = self.ax.vi
+00006790: 6577 5265 6374 2829 2e78 2829 202b 2073  ewRect().x() + s
+000067a0: 656c 662e 6178 2e76 6965 7752 6563 7428  elf.ax.viewRect(
+000067b0: 292e 7769 6474 6828 292a 302e 390d 0a20  ).width()*0.9.. 
+000067c0: 2020 2020 2020 2066 6172 5f62 6f74 746f         far_botto
+000067d0: 6d20 3d20 7365 6c66 2e61 782e 7669 6577  m = self.ax.view
+000067e0: 5265 6374 2829 2e79 2829 202b 2073 656c  Rect().y() + sel
+000067f0: 662e 6178 2e76 6965 7752 6563 7428 292e  f.ax.viewRect().
+00006800: 6865 6967 6874 2829 2a30 2e31 0d0a 2020  height()*0.1..  
+00006810: 2020 2020 2020 636c 6f73 6532 7269 6768        close2righ
+00006820: 7420 3d20 7820 3e20 6661 725f 7269 6768  t = x > far_righ
+00006830: 740d 0a20 2020 2020 2020 2063 6c6f 7365  t..        close
+00006840: 3262 6f74 746f 6d20 3d20 6c69 6e65 6172  2bottom = linear
+00006850: 5f79 203c 2066 6172 5f62 6f74 746f 6d0d  _y < far_bottom.
+00006860: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
+00006870: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00006880: 6e66 6f20 696e 2073 656c 662e 696e 666f  nfo in self.info
+00006890: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+000068a0: 2020 2020 7874 6578 742c 7974 6578 7420      xtext,ytext 
+000068b0: 3d20 696e 666f 2878 2c79 2c78 7465 7874  = info(x,y,xtext
+000068c0: 2c79 7465 7874 290d 0a20 2020 2020 2020  ,ytext)..       
+000068d0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+000068e0: 6e20 6173 2065 3a0d 0a20 2020 2020 2020  n as e:..       
+000068f0: 2020 2020 2070 7269 6e74 2827 4372 6f73       print('Cros
+00006900: 7368 6169 7220 6572 726f 723a 272c 2074  shair error:', t
+00006910: 7970 6528 6529 2c20 6529 0d0a 2020 2020  ype(e), e)..    
+00006920: 2020 2020 7370 6163 6520 3d20 2720 2020      space = '   
+00006930: 2020 2027 0d0a 2020 2020 2020 2020 6966     '..        if
+00006940: 2063 6c6f 7365 3272 6967 6874 3a0d 0a20   close2right:.. 
+00006950: 2020 2020 2020 2020 2020 2078 7465 7874             xtext
+00006960: 203d 2078 7465 7874 202b 2073 7061 6365   = xtext + space
+00006970: 0d0a 2020 2020 2020 2020 2020 2020 7974  ..            yt
+00006980: 6578 7420 3d20 7974 6578 7420 2b20 7370  ext = ytext + sp
+00006990: 6163 650d 0a20 2020 2020 2020 2020 2020  ace..           
+000069a0: 2078 616e 6368 6f72 203d 205b 312c 315d   xanchor = [1,1]
+000069b0: 0d0a 2020 2020 2020 2020 2020 2020 7961  ..            ya
+000069c0: 6e63 686f 7220 3d20 5b31 2c30 5d0d 0a20  nchor = [1,0].. 
+000069d0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000069e0: 2020 2020 2020 2020 2020 7874 6578 7420            xtext 
+000069f0: 3d20 7370 6163 6520 2b20 7874 6578 740d  = space + xtext.
+00006a00: 0a20 2020 2020 2020 2020 2020 2079 7465  .            yte
+00006a10: 7874 203d 2073 7061 6365 202b 2079 7465  xt = space + yte
+00006a20: 7874 0d0a 2020 2020 2020 2020 2020 2020  xt..            
+00006a30: 7861 6e63 686f 7220 3d20 5b30 2c31 5d0d  xanchor = [0,1].
+00006a40: 0a20 2020 2020 2020 2020 2020 2079 616e  .            yan
+00006a50: 6368 6f72 203d 205b 302c 305d 0d0a 2020  chor = [0,0]..  
+00006a60: 2020 2020 2020 6966 2063 6c6f 7365 3262        if close2b
+00006a70: 6f74 746f 6d3a 0d0a 2020 2020 2020 2020  ottom:..        
+00006a80: 2020 2020 7974 6578 7420 3d20 7974 6578      ytext = ytex
+00006a90: 7420 2b20 7370 6163 650d 0a20 2020 2020  t + space..     
+00006aa0: 2020 2020 2020 2079 616e 6368 6f72 203d         yanchor =
+00006ab0: 205b 312c 315d 0d0a 2020 2020 2020 2020   [1,1]..        
+00006ac0: 2020 2020 6966 2063 6c6f 7365 3272 6967      if close2rig
+00006ad0: 6874 3a0d 0a20 2020 2020 2020 2020 2020  ht:..           
+00006ae0: 2020 2020 2078 616e 6368 6f72 203d 205b       xanchor = [
+00006af0: 312c 325d 0d0a 2020 2020 2020 2020 7365  1,2]..        se
+00006b00: 6c66 2e78 7465 7874 2e73 6574 416e 6368  lf.xtext.setAnch
+00006b10: 6f72 2878 616e 6368 6f72 290d 0a20 2020  or(xanchor)..   
+00006b20: 2020 2020 2073 656c 662e 7974 6578 742e       self.ytext.
+00006b30: 7365 7441 6e63 686f 7228 7961 6e63 686f  setAnchor(yancho
+00006b40: 7229 0d0a 2020 2020 2020 2020 7365 6c66  r)..        self
+00006b50: 2e78 7465 7874 2e73 6574 5465 7874 2878  .xtext.setText(x
+00006b60: 7465 7874 290d 0a20 2020 2020 2020 2073  text)..        s
+00006b70: 656c 662e 7974 6578 742e 7365 7454 6578  elf.ytext.setTex
+00006b80: 7428 7974 6578 7429 0d0a 0d0a 2020 2020  t(ytext)....    
+00006b90: 6465 6620 7368 6f77 2873 656c 6629 3a0d  def show(self):.
+00006ba0: 0a20 2020 2020 2020 2073 656c 662e 6178  .        self.ax
+00006bb0: 2e61 6464 4974 656d 2873 656c 662e 766c  .addItem(self.vl
+00006bc0: 696e 652c 2069 676e 6f72 6542 6f75 6e64  ine, ignoreBound
+00006bd0: 733d 5472 7565 290d 0a20 2020 2020 2020  s=True)..       
+00006be0: 2073 656c 662e 6178 2e61 6464 4974 656d   self.ax.addItem
+00006bf0: 2873 656c 662e 686c 696e 652c 2069 676e  (self.hline, ign
+00006c00: 6f72 6542 6f75 6e64 733d 5472 7565 290d  oreBounds=True).
+00006c10: 0a20 2020 2020 2020 2073 656c 662e 6178  .        self.ax
+00006c20: 2e61 6464 4974 656d 2873 656c 662e 7874  .addItem(self.xt
+00006c30: 6578 742c 2069 676e 6f72 6542 6f75 6e64  ext, ignoreBound
+00006c40: 733d 5472 7565 290d 0a20 2020 2020 2020  s=True)..       
+00006c50: 2073 656c 662e 6178 2e61 6464 4974 656d   self.ax.addItem
+00006c60: 2873 656c 662e 7974 6578 742c 2069 676e  (self.ytext, ign
+00006c70: 6f72 6542 6f75 6e64 733d 5472 7565 290d  oreBounds=True).
+00006c80: 0a0d 0a20 2020 2064 6566 2068 6964 6528  ...    def hide(
+00006c90: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00006ca0: 7365 6c66 2e61 782e 7265 6d6f 7665 4974  self.ax.removeIt
+00006cb0: 656d 2873 656c 662e 7874 6578 7429 0d0a  em(self.xtext)..
+00006cc0: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
+00006cd0: 7265 6d6f 7665 4974 656d 2873 656c 662e  removeItem(self.
+00006ce0: 7974 6578 7429 0d0a 2020 2020 2020 2020  ytext)..        
+00006cf0: 7365 6c66 2e61 782e 7265 6d6f 7665 4974  self.ax.removeIt
+00006d00: 656d 2873 656c 662e 766c 696e 6529 0d0a  em(self.vline)..
+00006d10: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
+00006d20: 7265 6d6f 7665 4974 656d 2873 656c 662e  removeItem(self.
+00006d30: 686c 696e 6529 0d0a 0d0a 0d0a 0d0a 636c  hline)........cl
+00006d40: 6173 7320 4669 6e4c 6567 656e 6449 7465  ass FinLegendIte
+00006d50: 6d28 7067 2e4c 6567 656e 6449 7465 6d29  m(pg.LegendItem)
+00006d60: 3a0d 0a20 2020 2064 6566 205f 5f69 6e69  :..    def __ini
+00006d70: 745f 5f28 7365 6c66 2c20 626f 7264 6572  t__(self, border
+00006d80: 5f63 6f6c 6f72 2c20 6669 6c6c 5f63 6f6c  _color, fill_col
+00006d90: 6f72 2c20 2a2a 6b77 6172 6773 293a 0d0a  or, **kwargs):..
+00006da0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+00006db0: 5f5f 696e 6974 5f5f 282a 2a6b 7761 7267  __init__(**kwarg
+00006dc0: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
+00006dd0: 2e6c 6179 6f75 742e 7365 7456 6572 7469  .layout.setVerti
+00006de0: 6361 6c53 7061 6369 6e67 2832 290d 0a20  calSpacing(2).. 
+00006df0: 2020 2020 2020 2073 656c 662e 6c61 796f         self.layo
+00006e00: 7574 2e73 6574 486f 7269 7a6f 6e74 616c  ut.setHorizontal
+00006e10: 5370 6163 696e 6728 3230 290d 0a20 2020  Spacing(20)..   
+00006e20: 2020 2020 2073 656c 662e 6c61 796f 7574       self.layout
+00006e30: 2e73 6574 436f 6e74 656e 7473 4d61 7267  .setContentsMarg
+00006e40: 696e 7328 322c 2032 2c20 3130 2c20 3229  ins(2, 2, 10, 2)
+00006e50: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+00006e60: 6f72 6465 725f 636f 6c6f 7220 3d20 626f  order_color = bo
+00006e70: 7264 6572 5f63 6f6c 6f72 0d0a 2020 2020  rder_color..    
+00006e80: 2020 2020 7365 6c66 2e66 696c 6c5f 636f      self.fill_co
+00006e90: 6c6f 7220 3d20 6669 6c6c 5f63 6f6c 6f72  lor = fill_color
+00006ea0: 0d0a 0d0a 2020 2020 6465 6620 7061 696e  ....    def pain
+00006eb0: 7428 7365 6c66 2c20 702c 202a 6172 6773  t(self, p, *args
+00006ec0: 293a 0d0a 2020 2020 2020 2020 702e 7365  ):..        p.se
+00006ed0: 7450 656e 2870 672e 6d6b 5065 6e28 7365  tPen(pg.mkPen(se
+00006ee0: 6c66 2e62 6f72 6465 725f 636f 6c6f 7229  lf.border_color)
+00006ef0: 290d 0a20 2020 2020 2020 2070 2e73 6574  )..        p.set
+00006f00: 4272 7573 6828 7067 2e6d 6b42 7275 7368  Brush(pg.mkBrush
+00006f10: 2873 656c 662e 6669 6c6c 5f63 6f6c 6f72  (self.fill_color
+00006f20: 2929 0d0a 2020 2020 2020 2020 702e 6472  ))..        p.dr
+00006f30: 6177 5265 6374 2873 656c 662e 626f 756e  awRect(self.boun
+00006f40: 6469 6e67 5265 6374 2829 290d 0a0d 0a0d  dingRect()).....
+00006f50: 0a0d 0a63 6c61 7373 2046 696e 506f 6c79  ...class FinPoly
+00006f60: 4c69 6e65 2870 672e 506f 6c79 4c69 6e65  Line(pg.PolyLine
+00006f70: 524f 4929 3a0d 0a20 2020 2064 6566 205f  ROI):..    def _
+00006f80: 5f69 6e69 745f 5f28 7365 6c66 2c20 7662  _init__(self, vb
+00006f90: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+00006fa0: 7329 3a0d 0a20 2020 2020 2020 2073 656c  s):..        sel
+00006fb0: 662e 7662 203d 2076 6220 2320 696e 6974  f.vb = vb # init
+00006fc0: 2062 6566 6f72 6520 7061 7265 6e74 2063   before parent c
+00006fd0: 6f6e 7374 7275 6374 6f72 0d0a 2020 2020  onstructor..    
+00006fe0: 2020 2020 7365 6c66 2e74 6578 7473 203d      self.texts =
+00006ff0: 205b 5d0d 0a20 2020 2020 2020 2073 7570   []..        sup
+00007000: 6572 2829 2e5f 5f69 6e69 745f 5f28 2a61  er().__init__(*a
+00007010: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
+00007020: 0d0a 2020 2020 6465 6620 6164 6453 6567  ..    def addSeg
+00007030: 6d65 6e74 2873 656c 662c 2068 312c 2068  ment(self, h1, h
+00007040: 322c 2069 6e64 6578 3d4e 6f6e 6529 3a0d  2, index=None):.
+00007050: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+00007060: 2e61 6464 5365 676d 656e 7428 6831 2c20  .addSegment(h1, 
+00007070: 6832 2c20 696e 6465 7829 0d0a 2020 2020  h2, index)..    
+00007080: 2020 2020 7465 7874 203d 2070 672e 5465      text = pg.Te
+00007090: 7874 4974 656d 2863 6f6c 6f72 3d64 7261  xtItem(color=dra
+000070a0: 775f 6c69 6e65 5f63 6f6c 6f72 290d 0a20  w_line_color).. 
+000070b0: 2020 2020 2020 2074 6578 742e 7365 745a         text.setZ
+000070c0: 5661 6c75 6528 3530 290d 0a20 2020 2020  Value(50)..     
+000070d0: 2020 2074 6578 742e 7365 676d 656e 7420     text.segment 
+000070e0: 3d20 7365 6c66 2e73 6567 6d65 6e74 735b  = self.segments[
+000070f0: 2d31 2069 6620 696e 6465 7820 6973 204e  -1 if index is N
+00007100: 6f6e 6520 656c 7365 2069 6e64 6578 5d0d  one else index].
+00007110: 0a20 2020 2020 2020 2069 6620 696e 6465  .        if inde
+00007120: 7820 6973 204e 6f6e 653a 0d0a 2020 2020  x is None:..    
+00007130: 2020 2020 2020 2020 7365 6c66 2e74 6578          self.tex
+00007140: 7473 2e61 7070 656e 6428 7465 7874 290d  ts.append(text).
+00007150: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00007160: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007170: 2e74 6578 7473 2e69 6e73 6572 7428 696e  .texts.insert(in
+00007180: 6465 782c 2074 6578 7429 0d0a 2020 2020  dex, text)..    
+00007190: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+000071a0: 7465 7874 2874 6578 7429 0d0a 2020 2020  text(text)..    
+000071b0: 2020 2020 7365 6c66 2e76 622e 6164 6449      self.vb.addI
+000071c0: 7465 6d28 7465 7874 2c20 6967 6e6f 7265  tem(text, ignore
+000071d0: 426f 756e 6473 3d54 7275 6529 0d0a 0d0a  Bounds=True)....
+000071e0: 2020 2020 6465 6620 7265 6d6f 7665 5365      def removeSe
+000071f0: 676d 656e 7428 7365 6c66 2c20 7365 6729  gment(self, seg)
+00007200: 3a0d 0a20 2020 2020 2020 2073 7570 6572  :..        super
+00007210: 2829 2e72 656d 6f76 6553 6567 6d65 6e74  ().removeSegment
+00007220: 2873 6567 290d 0a20 2020 2020 2020 2066  (seg)..        f
+00007230: 6f72 2074 6578 7420 696e 206c 6973 7428  or text in list(
+00007240: 7365 6c66 2e74 6578 7473 293a 0d0a 2020  self.texts):..  
+00007250: 2020 2020 2020 2020 2020 6966 2074 6578            if tex
+00007260: 742e 7365 676d 656e 7420 3d3d 2073 6567  t.segment == seg
+00007270: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00007280: 2020 2073 656c 662e 7662 2e72 656d 6f76     self.vb.remov
+00007290: 6549 7465 6d28 7465 7874 290d 0a20 2020  eItem(text)..   
+000072a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000072b0: 662e 7465 7874 732e 7265 6d6f 7665 2874  f.texts.remove(t
+000072c0: 6578 7429 0d0a 0d0a 2020 2020 6465 6620  ext)....    def 
+000072d0: 7570 6461 7465 5f74 6578 7428 7365 6c66  update_text(self
+000072e0: 2c20 7465 7874 293a 0d0a 2020 2020 2020  , text):..      
+000072f0: 2020 6830 203d 2074 6578 742e 7365 676d    h0 = text.segm
+00007300: 656e 742e 6861 6e64 6c65 735b 305d 5b27  ent.handles[0]['
+00007310: 6974 656d 275d 0d0a 2020 2020 2020 2020  item']..        
+00007320: 6831 203d 2074 6578 742e 7365 676d 656e  h1 = text.segmen
+00007330: 742e 6861 6e64 6c65 735b 315d 5b27 6974  t.handles[1]['it
+00007340: 656d 275d 0d0a 2020 2020 2020 2020 6469  em']..        di
+00007350: 6666 203d 2068 312e 706f 7328 2920 2d20  ff = h1.pos() - 
+00007360: 6830 2e70 6f73 2829 0d0a 2020 2020 2020  h0.pos()..      
+00007370: 2020 6966 2064 6966 662e 7928 2920 3c20    if diff.y() < 
+00007380: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+00007390: 7465 7874 2e73 6574 416e 6368 6f72 2828  text.setAnchor((
+000073a0: 302e 352c 3029 290d 0a20 2020 2020 2020  0.5,0))..       
+000073b0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+000073c0: 2020 2020 7465 7874 2e73 6574 416e 6368      text.setAnch
+000073d0: 6f72 2828 302e 352c 3129 290d 0a20 2020  or((0.5,1))..   
+000073e0: 2020 2020 2074 6578 742e 7365 7450 6f73       text.setPos
+000073f0: 2868 312e 706f 7328 2929 0d0a 2020 2020  (h1.pos())..    
+00007400: 2020 2020 7465 7874 2e73 6574 5465 7874      text.setText
+00007410: 285f 6472 6177 5f6c 696e 655f 7365 676d  (_draw_line_segm
+00007420: 656e 745f 7465 7874 2873 656c 662c 2074  ent_text(self, t
+00007430: 6578 742e 7365 676d 656e 742c 2068 302e  ext.segment, h0.
+00007440: 706f 7328 292c 2068 312e 706f 7328 2929  pos(), h1.pos())
+00007450: 290d 0a0d 0a20 2020 2064 6566 2075 7064  )....    def upd
+00007460: 6174 655f 7465 7874 7328 7365 6c66 293a  ate_texts(self):
+00007470: 0d0a 2020 2020 2020 2020 666f 7220 7465  ..        for te
+00007480: 7874 2069 6e20 7365 6c66 2e74 6578 7473  xt in self.texts
+00007490: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+000074a0: 656c 662e 7570 6461 7465 5f74 6578 7428  elf.update_text(
+000074b0: 7465 7874 290d 0a0d 0a20 2020 2064 6566  text)....    def
+000074c0: 206d 6f76 6550 6f69 6e74 2873 656c 662c   movePoint(self,
+000074d0: 2068 616e 646c 652c 2070 6f73 2c20 6d6f   handle, pos, mo
+000074e0: 6469 6669 6572 733d 5174 436f 7265 2e51  difiers=QtCore.Q
+000074f0: 742e 4b65 7962 6f61 7264 4d6f 6469 6669  t.KeyboardModifi
+00007500: 6572 2c20 6669 6e69 7368 3d54 7275 652c  er, finish=True,
+00007510: 2063 6f6f 7264 733d 2770 6172 656e 7427   coords='parent'
+00007520: 293a 0d0a 2020 2020 2020 2020 7375 7065  ):..        supe
+00007530: 7228 292e 6d6f 7665 506f 696e 7428 6861  r().movePoint(ha
+00007540: 6e64 6c65 2c20 706f 732c 206d 6f64 6966  ndle, pos, modif
+00007550: 6965 7273 2c20 6669 6e69 7368 2c20 636f  iers, finish, co
+00007560: 6f72 6473 290d 0a20 2020 2020 2020 2073  ords)..        s
+00007570: 656c 662e 7570 6461 7465 5f74 6578 7473  elf.update_texts
+00007580: 2829 0d0a 0d0a 2020 2020 6465 6620 7365  ()....    def se
+00007590: 676d 656e 7443 6c69 636b 6564 2873 656c  gmentClicked(sel
+000075a0: 662c 2073 6567 6d65 6e74 2c20 6576 3d4e  f, segment, ev=N
+000075b0: 6f6e 652c 2070 6f73 3d4e 6f6e 6529 3a0d  one, pos=None):.
+000075c0: 0a20 2020 2020 2020 2070 6f73 203d 2073  .        pos = s
+000075d0: 6567 6d65 6e74 2e6d 6170 546f 5061 7265  egment.mapToPare
+000075e0: 6e74 2865 762e 706f 7328 2929 0d0a 2020  nt(ev.pos())..  
+000075f0: 2020 2020 2020 706f 7320 3d20 5f63 6c61        pos = _cla
+00007600: 6d70 5f70 6f69 6e74 2873 656c 662e 7662  mp_point(self.vb
+00007610: 2e70 6172 656e 7428 292c 2070 6f73 290d  .parent(), pos).
+00007620: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+00007630: 2e73 6567 6d65 6e74 436c 6963 6b65 6428  .segmentClicked(
+00007640: 7365 676d 656e 742c 2070 6f73 3d70 6f73  segment, pos=pos
+00007650: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00007660: 7570 6461 7465 5f74 6578 7473 2829 0d0a  update_texts()..
+00007670: 0d0a 2020 2020 6465 6620 6164 6448 616e  ..    def addHan
+00007680: 646c 6528 7365 6c66 2c20 696e 666f 2c20  dle(self, info, 
+00007690: 696e 6465 783d 4e6f 6e65 293a 0d0a 2020  index=None):..  
+000076a0: 2020 2020 2020 6861 6e64 6c65 203d 2073        handle = s
+000076b0: 7570 6572 2829 2e61 6464 4861 6e64 6c65  uper().addHandle
+000076c0: 2869 6e66 6f2c 2069 6e64 6578 290d 0a20  (info, index).. 
+000076d0: 2020 2020 2020 2068 616e 646c 652e 6d6f         handle.mo
+000076e0: 7665 506f 696e 7420 3d20 7061 7274 6961  vePoint = partia
+000076f0: 6c28 5f72 6f69 6861 6e64 6c65 5f6d 6f76  l(_roihandle_mov
+00007700: 655f 736e 6170 2c20 7365 6c66 2e76 622c  e_snap, self.vb,
+00007710: 2068 616e 646c 652e 6d6f 7665 506f 696e   handle.movePoin
+00007720: 7429 0d0a 2020 2020 2020 2020 7265 7475  t)..        retu
+00007730: 726e 2068 616e 646c 650d 0a0d 0a0d 0a63  rn handle......c
+00007740: 6c61 7373 2046 696e 4c69 6e65 2870 672e  lass FinLine(pg.
+00007750: 4772 6170 6869 6373 4f62 6a65 6374 293a  GraphicsObject):
+00007760: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00007770: 5f5f 2873 656c 662c 2070 6f69 6e74 732c  __(self, points,
+00007780: 2070 656e 293a 0d0a 2020 2020 2020 2020   pen):..        
+00007790: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
+000077a0: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+000077b0: 2e70 6f69 6e74 7320 3d20 706f 696e 7473  .points = points
+000077c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+000077d0: 656e 203d 2070 656e 0d0a 0d0a 2020 2020  en = pen....    
+000077e0: 6465 6620 7061 696e 7428 7365 6c66 2c20  def paint(self, 
+000077f0: 702c 202a 6172 6773 293a 0d0a 2020 2020  p, *args):..    
+00007800: 2020 2020 702e 7365 7450 656e 2873 656c      p.setPen(sel
+00007810: 662e 7065 6e29 0d0a 2020 2020 2020 2020  f.pen)..        
+00007820: 702e 6472 6177 5061 7468 2873 656c 662e  p.drawPath(self.
+00007830: 7368 6170 6528 2929 0d0a 0d0a 2020 2020  shape())....    
+00007840: 6465 6620 7368 6170 6528 7365 6c66 293a  def shape(self):
+00007850: 0d0a 2020 2020 2020 2020 7020 3d20 5174  ..        p = Qt
+00007860: 4775 692e 5150 6169 6e74 6572 5061 7468  Gui.QPainterPath
+00007870: 2829 0d0a 2020 2020 2020 2020 702e 6d6f  ()..        p.mo
+00007880: 7665 546f 282a 7365 6c66 2e70 6f69 6e74  veTo(*self.point
+00007890: 735b 305d 290d 0a20 2020 2020 2020 2070  s[0])..        p
+000078a0: 2e6c 696e 6554 6f28 2a73 656c 662e 706f  .lineTo(*self.po
+000078b0: 696e 7473 5b31 5d29 0d0a 2020 2020 2020  ints[1])..      
+000078c0: 2020 7265 7475 726e 2070 0d0a 0d0a 2020    return p....  
+000078d0: 2020 6465 6620 626f 756e 6469 6e67 5265    def boundingRe
+000078e0: 6374 2873 656c 6629 3a0d 0a20 2020 2020  ct(self):..     
+000078f0: 2020 2072 6574 7572 6e20 7365 6c66 2e73     return self.s
+00007900: 6861 7065 2829 2e62 6f75 6e64 696e 6752  hape().boundingR
+00007910: 6563 7428 290d 0a0d 0a0d 0a63 6c61 7373  ect()......class
+00007920: 2046 696e 456c 6c69 7073 6528 7067 2e45   FinEllipse(pg.E
+00007930: 6c6c 6970 7365 524f 4929 3a0d 0a20 2020  llipseROI):..   
+00007940: 2064 6566 2061 6464 526f 7461 7465 4861   def addRotateHa
+00007950: 6e64 6c65 2873 656c 662c 202a 6172 6773  ndle(self, *args
+00007960: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00007970: 2020 2020 2020 7061 7373 0d0a 0d0a 0d0a        pass......
+00007980: 636c 6173 7320 4669 6e52 6563 7428 7067  class FinRect(pg
+00007990: 2e52 6563 7452 4f49 293a 0d0a 2020 2020  .RectROI):..    
+000079a0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+000079b0: 662c 2061 782c 2062 7275 7368 2c20 2a61  f, ax, brush, *a
+000079c0: 7267 732c 202a 2a6b 7761 7267 7329 3a0d  rgs, **kwargs):.
+000079d0: 0a20 2020 2020 2020 2073 656c 662e 6178  .        self.ax
+000079e0: 203d 2061 780d 0a20 2020 2020 2020 2073   = ax..        s
+000079f0: 656c 662e 6272 7573 6820 3d20 6272 7573  elf.brush = brus
+00007a00: 680d 0a20 2020 2020 2020 2073 7570 6572  h..        super
+00007a10: 2829 2e5f 5f69 6e69 745f 5f28 2a61 7267  ().__init__(*arg
+00007a20: 732c 202a 2a6b 7761 7267 7329 0d0a 0d0a  s, **kwargs)....
+00007a30: 2020 2020 6465 6620 7061 696e 7428 7365      def paint(se
+00007a40: 6c66 2c20 702c 202a 6172 6773 293a 0d0a  lf, p, *args):..
+00007a50: 2020 2020 2020 2020 7220 3d20 5174 436f          r = QtCo
+00007a60: 7265 2e51 5265 6374 4628 302c 2030 2c20  re.QRectF(0, 0, 
+00007a70: 7365 6c66 2e73 7461 7465 5b27 7369 7a65  self.state['size
+00007a80: 275d 5b30 5d2c 2073 656c 662e 7374 6174  '][0], self.stat
+00007a90: 655b 2773 697a 6527 5d5b 315d 292e 6e6f  e['size'][1]).no
+00007aa0: 726d 616c 697a 6564 2829 0d0a 2020 2020  rmalized()..    
+00007ab0: 2020 2020 702e 7365 7450 656e 2873 656c      p.setPen(sel
+00007ac0: 662e 6375 7272 656e 7450 656e 290d 0a20  f.currentPen).. 
+00007ad0: 2020 2020 2020 2070 2e73 6574 4272 7573         p.setBrus
+00007ae0: 6828 7365 6c66 2e62 7275 7368 290d 0a20  h(self.brush).. 
+00007af0: 2020 2020 2020 2070 2e74 7261 6e73 6c61         p.transla
+00007b00: 7465 2872 2e6c 6566 7428 292c 2072 2e74  te(r.left(), r.t
+00007b10: 6f70 2829 290d 0a20 2020 2020 2020 2070  op())..        p
+00007b20: 2e73 6361 6c65 2872 2e77 6964 7468 2829  .scale(r.width()
+00007b30: 2c20 722e 6865 6967 6874 2829 290d 0a20  , r.height()).. 
+00007b40: 2020 2020 2020 2070 2e64 7261 7752 6563         p.drawRec
+00007b50: 7428 302c 2030 2c20 312c 2031 290d 0a0d  t(0, 0, 1, 1)...
+00007b60: 0a20 2020 2064 6566 2061 6464 5363 616c  .    def addScal
+00007b70: 6548 616e 646c 6528 7365 6c66 2c20 2a61  eHandle(self, *a
+00007b80: 7267 732c 202a 2a6b 7761 7267 7329 3a0d  rgs, **kwargs):.
+00007b90: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00007ba0: 2e72 6573 697a 6162 6c65 3a0d 0a20 2020  .resizable:..   
+00007bb0: 2020 2020 2020 2020 2073 7570 6572 2829           super()
+00007bc0: 2e61 6464 5363 616c 6548 616e 646c 6528  .addScaleHandle(
+00007bd0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+00007be0: 0d0a 0d0a 0d0a 636c 6173 7320 4669 6e56  ......class FinV
+00007bf0: 6965 7742 6f78 2870 672e 5669 6577 426f  iewBox(pg.ViewBo
+00007c00: 7829 3a0d 0a20 2020 2064 6566 205f 5f69  x):..    def __i
+00007c10: 6e69 745f 5f28 7365 6c66 2c20 7769 6e2c  nit__(self, win,
+00007c20: 2069 6e69 745f 7374 6570 733d 3330 302c   init_steps=300,
+00007c30: 2079 7363 616c 653d 5953 6361 6c65 2827   yscale=YScale('
+00007c40: 6c69 6e65 6172 272c 2031 292c 2076 5f7a  linear', 1), v_z
+00007c50: 6f6f 6d5f 7363 616c 653d 312c 202a 6172  oom_scale=1, *ar
+00007c60: 6773 2c20 2a2a 6b77 6172 6773 293a 0d0a  gs, **kwargs):..
+00007c70: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+00007c80: 5f5f 696e 6974 5f5f 282a 6172 6773 2c20  __init__(*args, 
+00007c90: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+00007ca0: 2020 2073 656c 662e 7769 6e20 3d20 7769     self.win = wi
+00007cb0: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+00007cc0: 696e 6974 5f73 7465 7073 203d 2069 6e69  init_steps = ini
+00007cd0: 745f 7374 6570 730d 0a20 2020 2020 2020  t_steps..       
+00007ce0: 2073 656c 662e 7973 6361 6c65 203d 2079   self.yscale = y
+00007cf0: 7363 616c 650d 0a20 2020 2020 2020 2073  scale..        s
+00007d00: 656c 662e 765f 7a6f 6f6d 5f73 6361 6c65  elf.v_zoom_scale
+00007d10: 203d 2076 5f7a 6f6f 6d5f 7363 616c 650d   = v_zoom_scale.
+00007d20: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
+00007d30: 7374 6572 5f76 6965 7762 6f78 203d 204e  ster_viewbox = N
+00007d40: 6f6e 650d 0a20 2020 2020 2020 2073 656c  one..        sel
+00007d50: 662e 726f 6973 203d 205b 5d0d 0a20 2020  f.rois = []..   
+00007d60: 2020 2020 2073 656c 662e 7769 6e2e 5f69       self.win._i
+00007d70: 734d 6f75 7365 4c65 6674 4472 6167 203d  sMouseLeftDrag =
+00007d80: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00007d90: 7365 6c66 2e7a 6f6f 6d5f 6c69 7374 656e  self.zoom_listen
+00007da0: 6572 7320 3d20 7365 7428 290d 0a20 2020  ers = set()..   
+00007db0: 2020 2020 2073 656c 662e 7265 7365 7428       self.reset(
+00007dc0: 290d 0a0d 0a20 2020 2064 6566 2072 6573  )....    def res
+00007dd0: 6574 2873 656c 6629 3a0d 0a20 2020 2020  et(self):..     
+00007de0: 2020 2073 656c 662e 765f 7a6f 6f6d 5f62     self.v_zoom_b
+00007df0: 6173 656c 696e 6520 3d20 302e 350d 0a20  aseline = 0.5.. 
+00007e00: 2020 2020 2020 2073 656c 662e 765f 6175         self.v_au
+00007e10: 746f 7a6f 6f6d 203d 2054 7275 650d 0a20  tozoom = True.. 
+00007e20: 2020 2020 2020 2073 656c 662e 6d61 785f         self.max_
+00007e30: 7a6f 6f6d 5f70 6f69 6e74 735f 6620 3d20  zoom_points_f = 
+00007e40: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
+00007e50: 795f 6d61 7820 3d20 3130 3030 0d0a 2020  y_max = 1000..  
+00007e60: 2020 2020 2020 7365 6c66 2e79 5f6d 696e        self.y_min
+00007e70: 203d 2030 0d0a 2020 2020 2020 2020 7365   = 0..        se
+00007e80: 6c66 2e79 5f70 6f73 6974 6976 6520 3d20  lf.y_positive = 
+00007e90: 5472 7565 0d0a 2020 2020 2020 2020 7365  True..        se
+00007ea0: 6c66 2e78 5f69 6e64 6578 6564 203d 2054  lf.x_indexed = T
+00007eb0: 7275 650d 0a20 2020 2020 2020 2073 656c  rue..        sel
+00007ec0: 662e 666f 7263 655f 7261 6e67 655f 7570  f.force_range_up
+00007ed0: 6461 7465 203d 2030 0d0a 2020 2020 2020  date = 0..      
+00007ee0: 2020 7768 696c 6520 7365 6c66 2e72 6f69    while self.roi
+00007ef0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00007f00: 7365 6c66 2e72 656d 6f76 655f 6c61 7374  self.remove_last
+00007f10: 5f72 6f69 2829 0d0a 2020 2020 2020 2020  _roi()..        
+00007f20: 7365 6c66 2e64 7261 775f 6c69 6e65 203d  self.draw_line =
+00007f30: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
+00007f40: 656c 662e 6472 6177 696e 6720 3d20 4661  elf.drawing = Fa
+00007f50: 6c73 650d 0a20 2020 2020 2020 2073 656c  lse..        sel
+00007f60: 662e 7374 616e 6461 6c6f 6e65 7320 3d20  f.standalones = 
+00007f70: 7365 7428 290d 0a20 2020 2020 2020 2073  set()..        s
+00007f80: 656c 662e 7570 6461 7469 6e67 5f6c 696e  elf.updating_lin
+00007f90: 6b65 6420 3d20 4661 6c73 650d 0a20 2020  ked = False..   
+00007fa0: 2020 2020 2073 656c 662e 7365 745f 6461       self.set_da
+00007fb0: 7461 7372 6328 4e6f 6e65 290d 0a20 2020  tasrc(None)..   
+00007fc0: 2020 2020 2073 656c 662e 7365 744d 6f75       self.setMou
+00007fd0: 7365 456e 6162 6c65 6428 783d 5472 7565  seEnabled(x=True
+00007fe0: 2c20 793d 4661 6c73 6529 0d0a 2020 2020  , y=False)..    
+00007ff0: 2020 2020 7365 6c66 2e73 6574 5261 6e67      self.setRang
+00008000: 6528 5174 436f 7265 2e51 5265 6374 4628  e(QtCore.QRectF(
+00008010: 7067 2e50 6f69 6e74 2830 2c20 3029 2c20  pg.Point(0, 0), 
+00008020: 7067 2e50 6f69 6e74 2831 2c20 3129 2929  pg.Point(1, 1)))
+00008030: 0d0a 0d0a 2020 2020 6465 6620 7365 745f  ....    def set_
+00008040: 6461 7461 7372 6328 7365 6c66 2c20 6461  datasrc(self, da
+00008050: 7461 7372 6329 3a0d 0a20 2020 2020 2020  tasrc):..       
+00008060: 2073 656c 662e 6461 7461 7372 6320 3d20   self.datasrc = 
+00008070: 6461 7461 7372 630d 0a20 2020 2020 2020  datasrc..       
+00008080: 2069 6620 6e6f 7420 7365 6c66 2e64 6174   if not self.dat
+00008090: 6173 7263 3a0d 0a20 2020 2020 2020 2020  asrc:..         
+000080a0: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+000080b0: 2020 2064 6174 6173 7263 2e75 7064 6174     datasrc.updat
+000080c0: 655f 696e 6974 5f78 2873 656c 662e 696e  e_init_x(self.in
+000080d0: 6974 5f73 7465 7073 290d 0a0d 0a20 2020  it_steps)....   
+000080e0: 2064 6566 2070 7265 5f70 726f 6365 7373   def pre_process
+000080f0: 5f64 6174 6128 7365 6c66 293a 0d0a 2020  _data(self):..  
+00008100: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
+00008110: 7461 7372 6320 616e 6420 7365 6c66 2e64  tasrc and self.d
+00008120: 6174 6173 7263 2e73 6361 6c65 5f63 6f6c  atasrc.scale_col
 00008130: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00008140: 6473 203d 206e 6578 7428 6974 6572 2873  ds = next(iter(s
-00008150: 656c 662e 7374 616e 6461 6c6f 6e65 7329  elf.standalones)
-00008160: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00008170: 6e20 6473 0d0a 0d0a 2020 2020 6465 6620  n ds....    def 
-00008180: 7768 6565 6c45 7665 6e74 2873 656c 662c  wheelEvent(self,
-00008190: 2065 762c 2061 7869 733d 4e6f 6e65 293a   ev, axis=None):
-000081a0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-000081b0: 662e 6d61 7374 6572 5f76 6965 7762 6f78  f.master_viewbox
-000081c0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000081d0: 6574 7572 6e20 7365 6c66 2e6d 6173 7465  eturn self.maste
-000081e0: 725f 7669 6577 626f 782e 7768 6565 6c45  r_viewbox.wheelE
-000081f0: 7665 6e74 2865 762c 2061 7869 733d 6178  vent(ev, axis=ax
-00008200: 6973 290d 0a20 2020 2020 2020 2069 6620  is)..        if 
-00008210: 6576 2e6d 6f64 6966 6965 7273 2829 203d  ev.modifiers() =
-00008220: 3d20 5174 436f 7265 2e51 742e 4b65 7962  = QtCore.Qt.Keyb
-00008230: 6f61 7264 4d6f 6469 6669 6572 2e43 6f6e  oardModifier.Con
-00008240: 7472 6f6c 4d6f 6469 6669 6572 3a0d 0a20  trolModifier:.. 
-00008250: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
-00008260: 5f66 6163 7420 3d20 310d 0a20 2020 2020  _fact = 1..     
-00008270: 2020 2020 2020 2073 656c 662e 765f 7a6f         self.v_zo
-00008280: 6f6d 5f73 6361 6c65 202f 3d20 312e 3032  om_scale /= 1.02
-00008290: 202a 2a20 2865 762e 6465 6c74 6128 2920   ** (ev.delta() 
-000082a0: 2a20 7365 6c66 2e73 7461 7465 5b27 7768  * self.state['wh
-000082b0: 6565 6c53 6361 6c65 4661 6374 6f72 275d  eelScaleFactor']
-000082c0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-000082d0: 0d0a 2020 2020 2020 2020 2020 2020 7363  ..            sc
-000082e0: 616c 655f 6661 6374 203d 2031 2e30 3220  ale_fact = 1.02 
-000082f0: 2a2a 2028 6576 2e64 656c 7461 2829 202a  ** (ev.delta() *
-00008300: 2073 656c 662e 7374 6174 655b 2777 6865   self.state['whe
-00008310: 656c 5363 616c 6546 6163 746f 7227 5d29  elScaleFactor'])
-00008320: 0d0a 2020 2020 2020 2020 7672 203d 2073  ..        vr = s
-00008330: 656c 662e 7461 7267 6574 5265 6374 2829  elf.targetRect()
-00008340: 0d0a 2020 2020 2020 2020 6365 6e74 6572  ..        center
-00008350: 203d 2073 656c 662e 6d61 7054 6f56 6965   = self.mapToVie
-00008360: 7728 6576 2e73 6365 6e65 506f 7328 2929  w(ev.scenePos())
-00008370: 0d0a 2020 2020 2020 2020 7063 745f 7820  ..        pct_x 
-00008380: 3d20 2863 656e 7465 722e 7828 292d 7672  = (center.x()-vr
-00008390: 2e6c 6566 7428 2929 202f 2076 722e 7769  .left()) / vr.wi
-000083a0: 6474 6828 290d 0a20 2020 2020 2020 2069  dth()..        i
-000083b0: 6620 7063 745f 7820 3c20 302e 3035 3a20  f pct_x < 0.05: 
-000083c0: 2320 7a6f 6f6d 2074 6f20 6661 7220 6c65  # zoom to far le
-000083d0: 6674 203d 3e20 616c 6c20 7468 6520 7761  ft => all the wa
-000083e0: 7920 6c65 6674 0d0a 2020 2020 2020 2020  y left..        
-000083f0: 2020 2020 6365 6e74 6572 203d 2070 672e      center = pg.
-00008400: 506f 696e 7428 7672 2e6c 6566 7428 292c  Point(vr.left(),
-00008410: 2063 656e 7465 722e 7928 2929 0d0a 2020   center.y())..  
-00008420: 2020 2020 2020 656c 6966 2070 6374 5f78        elif pct_x
-00008430: 203e 2030 2e39 353a 2023 207a 6f6f 6d20   > 0.95: # zoom 
-00008440: 746f 2066 6172 2072 6967 6874 203d 3e20  to far right => 
-00008450: 616c 6c20 7468 6520 7761 7920 7269 6768  all the way righ
-00008460: 740d 0a20 2020 2020 2020 2020 2020 2063  t..            c
-00008470: 656e 7465 7220 3d20 7067 2e50 6f69 6e74  enter = pg.Point
-00008480: 2876 722e 7269 6768 7428 292c 2063 656e  (vr.right(), cen
-00008490: 7465 722e 7928 2929 0d0a 2020 2020 2020  ter.y())..      
-000084a0: 2020 7365 6c66 2e7a 6f6f 6d5f 7265 6374    self.zoom_rect
-000084b0: 2876 722c 2073 6361 6c65 5f66 6163 742c  (vr, scale_fact,
-000084c0: 2063 656e 7465 7229 0d0a 2020 2020 2020   center)..      
-000084d0: 2020 2320 7570 6461 7465 2063 726f 7373    # update cross
-000084e0: 6861 6972 0d0a 2020 2020 2020 2020 5f6d  hair..        _m
-000084f0: 6f75 7365 5f6d 6f76 6564 2873 656c 662e  ouse_moved(self.
-00008500: 7769 6e2c 2073 656c 662c 204e 6f6e 6529  win, self, None)
-00008510: 0d0a 2020 2020 2020 2020 6576 2e61 6363  ..        ev.acc
-00008520: 6570 7428 290d 0a0d 0a20 2020 2064 6566  ept()....    def
-00008530: 206d 6f75 7365 4472 6167 4576 656e 7428   mouseDragEvent(
-00008540: 7365 6c66 2c20 6576 2c20 6178 6973 3d4e  self, ev, axis=N
-00008550: 6f6e 6529 3a0d 0a20 2020 2020 2020 2061  one):..        a
-00008560: 7869 7320 3d20 3020 2320 646f 6e27 7420  xis = 0 # don't 
-00008570: 636f 6e73 7472 6169 6e20 6472 6167 2064  constrain drag d
-00008580: 6972 6563 7469 6f6e 0d0a 2020 2020 2020  irection..      
-00008590: 2020 6966 2073 656c 662e 6d61 7374 6572    if self.master
-000085a0: 5f76 6965 7762 6f78 3a0d 0a20 2020 2020  _viewbox:..     
-000085b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000085c0: 6c66 2e6d 6173 7465 725f 7669 6577 626f  lf.master_viewbo
-000085d0: 782e 6d6f 7573 6544 7261 6745 7665 6e74  x.mouseDragEvent
-000085e0: 2865 762c 2061 7869 733d 6178 6973 290d  (ev, axis=axis).
-000085f0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00008600: 7365 6c66 2e64 6174 6173 7263 3a0d 0a20  self.datasrc:.. 
-00008610: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008620: 6e0d 0a20 2020 2020 2020 2069 6620 6576  n..        if ev
-00008630: 2e62 7574 746f 6e28 2920 3d3d 2051 7443  .button() == QtC
-00008640: 6f72 652e 5174 2e4d 6f75 7365 4275 7474  ore.Qt.MouseButt
-00008650: 6f6e 2e4c 6566 7442 7574 746f 6e3a 0d0a  on.LeftButton:..
-00008660: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008670: 2e6d 6f75 7365 4c65 6674 4472 6167 2865  .mouseLeftDrag(e
-00008680: 762c 2061 7869 7329 0d0a 2020 2020 2020  v, axis)..      
-00008690: 2020 656c 6966 2065 762e 6275 7474 6f6e    elif ev.button
-000086a0: 2829 203d 3d20 5174 436f 7265 2e51 742e  () == QtCore.Qt.
-000086b0: 4d6f 7573 6542 7574 746f 6e2e 4d69 6464  MouseButton.Midd
-000086c0: 6c65 4275 7474 6f6e 3a0d 0a20 2020 2020  leButton:..     
-000086d0: 2020 2020 2020 2073 656c 662e 6d6f 7573         self.mous
-000086e0: 654d 6964 646c 6544 7261 6728 6576 2c20  eMiddleDrag(ev, 
-000086f0: 6178 6973 290d 0a20 2020 2020 2020 2065  axis)..        e
-00008700: 6c69 6620 6576 2e62 7574 746f 6e28 2920  lif ev.button() 
-00008710: 3d3d 2051 7443 6f72 652e 5174 2e4d 6f75  == QtCore.Qt.Mou
-00008720: 7365 4275 7474 6f6e 2e52 6967 6874 4275  seButton.RightBu
-00008730: 7474 6f6e 3a0d 0a20 2020 2020 2020 2020  tton:..         
-00008740: 2020 2073 656c 662e 6d6f 7573 6552 6967     self.mouseRig
-00008750: 6874 4472 6167 2865 762c 2061 7869 7329  htDrag(ev, axis)
-00008760: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00008770: 0a20 2020 2020 2020 2020 2020 2073 7570  .            sup
-00008780: 6572 2829 2e6d 6f75 7365 4472 6167 4576  er().mouseDragEv
-00008790: 656e 7428 6576 2c20 6178 6973 290d 0a0d  ent(ev, axis)...
-000087a0: 0a20 2020 2064 6566 206d 6f75 7365 4c65  .    def mouseLe
-000087b0: 6674 4472 6167 2873 656c 662c 2065 762c  ftDrag(self, ev,
-000087c0: 2061 7869 7329 3a0d 0a20 2020 2020 2020   axis):..       
-000087d0: 2027 2727 4374 726c 2b4c 4275 7474 6f6e   '''Ctrl+LButton
-000087e0: 2064 7261 7720 6c69 6e65 732e 2727 270d   draw lines.'''.
-000087f0: 0a20 2020 2020 2020 2069 6620 6576 2e6d  .        if ev.m
-00008800: 6f64 6966 6965 7273 2829 2021 3d20 5174  odifiers() != Qt
-00008810: 436f 7265 2e51 742e 4b65 7962 6f61 7264  Core.Qt.Keyboard
-00008820: 4d6f 6469 6669 6572 2e43 6f6e 7472 6f6c  Modifier.Control
-00008830: 4d6f 6469 6669 6572 3a0d 0a20 2020 2020  Modifier:..     
-00008840: 2020 2020 2020 2073 7570 6572 2829 2e6d         super().m
-00008850: 6f75 7365 4472 6167 4576 656e 7428 6576  ouseDragEvent(ev
-00008860: 2c20 6178 6973 290d 0a20 2020 2020 2020  , axis)..       
-00008870: 2020 2020 2069 6620 6576 2e69 7346 696e       if ev.isFin
-00008880: 6973 6828 293a 0d0a 2020 2020 2020 2020  ish():..        
-00008890: 2020 2020 2020 2020 7365 6c66 2e77 696e          self.win
-000088a0: 2e5f 6973 4d6f 7573 654c 6566 7444 7261  ._isMouseLeftDra
-000088b0: 6720 3d20 4661 6c73 650d 0a20 2020 2020  g = False..     
-000088c0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000088d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000088e0: 6c66 2e77 696e 2e5f 6973 4d6f 7573 654c  lf.win._isMouseL
-000088f0: 6566 7444 7261 6720 3d20 5472 7565 0d0a  eftDrag = True..
-00008900: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00008910: 762e 6973 4669 6e69 7368 2829 206f 7220  v.isFinish() or 
-00008920: 7365 6c66 2e64 7261 7769 6e67 3a0d 0a20  self.drawing:.. 
-00008930: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00008940: 656c 662e 7265 6672 6573 685f 616c 6c5f  elf.refresh_all_
-00008950: 795f 7a6f 6f6d 2829 0d0a 2020 2020 2020  y_zoom()..      
-00008960: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00008970: 662e 6472 6177 696e 673a 0d0a 2020 2020  f.drawing:..    
-00008980: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00008990: 726e 0d0a 2020 2020 2020 2020 6966 2073  rn..        if s
-000089a0: 656c 662e 6472 6177 5f6c 696e 6520 616e  elf.draw_line an
-000089b0: 6420 6e6f 7420 7365 6c66 2e64 7261 7769  d not self.drawi
-000089c0: 6e67 3a0d 0a20 2020 2020 2020 2020 2020  ng:..           
-000089d0: 2073 656c 662e 7365 745f 6472 6177 5f6c   self.set_draw_l
-000089e0: 696e 655f 636f 6c6f 7228 6472 6177 5f64  ine_color(draw_d
-000089f0: 6f6e 655f 636f 6c6f 7229 0d0a 2020 2020  one_color)..    
-00008a00: 2020 2020 7031 203d 2073 656c 662e 6d61      p1 = self.ma
-00008a10: 7054 6f56 6965 7728 6576 2e70 6f73 2829  pToView(ev.pos()
-00008a20: 290d 0a20 2020 2020 2020 2070 3120 3d20  )..        p1 = 
-00008a30: 5f63 6c61 6d70 5f70 6f69 6e74 2873 656c  _clamp_point(sel
-00008a40: 662e 7061 7265 6e74 2829 2c20 7031 290d  f.parent(), p1).
-00008a50: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00008a60: 7365 6c66 2e64 7261 7769 6e67 3a0d 0a20  self.drawing:.. 
-00008a70: 2020 2020 2020 2020 2020 2023 2061 6464             # add
-00008a80: 206e 6577 206c 696e 650d 0a20 2020 2020   new line..     
-00008a90: 2020 2020 2020 2070 3020 3d20 7365 6c66         p0 = self
-00008aa0: 2e6d 6170 546f 5669 6577 2865 762e 6c61  .mapToView(ev.la
-00008ab0: 7374 506f 7328 2929 0d0a 2020 2020 2020  stPos())..      
-00008ac0: 2020 2020 2020 7030 203d 205f 636c 616d        p0 = _clam
-00008ad0: 705f 706f 696e 7428 7365 6c66 2e70 6172  p_point(self.par
-00008ae0: 656e 7428 292c 2070 3029 0d0a 2020 2020  ent(), p0)..    
-00008af0: 2020 2020 2020 2020 7365 6c66 2e64 7261          self.dra
-00008b00: 775f 6c69 6e65 203d 205f 6372 6561 7465  w_line = _create
-00008b10: 5f70 6f6c 795f 6c69 6e65 2873 656c 662c  _poly_line(self,
-00008b20: 205b 7030 2c20 7031 5d2c 2063 6c6f 7365   [p0, p1], close
-00008b30: 643d 4661 6c73 652c 2070 656e 3d70 672e  d=False, pen=pg.
-00008b40: 6d6b 5065 6e28 6472 6177 5f6c 696e 655f  mkPen(draw_line_
-00008b50: 636f 6c6f 7229 2c20 6d6f 7661 626c 653d  color), movable=
-00008b60: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00008b70: 2020 2020 7365 6c66 2e64 7261 775f 6c69      self.draw_li
-00008b80: 6e65 2e73 6574 5a56 616c 7565 2834 3029  ne.setZValue(40)
-00008b90: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00008ba0: 6c66 2e72 6f69 732e 6170 7065 6e64 2873  lf.rois.append(s
-00008bb0: 656c 662e 6472 6177 5f6c 696e 6529 0d0a  elf.draw_line)..
-00008bc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008bd0: 2e61 6464 4974 656d 2873 656c 662e 6472  .addItem(self.dr
-00008be0: 6177 5f6c 696e 6529 0d0a 2020 2020 2020  aw_line)..      
-00008bf0: 2020 2020 2020 7365 6c66 2e64 7261 7769        self.drawi
-00008c00: 6e67 203d 2054 7275 650d 0a20 2020 2020  ng = True..     
-00008c10: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00008c20: 2020 2020 2020 2320 6472 6177 2070 6c61        # draw pla
-00008c30: 6365 6420 706f 696e 7420 6174 2065 6e64  ced point at end
-00008c40: 206f 6620 706f 6c79 2d6c 696e 650d 0a20   of poly-line.. 
-00008c50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008c60: 6472 6177 5f6c 696e 652e 6d6f 7665 506f  draw_line.movePo
-00008c70: 696e 7428 2d31 2c20 7031 290d 0a20 2020  int(-1, p1)..   
-00008c80: 2020 2020 2069 6620 6576 2e69 7346 696e       if ev.isFin
-00008c90: 6973 6828 293a 0d0a 2020 2020 2020 2020  ish():..        
-00008ca0: 2020 2020 7365 6c66 2e64 7261 7769 6e67      self.drawing
-00008cb0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00008cc0: 2020 6576 2e61 6363 6570 7428 290d 0a0d    ev.accept()...
-00008cd0: 0a20 2020 2064 6566 206d 6f75 7365 4d69  .    def mouseMi
-00008ce0: 6464 6c65 4472 6167 2873 656c 662c 2065  ddleDrag(self, e
-00008cf0: 762c 2061 7869 7329 3a0d 0a20 2020 2020  v, axis):..     
-00008d00: 2020 2027 2727 4374 726c 2b4d 4275 7474     '''Ctrl+MButt
-00008d10: 6f6e 2064 7261 7720 656c 6c69 7073 6573  on draw ellipses
-00008d20: 2e27 2727 0d0a 2020 2020 2020 2020 6966  .'''..        if
-00008d30: 2065 762e 6d6f 6469 6669 6572 7328 2920   ev.modifiers() 
-00008d40: 213d 2051 7443 6f72 652e 5174 2e4b 6579  != QtCore.Qt.Key
-00008d50: 626f 6172 644d 6f64 6966 6965 722e 436f  boardModifier.Co
-00008d60: 6e74 726f 6c4d 6f64 6966 6965 723a 0d0a  ntrolModifier:..
-00008d70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00008d80: 726e 2073 7570 6572 2829 2e6d 6f75 7365  rn super().mouse
-00008d90: 4472 6167 4576 656e 7428 6576 2c20 6178  DragEvent(ev, ax
-00008da0: 6973 290d 0a20 2020 2020 2020 2070 3120  is)..        p1 
-00008db0: 3d20 7365 6c66 2e6d 6170 546f 5669 6577  = self.mapToView
-00008dc0: 2865 762e 706f 7328 2929 0d0a 2020 2020  (ev.pos())..    
-00008dd0: 2020 2020 7031 203d 205f 636c 616d 705f      p1 = _clamp_
-00008de0: 706f 696e 7428 7365 6c66 2e70 6172 656e  point(self.paren
-00008df0: 7428 292c 2070 3129 0d0a 2020 2020 2020  t(), p1)..      
-00008e00: 2020 6465 6620 6e6f 6e7a 6572 6f73 697a    def nonzerosiz
-00008e10: 6528 612c 2062 293a 0d0a 2020 2020 2020  e(a, b):..      
-00008e20: 2020 2020 2020 6320 3d20 622d 610d 0a20        c = b-a.. 
-00008e30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008e40: 6e20 7067 2e50 6f69 6e74 2861 6273 2863  n pg.Point(abs(c
-00008e50: 2e78 2829 2920 6f72 2031 2c20 6162 7328  .x()) or 1, abs(
-00008e60: 632e 7928 2929 206f 7220 3165 2d33 290d  c.y()) or 1e-3).
-00008e70: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00008e80: 7365 6c66 2e64 7261 7769 6e67 3a0d 0a20  self.drawing:.. 
-00008e90: 2020 2020 2020 2020 2020 2023 2061 6464             # add
-00008ea0: 206e 6577 2065 6c6c 6970 7365 0d0a 2020   new ellipse..  
-00008eb0: 2020 2020 2020 2020 2020 7030 203d 2073            p0 = s
-00008ec0: 656c 662e 6d61 7054 6f56 6965 7728 6576  elf.mapToView(ev
-00008ed0: 2e6c 6173 7450 6f73 2829 290d 0a20 2020  .lastPos())..   
-00008ee0: 2020 2020 2020 2020 2070 3020 3d20 5f63           p0 = _c
-00008ef0: 6c61 6d70 5f70 6f69 6e74 2873 656c 662e  lamp_point(self.
-00008f00: 7061 7265 6e74 2829 2c20 7030 290d 0a20  parent(), p0).. 
-00008f10: 2020 2020 2020 2020 2020 2073 203d 206e             s = n
-00008f20: 6f6e 7a65 726f 7369 7a65 2870 302c 2070  onzerosize(p0, p
-00008f30: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-00008f40: 7030 203d 2051 7443 6f72 652e 5150 6f69  p0 = QtCore.QPoi
-00008f50: 6e74 4628 7030 2e78 2829 2d73 2e78 2829  ntF(p0.x()-s.x()
-00008f60: 2f32 2c20 7030 2e79 2829 2d73 2e79 2829  /2, p0.y()-s.y()
-00008f70: 2f32 290d 0a20 2020 2020 2020 2020 2020  /2)..           
-00008f80: 2073 656c 662e 6472 6177 5f65 6c6c 6970   self.draw_ellip
-00008f90: 7365 203d 2046 696e 456c 6c69 7073 6528  se = FinEllipse(
-00008fa0: 7030 2c20 732c 2070 656e 3d70 672e 6d6b  p0, s, pen=pg.mk
-00008fb0: 5065 6e28 6472 6177 5f6c 696e 655f 636f  Pen(draw_line_co
-00008fc0: 6c6f 7229 2c20 6d6f 7661 626c 653d 5472  lor), movable=Tr
-00008fd0: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-00008fe0: 2073 656c 662e 6472 6177 5f65 6c6c 6970   self.draw_ellip
-00008ff0: 7365 2e73 6574 5a56 616c 7565 2838 3029  se.setZValue(80)
-00009000: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00009010: 6c66 2e72 6f69 732e 6170 7065 6e64 2873  lf.rois.append(s
-00009020: 656c 662e 6472 6177 5f65 6c6c 6970 7365  elf.draw_ellipse
-00009030: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00009040: 656c 662e 6164 6449 7465 6d28 7365 6c66  elf.addItem(self
-00009050: 2e64 7261 775f 656c 6c69 7073 6529 0d0a  .draw_ellipse)..
-00009060: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009070: 2e64 7261 7769 6e67 203d 2054 7275 650d  .drawing = True.
-00009080: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00009090: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
-000090a0: 7365 6c66 2e64 7261 775f 656c 6c69 7073  self.draw_ellips
-000090b0: 652e 706f 7328 2920 2b20 7365 6c66 2e64  e.pos() + self.d
-000090c0: 7261 775f 656c 6c69 7073 652e 7369 7a65  raw_ellipse.size
-000090d0: 2829 2a30 2e35 0d0a 2020 2020 2020 2020  ()*0.5..        
-000090e0: 2020 2020 7320 3d20 6e6f 6e7a 6572 6f73      s = nonzeros
-000090f0: 697a 6528 632c 2070 3129 0d0a 2020 2020  ize(c, p1)..    
-00009100: 2020 2020 2020 2020 7365 6c66 2e64 7261          self.dra
-00009110: 775f 656c 6c69 7073 652e 7365 7453 697a  w_ellipse.setSiz
-00009120: 6528 732a 322c 2075 7064 6174 653d 4661  e(s*2, update=Fa
-00009130: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
-00009140: 2020 7365 6c66 2e64 7261 775f 656c 6c69    self.draw_elli
-00009150: 7073 652e 7365 7450 6f73 2863 2d73 290d  pse.setPos(c-s).
-00009160: 0a20 2020 2020 2020 2069 6620 6576 2e69  .        if ev.i
-00009170: 7346 696e 6973 6828 293a 0d0a 2020 2020  sFinish():..    
-00009180: 2020 2020 2020 2020 7365 6c66 2e64 7261          self.dra
-00009190: 7769 6e67 203d 2046 616c 7365 0d0a 2020  wing = False..  
-000091a0: 2020 2020 2020 6576 2e61 6363 6570 7428        ev.accept(
-000091b0: 290d 0a0d 0a20 2020 2064 6566 206d 6f75  )....    def mou
-000091c0: 7365 5269 6768 7444 7261 6728 7365 6c66  seRightDrag(self
-000091d0: 2c20 6576 2c20 6178 6973 293a 0d0a 2020  , ev, axis):..  
-000091e0: 2020 2020 2020 2727 2752 4275 7474 6f6e        '''RButton
-000091f0: 2069 7320 626f 7820 7a6f 6f6d 2e20 4174   is box zoom. At
-00009200: 206c 6561 7374 2066 6f72 206e 6f77 2e27   least for now.'
-00009210: 2727 0d0a 2020 2020 2020 2020 6576 2e61  ''..        ev.a
-00009220: 6363 6570 7428 290d 0a20 2020 2020 2020  ccept()..       
-00009230: 2069 6620 6e6f 7420 6576 2e69 7346 696e   if not ev.isFin
-00009240: 6973 6828 293a 0d0a 2020 2020 2020 2020  ish():..        
-00009250: 2020 2020 7365 6c66 2e75 7064 6174 6553      self.updateS
-00009260: 6361 6c65 426f 7828 6576 2e62 7574 746f  caleBox(ev.butto
-00009270: 6e44 6f77 6e50 6f73 2829 2c20 6576 2e70  nDownPos(), ev.p
-00009280: 6f73 2829 290d 0a20 2020 2020 2020 2065  os())..        e
-00009290: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-000092a0: 2020 7365 6c66 2e72 6253 6361 6c65 426f    self.rbScaleBo
-000092b0: 782e 6869 6465 2829 0d0a 2020 2020 2020  x.hide()..      
-000092c0: 2020 2020 2020 6178 203d 2051 7443 6f72        ax = QtCor
-000092d0: 652e 5152 6563 7446 2870 672e 506f 696e  e.QRectF(pg.Poin
-000092e0: 7428 6576 2e62 7574 746f 6e44 6f77 6e50  t(ev.buttonDownP
-000092f0: 6f73 2865 762e 6275 7474 6f6e 2829 2929  os(ev.button()))
-00009300: 2c20 7067 2e50 6f69 6e74 2865 762e 706f  , pg.Point(ev.po
-00009310: 7328 2929 290d 0a20 2020 2020 2020 2020  s()))..         
-00009320: 2020 2061 7820 3d20 7365 6c66 2e63 6869     ax = self.chi
-00009330: 6c64 4772 6f75 702e 6d61 7052 6563 7446  ldGroup.mapRectF
-00009340: 726f 6d50 6172 656e 7428 6178 290d 0a20  romParent(ax).. 
-00009350: 2020 2020 2020 2020 2020 2069 6620 6178             if ax
-00009360: 2e77 6964 7468 2829 203c 2032 3a20 2320  .width() < 2: # 
-00009370: 7a6f 6f6d 696e 6720 7468 6973 206e 6172  zooming this nar
-00009380: 726f 7720 6973 2070 726f 6261 626c 7920  row is probably 
-00009390: 6120 6d69 7374 616b 650d 0a20 2020 2020  a mistake..     
-000093a0: 2020 2020 2020 2020 2020 2061 782e 6164             ax.ad
-000093b0: 6a75 7374 282d 312c 2030 2c20 2b31 2c20  just(-1, 0, +1, 
-000093c0: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
-000093d0: 7365 6c66 2e73 686f 7741 7852 6563 7428  self.showAxRect(
-000093e0: 6178 290d 0a20 2020 2020 2020 2020 2020  ax)..           
-000093f0: 2073 656c 662e 6178 4869 7374 6f72 7950   self.axHistoryP
-00009400: 6f69 6e74 6572 202b 3d20 310d 0a20 2020  ointer += 1..   
-00009410: 2020 2020 2020 2020 2073 656c 662e 6178           self.ax
-00009420: 4869 7374 6f72 7920 3d20 7365 6c66 2e61  History = self.a
-00009430: 7848 6973 746f 7279 5b3a 7365 6c66 2e61  xHistory[:self.a
-00009440: 7848 6973 746f 7279 506f 696e 7465 725d  xHistoryPointer]
-00009450: 202b 205b 6178 5d0d 0a0d 0a20 2020 2064   + [ax]....    d
-00009460: 6566 206d 6f75 7365 436c 6963 6b45 7665  ef mouseClickEve
-00009470: 6e74 2873 656c 662c 2065 7629 3a0d 0a20  nt(self, ev):.. 
-00009480: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
-00009490: 6173 7465 725f 7669 6577 626f 783a 0d0a  aster_viewbox:..
-000094a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000094b0: 726e 2073 656c 662e 6d61 7374 6572 5f76  rn self.master_v
-000094c0: 6965 7762 6f78 2e6d 6f75 7365 436c 6963  iewbox.mouseClic
-000094d0: 6b45 7665 6e74 2865 7629 0d0a 2020 2020  kEvent(ev)..    
-000094e0: 2020 2020 6966 205f 6d6f 7573 655f 636c      if _mouse_cl
-000094f0: 6963 6b65 6428 7365 6c66 2c20 6576 293a  icked(self, ev):
-00009500: 0d0a 2020 2020 2020 2020 2020 2020 6576  ..            ev
-00009510: 2e61 6363 6570 7428 290d 0a20 2020 2020  .accept()..     
-00009520: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
-00009530: 2020 2020 2020 2069 6620 6576 2e62 7574         if ev.but
-00009540: 746f 6e28 2920 213d 2051 7443 6f72 652e  ton() != QtCore.
-00009550: 5174 2e4d 6f75 7365 4275 7474 6f6e 2e4c  Qt.MouseButton.L
-00009560: 6566 7442 7574 746f 6e20 6f72 2065 762e  eftButton or ev.
-00009570: 6d6f 6469 6669 6572 7328 2920 213d 2051  modifiers() != Q
-00009580: 7443 6f72 652e 5174 2e4b 6579 626f 6172  tCore.Qt.Keyboar
-00009590: 644d 6f64 6966 6965 722e 436f 6e74 726f  dModifier.Contro
-000095a0: 6c4d 6f64 6966 6965 7220 6f72 206e 6f74  lModifier or not
-000095b0: 2073 656c 662e 6472 6177 5f6c 696e 653a   self.draw_line:
-000095c0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000095d0: 7475 726e 2073 7570 6572 2829 2e6d 6f75  turn super().mou
-000095e0: 7365 436c 6963 6b45 7665 6e74 2865 7629  seClickEvent(ev)
-000095f0: 0d0a 2020 2020 2020 2020 2320 6164 6420  ..        # add 
-00009600: 616e 6f74 6865 7220 7365 676d 656e 7420  another segment 
-00009610: 746f 2074 6865 2063 7572 7265 6e74 6c79  to the currently
-00009620: 2064 7261 776e 206c 696e 650d 0a20 2020   drawn line..   
-00009630: 2020 2020 2070 203d 2073 656c 662e 6d61       p = self.ma
-00009640: 7043 6c69 636b 546f 5669 6577 2865 762e  pClickToView(ev.
-00009650: 706f 7328 2929 0d0a 2020 2020 2020 2020  pos())..        
-00009660: 7020 3d20 5f63 6c61 6d70 5f70 6f69 6e74  p = _clamp_point
-00009670: 2873 656c 662e 7061 7265 6e74 2829 2c20  (self.parent(), 
-00009680: 7029 0d0a 2020 2020 2020 2020 7365 6c66  p)..        self
-00009690: 2e61 7070 656e 645f 6472 6177 5f73 6567  .append_draw_seg
-000096a0: 6d65 6e74 2870 290d 0a20 2020 2020 2020  ment(p)..       
-000096b0: 2073 656c 662e 6472 6177 696e 6720 3d20   self.drawing = 
-000096c0: 4661 6c73 650d 0a20 2020 2020 2020 2065  False..        e
-000096d0: 762e 6163 6365 7074 2829 0d0a 0d0a 2020  v.accept()....  
-000096e0: 2020 6465 6620 6d61 7043 6c69 636b 546f    def mapClickTo
-000096f0: 5669 6577 2873 656c 662c 2070 6f73 293a  View(self, pos):
-00009700: 0d0a 2020 2020 2020 2020 2727 276d 6170  ..        '''map
-00009710: 546f 5669 6577 2829 2064 6f65 7320 6e6f  ToView() does no
-00009720: 7420 646f 2067 7269 6473 2070 726f 7065  t do grids prope
-00009730: 726c 7920 696e 2065 6d62 6564 6465 6420  rly in embedded 
-00009740: 7769 6467 6574 732e 2053 7472 616e 6765  widgets. Strange
-00009750: 6c79 2c20 6f6e 6c79 2061 6666 6563 7420  ly, only affect 
-00009760: 636c 6963 6b73 2c20 6e6f 7420 6472 6167  clicks, not drag
-00009770: 732e 2727 270d 0a20 2020 2020 2020 2069  s.'''..        i
-00009780: 6620 7365 6c66 2e77 696e 2e70 6172 656e  f self.win.paren
-00009790: 7428 2920 6973 206e 6f74 204e 6f6e 653a  t() is not None:
-000097a0: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-000097b0: 203d 2073 656c 662e 7061 7265 6e74 2829   = self.parent()
-000097c0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000097d0: 2061 782e 6765 7441 7869 7328 2772 6967   ax.getAxis('rig
-000097e0: 6874 2729 2e67 7269 643a 0d0a 2020 2020  ht').grid:..    
-000097f0: 2020 2020 2020 2020 2020 2020 706f 732e              pos.
-00009800: 7365 7458 2870 6f73 2e78 2829 202b 2073  setX(pos.x() + s
-00009810: 656c 662e 7769 6474 6828 2929 0d0a 2020  elf.width())..  
-00009820: 2020 2020 2020 2020 2020 656c 6966 2061            elif a
-00009830: 782e 6765 7441 7869 7328 2762 6f74 746f  x.getAxis('botto
-00009840: 6d27 292e 6772 6964 3a0d 0a20 2020 2020  m').grid:..     
-00009850: 2020 2020 2020 2020 2020 2070 6f73 2e73             pos.s
-00009860: 6574 5928 706f 732e 7928 2920 2b20 7365  etY(pos.y() + se
-00009870: 6c66 2e68 6569 6768 7428 2929 0d0a 2020  lf.height())..  
-00009880: 2020 2020 2020 7265 7475 726e 2073 7570        return sup
-00009890: 6572 2829 2e6d 6170 546f 5669 6577 2870  er().mapToView(p
-000098a0: 6f73 290d 0a0d 0a20 2020 2064 6566 206b  os)....    def k
-000098b0: 6579 5072 6573 7345 7665 6e74 2873 656c  eyPressEvent(sel
-000098c0: 662c 2065 7629 3a0d 0a20 2020 2020 2020  f, ev):..       
-000098d0: 2069 6620 7365 6c66 2e6d 6173 7465 725f   if self.master_
-000098e0: 7669 6577 626f 783a 0d0a 2020 2020 2020  viewbox:..      
-000098f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00009900: 662e 6d61 7374 6572 5f76 6965 7762 6f78  f.master_viewbox
-00009910: 2e6b 6579 5072 6573 7345 7665 6e74 2865  .keyPressEvent(e
-00009920: 7629 0d0a 2020 2020 2020 2020 6966 205f  v)..        if _
-00009930: 6b65 795f 7072 6573 7365 6428 7365 6c66  key_pressed(self
-00009940: 2c20 6576 293a 0d0a 2020 2020 2020 2020  , ev):..        
-00009950: 2020 2020 6576 2e61 6363 6570 7428 290d      ev.accept().
-00009960: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00009970: 7572 6e0d 0a20 2020 2020 2020 2073 7570  urn..        sup
-00009980: 6572 2829 2e6b 6579 5072 6573 7345 7665  er().keyPressEve
-00009990: 6e74 2865 7629 0d0a 0d0a 2020 2020 6465  nt(ev)....    de
-000099a0: 6620 6c69 6e6b 6564 5669 6577 4368 616e  f linkedViewChan
-000099b0: 6765 6428 7365 6c66 2c20 7669 6577 2c20  ged(self, view, 
-000099c0: 6178 6973 293a 0d0a 2020 2020 2020 2020  axis):..        
-000099d0: 6966 206e 6f74 2073 656c 662e 6461 7461  if not self.data
-000099e0: 7372 6320 6f72 2073 656c 662e 7570 6461  src or self.upda
-000099f0: 7469 6e67 5f6c 696e 6b65 643a 0d0a 2020  ting_linked:..  
-00009a00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009a10: 0d0a 2020 2020 2020 2020 6966 2076 6965  ..        if vie
-00009a20: 7720 616e 6420 7365 6c66 2e64 6174 6173  w and self.datas
-00009a30: 7263 2061 6e64 2076 6965 772e 6461 7461  rc and view.data
-00009a40: 7372 633a 0d0a 2020 2020 2020 2020 2020  src:..          
-00009a50: 2020 7365 6c66 2e75 7064 6174 696e 675f    self.updating_
-00009a60: 6c69 6e6b 6564 203d 2054 7275 650d 0a20  linked = True.. 
-00009a70: 2020 2020 2020 2020 2020 2074 7220 3d20             tr = 
-00009a80: 7365 6c66 2e74 6172 6765 7452 6563 7428  self.targetRect(
-00009a90: 290d 0a20 2020 2020 2020 2020 2020 2076  )..            v
-00009aa0: 7220 3d20 7669 6577 2e74 6172 6765 7452  r = view.targetR
-00009ab0: 6563 7428 290d 0a20 2020 2020 2020 2020  ect()..         
-00009ac0: 2020 2069 735f 6469 7274 7920 3d20 7669     is_dirty = vi
-00009ad0: 6577 2e66 6f72 6365 5f72 616e 6765 5f75  ew.force_range_u
-00009ae0: 7064 6174 6520 3e20 300d 0a20 2020 2020  pdate > 0..     
-00009af0: 2020 2020 2020 2069 735f 7361 6d65 5f73         is_same_s
-00009b00: 6361 6c65 203d 2073 656c 662e 6461 7461  cale = self.data
-00009b10: 7372 632e 786c 656e 203d 3d20 7669 6577  src.xlen == view
-00009b20: 2e64 6174 6173 7263 2e78 6c65 6e0d 0a20  .datasrc.xlen.. 
-00009b30: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00009b40: 5f73 616d 655f 7363 616c 653a 2023 2073  _same_scale: # s
-00009b50: 7461 626c 6520 7a6f 6f6d 2062 6173 6564  table zoom based
-00009b60: 206f 6e20 696e 6465 780d 0a20 2020 2020   on index..     
-00009b70: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00009b80: 5f64 6972 7479 206f 7220 6162 7328 7672  _dirty or abs(vr
-00009b90: 2e6c 6566 7428 292d 7472 2e6c 6566 7428  .left()-tr.left(
-00009ba0: 2929 203e 3d20 3120 6f72 2061 6273 2876  )) >= 1 or abs(v
-00009bb0: 722e 7269 6768 7428 292d 7472 2e72 6967  r.right()-tr.rig
-00009bc0: 6874 2829 2920 3e3d 2031 3a0d 0a20 2020  ht()) >= 1:..   
-00009bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009be0: 2069 6620 6973 5f64 6972 7479 3a0d 0a20   if is_dirty:.. 
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 2020 2020 2020 2076 6965 772e 666f 7263         view.forc
-00009c10: 655f 7261 6e67 655f 7570 6461 7465 202d  e_range_update -
-00009c20: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-00009c30: 2020 2020 2020 2020 2073 656c 662e 7570           self.up
-00009c40: 6461 7465 5f79 5f7a 6f6f 6d28 7672 2e6c  date_y_zoom(vr.l
-00009c50: 6566 7428 292c 2076 722e 7269 6768 7428  eft(), vr.right(
-00009c60: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00009c70: 656c 7365 3a20 2320 736c 6f70 7079 206f  else: # sloppy o
-00009c80: 6e65 2062 6173 6564 206f 6e20 7469 6d65  ne based on time
-00009c90: 2073 7461 6d70 730d 0a20 2020 2020 2020   stamps..       
-00009ca0: 2020 2020 2020 2020 2074 7430 2c74 7431           tt0,tt1
-00009cb0: 2c5f 2c5f 2c5f 203d 2073 656c 662e 6461  ,_,_,_ = self.da
-00009cc0: 7461 7372 632e 6869 6c6f 2874 722e 6c65  tasrc.hilo(tr.le
-00009cd0: 6674 2829 2c20 7472 2e72 6967 6874 2829  ft(), tr.right()
-00009ce0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00009cf0: 2020 2076 7430 2c76 7431 2c5f 2c5f 2c5f     vt0,vt1,_,_,_
-00009d00: 203d 2076 6965 772e 6461 7461 7372 632e   = view.datasrc.
-00009d10: 6869 6c6f 2876 722e 6c65 6674 2829 2c20  hilo(vr.left(), 
-00009d20: 7672 2e72 6967 6874 2829 290d 0a20 2020  vr.right())..   
-00009d30: 2020 2020 2020 2020 2020 2020 2070 6572               per
-00009d40: 696f 6432 203d 2073 656c 662e 6461 7461  iod2 = self.data
-00009d50: 7372 632e 7065 7269 6f64 5f6e 7320 2a20  src.period_ns * 
-00009d60: 302e 350d 0a20 2020 2020 2020 2020 2020  0.5..           
-00009d70: 2020 2020 2069 6620 6973 5f64 6972 7479       if is_dirty
-00009d80: 206f 7220 6162 7328 7674 302d 7474 3029   or abs(vt0-tt0)
-00009d90: 203e 3d20 7065 7269 6f64 3220 6f72 2061   >= period2 or a
-00009da0: 6273 2876 7431 2d74 7431 2920 3e3d 2070  bs(vt1-tt1) >= p
-00009db0: 6572 696f 6432 3a0d 0a20 2020 2020 2020  eriod2:..       
-00009dc0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00009dd0: 6973 5f64 6972 7479 3a0d 0a20 2020 2020  is_dirty:..     
-00009de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009df0: 2020 2076 6965 772e 666f 7263 655f 7261     view.force_ra
-00009e00: 6e67 655f 7570 6461 7465 202d 3d20 310d  nge_update -= 1.
-00009e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009e20: 2020 2020 2069 6620 7365 6c66 2e70 6172       if self.par
-00009e30: 656e 7428 293a 0d0a 2020 2020 2020 2020  ent():..        
-00009e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e50: 7830 2c78 3120 3d20 5f70 6474 696d 6532  x0,x1 = _pdtime2
-00009e60: 696e 6465 7828 7365 6c66 2e70 6172 656e  index(self.paren
-00009e70: 7428 292c 2070 642e 5365 7269 6573 285b  t(), pd.Series([
-00009e80: 7674 302c 7674 315d 292c 2061 6e79 5f65  vt0,vt1]), any_e
-00009e90: 6e64 3d54 7275 6529 0d0a 2020 2020 2020  nd=True)..      
-00009ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009eb0: 2020 7365 6c66 2e75 7064 6174 655f 795f    self.update_y_
-00009ec0: 7a6f 6f6d 2878 302c 2078 3129 0d0a 2020  zoom(x0, x1)..  
-00009ed0: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
-00009ee0: 7064 6174 696e 675f 6c69 6e6b 6564 203d  pdating_linked =
-00009ef0: 2046 616c 7365 0d0a 0d0a 2020 2020 6465   False....    de
-00009f00: 6620 7a6f 6f6d 5f72 6563 7428 7365 6c66  f zoom_rect(self
-00009f10: 2c20 7672 2c20 7363 616c 655f 6661 6374  , vr, scale_fact
-00009f20: 2c20 6365 6e74 6572 293a 0d0a 2020 2020  , center):..    
-00009f30: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00009f40: 6461 7461 7372 633a 0d0a 2020 2020 2020  datasrc:..      
-00009f50: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
-00009f60: 2020 2020 2020 7830 203d 2063 656e 7465        x0 = cente
-00009f70: 722e 7828 2920 2b20 2876 722e 6c65 6674  r.x() + (vr.left
-00009f80: 2829 2d63 656e 7465 722e 7828 2929 202a  ()-center.x()) *
-00009f90: 2073 6361 6c65 5f66 6163 740d 0a20 2020   scale_fact..   
-00009fa0: 2020 2020 2078 3120 3d20 6365 6e74 6572       x1 = center
-00009fb0: 2e78 2829 202b 2028 7672 2e72 6967 6874  .x() + (vr.right
-00009fc0: 2829 2d63 656e 7465 722e 7828 2929 202a  ()-center.x()) *
-00009fd0: 2073 6361 6c65 5f66 6163 740d 0a20 2020   scale_fact..   
-00009fe0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-00009ff0: 5f79 5f7a 6f6f 6d28 7830 2c20 7831 290d  _y_zoom(x0, x1).
-0000a000: 0a0d 0a20 2020 2064 6566 2070 616e 5f78  ...    def pan_x
-0000a010: 2873 656c 662c 2073 7465 7073 3d4e 6f6e  (self, steps=Non
-0000a020: 652c 2070 6572 6365 6e74 3d4e 6f6e 6529  e, percent=None)
-0000a030: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
-0000a040: 6c66 2e64 6174 6173 7263 2069 7320 4e6f  lf.datasrc is No
-0000a050: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0000a060: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
-0000a070: 2069 6620 7374 6570 7320 6973 204e 6f6e   if steps is Non
-0000a080: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000a090: 7374 6570 7320 3d20 696e 7428 7065 7263  steps = int(perc
-0000a0a0: 656e 742f 3130 302a 7365 6c66 2e74 6172  ent/100*self.tar
-0000a0b0: 6765 7452 6563 7428 292e 7769 6474 6828  getRect().width(
-0000a0c0: 2929 0d0a 2020 2020 2020 2020 7472 203d  ))..        tr =
-0000a0d0: 2073 656c 662e 7461 7267 6574 5265 6374   self.targetRect
-0000a0e0: 2829 0d0a 2020 2020 2020 2020 7831 203d  ()..        x1 =
-0000a0f0: 2074 722e 7269 6768 7428 2920 2b20 7374   tr.right() + st
-0000a100: 6570 730d 0a20 2020 2020 2020 2073 7461  eps..        sta
-0000a110: 7274 7820 3d20 2d73 6964 655f 6d61 7267  rtx = -side_marg
-0000a120: 696e 0d0a 2020 2020 2020 2020 656e 6478  in..        endx
-0000a130: 203d 2073 656c 662e 6461 7461 7372 632e   = self.datasrc.
-0000a140: 786c 656e 202b 2072 6967 6874 5f6d 6172  xlen + right_mar
-0000a150: 6769 6e5f 6361 6e64 6c65 7320 2d20 7369  gin_candles - si
-0000a160: 6465 5f6d 6172 6769 6e0d 0a20 2020 2020  de_margin..     
-0000a170: 2020 2069 6620 7831 203e 2065 6e64 783a     if x1 > endx:
-0000a180: 0d0a 2020 2020 2020 2020 2020 2020 7831  ..            x1
-0000a190: 203d 2065 6e64 780d 0a20 2020 2020 2020   = endx..       
-0000a1a0: 2078 3020 3d20 7831 202d 2074 722e 7769   x0 = x1 - tr.wi
-0000a1b0: 6474 6828 290d 0a20 2020 2020 2020 2069  dth()..        i
-0000a1c0: 6620 7830 203c 2073 7461 7274 783a 0d0a  f x0 < startx:..
-0000a1d0: 2020 2020 2020 2020 2020 2020 7830 203d              x0 =
-0000a1e0: 2073 7461 7274 780d 0a20 2020 2020 2020   startx..       
-0000a1f0: 2020 2020 2078 3120 3d20 7830 202b 2074       x1 = x0 + t
-0000a200: 722e 7769 6474 6828 290d 0a20 2020 2020  r.width()..     
-0000a210: 2020 2073 656c 662e 7570 6461 7465 5f79     self.update_y
-0000a220: 5f7a 6f6f 6d28 7830 2c20 7831 290d 0a0d  _zoom(x0, x1)...
-0000a230: 0a20 2020 2064 6566 2072 6566 7265 7368  .    def refresh
-0000a240: 5f61 6c6c 5f79 5f7a 6f6f 6d28 7365 6c66  _all_y_zoom(self
-0000a250: 293a 0d0a 2020 2020 2020 2020 2727 2754  ):..        '''T
-0000a260: 6869 7320 7570 6461 7465 7320 5920 7a6f  his updates Y zo
-0000a270: 6f6d 206f 6e20 616c 6c20 7669 6577 732c  om on all views,
-0000a280: 2073 7563 6820 6173 2077 6865 6e20 6120   such as when a 
-0000a290: 6d6f 7573 6520 6472 6167 2069 7320 636f  mouse drag is co
-0000a2a0: 6d70 6c65 7465 642e 2727 270d 0a20 2020  mpleted.'''..   
-0000a2b0: 2020 2020 206d 6169 6e5f 7662 203d 2073       main_vb = s
-0000a2c0: 656c 660d 0a20 2020 2020 2020 2069 6620  elf..        if 
-0000a2d0: 7365 6c66 2e6c 696e 6b65 6456 6965 7728  self.linkedView(
-0000a2e0: 3029 3a0d 0a20 2020 2020 2020 2020 2020  0):..           
-0000a2f0: 2073 656c 662e 666f 7263 655f 7261 6e67   self.force_rang
-0000a300: 655f 7570 6461 7465 203d 2031 2023 206d  e_update = 1 # m
-0000a310: 6169 6e20 6e65 6564 2074 6f20 7570 6461  ain need to upda
-0000a320: 7465 206f 6e6c 7920 6f6e 6365 2074 6f20  te only once to 
-0000a330: 7573 0d0a 2020 2020 2020 2020 2020 2020  us..            
-0000a340: 6d61 696e 5f76 6220 3d20 6c69 7374 2873  main_vb = list(s
-0000a350: 656c 662e 7769 6e2e 6178 7329 5b30 5d2e  elf.win.axs)[0].
-0000a360: 7662 0d0a 2020 2020 2020 2020 6d61 696e  vb..        main
-0000a370: 5f76 622e 666f 7263 655f 7261 6e67 655f  _vb.force_range_
-0000a380: 7570 6461 7465 203d 206c 656e 2873 656c  update = len(sel
-0000a390: 662e 7769 6e2e 6178 7329 2d31 2023 2075  f.win.axs)-1 # u
-0000a3a0: 7064 6174 6520 6d61 696e 2061 7320 6d61  pdate main as ma
-0000a3b0: 6e79 2074 696d 6573 2061 7320 7468 6572  ny times as ther
-0000a3c0: 6520 6172 6520 6f74 6865 7220 726f 7773  e are other rows
-0000a3d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e75  ..        self.u
-0000a3e0: 7064 6174 655f 795f 7a6f 6f6d 2829 0d0a  pdate_y_zoom()..
-0000a3f0: 2020 2020 2020 2020 2320 7265 6672 6573          # refres
-0000a400: 6820 6372 6f73 7368 6169 7220 7768 656e  h crosshair when
-0000a410: 2064 6f6e 650d 0a20 2020 2020 2020 205f   done..        _
-0000a420: 6d6f 7573 655f 6d6f 7665 6428 7365 6c66  mouse_moved(self
-0000a430: 2e77 696e 2c20 7365 6c66 2c20 4e6f 6e65  .win, self, None
-0000a440: 290d 0a0d 0a20 2020 2064 6566 2075 7064  )....    def upd
-0000a450: 6174 655f 795f 7a6f 6f6d 2873 656c 662c  ate_y_zoom(self,
-0000a460: 2078 303d 4e6f 6e65 2c20 7831 3d4e 6f6e   x0=None, x1=Non
-0000a470: 6529 3a0d 0a20 2020 2020 2020 2064 6174  e):..        dat
-0000a480: 6173 7263 203d 2073 656c 662e 6461 7461  asrc = self.data
-0000a490: 7372 635f 6f72 5f73 7461 6e64 616c 6f6e  src_or_standalon
-0000a4a0: 650d 0a20 2020 2020 2020 2069 6620 6461  e..        if da
-0000a4b0: 7461 7372 6320 6973 204e 6f6e 653a 0d0a  tasrc is None:..
-0000a4c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000a4d0: 726e 0d0a 2020 2020 2020 2020 6966 2078  rn..        if x
-0000a4e0: 3020 6973 204e 6f6e 6520 6f72 2078 3120  0 is None or x1 
-0000a4f0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-0000a500: 2020 2020 2020 7472 203d 2073 656c 662e        tr = self.
-0000a510: 7461 7267 6574 5265 6374 2829 0d0a 2020  targetRect()..  
-0000a520: 2020 2020 2020 2020 2020 7830 203d 2074            x0 = t
-0000a530: 722e 6c65 6674 2829 0d0a 2020 2020 2020  r.left()..      
-0000a540: 2020 2020 2020 7831 203d 2074 722e 7269        x1 = tr.ri
-0000a550: 6768 7428 290d 0a20 2020 2020 2020 2020  ght()..         
-0000a560: 2020 2069 6620 7831 2d78 3020 3c3d 2031     if x1-x0 <= 1
-0000a570: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000a580: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
-0000a590: 2020 2023 206d 616b 6520 6564 6765 7320     # make edges 
-0000a5a0: 7269 6769 640d 0a20 2020 2020 2020 2078  rigid..        x
-0000a5b0: 6c20 3d20 6d61 7828 5f72 6f75 6e64 2878  l = max(_round(x
-0000a5c0: 302d 7369 6465 5f6d 6172 6769 6e29 2b73  0-side_margin)+s
-0000a5d0: 6964 655f 6d61 7267 696e 2c20 2d73 6964  ide_margin, -sid
-0000a5e0: 655f 6d61 7267 696e 290d 0a20 2020 2020  e_margin)..     
-0000a5f0: 2020 2078 7220 3d20 6d69 6e28 5f72 6f75     xr = min(_rou
-0000a600: 6e64 2878 312d 7369 6465 5f6d 6172 6769  nd(x1-side_margi
-0000a610: 6e29 2b73 6964 655f 6d61 7267 696e 2c20  n)+side_margin, 
-0000a620: 6461 7461 7372 632e 786c 656e 2b72 6967  datasrc.xlen+rig
-0000a630: 6874 5f6d 6172 6769 6e5f 6361 6e64 6c65  ht_margin_candle
-0000a640: 732d 7369 6465 5f6d 6172 6769 6e29 0d0a  s-side_margin)..
-0000a650: 2020 2020 2020 2020 6478 6c20 3d20 786c          dxl = xl
-0000a660: 2d78 300d 0a20 2020 2020 2020 2064 7872  -x0..        dxr
-0000a670: 203d 2078 722d 7831 0d0a 2020 2020 2020   = xr-x1..      
-0000a680: 2020 6966 2064 786c 203e 2030 3a0d 0a20    if dxl > 0:.. 
-0000a690: 2020 2020 2020 2020 2020 2078 3120 2b3d             x1 +=
-0000a6a0: 2064 786c 0d0a 2020 2020 2020 2020 6966   dxl..        if
-0000a6b0: 2064 7872 203c 2030 3a0d 0a20 2020 2020   dxr < 0:..     
-0000a6c0: 2020 2020 2020 2078 3020 2b3d 2064 7872         x0 += dxr
-0000a6d0: 0d0a 2020 2020 2020 2020 7830 203d 206d  ..        x0 = m
-0000a6e0: 6178 285f 726f 756e 6428 7830 2d73 6964  ax(_round(x0-sid
-0000a6f0: 655f 6d61 7267 696e 292b 7369 6465 5f6d  e_margin)+side_m
-0000a700: 6172 6769 6e2c 202d 7369 6465 5f6d 6172  argin, -side_mar
-0000a710: 6769 6e29 0d0a 2020 2020 2020 2020 7831  gin)..        x1
-0000a720: 203d 206d 696e 285f 726f 756e 6428 7831   = min(_round(x1
-0000a730: 2d73 6964 655f 6d61 7267 696e 292b 7369  -side_margin)+si
-0000a740: 6465 5f6d 6172 6769 6e2c 2064 6174 6173  de_margin, datas
-0000a750: 7263 2e78 6c65 6e2b 7269 6768 745f 6d61  rc.xlen+right_ma
-0000a760: 7267 696e 5f63 616e 646c 6573 2d73 6964  rgin_candles-sid
-0000a770: 655f 6d61 7267 696e 290d 0a20 2020 2020  e_margin)..     
-0000a780: 2020 2023 2066 6574 6368 2068 692d 6c6f     # fetch hi-lo
-0000a790: 2061 6e64 2073 6574 2072 616e 6765 0d0a   and set range..
-0000a7a0: 2020 2020 2020 2020 5f2c 5f2c 6869 2c6c          _,_,hi,l
-0000a7b0: 6f2c 636e 7420 3d20 6461 7461 7372 632e  o,cnt = datasrc.
-0000a7c0: 6869 6c6f 2878 302c 2078 3129 0d0a 2020  hilo(x0, x1)..  
-0000a7d0: 2020 2020 2020 7672 203d 2073 656c 662e        vr = self.
-0000a7e0: 7669 6577 5265 6374 2829 0d0a 2020 2020  viewRect()..    
-0000a7f0: 2020 2020 6d69 6e6c 656e 203d 2069 6e74      minlen = int
-0000a800: 2828 6d61 785f 7a6f 6f6d 5f70 6f69 6e74  ((max_zoom_point
-0000a810: 732d 302e 3529 202a 2073 656c 662e 6d61  s-0.5) * self.ma
-0000a820: 785f 7a6f 6f6d 5f70 6f69 6e74 735f 6620  x_zoom_points_f 
-0000a830: 2b20 302e 3531 290d 0a20 2020 2020 2020  + 0.51)..       
-0000a840: 2069 6620 2878 312d 7830 2920 3c20 7672   if (x1-x0) < vr
-0000a850: 2e77 6964 7468 2829 2061 6e64 2063 6e74  .width() and cnt
-0000a860: 203c 206d 696e 6c65 6e3a 0d0a 2020 2020   < minlen:..    
-0000a870: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
-0000a880: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0000a890: 656c 662e 765f 6175 746f 7a6f 6f6d 3a0d  elf.v_autozoom:.
-0000a8a0: 0a20 2020 2020 2020 2020 2020 2068 6920  .            hi 
-0000a8b0: 3d20 7672 2e62 6f74 746f 6d28 290d 0a20  = vr.bottom().. 
-0000a8c0: 2020 2020 2020 2020 2020 206c 6f20 3d20             lo = 
-0000a8d0: 7672 2e74 6f70 2829 0d0a 2020 2020 2020  vr.top()..      
-0000a8e0: 2020 6966 2073 656c 662e 7973 6361 6c65    if self.yscale
-0000a8f0: 2e73 6361 6c65 7479 7065 203d 3d20 276c  .scaletype == 'l
-0000a900: 6f67 273a 0d0a 2020 2020 2020 2020 2020  og':..          
-0000a910: 2020 6966 206c 6f20 3c20 303a 0d0a 2020    if lo < 0:..  
-0000a920: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0000a930: 203d 2030 2e30 3520 2a20 7365 6c66 2e79   = 0.05 * self.y
-0000a940: 7363 616c 652e 7363 616c 6566 2023 2073  scale.scalef # s
-0000a950: 7472 616e 6765 2051 5420 6c6f 6720 7363  trange QT log sc
-0000a960: 616c 6520 7265 6e64 6572 696e 672c 2077  ale rendering, w
-0000a970: 6869 6368 2049 276d 2075 6e61 626c 6520  hich I'm unable 
-0000a980: 746f 2063 6f6d 7065 6e73 6174 6520 666f  to compensate fo
-0000a990: 720d 0a20 2020 2020 2020 2020 2020 2065  r..            e
-0000a9a0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0000a9b0: 2020 2020 2020 6c6f 203d 206d 6178 2831        lo = max(1
-0000a9c0: 652d 3130 302c 206c 6f29 0d0a 2020 2020  e-100, lo)..    
-0000a9d0: 2020 2020 2020 2020 726e 6720 3d20 2868          rng = (h
-0000a9e0: 6920 2f20 6c6f 2920 2a2a 2028 312f 7365  i / lo) ** (1/se
-0000a9f0: 6c66 2e76 5f7a 6f6f 6d5f 7363 616c 6529  lf.v_zoom_scale)
-0000aa00: 0d0a 2020 2020 2020 2020 2020 2020 726e  ..            rn
-0000aa10: 6720 3d20 6d69 6e28 726e 672c 2031 6535  g = min(rng, 1e5
-0000aa20: 3029 2023 2061 766f 6964 2066 6c6f 6174  0) # avoid float
-0000aa30: 206f 7665 7266 6c6f 770d 0a20 2020 2020   overflow..     
-0000aa40: 2020 2020 2020 2062 6173 6520 3d20 2868         base = (h
-0000aa50: 692a 6c6f 2920 2a2a 2073 656c 662e 765f  i*lo) ** self.v_
-0000aa60: 7a6f 6f6d 5f62 6173 656c 696e 650d 0a20  zoom_baseline.. 
-0000aa70: 2020 2020 2020 2020 2020 2079 3020 3d20             y0 = 
-0000aa80: 6261 7365 202f 2072 6e67 2a2a 7365 6c66  base / rng**self
-0000aa90: 2e76 5f7a 6f6f 6d5f 6261 7365 6c69 6e65  .v_zoom_baseline
-0000aaa0: 0d0a 2020 2020 2020 2020 2020 2020 7931  ..            y1
-0000aab0: 203d 2062 6173 6520 2a20 726e 672a 2a28   = base * rng**(
-0000aac0: 312d 7365 6c66 2e76 5f7a 6f6f 6d5f 6261  1-self.v_zoom_ba
-0000aad0: 7365 6c69 6e65 290d 0a20 2020 2020 2020  seline)..       
-0000aae0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000aaf0: 2020 2020 726e 6720 3d20 2868 692d 6c6f      rng = (hi-lo
-0000ab00: 2920 2f20 7365 6c66 2e76 5f7a 6f6f 6d5f  ) / self.v_zoom_
-0000ab10: 7363 616c 650d 0a20 2020 2020 2020 2020  scale..         
-0000ab20: 2020 2072 6e67 203d 206d 6178 2872 6e67     rng = max(rng
-0000ab30: 2c20 3265 2d37 2920 2320 736f 6d65 2076  , 2e-7) # some v
-0000ab40: 6572 7920 7765 6972 6420 6275 6720 7768  ery weird bug wh
-0000ab50: 6572 6520 6869 6768 2f6c 6f77 2065 7870  ere high/low exp
-0000ab60: 6f6e 656e 7473 2073 746f 7073 2072 656e  onents stops ren
-0000ab70: 6465 7269 6e67 0d0a 2020 2020 2020 2020  dering..        
-0000ab80: 2020 2020 6261 7365 203d 2028 6869 2b6c      base = (hi+l
-0000ab90: 6f29 202a 2073 656c 662e 765f 7a6f 6f6d  o) * self.v_zoom
-0000aba0: 5f62 6173 656c 696e 650d 0a20 2020 2020  _baseline..     
-0000abb0: 2020 2020 2020 2079 3020 3d20 6261 7365         y0 = base
-0000abc0: 202d 2072 6e67 2a73 656c 662e 765f 7a6f   - rng*self.v_zo
-0000abd0: 6f6d 5f62 6173 656c 696e 650d 0a20 2020  om_baseline..   
-0000abe0: 2020 2020 2020 2020 2079 3120 3d20 6261           y1 = ba
-0000abf0: 7365 202b 2072 6e67 2a28 312d 7365 6c66  se + rng*(1-self
-0000ac00: 2e76 5f7a 6f6f 6d5f 6261 7365 6c69 6e65  .v_zoom_baseline
-0000ac10: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-0000ac20: 7420 7365 6c66 2e78 5f69 6e64 6578 6564  t self.x_indexed
-0000ac30: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
-0000ac40: 302c 7831 203d 205f 786d 696e 6d61 7828  0,x1 = _xminmax(
-0000ac50: 6461 7461 7372 632c 2078 5f69 6e64 6578  datasrc, x_index
-0000ac60: 6564 3d46 616c 7365 2c20 6578 7472 615f  ed=False, extra_
-0000ac70: 6d61 7267 696e 3d30 290d 0a20 2020 2020  margin=0)..     
-0000ac80: 2020 2072 6574 7572 6e20 7365 6c66 2e73     return self.s
-0000ac90: 6574 5f72 616e 6765 2878 302c 2079 302c  et_range(x0, y0,
-0000aca0: 2078 312c 2079 3129 0d0a 0d0a 2020 2020   x1, y1)....    
-0000acb0: 6465 6620 7365 745f 7261 6e67 6528 7365  def set_range(se
-0000acc0: 6c66 2c20 7830 2c20 7930 2c20 7831 2c20  lf, x0, y0, x1, 
-0000acd0: 7931 293a 0d0a 2020 2020 2020 2020 6966  y1):..        if
-0000ace0: 2078 3020 6973 204e 6f6e 6520 6f72 2078   x0 is None or x
-0000acf0: 3120 6973 204e 6f6e 653a 0d0a 2020 2020  1 is None:..    
-0000ad00: 2020 2020 2020 2020 7472 203d 2073 656c          tr = sel
-0000ad10: 662e 7461 7267 6574 5265 6374 2829 0d0a  f.targetRect()..
-0000ad20: 2020 2020 2020 2020 2020 2020 7830 203d              x0 =
-0000ad30: 2074 722e 6c65 6674 2829 0d0a 2020 2020   tr.left()..    
-0000ad40: 2020 2020 2020 2020 7831 203d 2074 722e          x1 = tr.
-0000ad50: 7269 6768 7428 290d 0a20 2020 2020 2020  right()..       
-0000ad60: 2069 6620 6e70 2e69 736e 616e 2879 3029   if np.isnan(y0)
-0000ad70: 206f 7220 6e70 2e69 736e 616e 2879 3129   or np.isnan(y1)
-0000ad80: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0000ad90: 6574 7572 6e0d 0a20 2020 2020 2020 205f  eturn..        _
-0000ada0: 7930 203d 2073 656c 662e 7973 6361 6c65  y0 = self.yscale
-0000adb0: 2e69 6e76 7866 6f72 6d28 7930 2c20 7665  .invxform(y0, ve
-0000adc0: 7269 6679 3d54 7275 6529 0d0a 2020 2020  rify=True)..    
-0000add0: 2020 2020 5f79 3120 3d20 7365 6c66 2e79      _y1 = self.y
-0000ade0: 7363 616c 652e 696e 7678 666f 726d 2879  scale.invxform(y
-0000adf0: 312c 2076 6572 6966 793d 5472 7565 290d  1, verify=True).
-0000ae00: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
-0000ae10: 7452 616e 6765 2851 7443 6f72 652e 5152  tRange(QtCore.QR
-0000ae20: 6563 7446 2870 672e 506f 696e 7428 7830  ectF(pg.Point(x0
-0000ae30: 2c20 5f79 3029 2c20 7067 2e50 6f69 6e74  , _y0), pg.Point
-0000ae40: 2878 312c 205f 7931 2929 2c20 7061 6464  (x1, _y1)), padd
-0000ae50: 696e 673d 3029 0d0a 2020 2020 2020 2020  ing=0)..        
-0000ae60: 7365 6c66 2e7a 6f6f 6d5f 6368 616e 6765  self.zoom_change
-0000ae70: 6428 290d 0a20 2020 2020 2020 2072 6574  d()..        ret
-0000ae80: 7572 6e20 5472 7565 0d0a 0d0a 2020 2020  urn True....    
-0000ae90: 6465 6620 7265 6d6f 7665 5f6c 6173 745f  def remove_last_
-0000aea0: 726f 6928 7365 6c66 293a 0d0a 2020 2020  roi(self):..    
-0000aeb0: 2020 2020 6966 2073 656c 662e 726f 6973      if self.rois
-0000aec0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0000aed0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0000aee0: 2873 656c 662e 726f 6973 5b2d 315d 2c20  (self.rois[-1], 
-0000aef0: 7067 2e50 6f6c 794c 696e 6552 4f49 293a  pg.PolyLineROI):
-0000af00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000af10: 2020 7365 6c66 2e72 656d 6f76 6549 7465    self.removeIte
-0000af20: 6d28 7365 6c66 2e72 6f69 735b 2d31 5d29  m(self.rois[-1])
-0000af30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000af40: 2020 7365 6c66 2e72 6f69 7320 3d20 7365    self.rois = se
-0000af50: 6c66 2e72 6f69 735b 3a2d 315d 0d0a 2020  lf.rois[:-1]..  
-0000af60: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0000af70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000af80: 2068 203d 2073 656c 662e 726f 6973 5b2d   h = self.rois[-
-0000af90: 315d 2e68 616e 646c 6573 5b2d 315d 5b27  1].handles[-1]['
-0000afa0: 6974 656d 275d 0d0a 2020 2020 2020 2020  item']..        
-0000afb0: 2020 2020 2020 2020 7365 6c66 2e72 6f69          self.roi
-0000afc0: 735b 2d31 5d2e 7265 6d6f 7665 4861 6e64  s[-1].removeHand
-0000afd0: 6c65 2868 290d 0a20 2020 2020 2020 2020  le(h)..         
-0000afe0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-0000aff0: 6c66 2e72 6f69 735b 2d31 5d2e 7365 676d  lf.rois[-1].segm
-0000b000: 656e 7473 3a0d 0a20 2020 2020 2020 2020  ents:..         
-0000b010: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b020: 7265 6d6f 7665 4974 656d 2873 656c 662e  removeItem(self.
-0000b030: 726f 6973 5b2d 315d 290d 0a20 2020 2020  rois[-1])..     
-0000b040: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b050: 656c 662e 726f 6973 203d 2073 656c 662e  elf.rois = self.
-0000b060: 726f 6973 5b3a 2d31 5d0d 0a20 2020 2020  rois[:-1]..     
-0000b070: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b080: 656c 662e 6472 6177 5f6c 696e 6520 3d20  elf.draw_line = 
-0000b090: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-0000b0a0: 2020 6966 2073 656c 662e 726f 6973 3a0d    if self.rois:.
-0000b0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b0c0: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
-0000b0d0: 656c 662e 726f 6973 5b2d 315d 2c20 7067  elf.rois[-1], pg
-0000b0e0: 2e50 6f6c 794c 696e 6552 4f49 293a 0d0a  .PolyLineROI):..
-0000b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b100: 2020 2020 7365 6c66 2e64 7261 775f 6c69      self.draw_li
-0000b110: 6e65 203d 2073 656c 662e 726f 6973 5b2d  ne = self.rois[-
-0000b120: 315d 0d0a 2020 2020 2020 2020 2020 2020  1]..            
-0000b130: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-0000b140: 5f64 7261 775f 6c69 6e65 5f63 6f6c 6f72  _draw_line_color
-0000b150: 2864 7261 775f 6c69 6e65 5f63 6f6c 6f72  (draw_line_color
-0000b160: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-0000b170: 6574 7572 6e20 5472 7565 0d0a 0d0a 2020  eturn True....  
-0000b180: 2020 6465 6620 6170 7065 6e64 5f64 7261    def append_dra
-0000b190: 775f 7365 676d 656e 7428 7365 6c66 2c20  w_segment(self, 
-0000b1a0: 7029 3a0d 0a20 2020 2020 2020 2068 3020  p):..        h0 
-0000b1b0: 3d20 7365 6c66 2e64 7261 775f 6c69 6e65  = self.draw_line
-0000b1c0: 2e68 616e 646c 6573 5b2d 315d 5b27 6974  .handles[-1]['it
-0000b1d0: 656d 275d 0d0a 2020 2020 2020 2020 6831  em']..        h1
-0000b1e0: 203d 2073 656c 662e 6472 6177 5f6c 696e   = self.draw_lin
-0000b1f0: 652e 6164 6446 7265 6548 616e 646c 6528  e.addFreeHandle(
-0000b200: 7029 0d0a 2020 2020 2020 2020 7365 6c66  p)..        self
-0000b210: 2e64 7261 775f 6c69 6e65 2e61 6464 5365  .draw_line.addSe
-0000b220: 676d 656e 7428 6830 2c20 6831 290d 0a20  gment(h0, h1).. 
-0000b230: 2020 2020 2020 2073 656c 662e 6472 6177         self.draw
-0000b240: 696e 6720 3d20 5472 7565 0d0a 0d0a 2020  ing = True....  
-0000b250: 2020 6465 6620 7365 745f 6472 6177 5f6c    def set_draw_l
-0000b260: 696e 655f 636f 6c6f 7228 7365 6c66 2c20  ine_color(self, 
-0000b270: 636f 6c6f 7229 3a0d 0a20 2020 2020 2020  color):..       
-0000b280: 2069 6620 7365 6c66 2e64 7261 775f 6c69   if self.draw_li
-0000b290: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0000b2a0: 2070 656e 203d 2070 672e 6d6b 5065 6e28   pen = pg.mkPen(
-0000b2b0: 636f 6c6f 7229 0d0a 2020 2020 2020 2020  color)..        
-0000b2c0: 2020 2020 666f 7220 7365 676d 656e 7420      for segment 
-0000b2d0: 696e 2073 656c 662e 6472 6177 5f6c 696e  in self.draw_lin
-0000b2e0: 652e 7365 676d 656e 7473 3a0d 0a20 2020  e.segments:..   
-0000b2f0: 2020 2020 2020 2020 2020 2020 2073 6567               seg
-0000b300: 6d65 6e74 2e63 7572 7265 6e74 5065 6e20  ment.currentPen 
-0000b310: 3d20 7365 676d 656e 742e 7065 6e20 3d20  = segment.pen = 
-0000b320: 7065 6e0d 0a20 2020 2020 2020 2020 2020  pen..           
-0000b330: 2020 2020 2073 6567 6d65 6e74 2e75 7064       segment.upd
-0000b340: 6174 6528 290d 0a0d 0a20 2020 2064 6566  ate()....    def
-0000b350: 2073 7567 6765 7374 5061 6464 696e 6728   suggestPadding(
-0000b360: 7365 6c66 2c20 6178 6973 293a 0d0a 2020  self, axis):..  
-0000b370: 2020 2020 2020 7265 7475 726e 2030 0d0a        return 0..
-0000b380: 0d0a 2020 2020 6465 6620 7a6f 6f6d 5f63  ..    def zoom_c
-0000b390: 6861 6e67 6564 2873 656c 6629 3a0d 0a20  hanged(self):.. 
-0000b3a0: 2020 2020 2020 2066 6f72 207a 6c20 696e         for zl in
-0000b3b0: 2073 656c 662e 7a6f 6f6d 5f6c 6973 7465   self.zoom_liste
-0000b3c0: 6e65 7273 3a0d 0a20 2020 2020 2020 2020  ners:..         
-0000b3d0: 2020 207a 6c28 7365 6c66 290d 0a0d 0a0d     zl(self).....
-0000b3e0: 0a0d 0a63 6c61 7373 2046 696e 506c 6f74  ...class FinPlot
-0000b3f0: 4974 656d 2870 672e 4772 6170 6869 6373  Item(pg.Graphics
-0000b400: 4f62 6a65 6374 293a 0d0a 2020 2020 6465  Object):..    de
-0000b410: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0000b420: 2061 782c 2064 6174 6173 7263 2c20 6c6f   ax, datasrc, lo
-0000b430: 6429 3a0d 0a20 2020 2020 2020 2073 7570  d):..        sup
-0000b440: 6572 2829 2e5f 5f69 6e69 745f 5f28 290d  er().__init__().
-0000b450: 0a20 2020 2020 2020 2073 656c 662e 6178  .        self.ax
-0000b460: 203d 2061 780d 0a20 2020 2020 2020 2073   = ax..        s
-0000b470: 656c 662e 6461 7461 7372 6320 3d20 6461  elf.datasrc = da
-0000b480: 7461 7372 630d 0a20 2020 2020 2020 2073  tasrc..        s
-0000b490: 656c 662e 7069 6374 7572 6520 3d20 5174  elf.picture = Qt
-0000b4a0: 4775 692e 5150 6963 7475 7265 2829 0d0a  Gui.QPicture()..
-0000b4b0: 2020 2020 2020 2020 7365 6c66 2e70 6169          self.pai
-0000b4c0: 6e74 6572 203d 2051 7447 7569 2e51 5061  nter = QtGui.QPa
-0000b4d0: 696e 7465 7228 290d 0a20 2020 2020 2020  inter()..       
-0000b4e0: 2073 656c 662e 6469 7274 7920 3d20 5472   self.dirty = Tr
-0000b4f0: 7565 0d0a 2020 2020 2020 2020 7365 6c66  ue..        self
-0000b500: 2e6c 6f64 203d 206c 6f64 0d0a 2020 2020  .lod = lod..    
-0000b510: 2020 2020 7365 6c66 2e63 6163 6865 6452      self.cachedR
-0000b520: 6563 7420 3d20 4e6f 6e65 0d0a 0d0a 2020  ect = None....  
-0000b530: 2020 6465 6620 7265 7061 696e 7428 7365    def repaint(se
-0000b540: 6c66 293a 0d0a 2020 2020 2020 2020 7365  lf):..        se
-0000b550: 6c66 2e64 6972 7479 203d 2054 7275 650d  lf.dirty = True.
-0000b560: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-0000b570: 696e 7428 4e6f 6e65 290d 0a0d 0a20 2020  int(None)....   
-0000b580: 2064 6566 2070 6169 6e74 2873 656c 662c   def paint(self,
-0000b590: 2070 2c20 2a61 7267 7329 3a0d 0a20 2020   p, *args):..   
-0000b5a0: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
-0000b5b0: 6173 7263 2e69 735f 7370 6172 7365 3a0d  asrc.is_sparse:.
-0000b5c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000b5d0: 662e 6469 7274 7920 3d20 5472 7565 0d0a  f.dirty = True..
-0000b5e0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-0000b5f0: 6174 655f 6469 7274 795f 7069 6374 7572  ate_dirty_pictur
-0000b600: 6528 7365 6c66 2e76 6965 7752 6563 7428  e(self.viewRect(
-0000b610: 2929 0d0a 2020 2020 2020 2020 6966 2070  ))..        if p
-0000b620: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0000b630: 2020 2020 2020 2020 2020 2070 2e64 7261             p.dra
-0000b640: 7750 6963 7475 7265 2830 2c20 302c 2073  wPicture(0, 0, s
-0000b650: 656c 662e 7069 6374 7572 6529 0d0a 0d0a  elf.picture)....
-0000b660: 2020 2020 6465 6620 7570 6461 7465 5f64      def update_d
-0000b670: 6972 7479 5f70 6963 7475 7265 2873 656c  irty_picture(sel
-0000b680: 662c 2076 6973 6962 6c65 5265 6374 293a  f, visibleRect):
-0000b690: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000b6a0: 662e 6469 7274 7920 6f72 205c 0d0a 2020  f.dirty or \..  
-0000b6b0: 2020 2020 2020 2020 2020 2873 656c 662e            (self.
-0000b6c0: 6c6f 6420 616e 6420 2320 7265 6765 6e65  lod and # regene
-0000b6d0: 7261 7465 2077 6865 6e20 7a6f 6f6d 2063  rate when zoom c
-0000b6e0: 6861 6e67 6573 3f0d 0a20 2020 2020 2020  hanges?..       
-0000b6f0: 2020 2020 2020 2020 2028 7669 7369 626c           (visibl
-0000b700: 6552 6563 742e 6c65 6674 2829 203c 2073  eRect.left() < s
-0000b710: 656c 662e 6361 6368 6564 5265 6374 2e6c  elf.cachedRect.l
-0000b720: 6566 7428 2920 6f72 205c 0d0a 2020 2020  eft() or \..    
-0000b730: 2020 2020 2020 2020 2020 2020 2076 6973               vis
-0000b740: 6962 6c65 5265 6374 2e72 6967 6874 2829  ibleRect.right()
-0000b750: 203e 2073 656c 662e 6361 6368 6564 5265   > self.cachedRe
-0000b760: 6374 2e72 6967 6874 2829 206f 7220 5c0d  ct.right() or \.
-0000b770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b780: 2020 7669 7369 626c 6552 6563 742e 7769    visibleRect.wi
-0000b790: 6474 6828 2920 3c20 7365 6c66 2e63 6163  dth() < self.cac
-0000b7a0: 6865 6452 6563 742e 7769 6474 6828 2920  hedRect.width() 
-0000b7b0: 2f20 6361 6368 655f 6361 6e64 6c65 5f66  / cache_candle_f
-0000b7c0: 6163 746f 7229 293a 2023 206f 7074 696d  actor)): # optim
-0000b7d0: 697a 6520 7768 656e 207a 6f6f 6d69 6e67  ize when zooming
-0000b7e0: 2069 6e0d 0a20 2020 2020 2020 2020 2020   in..           
-0000b7f0: 2073 656c 662e 5f67 656e 6572 6174 655f   self._generate_
-0000b800: 7069 6374 7572 6528 7669 7369 626c 6552  picture(visibleR
-0000b810: 6563 7429 0d0a 0d0a 2020 2020 6465 6620  ect)....    def 
-0000b820: 5f67 656e 6572 6174 655f 7069 6374 7572  _generate_pictur
-0000b830: 6528 7365 6c66 2c20 626f 756e 6469 6e67  e(self, bounding
-0000b840: 5265 6374 293a 0d0a 2020 2020 2020 2020  Rect):..        
-0000b850: 7720 3d20 626f 756e 6469 6e67 5265 6374  w = boundingRect
-0000b860: 2e77 6964 7468 2829 0d0a 2020 2020 2020  .width()..      
-0000b870: 2020 7365 6c66 2e63 6163 6865 6452 6563    self.cachedRec
-0000b880: 7420 3d20 5174 436f 7265 2e51 5265 6374  t = QtCore.QRect
-0000b890: 4628 626f 756e 6469 6e67 5265 6374 2e6c  F(boundingRect.l
-0000b8a0: 6566 7428 292d 2863 6163 6865 5f63 616e  eft()-(cache_can
-0000b8b0: 646c 655f 6661 6374 6f72 2d31 292a 302e  dle_factor-1)*0.
-0000b8c0: 352a 772c 2030 2c20 6361 6368 655f 6361  5*w, 0, cache_ca
-0000b8d0: 6e64 6c65 5f66 6163 746f 722a 772c 2030  ndle_factor*w, 0
-0000b8e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0000b8f0: 7061 696e 7465 722e 6265 6769 6e28 7365  painter.begin(se
-0000b900: 6c66 2e70 6963 7475 7265 290d 0a20 2020  lf.picture)..   
-0000b910: 2020 2020 2073 656c 662e 5f67 656e 6572       self._gener
-0000b920: 6174 655f 6475 6d6d 795f 7069 6374 7572  ate_dummy_pictur
-0000b930: 6528 7365 6c66 2e76 6965 7752 6563 7428  e(self.viewRect(
-0000b940: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
-0000b950: 2e67 656e 6572 6174 655f 7069 6374 7572  .generate_pictur
-0000b960: 6528 7365 6c66 2e63 6163 6865 6452 6563  e(self.cachedRec
-0000b970: 7429 0d0a 2020 2020 2020 2020 7365 6c66  t)..        self
-0000b980: 2e70 6169 6e74 6572 2e65 6e64 2829 0d0a  .painter.end()..
-0000b990: 2020 2020 2020 2020 7365 6c66 2e64 6972          self.dir
-0000b9a0: 7479 203d 2046 616c 7365 0d0a 0d0a 2020  ty = False....  
-0000b9b0: 2020 6465 6620 5f67 656e 6572 6174 655f    def _generate_
-0000b9c0: 6475 6d6d 795f 7069 6374 7572 6528 7365  dummy_picture(se
-0000b9d0: 6c66 2c20 626f 756e 6469 6e67 5265 6374  lf, boundingRect
-0000b9e0: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
-0000b9f0: 656c 662e 6461 7461 7372 632e 6973 5f73  elf.datasrc.is_s
-0000ba00: 7061 7273 653a 0d0a 2020 2020 2020 2020  parse:..        
-0000ba10: 2020 2020 2320 6a75 7374 2064 7261 7720      # just draw 
-0000ba20: 736f 6d65 7468 696e 6720 746f 2065 6e73  something to ens
-0000ba30: 7572 6520 5079 5174 2077 696c 6c20 7061  ure PyQt will pa
-0000ba40: 696e 7420 7573 2061 6761 696e 0d0a 2020  int us again..  
-0000ba50: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000ba60: 6169 6e74 6572 2e73 6574 5065 6e28 7067  ainter.setPen(pg
-0000ba70: 2e6d 6b50 656e 2862 6163 6b67 726f 756e  .mkPen(backgroun
-0000ba80: 6429 290d 0a20 2020 2020 2020 2020 2020  d))..           
-0000ba90: 2073 656c 662e 7061 696e 7465 722e 7365   self.painter.se
-0000baa0: 7442 7275 7368 2870 672e 6d6b 4272 7573  tBrush(pg.mkBrus
-0000bab0: 6828 6261 636b 6772 6f75 6e64 2929 0d0a  h(background))..
-0000bac0: 2020 2020 2020 2020 2020 2020 6c2c 7220              l,r 
-0000bad0: 3d20 626f 756e 6469 6e67 5265 6374 2e6c  = boundingRect.l
-0000bae0: 6566 7428 292c 2062 6f75 6e64 696e 6752  eft(), boundingR
-0000baf0: 6563 742e 7269 6768 7428 290d 0a20 2020  ect.right()..   
-0000bb00: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-0000bb10: 696e 7465 722e 6472 6177 5265 6374 2851  inter.drawRect(Q
-0000bb20: 7443 6f72 652e 5152 6563 7446 286c 2c20  tCore.QRectF(l, 
-0000bb30: 626f 756e 6469 6e67 5265 6374 2e74 6f70  boundingRect.top
-0000bb40: 2829 2c20 3165 2d33 2c20 626f 756e 6469  (), 1e-3, boundi
-0000bb50: 6e67 5265 6374 2e68 6569 6768 7428 292a  ngRect.height()*
-0000bb60: 3165 2d35 2929 0d0a 2020 2020 2020 2020  1e-5))..        
-0000bb70: 2020 2020 7365 6c66 2e70 6169 6e74 6572      self.painter
-0000bb80: 2e64 7261 7752 6563 7428 5174 436f 7265  .drawRect(QtCore
-0000bb90: 2e51 5265 6374 4628 722c 2062 6f75 6e64  .QRectF(r, bound
-0000bba0: 696e 6752 6563 742e 626f 7474 6f6d 2829  ingRect.bottom()
-0000bbb0: 2c20 2d31 652d 332c 202d 626f 756e 6469  , -1e-3, -boundi
-0000bbc0: 6e67 5265 6374 2e68 6569 6768 7428 292a  ngRect.height()*
-0000bbd0: 3165 2d35 2929 0d0a 0d0a 2020 2020 6465  1e-5))....    de
-0000bbe0: 6620 626f 756e 6469 6e67 5265 6374 2873  f boundingRect(s
-0000bbf0: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
-0000bc00: 6574 7572 6e20 5174 436f 7265 2e51 5265  eturn QtCore.QRe
-0000bc10: 6374 4628 7365 6c66 2e70 6963 7475 7265  ctF(self.picture
-0000bc20: 2e62 6f75 6e64 696e 6752 6563 7428 2929  .boundingRect())
-0000bc30: 0d0a 0d0a 0d0a 0d0a 636c 6173 7320 4361  ........class Ca
-0000bc40: 6e64 6c65 7374 6963 6b49 7465 6d28 4669  ndlestickItem(Fi
-0000bc50: 6e50 6c6f 7449 7465 6d29 3a0d 0a20 2020  nPlotItem):..   
-0000bc60: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-0000bc70: 6c66 2c20 6178 2c20 6461 7461 7372 632c  lf, ax, datasrc,
-0000bc80: 2064 7261 775f 626f 6479 2c20 6472 6177   draw_body, draw
-0000bc90: 5f73 6861 646f 772c 2063 616e 646c 655f  _shadow, candle_
-0000bca0: 7769 6474 682c 2063 6f6c 6f72 6675 6e63  width, colorfunc
-0000bcb0: 2c20 7265 7361 6d70 3d4e 6f6e 6529 3a0d  , resamp=None):.
-0000bcc0: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-0000bcd0: 6c6f 7273 203d 2064 6963 7428 6275 6c6c  lors = dict(bull
-0000bce0: 5f73 6861 646f 7720 2020 2020 203d 2063  _shadow      = c
-0000bcf0: 616e 646c 655f 6275 6c6c 5f63 6f6c 6f72  andle_bull_color
-0000bd00: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000bd10: 2020 2020 2020 2020 2020 2020 2020 6275                bu
-0000bd20: 6c6c 5f66 7261 6d65 2020 2020 2020 203d  ll_frame       =
-0000bd30: 2063 616e 646c 655f 6275 6c6c 5f63 6f6c   candle_bull_col
-0000bd40: 6f72 2c0d 0a20 2020 2020 2020 2020 2020  or,..           
-0000bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd60: 6275 6c6c 5f62 6f64 7920 2020 2020 2020  bull_body       
-0000bd70: 203d 2063 616e 646c 655f 6275 6c6c 5f62   = candle_bull_b
-0000bd80: 6f64 795f 636f 6c6f 722c 0d0a 2020 2020  ody_color,..    
-0000bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bda0: 2020 2020 2020 2062 6561 725f 7368 6164         bear_shad
-0000bdb0: 6f77 2020 2020 2020 3d20 6361 6e64 6c65  ow      = candle
-0000bdc0: 5f62 6561 725f 636f 6c6f 722c 0d0a 2020  _bear_color,..  
-0000bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bde0: 2020 2020 2020 2020 2062 6561 725f 6672           bear_fr
-0000bdf0: 616d 6520 2020 2020 2020 3d20 6361 6e64  ame       = cand
-0000be00: 6c65 5f62 6561 725f 636f 6c6f 722c 0d0a  le_bear_color,..
-0000be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be20: 2020 2020 2020 2020 2020 2062 6561 725f             bear_
-0000be30: 626f 6479 2020 2020 2020 2020 3d20 6361  body        = ca
-0000be40: 6e64 6c65 5f62 6561 725f 626f 6479 5f63  ndle_bear_body_c
-0000be50: 6f6c 6f72 2c0d 0a20 2020 2020 2020 2020  olor,..         
+00008140: 6466 203d 2073 656c 662e 6461 7461 7372  df = self.datasr
+00008150: 632e 6466 2e69 6c6f 635b 3a2c 2073 656c  c.df.iloc[:, sel
+00008160: 662e 6461 7461 7372 632e 7363 616c 655f  f.datasrc.scale_
+00008170: 636f 6c73 5d0d 0a20 2020 2020 2020 2020  cols]..         
+00008180: 2020 2073 656c 662e 795f 6d61 7820 3d20     self.y_max = 
+00008190: 6466 2e6d 6178 2829 2e6d 6178 2829 0d0a  df.max().max()..
+000081a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000081b0: 2e79 5f6d 696e 203d 2064 662e 6d69 6e28  .y_min = df.min(
+000081c0: 292e 6d69 6e28 290d 0a20 2020 2020 2020  ).min()..       
+000081d0: 2020 2020 2069 6620 7365 6c66 2e79 5f6d       if self.y_m
+000081e0: 696e 203c 3d20 303a 0d0a 2020 2020 2020  in <= 0:..      
+000081f0: 2020 2020 2020 2020 2020 7365 6c66 2e79            self.y
+00008200: 5f70 6f73 6974 6976 6520 3d20 4661 6c73  _positive = Fals
+00008210: 650d 0a0d 0a20 2020 2040 7072 6f70 6572  e....    @proper
+00008220: 7479 0d0a 2020 2020 6465 6620 6461 7461  ty..    def data
+00008230: 7372 635f 6f72 5f73 7461 6e64 616c 6f6e  src_or_standalon
+00008240: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
+00008250: 2020 6473 203d 2073 656c 662e 6461 7461    ds = self.data
+00008260: 7372 630d 0a20 2020 2020 2020 2069 6620  src..        if 
+00008270: 6e6f 7420 6473 2061 6e64 2073 656c 662e  not ds and self.
+00008280: 7374 616e 6461 6c6f 6e65 733a 0d0a 2020  standalones:..  
+00008290: 2020 2020 2020 2020 2020 6473 203d 206e            ds = n
+000082a0: 6578 7428 6974 6572 2873 656c 662e 7374  ext(iter(self.st
+000082b0: 616e 6461 6c6f 6e65 7329 290d 0a20 2020  andalones))..   
+000082c0: 2020 2020 2072 6574 7572 6e20 6473 0d0a       return ds..
+000082d0: 0d0a 2020 2020 6465 6620 7768 6565 6c45  ..    def wheelE
+000082e0: 7665 6e74 2873 656c 662c 2065 762c 2061  vent(self, ev, a
+000082f0: 7869 733d 4e6f 6e65 293a 0d0a 2020 2020  xis=None):..    
+00008300: 2020 2020 6966 2073 656c 662e 6d61 7374      if self.mast
+00008310: 6572 5f76 6965 7762 6f78 3a0d 0a20 2020  er_viewbox:..   
+00008320: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00008330: 7365 6c66 2e6d 6173 7465 725f 7669 6577  self.master_view
+00008340: 626f 782e 7768 6565 6c45 7665 6e74 2865  box.wheelEvent(e
+00008350: 762c 2061 7869 733d 6178 6973 290d 0a20  v, axis=axis).. 
+00008360: 2020 2020 2020 2069 6620 6576 2e6d 6f64         if ev.mod
+00008370: 6966 6965 7273 2829 203d 3d20 5174 436f  ifiers() == QtCo
+00008380: 7265 2e51 742e 4b65 7962 6f61 7264 4d6f  re.Qt.KeyboardMo
+00008390: 6469 6669 6572 2e43 6f6e 7472 6f6c 4d6f  difier.ControlMo
+000083a0: 6469 6669 6572 3a0d 0a20 2020 2020 2020  difier:..       
+000083b0: 2020 2020 2073 6361 6c65 5f66 6163 7420       scale_fact 
+000083c0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+000083d0: 2073 656c 662e 765f 7a6f 6f6d 5f73 6361   self.v_zoom_sca
+000083e0: 6c65 202f 3d20 312e 3032 202a 2a20 2865  le /= 1.02 ** (e
+000083f0: 762e 6465 6c74 6128 2920 2a20 7365 6c66  v.delta() * self
+00008400: 2e73 7461 7465 5b27 7768 6565 6c53 6361  .state['wheelSca
+00008410: 6c65 4661 6374 6f72 275d 290d 0a20 2020  leFactor'])..   
+00008420: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00008430: 2020 2020 2020 2020 7363 616c 655f 6661          scale_fa
+00008440: 6374 203d 2031 2e30 3220 2a2a 2028 6576  ct = 1.02 ** (ev
+00008450: 2e64 656c 7461 2829 202a 2073 656c 662e  .delta() * self.
+00008460: 7374 6174 655b 2777 6865 656c 5363 616c  state['wheelScal
+00008470: 6546 6163 746f 7227 5d29 0d0a 2020 2020  eFactor'])..    
+00008480: 2020 2020 7672 203d 2073 656c 662e 7461      vr = self.ta
+00008490: 7267 6574 5265 6374 2829 0d0a 2020 2020  rgetRect()..    
+000084a0: 2020 2020 6365 6e74 6572 203d 2073 656c      center = sel
+000084b0: 662e 6d61 7054 6f56 6965 7728 6576 2e73  f.mapToView(ev.s
+000084c0: 6365 6e65 506f 7328 2929 0d0a 2020 2020  cenePos())..    
+000084d0: 2020 2020 7063 745f 7820 3d20 2863 656e      pct_x = (cen
+000084e0: 7465 722e 7828 292d 7672 2e6c 6566 7428  ter.x()-vr.left(
+000084f0: 2929 202f 2076 722e 7769 6474 6828 290d  )) / vr.width().
+00008500: 0a20 2020 2020 2020 2069 6620 7063 745f  .        if pct_
+00008510: 7820 3c20 302e 3035 3a20 2320 7a6f 6f6d  x < 0.05: # zoom
+00008520: 2074 6f20 6661 7220 6c65 6674 203d 3e20   to far left => 
+00008530: 616c 6c20 7468 6520 7761 7920 6c65 6674  all the way left
+00008540: 0d0a 2020 2020 2020 2020 2020 2020 6365  ..            ce
+00008550: 6e74 6572 203d 2070 672e 506f 696e 7428  nter = pg.Point(
+00008560: 7672 2e6c 6566 7428 292c 2063 656e 7465  vr.left(), cente
+00008570: 722e 7928 2929 0d0a 2020 2020 2020 2020  r.y())..        
+00008580: 656c 6966 2070 6374 5f78 203e 2030 2e39  elif pct_x > 0.9
+00008590: 353a 2023 207a 6f6f 6d20 746f 2066 6172  5: # zoom to far
+000085a0: 2072 6967 6874 203d 3e20 616c 6c20 7468   right => all th
+000085b0: 6520 7761 7920 7269 6768 740d 0a20 2020  e way right..   
+000085c0: 2020 2020 2020 2020 2063 656e 7465 7220           center 
+000085d0: 3d20 7067 2e50 6f69 6e74 2876 722e 7269  = pg.Point(vr.ri
+000085e0: 6768 7428 292c 2063 656e 7465 722e 7928  ght(), center.y(
+000085f0: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
+00008600: 2e7a 6f6f 6d5f 7265 6374 2876 722c 2073  .zoom_rect(vr, s
+00008610: 6361 6c65 5f66 6163 742c 2063 656e 7465  cale_fact, cente
+00008620: 7229 0d0a 2020 2020 2020 2020 2320 7570  r)..        # up
+00008630: 6461 7465 2063 726f 7373 6861 6972 0d0a  date crosshair..
+00008640: 2020 2020 2020 2020 5f6d 6f75 7365 5f6d          _mouse_m
+00008650: 6f76 6564 2873 656c 662e 7769 6e2c 2073  oved(self.win, s
+00008660: 656c 662c 204e 6f6e 6529 0d0a 2020 2020  elf, None)..    
+00008670: 2020 2020 6576 2e61 6363 6570 7428 290d      ev.accept().
+00008680: 0a0d 0a20 2020 2064 6566 206d 6f75 7365  ...    def mouse
+00008690: 4472 6167 4576 656e 7428 7365 6c66 2c20  DragEvent(self, 
+000086a0: 6576 2c20 6178 6973 3d4e 6f6e 6529 3a0d  ev, axis=None):.
+000086b0: 0a20 2020 2020 2020 2061 7869 7320 3d20  .        axis = 
+000086c0: 3020 2320 646f 6e27 7420 636f 6e73 7472  0 # don't constr
+000086d0: 6169 6e20 6472 6167 2064 6972 6563 7469  ain drag directi
+000086e0: 6f6e 0d0a 2020 2020 2020 2020 6966 2073  on..        if s
+000086f0: 656c 662e 6d61 7374 6572 5f76 6965 7762  elf.master_viewb
+00008700: 6f78 3a0d 0a20 2020 2020 2020 2020 2020  ox:..           
+00008710: 2072 6574 7572 6e20 7365 6c66 2e6d 6173   return self.mas
+00008720: 7465 725f 7669 6577 626f 782e 6d6f 7573  ter_viewbox.mous
+00008730: 6544 7261 6745 7665 6e74 2865 762c 2061  eDragEvent(ev, a
+00008740: 7869 733d 6178 6973 290d 0a20 2020 2020  xis=axis)..     
+00008750: 2020 2069 6620 6e6f 7420 7365 6c66 2e64     if not self.d
+00008760: 6174 6173 7263 3a0d 0a20 2020 2020 2020  atasrc:..       
+00008770: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
+00008780: 2020 2020 2069 6620 6576 2e62 7574 746f       if ev.butto
+00008790: 6e28 2920 3d3d 2051 7443 6f72 652e 5174  n() == QtCore.Qt
+000087a0: 2e4d 6f75 7365 4275 7474 6f6e 2e4c 6566  .MouseButton.Lef
+000087b0: 7442 7574 746f 6e3a 0d0a 2020 2020 2020  tButton:..      
+000087c0: 2020 2020 2020 7365 6c66 2e6d 6f75 7365        self.mouse
+000087d0: 4c65 6674 4472 6167 2865 762c 2061 7869  LeftDrag(ev, axi
+000087e0: 7329 0d0a 2020 2020 2020 2020 656c 6966  s)..        elif
+000087f0: 2065 762e 6275 7474 6f6e 2829 203d 3d20   ev.button() == 
+00008800: 5174 436f 7265 2e51 742e 4d6f 7573 6542  QtCore.Qt.MouseB
+00008810: 7574 746f 6e2e 4d69 6464 6c65 4275 7474  utton.MiddleButt
+00008820: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
+00008830: 2073 656c 662e 6d6f 7573 654d 6964 646c   self.mouseMiddl
+00008840: 6544 7261 6728 6576 2c20 6178 6973 290d  eDrag(ev, axis).
+00008850: 0a20 2020 2020 2020 2065 6c69 6620 6576  .        elif ev
+00008860: 2e62 7574 746f 6e28 2920 3d3d 2051 7443  .button() == QtC
+00008870: 6f72 652e 5174 2e4d 6f75 7365 4275 7474  ore.Qt.MouseButt
+00008880: 6f6e 2e52 6967 6874 4275 7474 6f6e 3a0d  on.RightButton:.
+00008890: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000088a0: 662e 6d6f 7573 6552 6967 6874 4472 6167  f.mouseRightDrag
+000088b0: 2865 762c 2061 7869 7329 0d0a 2020 2020  (ev, axis)..    
+000088c0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000088d0: 2020 2020 2020 2073 7570 6572 2829 2e6d         super().m
+000088e0: 6f75 7365 4472 6167 4576 656e 7428 6576  ouseDragEvent(ev
+000088f0: 2c20 6178 6973 290d 0a0d 0a20 2020 2064  , axis)....    d
+00008900: 6566 206d 6f75 7365 4c65 6674 4472 6167  ef mouseLeftDrag
+00008910: 2873 656c 662c 2065 762c 2061 7869 7329  (self, ev, axis)
+00008920: 3a0d 0a20 2020 2020 2020 2027 2727 4374  :..        '''Ct
+00008930: 726c 2b4c 4275 7474 6f6e 2064 7261 7720  rl+LButton draw 
+00008940: 6c69 6e65 732e 2727 270d 0a20 2020 2020  lines.'''..     
+00008950: 2020 2069 6620 6576 2e6d 6f64 6966 6965     if ev.modifie
+00008960: 7273 2829 2021 3d20 5174 436f 7265 2e51  rs() != QtCore.Q
+00008970: 742e 4b65 7962 6f61 7264 4d6f 6469 6669  t.KeyboardModifi
+00008980: 6572 2e43 6f6e 7472 6f6c 4d6f 6469 6669  er.ControlModifi
+00008990: 6572 3a0d 0a20 2020 2020 2020 2020 2020  er:..           
+000089a0: 2073 7570 6572 2829 2e6d 6f75 7365 4472   super().mouseDr
+000089b0: 6167 4576 656e 7428 6576 2c20 6178 6973  agEvent(ev, axis
+000089c0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+000089d0: 6620 6576 2e69 7346 696e 6973 6828 293a  f ev.isFinish():
+000089e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000089f0: 2020 7365 6c66 2e77 696e 2e5f 6973 4d6f    self.win._isMo
+00008a00: 7573 654c 6566 7444 7261 6720 3d20 4661  useLeftDrag = Fa
+00008a10: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+00008a20: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00008a30: 2020 2020 2020 2020 7365 6c66 2e77 696e          self.win
+00008a40: 2e5f 6973 4d6f 7573 654c 6566 7444 7261  ._isMouseLeftDra
+00008a50: 6720 3d20 5472 7565 0d0a 2020 2020 2020  g = True..      
+00008a60: 2020 2020 2020 6966 2065 762e 6973 4669        if ev.isFi
+00008a70: 6e69 7368 2829 206f 7220 7365 6c66 2e64  nish() or self.d
+00008a80: 7261 7769 6e67 3a0d 0a20 2020 2020 2020  rawing:..       
+00008a90: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+00008aa0: 6672 6573 685f 616c 6c5f 795f 7a6f 6f6d  fresh_all_y_zoom
+00008ab0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00008ac0: 6966 206e 6f74 2073 656c 662e 6472 6177  if not self.draw
+00008ad0: 696e 673a 0d0a 2020 2020 2020 2020 2020  ing:..          
+00008ae0: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
+00008af0: 2020 2020 2020 6966 2073 656c 662e 6472        if self.dr
+00008b00: 6177 5f6c 696e 6520 616e 6420 6e6f 7420  aw_line and not 
+00008b10: 7365 6c66 2e64 7261 7769 6e67 3a0d 0a20  self.drawing:.. 
+00008b20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008b30: 7365 745f 6472 6177 5f6c 696e 655f 636f  set_draw_line_co
+00008b40: 6c6f 7228 6472 6177 5f64 6f6e 655f 636f  lor(draw_done_co
+00008b50: 6c6f 7229 0d0a 2020 2020 2020 2020 7031  lor)..        p1
+00008b60: 203d 2073 656c 662e 6d61 7054 6f56 6965   = self.mapToVie
+00008b70: 7728 6576 2e70 6f73 2829 290d 0a20 2020  w(ev.pos())..   
+00008b80: 2020 2020 2070 3120 3d20 5f63 6c61 6d70       p1 = _clamp
+00008b90: 5f70 6f69 6e74 2873 656c 662e 7061 7265  _point(self.pare
+00008ba0: 6e74 2829 2c20 7031 290d 0a20 2020 2020  nt(), p1)..     
+00008bb0: 2020 2069 6620 6e6f 7420 7365 6c66 2e64     if not self.d
+00008bc0: 7261 7769 6e67 3a0d 0a20 2020 2020 2020  rawing:..       
+00008bd0: 2020 2020 2023 2061 6464 206e 6577 206c       # add new l
+00008be0: 696e 650d 0a20 2020 2020 2020 2020 2020  ine..           
+00008bf0: 2070 3020 3d20 7365 6c66 2e6d 6170 546f   p0 = self.mapTo
+00008c00: 5669 6577 2865 762e 6c61 7374 506f 7328  View(ev.lastPos(
+00008c10: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00008c20: 7030 203d 205f 636c 616d 705f 706f 696e  p0 = _clamp_poin
+00008c30: 7428 7365 6c66 2e70 6172 656e 7428 292c  t(self.parent(),
+00008c40: 2070 3029 0d0a 2020 2020 2020 2020 2020   p0)..          
+00008c50: 2020 7365 6c66 2e64 7261 775f 6c69 6e65    self.draw_line
+00008c60: 203d 205f 6372 6561 7465 5f70 6f6c 795f   = _create_poly_
+00008c70: 6c69 6e65 2873 656c 662c 205b 7030 2c20  line(self, [p0, 
+00008c80: 7031 5d2c 2063 6c6f 7365 643d 4661 6c73  p1], closed=Fals
+00008c90: 652c 2070 656e 3d70 672e 6d6b 5065 6e28  e, pen=pg.mkPen(
+00008ca0: 6472 6177 5f6c 696e 655f 636f 6c6f 7229  draw_line_color)
+00008cb0: 2c20 6d6f 7661 626c 653d 4661 6c73 6529  , movable=False)
+00008cc0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00008cd0: 6c66 2e64 7261 775f 6c69 6e65 2e73 6574  lf.draw_line.set
+00008ce0: 5a56 616c 7565 2834 3029 0d0a 2020 2020  ZValue(40)..    
+00008cf0: 2020 2020 2020 2020 7365 6c66 2e72 6f69          self.roi
+00008d00: 732e 6170 7065 6e64 2873 656c 662e 6472  s.append(self.dr
+00008d10: 6177 5f6c 696e 6529 0d0a 2020 2020 2020  aw_line)..      
+00008d20: 2020 2020 2020 7365 6c66 2e61 6464 4974        self.addIt
+00008d30: 656d 2873 656c 662e 6472 6177 5f6c 696e  em(self.draw_lin
+00008d40: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00008d50: 7365 6c66 2e64 7261 7769 6e67 203d 2054  self.drawing = T
+00008d60: 7275 650d 0a20 2020 2020 2020 2065 6c73  rue..        els
+00008d70: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00008d80: 2320 6472 6177 2070 6c61 6365 6420 706f  # draw placed po
+00008d90: 696e 7420 6174 2065 6e64 206f 6620 706f  int at end of po
+00008da0: 6c79 2d6c 696e 650d 0a20 2020 2020 2020  ly-line..       
+00008db0: 2020 2020 2073 656c 662e 6472 6177 5f6c       self.draw_l
+00008dc0: 696e 652e 6d6f 7665 506f 696e 7428 2d31  ine.movePoint(-1
+00008dd0: 2c20 7031 290d 0a20 2020 2020 2020 2069  , p1)..        i
+00008de0: 6620 6576 2e69 7346 696e 6973 6828 293a  f ev.isFinish():
+00008df0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00008e00: 6c66 2e64 7261 7769 6e67 203d 2046 616c  lf.drawing = Fal
+00008e10: 7365 0d0a 2020 2020 2020 2020 6576 2e61  se..        ev.a
+00008e20: 6363 6570 7428 290d 0a0d 0a20 2020 2064  ccept()....    d
+00008e30: 6566 206d 6f75 7365 4d69 6464 6c65 4472  ef mouseMiddleDr
+00008e40: 6167 2873 656c 662c 2065 762c 2061 7869  ag(self, ev, axi
+00008e50: 7329 3a0d 0a20 2020 2020 2020 2027 2727  s):..        '''
+00008e60: 4374 726c 2b4d 4275 7474 6f6e 2064 7261  Ctrl+MButton dra
+00008e70: 7720 656c 6c69 7073 6573 2e27 2727 0d0a  w ellipses.'''..
+00008e80: 2020 2020 2020 2020 6966 2065 762e 6d6f          if ev.mo
+00008e90: 6469 6669 6572 7328 2920 213d 2051 7443  difiers() != QtC
+00008ea0: 6f72 652e 5174 2e4b 6579 626f 6172 644d  ore.Qt.KeyboardM
+00008eb0: 6f64 6966 6965 722e 436f 6e74 726f 6c4d  odifier.ControlM
+00008ec0: 6f64 6966 6965 723a 0d0a 2020 2020 2020  odifier:..      
+00008ed0: 2020 2020 2020 7265 7475 726e 2073 7570        return sup
+00008ee0: 6572 2829 2e6d 6f75 7365 4472 6167 4576  er().mouseDragEv
+00008ef0: 656e 7428 6576 2c20 6178 6973 290d 0a20  ent(ev, axis).. 
+00008f00: 2020 2020 2020 2070 3120 3d20 7365 6c66         p1 = self
+00008f10: 2e6d 6170 546f 5669 6577 2865 762e 706f  .mapToView(ev.po
+00008f20: 7328 2929 0d0a 2020 2020 2020 2020 7031  s())..        p1
+00008f30: 203d 205f 636c 616d 705f 706f 696e 7428   = _clamp_point(
+00008f40: 7365 6c66 2e70 6172 656e 7428 292c 2070  self.parent(), p
+00008f50: 3129 0d0a 2020 2020 2020 2020 6465 6620  1)..        def 
+00008f60: 6e6f 6e7a 6572 6f73 697a 6528 612c 2062  nonzerosize(a, b
+00008f70: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00008f80: 6320 3d20 622d 610d 0a20 2020 2020 2020  c = b-a..       
+00008f90: 2020 2020 2072 6574 7572 6e20 7067 2e50       return pg.P
+00008fa0: 6f69 6e74 2861 6273 2863 2e78 2829 2920  oint(abs(c.x()) 
+00008fb0: 6f72 2031 2c20 6162 7328 632e 7928 2929  or 1, abs(c.y())
+00008fc0: 206f 7220 3165 2d33 290d 0a20 2020 2020   or 1e-3)..     
+00008fd0: 2020 2069 6620 6e6f 7420 7365 6c66 2e64     if not self.d
+00008fe0: 7261 7769 6e67 3a0d 0a20 2020 2020 2020  rawing:..       
+00008ff0: 2020 2020 2023 2061 6464 206e 6577 2065       # add new e
+00009000: 6c6c 6970 7365 0d0a 2020 2020 2020 2020  llipse..        
+00009010: 2020 2020 7030 203d 2073 656c 662e 6d61      p0 = self.ma
+00009020: 7054 6f56 6965 7728 6576 2e6c 6173 7450  pToView(ev.lastP
+00009030: 6f73 2829 290d 0a20 2020 2020 2020 2020  os())..         
+00009040: 2020 2070 3020 3d20 5f63 6c61 6d70 5f70     p0 = _clamp_p
+00009050: 6f69 6e74 2873 656c 662e 7061 7265 6e74  oint(self.parent
+00009060: 2829 2c20 7030 290d 0a20 2020 2020 2020  (), p0)..       
+00009070: 2020 2020 2073 203d 206e 6f6e 7a65 726f       s = nonzero
+00009080: 7369 7a65 2870 302c 2070 3129 0d0a 2020  size(p0, p1)..  
+00009090: 2020 2020 2020 2020 2020 7030 203d 2051            p0 = Q
+000090a0: 7443 6f72 652e 5150 6f69 6e74 4628 7030  tCore.QPointF(p0
+000090b0: 2e78 2829 2d73 2e78 2829 2f32 2c20 7030  .x()-s.x()/2, p0
+000090c0: 2e79 2829 2d73 2e79 2829 2f32 290d 0a20  .y()-s.y()/2).. 
+000090d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000090e0: 6472 6177 5f65 6c6c 6970 7365 203d 2046  draw_ellipse = F
+000090f0: 696e 456c 6c69 7073 6528 7030 2c20 732c  inEllipse(p0, s,
+00009100: 2070 656e 3d70 672e 6d6b 5065 6e28 6472   pen=pg.mkPen(dr
+00009110: 6177 5f6c 696e 655f 636f 6c6f 7229 2c20  aw_line_color), 
+00009120: 6d6f 7661 626c 653d 5472 7565 290d 0a20  movable=True).. 
+00009130: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009140: 6472 6177 5f65 6c6c 6970 7365 2e73 6574  draw_ellipse.set
+00009150: 5a56 616c 7565 2838 3029 0d0a 2020 2020  ZValue(80)..    
+00009160: 2020 2020 2020 2020 7365 6c66 2e72 6f69          self.roi
+00009170: 732e 6170 7065 6e64 2873 656c 662e 6472  s.append(self.dr
+00009180: 6177 5f65 6c6c 6970 7365 290d 0a20 2020  aw_ellipse)..   
+00009190: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
+000091a0: 6449 7465 6d28 7365 6c66 2e64 7261 775f  dItem(self.draw_
+000091b0: 656c 6c69 7073 6529 0d0a 2020 2020 2020  ellipse)..      
+000091c0: 2020 2020 2020 7365 6c66 2e64 7261 7769        self.drawi
+000091d0: 6e67 203d 2054 7275 650d 0a20 2020 2020  ng = True..     
+000091e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000091f0: 2020 2020 2020 6320 3d20 7365 6c66 2e64        c = self.d
+00009200: 7261 775f 656c 6c69 7073 652e 706f 7328  raw_ellipse.pos(
+00009210: 2920 2b20 7365 6c66 2e64 7261 775f 656c  ) + self.draw_el
+00009220: 6c69 7073 652e 7369 7a65 2829 2a30 2e35  lipse.size()*0.5
+00009230: 0d0a 2020 2020 2020 2020 2020 2020 7320  ..            s 
+00009240: 3d20 6e6f 6e7a 6572 6f73 697a 6528 632c  = nonzerosize(c,
+00009250: 2070 3129 0d0a 2020 2020 2020 2020 2020   p1)..          
+00009260: 2020 7365 6c66 2e64 7261 775f 656c 6c69    self.draw_elli
+00009270: 7073 652e 7365 7453 697a 6528 732a 322c  pse.setSize(s*2,
+00009280: 2075 7064 6174 653d 4661 6c73 6529 0d0a   update=False)..
+00009290: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000092a0: 2e64 7261 775f 656c 6c69 7073 652e 7365  .draw_ellipse.se
+000092b0: 7450 6f73 2863 2d73 290d 0a20 2020 2020  tPos(c-s)..     
+000092c0: 2020 2069 6620 6576 2e69 7346 696e 6973     if ev.isFinis
+000092d0: 6828 293a 0d0a 2020 2020 2020 2020 2020  h():..          
+000092e0: 2020 7365 6c66 2e64 7261 7769 6e67 203d    self.drawing =
+000092f0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00009300: 6576 2e61 6363 6570 7428 290d 0a0d 0a20  ev.accept().... 
+00009310: 2020 2064 6566 206d 6f75 7365 5269 6768     def mouseRigh
+00009320: 7444 7261 6728 7365 6c66 2c20 6576 2c20  tDrag(self, ev, 
+00009330: 6178 6973 293a 0d0a 2020 2020 2020 2020  axis):..        
+00009340: 2727 2752 4275 7474 6f6e 2069 7320 626f  '''RButton is bo
+00009350: 7820 7a6f 6f6d 2e20 4174 206c 6561 7374  x zoom. At least
+00009360: 2066 6f72 206e 6f77 2e27 2727 0d0a 2020   for now.'''..  
+00009370: 2020 2020 2020 6576 2e61 6363 6570 7428        ev.accept(
+00009380: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+00009390: 7420 6576 2e69 7346 696e 6973 6828 293a  t ev.isFinish():
+000093a0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000093b0: 6c66 2e75 7064 6174 6553 6361 6c65 426f  lf.updateScaleBo
+000093c0: 7828 6576 2e62 7574 746f 6e44 6f77 6e50  x(ev.buttonDownP
+000093d0: 6f73 2829 2c20 6576 2e70 6f73 2829 290d  os(), ev.pos()).
+000093e0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+000093f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00009400: 2e72 6253 6361 6c65 426f 782e 6869 6465  .rbScaleBox.hide
+00009410: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00009420: 6178 203d 2051 7443 6f72 652e 5152 6563  ax = QtCore.QRec
+00009430: 7446 2870 672e 506f 696e 7428 6576 2e62  tF(pg.Point(ev.b
+00009440: 7574 746f 6e44 6f77 6e50 6f73 2865 762e  uttonDownPos(ev.
+00009450: 6275 7474 6f6e 2829 2929 2c20 7067 2e50  button())), pg.P
+00009460: 6f69 6e74 2865 762e 706f 7328 2929 290d  oint(ev.pos())).
+00009470: 0a20 2020 2020 2020 2020 2020 2061 7820  .            ax 
+00009480: 3d20 7365 6c66 2e63 6869 6c64 4772 6f75  = self.childGrou
+00009490: 702e 6d61 7052 6563 7446 726f 6d50 6172  p.mapRectFromPar
+000094a0: 656e 7428 6178 290d 0a20 2020 2020 2020  ent(ax)..       
+000094b0: 2020 2020 2069 6620 6178 2e77 6964 7468       if ax.width
+000094c0: 2829 203c 2032 3a20 2320 7a6f 6f6d 696e  () < 2: # zoomin
+000094d0: 6720 7468 6973 206e 6172 726f 7720 6973  g this narrow is
+000094e0: 2070 726f 6261 626c 7920 6120 6d69 7374   probably a mist
+000094f0: 616b 650d 0a20 2020 2020 2020 2020 2020  ake..           
+00009500: 2020 2020 2061 782e 6164 6a75 7374 282d       ax.adjust(-
+00009510: 312c 2030 2c20 2b31 2c20 3029 0d0a 2020  1, 0, +1, 0)..  
+00009520: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00009530: 686f 7741 7852 6563 7428 6178 290d 0a20  howAxRect(ax).. 
+00009540: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009550: 6178 4869 7374 6f72 7950 6f69 6e74 6572  axHistoryPointer
+00009560: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
+00009570: 2020 2073 656c 662e 6178 4869 7374 6f72     self.axHistor
+00009580: 7920 3d20 7365 6c66 2e61 7848 6973 746f  y = self.axHisto
+00009590: 7279 5b3a 7365 6c66 2e61 7848 6973 746f  ry[:self.axHisto
+000095a0: 7279 506f 696e 7465 725d 202b 205b 6178  ryPointer] + [ax
+000095b0: 5d0d 0a0d 0a20 2020 2064 6566 206d 6f75  ]....    def mou
+000095c0: 7365 436c 6963 6b45 7665 6e74 2873 656c  seClickEvent(sel
+000095d0: 662c 2065 7629 3a0d 0a20 2020 2020 2020  f, ev):..       
+000095e0: 2069 6620 7365 6c66 2e6d 6173 7465 725f   if self.master_
+000095f0: 7669 6577 626f 783a 0d0a 2020 2020 2020  viewbox:..      
+00009600: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00009610: 662e 6d61 7374 6572 5f76 6965 7762 6f78  f.master_viewbox
+00009620: 2e6d 6f75 7365 436c 6963 6b45 7665 6e74  .mouseClickEvent
+00009630: 2865 7629 0d0a 2020 2020 2020 2020 6966  (ev)..        if
+00009640: 205f 6d6f 7573 655f 636c 6963 6b65 6428   _mouse_clicked(
+00009650: 7365 6c66 2c20 6576 293a 0d0a 2020 2020  self, ev):..    
+00009660: 2020 2020 2020 2020 6576 2e61 6363 6570          ev.accep
+00009670: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
+00009680: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+00009690: 2069 6620 6576 2e62 7574 746f 6e28 2920   if ev.button() 
+000096a0: 213d 2051 7443 6f72 652e 5174 2e4d 6f75  != QtCore.Qt.Mou
+000096b0: 7365 4275 7474 6f6e 2e4c 6566 7442 7574  seButton.LeftBut
+000096c0: 746f 6e20 6f72 2065 762e 6d6f 6469 6669  ton or ev.modifi
+000096d0: 6572 7328 2920 213d 2051 7443 6f72 652e  ers() != QtCore.
+000096e0: 5174 2e4b 6579 626f 6172 644d 6f64 6966  Qt.KeyboardModif
+000096f0: 6965 722e 436f 6e74 726f 6c4d 6f64 6966  ier.ControlModif
+00009700: 6965 7220 6f72 206e 6f74 2073 656c 662e  ier or not self.
+00009710: 6472 6177 5f6c 696e 653a 0d0a 2020 2020  draw_line:..    
+00009720: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00009730: 7570 6572 2829 2e6d 6f75 7365 436c 6963  uper().mouseClic
+00009740: 6b45 7665 6e74 2865 7629 0d0a 2020 2020  kEvent(ev)..    
+00009750: 2020 2020 2320 6164 6420 616e 6f74 6865      # add anothe
+00009760: 7220 7365 676d 656e 7420 746f 2074 6865  r segment to the
+00009770: 2063 7572 7265 6e74 6c79 2064 7261 776e   currently drawn
+00009780: 206c 696e 650d 0a20 2020 2020 2020 2070   line..        p
+00009790: 203d 2073 656c 662e 6d61 7043 6c69 636b   = self.mapClick
+000097a0: 546f 5669 6577 2865 762e 706f 7328 2929  ToView(ev.pos())
+000097b0: 0d0a 2020 2020 2020 2020 7020 3d20 5f63  ..        p = _c
+000097c0: 6c61 6d70 5f70 6f69 6e74 2873 656c 662e  lamp_point(self.
+000097d0: 7061 7265 6e74 2829 2c20 7029 0d0a 2020  parent(), p)..  
+000097e0: 2020 2020 2020 7365 6c66 2e61 7070 656e        self.appen
+000097f0: 645f 6472 6177 5f73 6567 6d65 6e74 2870  d_draw_segment(p
+00009800: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00009810: 6472 6177 696e 6720 3d20 4661 6c73 650d  drawing = False.
+00009820: 0a20 2020 2020 2020 2065 762e 6163 6365  .        ev.acce
+00009830: 7074 2829 0d0a 0d0a 2020 2020 6465 6620  pt()....    def 
+00009840: 6d61 7043 6c69 636b 546f 5669 6577 2873  mapClickToView(s
+00009850: 656c 662c 2070 6f73 293a 0d0a 2020 2020  elf, pos):..    
+00009860: 2020 2020 2727 276d 6170 546f 5669 6577      '''mapToView
+00009870: 2829 2064 6f65 7320 6e6f 7420 646f 2067  () does not do g
+00009880: 7269 6473 2070 726f 7065 726c 7920 696e  rids properly in
+00009890: 2065 6d62 6564 6465 6420 7769 6467 6574   embedded widget
+000098a0: 732e 2053 7472 616e 6765 6c79 2c20 6f6e  s. Strangely, on
+000098b0: 6c79 2061 6666 6563 7420 636c 6963 6b73  ly affect clicks
+000098c0: 2c20 6e6f 7420 6472 6167 732e 2727 270d  , not drags.'''.
+000098d0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000098e0: 2e77 696e 2e70 6172 656e 7428 2920 6973  .win.parent() is
+000098f0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00009900: 2020 2020 2020 2020 6178 203d 2073 656c          ax = sel
+00009910: 662e 7061 7265 6e74 2829 0d0a 2020 2020  f.parent()..    
+00009920: 2020 2020 2020 2020 6966 2061 782e 6765          if ax.ge
+00009930: 7441 7869 7328 2772 6967 6874 2729 2e67  tAxis('right').g
+00009940: 7269 643a 0d0a 2020 2020 2020 2020 2020  rid:..          
+00009950: 2020 2020 2020 706f 732e 7365 7458 2870        pos.setX(p
+00009960: 6f73 2e78 2829 202b 2073 656c 662e 7769  os.x() + self.wi
+00009970: 6474 6828 2929 0d0a 2020 2020 2020 2020  dth())..        
+00009980: 2020 2020 656c 6966 2061 782e 6765 7441      elif ax.getA
+00009990: 7869 7328 2762 6f74 746f 6d27 292e 6772  xis('bottom').gr
+000099a0: 6964 3a0d 0a20 2020 2020 2020 2020 2020  id:..           
+000099b0: 2020 2020 2070 6f73 2e73 6574 5928 706f       pos.setY(po
+000099c0: 732e 7928 2920 2b20 7365 6c66 2e68 6569  s.y() + self.hei
+000099d0: 6768 7428 2929 0d0a 2020 2020 2020 2020  ght())..        
+000099e0: 7265 7475 726e 2073 7570 6572 2829 2e6d  return super().m
+000099f0: 6170 546f 5669 6577 2870 6f73 290d 0a0d  apToView(pos)...
+00009a00: 0a20 2020 2064 6566 206b 6579 5072 6573  .    def keyPres
+00009a10: 7345 7665 6e74 2873 656c 662c 2065 7629  sEvent(self, ev)
+00009a20: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+00009a30: 6c66 2e6d 6173 7465 725f 7669 6577 626f  lf.master_viewbo
+00009a40: 783a 0d0a 2020 2020 2020 2020 2020 2020  x:..            
+00009a50: 7265 7475 726e 2073 656c 662e 6d61 7374  return self.mast
+00009a60: 6572 5f76 6965 7762 6f78 2e6b 6579 5072  er_viewbox.keyPr
+00009a70: 6573 7345 7665 6e74 2865 7629 0d0a 2020  essEvent(ev)..  
+00009a80: 2020 2020 2020 6966 205f 6b65 795f 7072        if _key_pr
+00009a90: 6573 7365 6428 7365 6c66 2c20 6576 293a  essed(self, ev):
+00009aa0: 0d0a 2020 2020 2020 2020 2020 2020 6576  ..            ev
+00009ab0: 2e61 6363 6570 7428 290d 0a20 2020 2020  .accept()..     
+00009ac0: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+00009ad0: 2020 2020 2020 2073 7570 6572 2829 2e6b         super().k
+00009ae0: 6579 5072 6573 7345 7665 6e74 2865 7629  eyPressEvent(ev)
+00009af0: 0d0a 0d0a 2020 2020 6465 6620 6c69 6e6b  ....    def link
+00009b00: 6564 5669 6577 4368 616e 6765 6428 7365  edViewChanged(se
+00009b10: 6c66 2c20 7669 6577 2c20 6178 6973 293a  lf, view, axis):
+00009b20: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00009b30: 2073 656c 662e 6461 7461 7372 6320 6f72   self.datasrc or
+00009b40: 2073 656c 662e 7570 6461 7469 6e67 5f6c   self.updating_l
+00009b50: 696e 6b65 643a 0d0a 2020 2020 2020 2020  inked:..        
+00009b60: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
+00009b70: 2020 2020 6966 2076 6965 7720 616e 6420      if view and 
+00009b80: 7365 6c66 2e64 6174 6173 7263 2061 6e64  self.datasrc and
+00009b90: 2076 6965 772e 6461 7461 7372 633a 0d0a   view.datasrc:..
+00009ba0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00009bb0: 2e75 7064 6174 696e 675f 6c69 6e6b 6564  .updating_linked
+00009bc0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+00009bd0: 2020 2020 2074 7220 3d20 7365 6c66 2e74       tr = self.t
+00009be0: 6172 6765 7452 6563 7428 290d 0a20 2020  argetRect()..   
+00009bf0: 2020 2020 2020 2020 2076 7220 3d20 7669           vr = vi
+00009c00: 6577 2e74 6172 6765 7452 6563 7428 290d  ew.targetRect().
+00009c10: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
+00009c20: 6469 7274 7920 3d20 7669 6577 2e66 6f72  dirty = view.for
+00009c30: 6365 5f72 616e 6765 5f75 7064 6174 6520  ce_range_update 
+00009c40: 3e20 300d 0a20 2020 2020 2020 2020 2020  > 0..           
+00009c50: 2069 735f 7361 6d65 5f73 6361 6c65 203d   is_same_scale =
+00009c60: 2073 656c 662e 6461 7461 7372 632e 786c   self.datasrc.xl
+00009c70: 656e 203d 3d20 7669 6577 2e64 6174 6173  en == view.datas
+00009c80: 7263 2e78 6c65 6e0d 0a20 2020 2020 2020  rc.xlen..       
+00009c90: 2020 2020 2069 6620 6973 5f73 616d 655f       if is_same_
+00009ca0: 7363 616c 653a 2023 2073 7461 626c 6520  scale: # stable 
+00009cb0: 7a6f 6f6d 2062 6173 6564 206f 6e20 696e  zoom based on in
+00009cc0: 6465 780d 0a20 2020 2020 2020 2020 2020  dex..           
+00009cd0: 2020 2020 2069 6620 6973 5f64 6972 7479       if is_dirty
+00009ce0: 206f 7220 6162 7328 7672 2e6c 6566 7428   or abs(vr.left(
+00009cf0: 292d 7472 2e6c 6566 7428 2929 203e 3d20  )-tr.left()) >= 
+00009d00: 3120 6f72 2061 6273 2876 722e 7269 6768  1 or abs(vr.righ
+00009d10: 7428 292d 7472 2e72 6967 6874 2829 2920  t()-tr.right()) 
+00009d20: 3e3d 2031 3a0d 0a20 2020 2020 2020 2020  >= 1:..         
+00009d30: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00009d40: 5f64 6972 7479 3a0d 0a20 2020 2020 2020  _dirty:..       
+00009d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d60: 2076 6965 772e 666f 7263 655f 7261 6e67   view.force_rang
+00009d70: 655f 7570 6461 7465 202d 3d20 310d 0a20  e_update -= 1.. 
+00009d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d90: 2020 2073 656c 662e 7570 6461 7465 5f79     self.update_y
+00009da0: 5f7a 6f6f 6d28 7672 2e6c 6566 7428 292c  _zoom(vr.left(),
+00009db0: 2076 722e 7269 6768 7428 2929 0d0a 2020   vr.right())..  
+00009dc0: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
+00009dd0: 2320 736c 6f70 7079 206f 6e65 2062 6173  # sloppy one bas
+00009de0: 6564 206f 6e20 7469 6d65 2073 7461 6d70  ed on time stamp
+00009df0: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+00009e00: 2020 2074 7430 2c74 7431 2c5f 2c5f 2c5f     tt0,tt1,_,_,_
+00009e10: 203d 2073 656c 662e 6461 7461 7372 632e   = self.datasrc.
+00009e20: 6869 6c6f 2874 722e 6c65 6674 2829 2c20  hilo(tr.left(), 
+00009e30: 7472 2e72 6967 6874 2829 290d 0a20 2020  tr.right())..   
+00009e40: 2020 2020 2020 2020 2020 2020 2076 7430               vt0
+00009e50: 2c76 7431 2c5f 2c5f 2c5f 203d 2076 6965  ,vt1,_,_,_ = vie
+00009e60: 772e 6461 7461 7372 632e 6869 6c6f 2876  w.datasrc.hilo(v
+00009e70: 722e 6c65 6674 2829 2c20 7672 2e72 6967  r.left(), vr.rig
+00009e80: 6874 2829 290d 0a20 2020 2020 2020 2020  ht())..         
+00009e90: 2020 2020 2020 2070 6572 696f 6432 203d         period2 =
+00009ea0: 2073 656c 662e 6461 7461 7372 632e 7065   self.datasrc.pe
+00009eb0: 7269 6f64 5f6e 7320 2a20 302e 350d 0a20  riod_ns * 0.5.. 
+00009ec0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00009ed0: 6620 6973 5f64 6972 7479 206f 7220 6162  f is_dirty or ab
+00009ee0: 7328 7674 302d 7474 3029 203e 3d20 7065  s(vt0-tt0) >= pe
+00009ef0: 7269 6f64 3220 6f72 2061 6273 2876 7431  riod2 or abs(vt1
+00009f00: 2d74 7431 2920 3e3d 2070 6572 696f 6432  -tt1) >= period2
+00009f10: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00009f20: 2020 2020 2020 2069 6620 6973 5f64 6972         if is_dir
+00009f30: 7479 3a0d 0a20 2020 2020 2020 2020 2020  ty:..           
+00009f40: 2020 2020 2020 2020 2020 2020 2076 6965               vie
+00009f50: 772e 666f 7263 655f 7261 6e67 655f 7570  w.force_range_up
+00009f60: 6461 7465 202d 3d20 310d 0a20 2020 2020  date -= 1..     
+00009f70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00009f80: 6620 7365 6c66 2e70 6172 656e 7428 293a  f self.parent():
+00009f90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009fa0: 2020 2020 2020 2020 2020 7830 2c78 3120            x0,x1 
+00009fb0: 3d20 5f70 6474 696d 6532 696e 6465 7828  = _pdtime2index(
+00009fc0: 7365 6c66 2e70 6172 656e 7428 292c 2070  self.parent(), p
+00009fd0: 642e 5365 7269 6573 285b 7674 302c 7674  d.Series([vt0,vt
+00009fe0: 315d 292c 2061 6e79 5f65 6e64 3d54 7275  1]), any_end=Tru
+00009ff0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0000a000: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000a010: 2e75 7064 6174 655f 795f 7a6f 6f6d 2878  .update_y_zoom(x
+0000a020: 302c 2078 3129 0d0a 2020 2020 2020 2020  0, x1)..        
+0000a030: 2020 2020 7365 6c66 2e75 7064 6174 696e      self.updatin
+0000a040: 675f 6c69 6e6b 6564 203d 2046 616c 7365  g_linked = False
+0000a050: 0d0a 0d0a 2020 2020 6465 6620 7a6f 6f6d  ....    def zoom
+0000a060: 5f72 6563 7428 7365 6c66 2c20 7672 2c20  _rect(self, vr, 
+0000a070: 7363 616c 655f 6661 6374 2c20 6365 6e74  scale_fact, cent
+0000a080: 6572 293a 0d0a 2020 2020 2020 2020 6966  er):..        if
+0000a090: 206e 6f74 2073 656c 662e 6461 7461 7372   not self.datasr
+0000a0a0: 633a 0d0a 2020 2020 2020 2020 2020 2020  c:..            
+0000a0b0: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
+0000a0c0: 7830 203d 2063 656e 7465 722e 7828 2920  x0 = center.x() 
+0000a0d0: 2b20 2876 722e 6c65 6674 2829 2d63 656e  + (vr.left()-cen
+0000a0e0: 7465 722e 7828 2929 202a 2073 6361 6c65  ter.x()) * scale
+0000a0f0: 5f66 6163 740d 0a20 2020 2020 2020 2078  _fact..        x
+0000a100: 3120 3d20 6365 6e74 6572 2e78 2829 202b  1 = center.x() +
+0000a110: 2028 7672 2e72 6967 6874 2829 2d63 656e   (vr.right()-cen
+0000a120: 7465 722e 7828 2929 202a 2073 6361 6c65  ter.x()) * scale
+0000a130: 5f66 6163 740d 0a20 2020 2020 2020 2073  _fact..        s
+0000a140: 656c 662e 7570 6461 7465 5f79 5f7a 6f6f  elf.update_y_zoo
+0000a150: 6d28 7830 2c20 7831 290d 0a0d 0a20 2020  m(x0, x1)....   
+0000a160: 2064 6566 2070 616e 5f78 2873 656c 662c   def pan_x(self,
+0000a170: 2073 7465 7073 3d4e 6f6e 652c 2070 6572   steps=None, per
+0000a180: 6365 6e74 3d4e 6f6e 6529 3a0d 0a20 2020  cent=None):..   
+0000a190: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
+0000a1a0: 6173 7263 2069 7320 4e6f 6e65 3a0d 0a20  asrc is None:.. 
+0000a1b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000a1c0: 6e0d 0a20 2020 2020 2020 2069 6620 7374  n..        if st
+0000a1d0: 6570 7320 6973 204e 6f6e 653a 0d0a 2020  eps is None:..  
+0000a1e0: 2020 2020 2020 2020 2020 7374 6570 7320            steps 
+0000a1f0: 3d20 696e 7428 7065 7263 656e 742f 3130  = int(percent/10
+0000a200: 302a 7365 6c66 2e74 6172 6765 7452 6563  0*self.targetRec
+0000a210: 7428 292e 7769 6474 6828 2929 0d0a 2020  t().width())..  
+0000a220: 2020 2020 2020 7472 203d 2073 656c 662e        tr = self.
+0000a230: 7461 7267 6574 5265 6374 2829 0d0a 2020  targetRect()..  
+0000a240: 2020 2020 2020 7831 203d 2074 722e 7269        x1 = tr.ri
+0000a250: 6768 7428 2920 2b20 7374 6570 730d 0a20  ght() + steps.. 
+0000a260: 2020 2020 2020 2073 7461 7274 7820 3d20         startx = 
+0000a270: 2d73 6964 655f 6d61 7267 696e 0d0a 2020  -side_margin..  
+0000a280: 2020 2020 2020 656e 6478 203d 2073 656c        endx = sel
+0000a290: 662e 6461 7461 7372 632e 786c 656e 202b  f.datasrc.xlen +
+0000a2a0: 2072 6967 6874 5f6d 6172 6769 6e5f 6361   right_margin_ca
+0000a2b0: 6e64 6c65 7320 2d20 7369 6465 5f6d 6172  ndles - side_mar
+0000a2c0: 6769 6e0d 0a20 2020 2020 2020 2069 6620  gin..        if 
+0000a2d0: 7831 203e 2065 6e64 783a 0d0a 2020 2020  x1 > endx:..    
+0000a2e0: 2020 2020 2020 2020 7831 203d 2065 6e64          x1 = end
+0000a2f0: 780d 0a20 2020 2020 2020 2078 3020 3d20  x..        x0 = 
+0000a300: 7831 202d 2074 722e 7769 6474 6828 290d  x1 - tr.width().
+0000a310: 0a20 2020 2020 2020 2069 6620 7830 203c  .        if x0 <
+0000a320: 2073 7461 7274 783a 0d0a 2020 2020 2020   startx:..      
+0000a330: 2020 2020 2020 7830 203d 2073 7461 7274        x0 = start
+0000a340: 780d 0a20 2020 2020 2020 2020 2020 2078  x..            x
+0000a350: 3120 3d20 7830 202b 2074 722e 7769 6474  1 = x0 + tr.widt
+0000a360: 6828 290d 0a20 2020 2020 2020 2073 656c  h()..        sel
+0000a370: 662e 7570 6461 7465 5f79 5f7a 6f6f 6d28  f.update_y_zoom(
+0000a380: 7830 2c20 7831 290d 0a0d 0a20 2020 2064  x0, x1)....    d
+0000a390: 6566 2072 6566 7265 7368 5f61 6c6c 5f79  ef refresh_all_y
+0000a3a0: 5f7a 6f6f 6d28 7365 6c66 293a 0d0a 2020  _zoom(self):..  
+0000a3b0: 2020 2020 2020 2727 2754 6869 7320 7570        '''This up
+0000a3c0: 6461 7465 7320 5920 7a6f 6f6d 206f 6e20  dates Y zoom on 
+0000a3d0: 616c 6c20 7669 6577 732c 2073 7563 6820  all views, such 
+0000a3e0: 6173 2077 6865 6e20 6120 6d6f 7573 6520  as when a mouse 
+0000a3f0: 6472 6167 2069 7320 636f 6d70 6c65 7465  drag is complete
+0000a400: 642e 2727 270d 0a20 2020 2020 2020 206d  d.'''..        m
+0000a410: 6169 6e5f 7662 203d 2073 656c 660d 0a20  ain_vb = self.. 
+0000a420: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
+0000a430: 696e 6b65 6456 6965 7728 3029 3a0d 0a20  inkedView(0):.. 
+0000a440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000a450: 666f 7263 655f 7261 6e67 655f 7570 6461  force_range_upda
+0000a460: 7465 203d 2031 2023 206d 6169 6e20 6e65  te = 1 # main ne
+0000a470: 6564 2074 6f20 7570 6461 7465 206f 6e6c  ed to update onl
+0000a480: 7920 6f6e 6365 2074 6f20 7573 0d0a 2020  y once to us..  
+0000a490: 2020 2020 2020 2020 2020 6d61 696e 5f76            main_v
+0000a4a0: 6220 3d20 6c69 7374 2873 656c 662e 7769  b = list(self.wi
+0000a4b0: 6e2e 6178 7329 5b30 5d2e 7662 0d0a 2020  n.axs)[0].vb..  
+0000a4c0: 2020 2020 2020 6d61 696e 5f76 622e 666f        main_vb.fo
+0000a4d0: 7263 655f 7261 6e67 655f 7570 6461 7465  rce_range_update
+0000a4e0: 203d 206c 656e 2873 656c 662e 7769 6e2e   = len(self.win.
+0000a4f0: 6178 7329 2d31 2023 2075 7064 6174 6520  axs)-1 # update 
+0000a500: 6d61 696e 2061 7320 6d61 6e79 2074 696d  main as many tim
+0000a510: 6573 2061 7320 7468 6572 6520 6172 6520  es as there are 
+0000a520: 6f74 6865 7220 726f 7773 0d0a 2020 2020  other rows..    
+0000a530: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+0000a540: 795f 7a6f 6f6d 2829 0d0a 2020 2020 2020  y_zoom()..      
+0000a550: 2020 2320 7265 6672 6573 6820 6372 6f73    # refresh cros
+0000a560: 7368 6169 7220 7768 656e 2064 6f6e 650d  shair when done.
+0000a570: 0a20 2020 2020 2020 205f 6d6f 7573 655f  .        _mouse_
+0000a580: 6d6f 7665 6428 7365 6c66 2e77 696e 2c20  moved(self.win, 
+0000a590: 7365 6c66 2c20 4e6f 6e65 290d 0a0d 0a20  self, None).... 
+0000a5a0: 2020 2064 6566 2075 7064 6174 655f 795f     def update_y_
+0000a5b0: 7a6f 6f6d 2873 656c 662c 2078 303d 4e6f  zoom(self, x0=No
+0000a5c0: 6e65 2c20 7831 3d4e 6f6e 6529 3a0d 0a20  ne, x1=None):.. 
+0000a5d0: 2020 2020 2020 2064 6174 6173 7263 203d         datasrc =
+0000a5e0: 2073 656c 662e 6461 7461 7372 635f 6f72   self.datasrc_or
+0000a5f0: 5f73 7461 6e64 616c 6f6e 650d 0a20 2020  _standalone..   
+0000a600: 2020 2020 2069 6620 6461 7461 7372 6320       if datasrc 
+0000a610: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+0000a620: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
+0000a630: 2020 2020 2020 6966 2078 3020 6973 204e        if x0 is N
+0000a640: 6f6e 6520 6f72 2078 3120 6973 204e 6f6e  one or x1 is Non
+0000a650: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000a660: 7472 203d 2073 656c 662e 7461 7267 6574  tr = self.target
+0000a670: 5265 6374 2829 0d0a 2020 2020 2020 2020  Rect()..        
+0000a680: 2020 2020 7830 203d 2074 722e 6c65 6674      x0 = tr.left
+0000a690: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0000a6a0: 7831 203d 2074 722e 7269 6768 7428 290d  x1 = tr.right().
+0000a6b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000a6c0: 7831 2d78 3020 3c3d 2031 3a0d 0a20 2020  x1-x0 <= 1:..   
+0000a6d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000a6e0: 7572 6e0d 0a20 2020 2020 2020 2023 206d  urn..        # m
+0000a6f0: 616b 6520 6564 6765 7320 7269 6769 640d  ake edges rigid.
+0000a700: 0a20 2020 2020 2020 2078 6c20 3d20 6d61  .        xl = ma
+0000a710: 7828 5f72 6f75 6e64 2878 302d 7369 6465  x(_round(x0-side
+0000a720: 5f6d 6172 6769 6e29 2b73 6964 655f 6d61  _margin)+side_ma
+0000a730: 7267 696e 2c20 2d73 6964 655f 6d61 7267  rgin, -side_marg
+0000a740: 696e 290d 0a20 2020 2020 2020 2078 7220  in)..        xr 
+0000a750: 3d20 6d69 6e28 5f72 6f75 6e64 2878 312d  = min(_round(x1-
+0000a760: 7369 6465 5f6d 6172 6769 6e29 2b73 6964  side_margin)+sid
+0000a770: 655f 6d61 7267 696e 2c20 6461 7461 7372  e_margin, datasr
+0000a780: 632e 786c 656e 2b72 6967 6874 5f6d 6172  c.xlen+right_mar
+0000a790: 6769 6e5f 6361 6e64 6c65 732d 7369 6465  gin_candles-side
+0000a7a0: 5f6d 6172 6769 6e29 0d0a 2020 2020 2020  _margin)..      
+0000a7b0: 2020 6478 6c20 3d20 786c 2d78 300d 0a20    dxl = xl-x0.. 
+0000a7c0: 2020 2020 2020 2064 7872 203d 2078 722d         dxr = xr-
+0000a7d0: 7831 0d0a 2020 2020 2020 2020 6966 2064  x1..        if d
+0000a7e0: 786c 203e 2030 3a0d 0a20 2020 2020 2020  xl > 0:..       
+0000a7f0: 2020 2020 2078 3120 2b3d 2064 786c 0d0a       x1 += dxl..
+0000a800: 2020 2020 2020 2020 6966 2064 7872 203c          if dxr <
+0000a810: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+0000a820: 2078 3020 2b3d 2064 7872 0d0a 2020 2020   x0 += dxr..    
+0000a830: 2020 2020 7830 203d 206d 6178 285f 726f      x0 = max(_ro
+0000a840: 756e 6428 7830 2d73 6964 655f 6d61 7267  und(x0-side_marg
+0000a850: 696e 292b 7369 6465 5f6d 6172 6769 6e2c  in)+side_margin,
+0000a860: 202d 7369 6465 5f6d 6172 6769 6e29 0d0a   -side_margin)..
+0000a870: 2020 2020 2020 2020 7831 203d 206d 696e          x1 = min
+0000a880: 285f 726f 756e 6428 7831 2d73 6964 655f  (_round(x1-side_
+0000a890: 6d61 7267 696e 292b 7369 6465 5f6d 6172  margin)+side_mar
+0000a8a0: 6769 6e2c 2064 6174 6173 7263 2e78 6c65  gin, datasrc.xle
+0000a8b0: 6e2b 7269 6768 745f 6d61 7267 696e 5f63  n+right_margin_c
+0000a8c0: 616e 646c 6573 2d73 6964 655f 6d61 7267  andles-side_marg
+0000a8d0: 696e 290d 0a20 2020 2020 2020 2023 2066  in)..        # f
+0000a8e0: 6574 6368 2068 692d 6c6f 2061 6e64 2073  etch hi-lo and s
+0000a8f0: 6574 2072 616e 6765 0d0a 2020 2020 2020  et range..      
+0000a900: 2020 5f2c 5f2c 6869 2c6c 6f2c 636e 7420    _,_,hi,lo,cnt 
+0000a910: 3d20 6461 7461 7372 632e 6869 6c6f 2878  = datasrc.hilo(x
+0000a920: 302c 2078 3129 0d0a 2020 2020 2020 2020  0, x1)..        
+0000a930: 7672 203d 2073 656c 662e 7669 6577 5265  vr = self.viewRe
+0000a940: 6374 2829 0d0a 2020 2020 2020 2020 6d69  ct()..        mi
+0000a950: 6e6c 656e 203d 2069 6e74 2828 6d61 785f  nlen = int((max_
+0000a960: 7a6f 6f6d 5f70 6f69 6e74 732d 302e 3529  zoom_points-0.5)
+0000a970: 202a 2073 656c 662e 6d61 785f 7a6f 6f6d   * self.max_zoom
+0000a980: 5f70 6f69 6e74 735f 6620 2b20 302e 3531  _points_f + 0.51
+0000a990: 290d 0a20 2020 2020 2020 2069 6620 2878  )..        if (x
+0000a9a0: 312d 7830 2920 3c20 7672 2e77 6964 7468  1-x0) < vr.width
+0000a9b0: 2829 2061 6e64 2063 6e74 203c 206d 696e  () and cnt < min
+0000a9c0: 6c65 6e3a 0d0a 2020 2020 2020 2020 2020  len:..          
+0000a9d0: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
+0000a9e0: 2020 6966 206e 6f74 2073 656c 662e 765f    if not self.v_
+0000a9f0: 6175 746f 7a6f 6f6d 3a0d 0a20 2020 2020  autozoom:..     
+0000aa00: 2020 2020 2020 2068 6920 3d20 7672 2e62         hi = vr.b
+0000aa10: 6f74 746f 6d28 290d 0a20 2020 2020 2020  ottom()..       
+0000aa20: 2020 2020 206c 6f20 3d20 7672 2e74 6f70       lo = vr.top
+0000aa30: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
+0000aa40: 656c 662e 7973 6361 6c65 2e73 6361 6c65  elf.yscale.scale
+0000aa50: 7479 7065 203d 3d20 276c 6f67 273a 0d0a  type == 'log':..
+0000aa60: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000aa70: 6f20 3c20 303a 0d0a 2020 2020 2020 2020  o < 0:..        
+0000aa80: 2020 2020 2020 2020 6c6f 203d 2030 2e30          lo = 0.0
+0000aa90: 3520 2a20 7365 6c66 2e79 7363 616c 652e  5 * self.yscale.
+0000aaa0: 7363 616c 6566 2023 2073 7472 616e 6765  scalef # strange
+0000aab0: 2051 5420 6c6f 6720 7363 616c 6520 7265   QT log scale re
+0000aac0: 6e64 6572 696e 672c 2077 6869 6368 2049  ndering, which I
+0000aad0: 276d 2075 6e61 626c 6520 746f 2063 6f6d  'm unable to com
+0000aae0: 7065 6e73 6174 6520 666f 720d 0a20 2020  pensate for..   
+0000aaf0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0000ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab10: 6c6f 203d 206d 6178 2831 652d 3130 302c  lo = max(1e-100,
+0000ab20: 206c 6f29 0d0a 2020 2020 2020 2020 2020   lo)..          
+0000ab30: 2020 726e 6720 3d20 2868 6920 2f20 6c6f    rng = (hi / lo
+0000ab40: 2920 2a2a 2028 312f 7365 6c66 2e76 5f7a  ) ** (1/self.v_z
+0000ab50: 6f6f 6d5f 7363 616c 6529 0d0a 2020 2020  oom_scale)..    
+0000ab60: 2020 2020 2020 2020 726e 6720 3d20 6d69          rng = mi
+0000ab70: 6e28 726e 672c 2031 6532 3030 2920 2320  n(rng, 1e200) # 
+0000ab80: 6176 6f69 6420 666c 6f61 7420 6f76 6572  avoid float over
+0000ab90: 666c 6f77 0d0a 2020 2020 2020 2020 2020  flow..          
+0000aba0: 2020 6261 7365 203d 2028 6869 2a6c 6f29    base = (hi*lo)
+0000abb0: 202a 2a20 7365 6c66 2e76 5f7a 6f6f 6d5f   ** self.v_zoom_
+0000abc0: 6261 7365 6c69 6e65 0d0a 2020 2020 2020  baseline..      
+0000abd0: 2020 2020 2020 7930 203d 2062 6173 6520        y0 = base 
+0000abe0: 2f20 726e 672a 2a73 656c 662e 765f 7a6f  / rng**self.v_zo
+0000abf0: 6f6d 5f62 6173 656c 696e 650d 0a20 2020  om_baseline..   
+0000ac00: 2020 2020 2020 2020 2079 3120 3d20 6261           y1 = ba
+0000ac10: 7365 202a 2072 6e67 2a2a 2831 2d73 656c  se * rng**(1-sel
+0000ac20: 662e 765f 7a6f 6f6d 5f62 6173 656c 696e  f.v_zoom_baselin
+0000ac30: 6529 0d0a 2020 2020 2020 2020 656c 7365  e)..        else
+0000ac40: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0000ac50: 6e67 203d 2028 6869 2d6c 6f29 202f 2073  ng = (hi-lo) / s
+0000ac60: 656c 662e 765f 7a6f 6f6d 5f73 6361 6c65  elf.v_zoom_scale
+0000ac70: 0d0a 2020 2020 2020 2020 2020 2020 726e  ..            rn
+0000ac80: 6720 3d20 6d61 7828 726e 672c 2032 652d  g = max(rng, 2e-
+0000ac90: 3729 2023 2073 6f6d 6520 7665 7279 2077  7) # some very w
+0000aca0: 6569 7264 2062 7567 2077 6865 7265 2068  eird bug where h
+0000acb0: 6967 682f 6c6f 7720 6578 706f 6e65 6e74  igh/low exponent
+0000acc0: 7320 7374 6f70 7320 7265 6e64 6572 696e  s stops renderin
+0000acd0: 670d 0a20 2020 2020 2020 2020 2020 2062  g..            b
+0000ace0: 6173 6520 3d20 2868 692b 6c6f 2920 2a20  ase = (hi+lo) * 
+0000acf0: 7365 6c66 2e76 5f7a 6f6f 6d5f 6261 7365  self.v_zoom_base
+0000ad00: 6c69 6e65 0d0a 2020 2020 2020 2020 2020  line..          
+0000ad10: 2020 7930 203d 2062 6173 6520 2d20 726e    y0 = base - rn
+0000ad20: 672a 7365 6c66 2e76 5f7a 6f6f 6d5f 6261  g*self.v_zoom_ba
+0000ad30: 7365 6c69 6e65 0d0a 2020 2020 2020 2020  seline..        
+0000ad40: 2020 2020 7931 203d 2062 6173 6520 2b20      y1 = base + 
+0000ad50: 726e 672a 2831 2d73 656c 662e 765f 7a6f  rng*(1-self.v_zo
+0000ad60: 6f6d 5f62 6173 656c 696e 6529 0d0a 2020  om_baseline)..  
+0000ad70: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+0000ad80: 662e 785f 696e 6465 7865 643a 0d0a 2020  f.x_indexed:..  
+0000ad90: 2020 2020 2020 2020 2020 7830 2c78 3120            x0,x1 
+0000ada0: 3d20 5f78 6d69 6e6d 6178 2864 6174 6173  = _xminmax(datas
+0000adb0: 7263 2c20 785f 696e 6465 7865 643d 4661  rc, x_indexed=Fa
+0000adc0: 6c73 652c 2065 7874 7261 5f6d 6172 6769  lse, extra_margi
+0000add0: 6e3d 3029 0d0a 2020 2020 2020 2020 7265  n=0)..        re
+0000ade0: 7475 726e 2073 656c 662e 7365 745f 7261  turn self.set_ra
+0000adf0: 6e67 6528 7830 2c20 7930 2c20 7831 2c20  nge(x0, y0, x1, 
+0000ae00: 7931 290d 0a0d 0a20 2020 2064 6566 2073  y1)....    def s
+0000ae10: 6574 5f72 616e 6765 2873 656c 662c 2078  et_range(self, x
+0000ae20: 302c 2079 302c 2078 312c 2079 3129 3a0d  0, y0, x1, y1):.
+0000ae30: 0a20 2020 2020 2020 2069 6620 7830 2069  .        if x0 i
+0000ae40: 7320 4e6f 6e65 206f 7220 7831 2069 7320  s None or x1 is 
+0000ae50: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000ae60: 2020 2074 7220 3d20 7365 6c66 2e74 6172     tr = self.tar
+0000ae70: 6765 7452 6563 7428 290d 0a20 2020 2020  getRect()..     
+0000ae80: 2020 2020 2020 2078 3020 3d20 7472 2e6c         x0 = tr.l
+0000ae90: 6566 7428 290d 0a20 2020 2020 2020 2020  eft()..         
+0000aea0: 2020 2078 3120 3d20 7472 2e72 6967 6874     x1 = tr.right
+0000aeb0: 2829 0d0a 2020 2020 2020 2020 6966 206e  ()..        if n
+0000aec0: 702e 6973 6e61 6e28 7930 2920 6f72 206e  p.isnan(y0) or n
+0000aed0: 702e 6973 6e61 6e28 7931 293a 0d0a 2020  p.isnan(y1):..  
+0000aee0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000aef0: 0d0a 2020 2020 2020 2020 5f79 3020 3d20  ..        _y0 = 
+0000af00: 7365 6c66 2e79 7363 616c 652e 696e 7678  self.yscale.invx
+0000af10: 666f 726d 2879 302c 2076 6572 6966 793d  form(y0, verify=
+0000af20: 5472 7565 290d 0a20 2020 2020 2020 205f  True)..        _
+0000af30: 7931 203d 2073 656c 662e 7973 6361 6c65  y1 = self.yscale
+0000af40: 2e69 6e76 7866 6f72 6d28 7931 2c20 7665  .invxform(y1, ve
+0000af50: 7269 6679 3d54 7275 6529 0d0a 2020 2020  rify=True)..    
+0000af60: 2020 2020 7365 6c66 2e73 6574 5261 6e67      self.setRang
+0000af70: 6528 5174 436f 7265 2e51 5265 6374 4628  e(QtCore.QRectF(
+0000af80: 7067 2e50 6f69 6e74 2878 302c 205f 7930  pg.Point(x0, _y0
+0000af90: 292c 2070 672e 506f 696e 7428 7831 2c20  ), pg.Point(x1, 
+0000afa0: 5f79 3129 292c 2070 6164 6469 6e67 3d30  _y1)), padding=0
+0000afb0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000afc0: 7a6f 6f6d 5f63 6861 6e67 6564 2829 0d0a  zoom_changed()..
+0000afd0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0000afe0: 7275 650d 0a0d 0a20 2020 2064 6566 2072  rue....    def r
+0000aff0: 656d 6f76 655f 6c61 7374 5f72 6f69 2873  emove_last_roi(s
+0000b000: 656c 6629 3a0d 0a20 2020 2020 2020 2069  elf):..        i
+0000b010: 6620 7365 6c66 2e72 6f69 733a 0d0a 2020  f self.rois:..  
+0000b020: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000b030: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+0000b040: 2e72 6f69 735b 2d31 5d2c 2070 672e 506f  .rois[-1], pg.Po
+0000b050: 6c79 4c69 6e65 524f 4929 3a0d 0a20 2020  lyLineROI):..   
+0000b060: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000b070: 662e 7265 6d6f 7665 4974 656d 2873 656c  f.removeItem(sel
+0000b080: 662e 726f 6973 5b2d 315d 290d 0a20 2020  f.rois[-1])..   
+0000b090: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000b0a0: 662e 726f 6973 203d 2073 656c 662e 726f  f.rois = self.ro
+0000b0b0: 6973 5b3a 2d31 5d0d 0a20 2020 2020 2020  is[:-1]..       
+0000b0c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000b0d0: 2020 2020 2020 2020 2020 2020 6820 3d20              h = 
+0000b0e0: 7365 6c66 2e72 6f69 735b 2d31 5d2e 6861  self.rois[-1].ha
+0000b0f0: 6e64 6c65 735b 2d31 5d5b 2769 7465 6d27  ndles[-1]['item'
+0000b100: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0000b110: 2020 2073 656c 662e 726f 6973 5b2d 315d     self.rois[-1]
+0000b120: 2e72 656d 6f76 6548 616e 646c 6528 6829  .removeHandle(h)
+0000b130: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b140: 2020 6966 206e 6f74 2073 656c 662e 726f    if not self.ro
+0000b150: 6973 5b2d 315d 2e73 6567 6d65 6e74 733a  is[-1].segments:
+0000b160: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b170: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
+0000b180: 6549 7465 6d28 7365 6c66 2e72 6f69 735b  eItem(self.rois[
+0000b190: 2d31 5d29 0d0a 2020 2020 2020 2020 2020  -1])..          
+0000b1a0: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+0000b1b0: 6f69 7320 3d20 7365 6c66 2e72 6f69 735b  ois = self.rois[
+0000b1c0: 3a2d 315d 0d0a 2020 2020 2020 2020 2020  :-1]..          
+0000b1d0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+0000b1e0: 7261 775f 6c69 6e65 203d 204e 6f6e 650d  raw_line = None.
+0000b1f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000b200: 7365 6c66 2e72 6f69 733a 0d0a 2020 2020  self.rois:..    
+0000b210: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000b220: 7369 6e73 7461 6e63 6528 7365 6c66 2e72  sinstance(self.r
+0000b230: 6f69 735b 2d31 5d2c 2070 672e 506f 6c79  ois[-1], pg.Poly
+0000b240: 4c69 6e65 524f 4929 3a0d 0a20 2020 2020  LineROI):..     
+0000b250: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b260: 656c 662e 6472 6177 5f6c 696e 6520 3d20  elf.draw_line = 
+0000b270: 7365 6c66 2e72 6f69 735b 2d31 5d0d 0a20  self.rois[-1].. 
+0000b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b290: 2020 2073 656c 662e 7365 745f 6472 6177     self.set_draw
+0000b2a0: 5f6c 696e 655f 636f 6c6f 7228 6472 6177  _line_color(draw
+0000b2b0: 5f6c 696e 655f 636f 6c6f 7229 0d0a 2020  _line_color)..  
+0000b2c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000b2d0: 2054 7275 650d 0a0d 0a20 2020 2064 6566   True....    def
+0000b2e0: 2061 7070 656e 645f 6472 6177 5f73 6567   append_draw_seg
+0000b2f0: 6d65 6e74 2873 656c 662c 2070 293a 0d0a  ment(self, p):..
+0000b300: 2020 2020 2020 2020 6830 203d 2073 656c          h0 = sel
+0000b310: 662e 6472 6177 5f6c 696e 652e 6861 6e64  f.draw_line.hand
+0000b320: 6c65 735b 2d31 5d5b 2769 7465 6d27 5d0d  les[-1]['item'].
+0000b330: 0a20 2020 2020 2020 2068 3120 3d20 7365  .        h1 = se
+0000b340: 6c66 2e64 7261 775f 6c69 6e65 2e61 6464  lf.draw_line.add
+0000b350: 4672 6565 4861 6e64 6c65 2870 290d 0a20  FreeHandle(p).. 
+0000b360: 2020 2020 2020 2073 656c 662e 6472 6177         self.draw
+0000b370: 5f6c 696e 652e 6164 6453 6567 6d65 6e74  _line.addSegment
+0000b380: 2868 302c 2068 3129 0d0a 2020 2020 2020  (h0, h1)..      
+0000b390: 2020 7365 6c66 2e64 7261 7769 6e67 203d    self.drawing =
+0000b3a0: 2054 7275 650d 0a0d 0a20 2020 2064 6566   True....    def
+0000b3b0: 2073 6574 5f64 7261 775f 6c69 6e65 5f63   set_draw_line_c
+0000b3c0: 6f6c 6f72 2873 656c 662c 2063 6f6c 6f72  olor(self, color
+0000b3d0: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
+0000b3e0: 656c 662e 6472 6177 5f6c 696e 653a 0d0a  elf.draw_line:..
+0000b3f0: 2020 2020 2020 2020 2020 2020 7065 6e20              pen 
+0000b400: 3d20 7067 2e6d 6b50 656e 2863 6f6c 6f72  = pg.mkPen(color
+0000b410: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
+0000b420: 6f72 2073 6567 6d65 6e74 2069 6e20 7365  or segment in se
+0000b430: 6c66 2e64 7261 775f 6c69 6e65 2e73 6567  lf.draw_line.seg
+0000b440: 6d65 6e74 733a 0d0a 2020 2020 2020 2020  ments:..        
+0000b450: 2020 2020 2020 2020 7365 676d 656e 742e          segment.
+0000b460: 6375 7272 656e 7450 656e 203d 2073 6567  currentPen = seg
+0000b470: 6d65 6e74 2e70 656e 203d 2070 656e 0d0a  ment.pen = pen..
+0000b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b490: 7365 676d 656e 742e 7570 6461 7465 2829  segment.update()
+0000b4a0: 0d0a 0d0a 2020 2020 6465 6620 7375 6767  ....    def sugg
+0000b4b0: 6573 7450 6164 6469 6e67 2873 656c 662c  estPadding(self,
+0000b4c0: 2061 7869 7329 3a0d 0a20 2020 2020 2020   axis):..       
+0000b4d0: 2072 6574 7572 6e20 300d 0a0d 0a20 2020   return 0....   
+0000b4e0: 2064 6566 207a 6f6f 6d5f 6368 616e 6765   def zoom_change
+0000b4f0: 6428 7365 6c66 293a 0d0a 2020 2020 2020  d(self):..      
+0000b500: 2020 666f 7220 7a6c 2069 6e20 7365 6c66    for zl in self
+0000b510: 2e7a 6f6f 6d5f 6c69 7374 656e 6572 733a  .zoom_listeners:
+0000b520: 0d0a 2020 2020 2020 2020 2020 2020 7a6c  ..            zl
+0000b530: 2873 656c 6629 0d0a 0d0a 0d0a 0d0a 636c  (self)........cl
+0000b540: 6173 7320 4669 6e50 6c6f 7449 7465 6d28  ass FinPlotItem(
+0000b550: 7067 2e47 7261 7068 6963 734f 626a 6563  pg.GraphicsObjec
+0000b560: 7429 3a0d 0a20 2020 2064 6566 205f 5f69  t):..    def __i
+0000b570: 6e69 745f 5f28 7365 6c66 2c20 6178 2c20  nit__(self, ax, 
+0000b580: 6461 7461 7372 632c 206c 6f64 293a 0d0a  datasrc, lod):..
+0000b590: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+0000b5a0: 5f5f 696e 6974 5f5f 2829 0d0a 2020 2020  __init__()..    
+0000b5b0: 2020 2020 7365 6c66 2e61 7820 3d20 6178      self.ax = ax
+0000b5c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+0000b5d0: 6174 6173 7263 203d 2064 6174 6173 7263  atasrc = datasrc
+0000b5e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0000b5f0: 6963 7475 7265 203d 2051 7447 7569 2e51  icture = QtGui.Q
+0000b600: 5069 6374 7572 6528 290d 0a20 2020 2020  Picture()..     
+0000b610: 2020 2073 656c 662e 7061 696e 7465 7220     self.painter 
+0000b620: 3d20 5174 4775 692e 5150 6169 6e74 6572  = QtGui.QPainter
+0000b630: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+0000b640: 2e64 6972 7479 203d 2054 7275 650d 0a20  .dirty = True.. 
+0000b650: 2020 2020 2020 2073 656c 662e 6c6f 6420         self.lod 
+0000b660: 3d20 6c6f 640d 0a20 2020 2020 2020 2073  = lod..        s
+0000b670: 656c 662e 6361 6368 6564 5265 6374 203d  elf.cachedRect =
+0000b680: 204e 6f6e 650d 0a0d 0a20 2020 2064 6566   None....    def
+0000b690: 2072 6570 6169 6e74 2873 656c 6629 3a0d   repaint(self):.
+0000b6a0: 0a20 2020 2020 2020 2073 656c 662e 6469  .        self.di
+0000b6b0: 7274 7920 3d20 5472 7565 0d0a 2020 2020  rty = True..    
+0000b6c0: 2020 2020 7365 6c66 2e70 6169 6e74 284e      self.paint(N
+0000b6d0: 6f6e 6529 0d0a 0d0a 2020 2020 6465 6620  one)....    def 
+0000b6e0: 7061 696e 7428 7365 6c66 2c20 702c 202a  paint(self, p, *
+0000b6f0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0000b700: 6966 2073 656c 662e 6461 7461 7372 632e  if self.datasrc.
+0000b710: 6973 5f73 7061 7273 653a 0d0a 2020 2020  is_sparse:..    
+0000b720: 2020 2020 2020 2020 7365 6c66 2e64 6972          self.dir
+0000b730: 7479 203d 2054 7275 650d 0a20 2020 2020  ty = True..     
+0000b740: 2020 2073 656c 662e 7570 6461 7465 5f64     self.update_d
+0000b750: 6972 7479 5f70 6963 7475 7265 2873 656c  irty_picture(sel
+0000b760: 662e 7669 6577 5265 6374 2829 290d 0a20  f.viewRect()).. 
+0000b770: 2020 2020 2020 2069 6620 7020 6973 206e         if p is n
+0000b780: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+0000b790: 2020 2020 2020 702e 6472 6177 5069 6374        p.drawPict
+0000b7a0: 7572 6528 302c 2030 2c20 7365 6c66 2e70  ure(0, 0, self.p
+0000b7b0: 6963 7475 7265 290d 0a0d 0a20 2020 2064  icture)....    d
+0000b7c0: 6566 2075 7064 6174 655f 6469 7274 795f  ef update_dirty_
+0000b7d0: 7069 6374 7572 6528 7365 6c66 2c20 7669  picture(self, vi
+0000b7e0: 7369 626c 6552 6563 7429 3a0d 0a20 2020  sibleRect):..   
+0000b7f0: 2020 2020 2069 6620 7365 6c66 2e64 6972       if self.dir
+0000b800: 7479 206f 7220 5c0d 0a20 2020 2020 2020  ty or \..       
+0000b810: 2020 2020 2028 7365 6c66 2e6c 6f64 2061       (self.lod a
+0000b820: 6e64 2023 2072 6567 656e 6572 6174 6520  nd # regenerate 
+0000b830: 7768 656e 207a 6f6f 6d20 6368 616e 6765  when zoom change
+0000b840: 733f 0d0a 2020 2020 2020 2020 2020 2020  s?..            
+0000b850: 2020 2020 2876 6973 6962 6c65 5265 6374      (visibleRect
+0000b860: 2e6c 6566 7428 2920 3c20 7365 6c66 2e63  .left() < self.c
+0000b870: 6163 6865 6452 6563 742e 6c65 6674 2829  achedRect.left()
+0000b880: 206f 7220 5c0d 0a20 2020 2020 2020 2020   or \..         
+0000b890: 2020 2020 2020 2020 7669 7369 626c 6552          visibleR
+0000b8a0: 6563 742e 7269 6768 7428 2920 3e20 7365  ect.right() > se
+0000b8b0: 6c66 2e63 6163 6865 6452 6563 742e 7269  lf.cachedRect.ri
+0000b8c0: 6768 7428 2920 6f72 205c 0d0a 2020 2020  ght() or \..    
+0000b8d0: 2020 2020 2020 2020 2020 2020 2076 6973               vis
+0000b8e0: 6962 6c65 5265 6374 2e77 6964 7468 2829  ibleRect.width()
+0000b8f0: 203c 2073 656c 662e 6361 6368 6564 5265   < self.cachedRe
+0000b900: 6374 2e77 6964 7468 2829 202f 2063 6163  ct.width() / cac
+0000b910: 6865 5f63 616e 646c 655f 6661 6374 6f72  he_candle_factor
+0000b920: 2929 3a20 2320 6f70 7469 6d69 7a65 2077  )): # optimize w
+0000b930: 6865 6e20 7a6f 6f6d 696e 6720 696e 0d0a  hen zooming in..
+0000b940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b950: 2e5f 6765 6e65 7261 7465 5f70 6963 7475  ._generate_pictu
+0000b960: 7265 2876 6973 6962 6c65 5265 6374 290d  re(visibleRect).
+0000b970: 0a0d 0a20 2020 2064 6566 205f 6765 6e65  ...    def _gene
+0000b980: 7261 7465 5f70 6963 7475 7265 2873 656c  rate_picture(sel
+0000b990: 662c 2062 6f75 6e64 696e 6752 6563 7429  f, boundingRect)
+0000b9a0: 3a0d 0a20 2020 2020 2020 2077 203d 2062  :..        w = b
+0000b9b0: 6f75 6e64 696e 6752 6563 742e 7769 6474  oundingRect.widt
+0000b9c0: 6828 290d 0a20 2020 2020 2020 2073 656c  h()..        sel
+0000b9d0: 662e 6361 6368 6564 5265 6374 203d 2051  f.cachedRect = Q
+0000b9e0: 7443 6f72 652e 5152 6563 7446 2862 6f75  tCore.QRectF(bou
+0000b9f0: 6e64 696e 6752 6563 742e 6c65 6674 2829  ndingRect.left()
+0000ba00: 2d28 6361 6368 655f 6361 6e64 6c65 5f66  -(cache_candle_f
+0000ba10: 6163 746f 722d 3129 2a30 2e35 2a77 2c20  actor-1)*0.5*w, 
+0000ba20: 302c 2063 6163 6865 5f63 616e 646c 655f  0, cache_candle_
+0000ba30: 6661 6374 6f72 2a77 2c20 3029 0d0a 2020  factor*w, 0)..  
+0000ba40: 2020 2020 2020 7365 6c66 2e70 6169 6e74        self.paint
+0000ba50: 6572 2e62 6567 696e 2873 656c 662e 7069  er.begin(self.pi
+0000ba60: 6374 7572 6529 0d0a 2020 2020 2020 2020  cture)..        
+0000ba70: 7365 6c66 2e5f 6765 6e65 7261 7465 5f64  self._generate_d
+0000ba80: 756d 6d79 5f70 6963 7475 7265 2873 656c  ummy_picture(sel
+0000ba90: 662e 7669 6577 5265 6374 2829 290d 0a20  f.viewRect()).. 
+0000baa0: 2020 2020 2020 2073 656c 662e 6765 6e65         self.gene
+0000bab0: 7261 7465 5f70 6963 7475 7265 2873 656c  rate_picture(sel
+0000bac0: 662e 6361 6368 6564 5265 6374 290d 0a20  f.cachedRect).. 
+0000bad0: 2020 2020 2020 2073 656c 662e 7061 696e         self.pain
+0000bae0: 7465 722e 656e 6428 290d 0a20 2020 2020  ter.end()..     
+0000baf0: 2020 2073 656c 662e 6469 7274 7920 3d20     self.dirty = 
+0000bb00: 4661 6c73 650d 0a0d 0a20 2020 2064 6566  False....    def
+0000bb10: 205f 6765 6e65 7261 7465 5f64 756d 6d79   _generate_dummy
+0000bb20: 5f70 6963 7475 7265 2873 656c 662c 2062  _picture(self, b
+0000bb30: 6f75 6e64 696e 6752 6563 7429 3a0d 0a20  oundingRect):.. 
+0000bb40: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
+0000bb50: 6174 6173 7263 2e69 735f 7370 6172 7365  atasrc.is_sparse
+0000bb60: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0000bb70: 206a 7573 7420 6472 6177 2073 6f6d 6574   just draw somet
+0000bb80: 6869 6e67 2074 6f20 656e 7375 7265 2050  hing to ensure P
+0000bb90: 7951 7420 7769 6c6c 2070 6169 6e74 2075  yQt will paint u
+0000bba0: 7320 6167 6169 6e0d 0a20 2020 2020 2020  s again..       
+0000bbb0: 2020 2020 2073 656c 662e 7061 696e 7465       self.painte
+0000bbc0: 722e 7365 7450 656e 2870 672e 6d6b 5065  r.setPen(pg.mkPe
+0000bbd0: 6e28 6261 636b 6772 6f75 6e64 2929 0d0a  n(background))..
+0000bbe0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bbf0: 2e70 6169 6e74 6572 2e73 6574 4272 7573  .painter.setBrus
+0000bc00: 6828 7067 2e6d 6b42 7275 7368 2862 6163  h(pg.mkBrush(bac
+0000bc10: 6b67 726f 756e 6429 290d 0a20 2020 2020  kground))..     
+0000bc20: 2020 2020 2020 206c 2c72 203d 2062 6f75         l,r = bou
+0000bc30: 6e64 696e 6752 6563 742e 6c65 6674 2829  ndingRect.left()
+0000bc40: 2c20 626f 756e 6469 6e67 5265 6374 2e72  , boundingRect.r
+0000bc50: 6967 6874 2829 0d0a 2020 2020 2020 2020  ight()..        
+0000bc60: 2020 2020 7365 6c66 2e70 6169 6e74 6572      self.painter
+0000bc70: 2e64 7261 7752 6563 7428 5174 436f 7265  .drawRect(QtCore
+0000bc80: 2e51 5265 6374 4628 6c2c 2062 6f75 6e64  .QRectF(l, bound
+0000bc90: 696e 6752 6563 742e 746f 7028 292c 2031  ingRect.top(), 1
+0000bca0: 652d 332c 2062 6f75 6e64 696e 6752 6563  e-3, boundingRec
+0000bcb0: 742e 6865 6967 6874 2829 2a31 652d 3529  t.height()*1e-5)
+0000bcc0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0000bcd0: 656c 662e 7061 696e 7465 722e 6472 6177  elf.painter.draw
+0000bce0: 5265 6374 2851 7443 6f72 652e 5152 6563  Rect(QtCore.QRec
+0000bcf0: 7446 2872 2c20 626f 756e 6469 6e67 5265  tF(r, boundingRe
+0000bd00: 6374 2e62 6f74 746f 6d28 292c 202d 3165  ct.bottom(), -1e
+0000bd10: 2d33 2c20 2d62 6f75 6e64 696e 6752 6563  -3, -boundingRec
+0000bd20: 742e 6865 6967 6874 2829 2a31 652d 3529  t.height()*1e-5)
+0000bd30: 290d 0a0d 0a20 2020 2064 6566 2062 6f75  )....    def bou
+0000bd40: 6e64 696e 6752 6563 7428 7365 6c66 293a  ndingRect(self):
+0000bd50: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000bd60: 2051 7443 6f72 652e 5152 6563 7446 2873   QtCore.QRectF(s
+0000bd70: 656c 662e 7069 6374 7572 652e 626f 756e  elf.picture.boun
+0000bd80: 6469 6e67 5265 6374 2829 290d 0a0d 0a0d  dingRect()).....
+0000bd90: 0a0d 0a63 6c61 7373 2043 616e 646c 6573  ...class Candles
+0000bda0: 7469 636b 4974 656d 2846 696e 506c 6f74  tickItem(FinPlot
+0000bdb0: 4974 656d 293a 0d0a 2020 2020 6465 6620  Item):..    def 
+0000bdc0: 5f5f 696e 6974 5f5f 2873 656c 662c 2061  __init__(self, a
+0000bdd0: 782c 2064 6174 6173 7263 2c20 6472 6177  x, datasrc, draw
+0000bde0: 5f62 6f64 792c 2064 7261 775f 7368 6164  _body, draw_shad
+0000bdf0: 6f77 2c20 6361 6e64 6c65 5f77 6964 7468  ow, candle_width
+0000be00: 2c20 636f 6c6f 7266 756e 632c 2072 6573  , colorfunc, res
+0000be10: 616d 703d 4e6f 6e65 293a 0d0a 2020 2020  amp=None):..    
+0000be20: 2020 2020 7365 6c66 2e63 6f6c 6f72 7320      self.colors 
+0000be30: 3d20 6469 6374 2862 756c 6c5f 7368 6164  = dict(bull_shad
+0000be40: 6f77 2020 2020 2020 3d20 6361 6e64 6c65  ow      = candle
+0000be50: 5f62 756c 6c5f 636f 6c6f 722c 0d0a 2020  _bull_color,..  
 0000be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be70: 2020 7765 616b 5f62 756c 6c5f 7368 6164    weak_bull_shad
-0000be80: 6f77 203d 2062 7269 6768 7465 6e28 6361  ow = brighten(ca
-0000be90: 6e64 6c65 5f62 756c 6c5f 636f 6c6f 722c  ndle_bull_color,
-0000bea0: 2031 2e32 292c 0d0a 2020 2020 2020 2020   1.2),..        
-0000beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bec0: 2020 2077 6561 6b5f 6275 6c6c 5f66 7261     weak_bull_fra
-0000bed0: 6d65 2020 3d20 6272 6967 6874 656e 2863  me  = brighten(c
-0000bee0: 616e 646c 655f 6275 6c6c 5f63 6f6c 6f72  andle_bull_color
-0000bef0: 2c20 312e 3229 2c0d 0a20 2020 2020 2020  , 1.2),..       
-0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf10: 2020 2020 7765 616b 5f62 756c 6c5f 626f      weak_bull_bo
-0000bf20: 6479 2020 203d 2062 7269 6768 7465 6e28  dy   = brighten(
-0000bf30: 6361 6e64 6c65 5f62 756c 6c5f 636f 6c6f  candle_bull_colo
-0000bf40: 722c 2031 2e32 292c 0d0a 2020 2020 2020  r, 1.2),..      
-0000bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf60: 2020 2020 2077 6561 6b5f 6265 6172 5f73       weak_bear_s
-0000bf70: 6861 646f 7720 3d20 6272 6967 6874 656e  hadow = brighten
-0000bf80: 2863 616e 646c 655f 6265 6172 5f63 6f6c  (candle_bear_col
-0000bf90: 6f72 2c20 312e 3529 2c0d 0a20 2020 2020  or, 1.5),..     
-0000bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfb0: 2020 2020 2020 7765 616b 5f62 6561 725f        weak_bear_
-0000bfc0: 6672 616d 6520 203d 2062 7269 6768 7465  frame  = brighte
-0000bfd0: 6e28 6361 6e64 6c65 5f62 6561 725f 636f  n(candle_bear_co
-0000bfe0: 6c6f 722c 2031 2e35 292c 0d0a 2020 2020  lor, 1.5),..    
-0000bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c000: 2020 2020 2020 2077 6561 6b5f 6265 6172         weak_bear
-0000c010: 5f62 6f64 7920 2020 3d20 6272 6967 6874  _body   = bright
-0000c020: 656e 2863 616e 646c 655f 6265 6172 5f63  en(candle_bear_c
-0000c030: 6f6c 6f72 2c20 312e 3529 290d 0a20 2020  olor, 1.5))..   
-0000c040: 2020 2020 2073 656c 662e 6472 6177 5f62       self.draw_b
-0000c050: 6f64 7920 3d20 6472 6177 5f62 6f64 790d  ody = draw_body.
-0000c060: 0a20 2020 2020 2020 2073 656c 662e 6472  .        self.dr
-0000c070: 6177 5f73 6861 646f 7720 3d20 6472 6177  aw_shadow = draw
-0000c080: 5f73 6861 646f 770d 0a20 2020 2020 2020  _shadow..       
-0000c090: 2073 656c 662e 6361 6e64 6c65 5f77 6964   self.candle_wid
-0000c0a0: 7468 203d 2063 616e 646c 655f 7769 6474  th = candle_widt
-0000c0b0: 680d 0a20 2020 2020 2020 2073 656c 662e  h..        self.
-0000c0c0: 7368 6164 6f77 5f77 6964 7468 203d 2063  shadow_width = c
-0000c0d0: 616e 646c 655f 7368 6164 6f77 5f77 6964  andle_shadow_wid
-0000c0e0: 7468 0d0a 2020 2020 2020 2020 7365 6c66  th..        self
-0000c0f0: 2e63 6f6c 6f72 6675 6e63 203d 2063 6f6c  .colorfunc = col
-0000c100: 6f72 6675 6e63 0d0a 2020 2020 2020 2020  orfunc..        
-0000c110: 7365 6c66 2e72 6573 616d 7020 3d20 7265  self.resamp = re
-0000c120: 7361 6d70 0d0a 2020 2020 2020 2020 7365  samp..        se
-0000c130: 6c66 2e78 5f6f 6666 7365 7420 3d20 300d  lf.x_offset = 0.
-0000c140: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
-0000c150: 2e5f 5f69 6e69 745f 5f28 6178 2c20 6461  .__init__(ax, da
-0000c160: 7461 7372 632c 206c 6f64 3d54 7275 6529  tasrc, lod=True)
-0000c170: 0d0a 0d0a 2020 2020 6465 6620 6765 6e65  ....    def gene
-0000c180: 7261 7465 5f70 6963 7475 7265 2873 656c  rate_picture(sel
-0000c190: 662c 2062 6f75 6e64 696e 6752 6563 7429  f, boundingRect)
-0000c1a0: 3a0d 0a20 2020 2020 2020 206c 6566 742c  :..        left,
-0000c1b0: 7269 6768 7420 3d20 626f 756e 6469 6e67  right = bounding
-0000c1c0: 5265 6374 2e6c 6566 7428 292c 2062 6f75  Rect.left(), bou
-0000c1d0: 6e64 696e 6752 6563 742e 7269 6768 7428  ndingRect.right(
-0000c1e0: 290d 0a20 2020 2020 2020 2070 203d 2073  )..        p = s
-0000c1f0: 656c 662e 7061 696e 7465 720d 0a20 2020  elf.painter..   
-0000c200: 2020 2020 2064 662c 6f72 6967 6c65 6e20       df,origlen 
-0000c210: 3d20 7365 6c66 2e64 6174 6173 7263 2e72  = self.datasrc.r
-0000c220: 6f77 7328 352c 206c 6566 742c 2072 6967  ows(5, left, rig
-0000c230: 6874 2c20 7973 6361 6c65 3d73 656c 662e  ht, yscale=self.
-0000c240: 6178 2e76 622e 7973 6361 6c65 2c20 7265  ax.vb.yscale, re
-0000c250: 7361 6d70 3d73 656c 662e 7265 7361 6d70  samp=self.resamp
-0000c260: 290d 0a20 2020 2020 2020 2066 203d 206f  )..        f = o
-0000c270: 7269 676c 656e 202f 206c 656e 2864 6629  riglen / len(df)
-0000c280: 2069 6620 6c65 6e28 6466 2920 656c 7365   if len(df) else
-0000c290: 2031 0d0a 2020 2020 2020 2020 7720 3d20   1..        w = 
-0000c2a0: 7365 6c66 2e63 616e 646c 655f 7769 6474  self.candle_widt
-0000c2b0: 6820 2a20 660d 0a20 2020 2020 2020 2077  h * f..        w
-0000c2c0: 3220 3d20 7720 2a20 302e 350d 0a20 2020  2 = w * 0.5..   
-0000c2d0: 2020 2020 2066 6f72 2073 6861 646f 772c       for shadow,
-0000c2e0: 6672 616d 652c 626f 6479 2c64 665f 726f  frame,body,df_ro
-0000c2f0: 7773 2069 6e20 7365 6c66 2e63 6f6c 6f72  ws in self.color
-0000c300: 6675 6e63 2873 656c 662c 2073 656c 662e  func(self, self.
-0000c310: 6461 7461 7372 632c 2064 6629 3a0d 0a20  datasrc, df):.. 
-0000c320: 2020 2020 2020 2020 2020 2069 6478 7320             idxs 
-0000c330: 3d20 6466 5f72 6f77 732e 696e 6465 780d  = df_rows.index.
-0000c340: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
-0000c350: 7320 3d20 6466 5f72 6f77 732e 7661 6c75  s = df_rows.valu
-0000c360: 6573 0d0a 2020 2020 2020 2020 2020 2020  es..            
-0000c370: 6966 2073 656c 662e 785f 6f66 6673 6574  if self.x_offset
-0000c380: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000c390: 2020 2069 6478 7320 2b3d 2073 656c 662e     idxs += self.
-0000c3a0: 785f 6f66 6673 6574 0d0a 2020 2020 2020  x_offset..      
-0000c3b0: 2020 2020 2020 6966 2073 656c 662e 6472        if self.dr
-0000c3c0: 6177 5f73 6861 646f 773a 0d0a 2020 2020  aw_shadow:..    
-0000c3d0: 2020 2020 2020 2020 2020 2020 702e 7365              p.se
-0000c3e0: 7450 656e 2870 672e 6d6b 5065 6e28 7368  tPen(pg.mkPen(sh
-0000c3f0: 6164 6f77 2c20 7769 6474 683d 7365 6c66  adow, width=self
-0000c400: 2e73 6861 646f 775f 7769 6474 6829 290d  .shadow_width)).
-0000c410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c420: 2066 6f72 2078 2c28 742c 6f70 656e 2c63   for x,(t,open,c
-0000c430: 6c6f 7365 2c68 6967 682c 6c6f 7729 2069  lose,high,low) i
-0000c440: 6e20 7a69 7028 6964 7873 2c20 726f 7773  n zip(idxs, rows
-0000c450: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000c460: 2020 2020 2020 2020 6966 2068 6967 6820          if high 
-0000c470: 3e20 6c6f 773a 0d0a 2020 2020 2020 2020  > low:..        
-0000c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c490: 702e 6472 6177 4c69 6e65 2851 7443 6f72  p.drawLine(QtCor
-0000c4a0: 652e 5150 6f69 6e74 4628 782c 206c 6f77  e.QPointF(x, low
-0000c4b0: 292c 2051 7443 6f72 652e 5150 6f69 6e74  ), QtCore.QPoint
-0000c4c0: 4628 782c 2068 6967 6829 290d 0a20 2020  F(x, high))..   
-0000c4d0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000c4e0: 2e64 7261 775f 626f 6479 3a0d 0a20 2020  .draw_body:..   
-0000c4f0: 2020 2020 2020 2020 2020 2020 2070 2e73               p.s
-0000c500: 6574 5065 6e28 7067 2e6d 6b50 656e 2866  etPen(pg.mkPen(f
-0000c510: 7261 6d65 2929 0d0a 2020 2020 2020 2020  rame))..        
-0000c520: 2020 2020 2020 2020 702e 7365 7442 7275          p.setBru
-0000c530: 7368 2870 672e 6d6b 4272 7573 6828 626f  sh(pg.mkBrush(bo
-0000c540: 6479 2929 0d0a 2020 2020 2020 2020 2020  dy))..          
-0000c550: 2020 2020 2020 666f 7220 782c 2874 2c6f        for x,(t,o
-0000c560: 7065 6e2c 636c 6f73 652c 6869 6768 2c6c  pen,close,high,l
-0000c570: 6f77 2920 696e 207a 6970 2869 6478 732c  ow) in zip(idxs,
-0000c580: 2072 6f77 7329 3a0d 0a20 2020 2020 2020   rows):..       
-0000c590: 2020 2020 2020 2020 2020 2020 2070 2e64               p.d
-0000c5a0: 7261 7752 6563 7428 5174 436f 7265 2e51  rawRect(QtCore.Q
-0000c5b0: 5265 6374 4628 782d 7732 2c20 6f70 656e  RectF(x-w2, open
-0000c5c0: 2c20 772c 2063 6c6f 7365 2d6f 7065 6e29  , w, close-open)
-0000c5d0: 290d 0a0d 0a20 2020 2064 6566 2072 6f77  )....    def row
-0000c5e0: 636f 6c6f 7273 2873 656c 662c 2070 7265  colors(self, pre
-0000c5f0: 6669 7829 3a0d 0a20 2020 2020 2020 2072  fix):..        r
-0000c600: 6574 7572 6e20 5b73 656c 662e 636f 6c6f  eturn [self.colo
-0000c610: 7273 5b70 7265 6669 782b 275f 7368 6164  rs[prefix+'_shad
-0000c620: 6f77 275d 2c20 7365 6c66 2e63 6f6c 6f72  ow'], self.color
-0000c630: 735b 7072 6566 6978 2b27 5f66 7261 6d65  s[prefix+'_frame
-0000c640: 275d 2c20 7365 6c66 2e63 6f6c 6f72 735b  '], self.colors[
-0000c650: 7072 6566 6978 2b27 5f62 6f64 7927 5d5d  prefix+'_body']]
-0000c660: 0d0a 0d0a 0d0a 0d0a 636c 6173 7320 4865  ........class He
-0000c670: 6174 6d61 7049 7465 6d28 4669 6e50 6c6f  atmapItem(FinPlo
-0000c680: 7449 7465 6d29 3a0d 0a20 2020 2064 6566  tItem):..    def
-0000c690: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0000c6a0: 6178 2c20 6461 7461 7372 632c 2072 6563  ax, datasrc, rec
-0000c6b0: 745f 7369 7a65 3d30 2e39 2c20 6669 6c74  t_size=0.9, filt
-0000c6c0: 6572 5f6c 696d 6974 3d30 2c20 636f 6c6d  er_limit=0, colm
-0000c6d0: 6170 3d63 6f6c 6d61 705f 636c 6173 682c  ap=colmap_clash,
-0000c6e0: 2077 6869 7465 6f75 743d 302e 302c 2063   whiteout=0.0, c
-0000c6f0: 6f6c 6375 7276 653d 6c61 6d62 6461 2078  olcurve=lambda x
-0000c700: 3a70 6f77 2878 2c34 2929 3a0d 0a20 2020  :pow(x,4)):..   
-0000c710: 2020 2020 2073 656c 662e 7265 6374 5f73       self.rect_s
-0000c720: 697a 6520 3d20 7265 6374 5f73 697a 650d  ize = rect_size.
-0000c730: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
-0000c740: 6c74 6572 5f6c 696d 6974 203d 2066 696c  lter_limit = fil
-0000c750: 7465 725f 6c69 6d69 740d 0a20 2020 2020  ter_limit..     
-0000c760: 2020 2073 656c 662e 636f 6c6d 6170 203d     self.colmap =
-0000c770: 2063 6f6c 6d61 700d 0a20 2020 2020 2020   colmap..       
-0000c780: 2073 656c 662e 7768 6974 656f 7574 203d   self.whiteout =
-0000c790: 2077 6869 7465 6f75 740d 0a20 2020 2020   whiteout..     
-0000c7a0: 2020 2073 656c 662e 636f 6c63 7572 7665     self.colcurve
-0000c7b0: 203d 2063 6f6c 6375 7276 650d 0a20 2020   = colcurve..   
-0000c7c0: 2020 2020 2073 656c 662e 636f 6c5f 6461       self.col_da
-0000c7d0: 7461 5f65 6e64 203d 206c 656e 2864 6174  ta_end = len(dat
-0000c7e0: 6173 7263 2e64 662e 636f 6c75 6d6e 7329  asrc.df.columns)
-0000c7f0: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
-0000c800: 292e 5f5f 696e 6974 5f5f 2861 782c 2064  ).__init__(ax, d
-0000c810: 6174 6173 7263 2c20 6c6f 643d 4661 6c73  atasrc, lod=Fals
-0000c820: 6529 0d0a 0d0a 2020 2020 6465 6620 6765  e)....    def ge
-0000c830: 6e65 7261 7465 5f70 6963 7475 7265 2873  nerate_picture(s
-0000c840: 656c 662c 2062 6f75 6e64 696e 6752 6563  elf, boundingRec
-0000c850: 7429 3a0d 0a20 2020 2020 2020 2070 7269  t):..        pri
-0000c860: 6365 7320 3d20 7365 6c66 2e64 6174 6173  ces = self.datas
-0000c870: 7263 2e64 662e 636f 6c75 6d6e 735b 7365  rc.df.columns[se
-0000c880: 6c66 2e64 6174 6173 7263 2e63 6f6c 5f64  lf.datasrc.col_d
-0000c890: 6174 615f 6f66 6673 6574 3a73 656c 662e  ata_offset:self.
-0000c8a0: 636f 6c5f 6461 7461 5f65 6e64 5d0d 0a20  col_data_end].. 
-0000c8b0: 2020 2020 2020 2068 3020 3d20 2870 7269         h0 = (pri
-0000c8c0: 6365 735b 305d 202d 2070 7269 6365 735b  ces[0] - prices[
-0000c8d0: 315d 2920 2a20 2831 2d73 656c 662e 7265  1]) * (1-self.re
-0000c8e0: 6374 5f73 697a 6529 0d0a 2020 2020 2020  ct_size)..      
-0000c8f0: 2020 6831 203d 2028 7072 6963 6573 5b30    h1 = (prices[0
-0000c900: 5d20 2d20 7072 6963 6573 5b31 5d29 202a  ] - prices[1]) *
-0000c910: 2028 312d 2831 2d73 656c 662e 7265 6374   (1-(1-self.rect
-0000c920: 5f73 697a 6529 2a32 290d 0a20 2020 2020  _size)*2)..     
-0000c930: 2020 2072 6563 745f 7369 7a65 3220 3d20     rect_size2 = 
-0000c940: 302e 3520 2a20 7365 6c66 2e72 6563 745f  0.5 * self.rect_
-0000c950: 7369 7a65 0d0a 2020 2020 2020 2020 6466  size..        df
-0000c960: 203d 2073 656c 662e 6461 7461 7372 632e   = self.datasrc.
-0000c970: 6466 2e69 6c6f 635b 3a2c 2073 656c 662e  df.iloc[:, self.
-0000c980: 6461 7461 7372 632e 636f 6c5f 6461 7461  datasrc.col_data
-0000c990: 5f6f 6666 7365 743a 7365 6c66 2e63 6f6c  _offset:self.col
-0000c9a0: 5f64 6174 615f 656e 645d 0d0a 2020 2020  _data_end]..    
-0000c9b0: 2020 2020 7661 6c75 6573 203d 2064 662e      values = df.
-0000c9c0: 7661 6c75 6573 0d0a 2020 2020 2020 2020  values..        
-0000c9d0: 2320 6e6f 726d 616c 697a 650d 0a20 2020  # normalize..   
-0000c9e0: 2020 2020 2076 616c 7565 7320 2d3d 206e       values -= n
-0000c9f0: 702e 6e61 6e6d 696e 2876 616c 7565 7329  p.nanmin(values)
-0000ca00: 0d0a 2020 2020 2020 2020 7661 6c75 6573  ..        values
-0000ca10: 203d 2076 616c 7565 7320 2f20 286e 702e   = values / (np.
-0000ca20: 6e61 6e6d 6178 2876 616c 7565 7329 202f  nanmax(values) /
-0000ca30: 2028 312b 7365 6c66 2e77 6869 7465 6f75   (1+self.whiteou
-0000ca40: 7429 2920 2320 6f76 6572 7368 6f6f 7420  t)) # overshoot 
-0000ca50: 666f 7220 636f 6c6f 7269 6e67 0d0a 2020  for coloring..  
-0000ca60: 2020 2020 2020 6c69 6d20 3d20 7365 6c66        lim = self
-0000ca70: 2e66 696c 7465 725f 6c69 6d69 7420 2a20  .filter_limit * 
-0000ca80: 2831 2b73 656c 662e 7768 6974 656f 7574  (1+self.whiteout
-0000ca90: 290d 0a20 2020 2020 2020 2070 203d 2073  )..        p = s
-0000caa0: 656c 662e 7061 696e 7465 720d 0a20 2020  elf.painter..   
-0000cab0: 2020 2020 2066 6f72 2074 2c72 6f77 2069       for t,row i
-0000cac0: 6e20 656e 756d 6572 6174 6528 7661 6c75  n enumerate(valu
-0000cad0: 6573 293a 0d0a 2020 2020 2020 2020 2020  es):..          
-0000cae0: 2020 666f 7220 6369 2c70 7269 6365 2069    for ci,price i
-0000caf0: 6e20 656e 756d 6572 6174 6528 7072 6963  n enumerate(pric
-0000cb00: 6573 293a 0d0a 2020 2020 2020 2020 2020  es):..          
-0000cb10: 2020 2020 2020 7620 3d20 726f 775b 6369        v = row[ci
-0000cb20: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0000cb30: 2020 2069 6620 7620 3e3d 206c 696d 3a0d     if v >= lim:.
-0000cb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cb50: 2020 2020 2076 203d 2031 202d 2073 656c       v = 1 - sel
-0000cb60: 662e 636f 6c63 7572 7665 2831 202d 2028  f.colcurve(1 - (
-0000cb70: 762d 6c69 6d29 2f28 312d 6c69 6d29 290d  v-lim)/(1-lim)).
-0000cb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cb90: 2020 2020 2063 6f6c 6f72 203d 2073 656c       color = sel
-0000cba0: 662e 636f 6c6d 6170 2e6d 6170 2876 2c20  f.colmap.map(v, 
-0000cbb0: 6d6f 6465 3d27 7163 6f6c 6f72 2729 0d0a  mode='qcolor')..
-0000cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbd0: 2020 2020 702e 6669 6c6c 5265 6374 2851      p.fillRect(Q
-0000cbe0: 7443 6f72 652e 5152 6563 7446 2874 2d72  tCore.QRectF(t-r
-0000cbf0: 6563 745f 7369 7a65 322c 2073 656c 662e  ect_size2, self.
-0000cc00: 6178 2e76 622e 7973 6361 6c65 2e69 6e76  ax.vb.yscale.inv
-0000cc10: 7866 6f72 6d28 7072 6963 652b 6830 292c  xform(price+h0),
-0000cc20: 2073 656c 662e 7265 6374 5f73 697a 652c   self.rect_size,
-0000cc30: 2073 656c 662e 6178 2e76 622e 7973 6361   self.ax.vb.ysca
-0000cc40: 6c65 2e69 6e76 7866 6f72 6d28 6831 2929  le.invxform(h1))
-0000cc50: 2c20 636f 6c6f 7229 0d0a 0d0a 0d0a 0d0a  , color)........
-0000cc60: 636c 6173 7320 486f 7269 7a6f 6e74 616c  class Horizontal
-0000cc70: 5469 6d65 566f 6c75 6d65 4974 656d 2843  TimeVolumeItem(C
-0000cc80: 616e 646c 6573 7469 636b 4974 656d 293a  andlestickItem):
-0000cc90: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-0000cca0: 5f5f 2873 656c 662c 2061 782c 2064 6174  __(self, ax, dat
-0000ccb0: 6173 7263 2c20 6361 6e64 6c65 5f77 6964  asrc, candle_wid
-0000ccc0: 7468 3d30 2e38 2c20 6472 6177 5f76 613d  th=0.8, draw_va=
-0000ccd0: 302e 302c 2064 7261 775f 7661 773d 312e  0.0, draw_vaw=1.
-0000cce0: 302c 2064 7261 775f 626f 6479 3d30 2e34  0, draw_body=0.4
-0000ccf0: 2c20 6472 6177 5f70 6f63 3d30 2e30 2c20  , draw_poc=0.0, 
-0000cd00: 636f 6c6f 7266 756e 633d 4e6f 6e65 293a  colorfunc=None):
-0000cd10: 0d0a 2020 2020 2020 2020 2727 2741 206e  ..        '''A n
-0000cd20: 6567 6174 6976 6520 6472 6177 5f62 6f64  egative draw_bod
-0000cd30: 7920 646f 6573 206e 6f74 206d 6561 6e20  y does not mean 
-0000cd40: 7468 6174 2074 6865 2063 616e 646c 6520  that the candle 
-0000cd50: 6973 2064 7261 776e 2069 6e20 7468 6520  is drawn in the 
-0000cd60: 6f70 706f 7369 7465 2064 6972 6563 7469  opposite directi
-0000cd70: 6f6e 2028 7573 6520 6e65 6761 7469 7665  on (use negative
-0000cd80: 2076 6f6c 756d 6520 666f 7220 7468 6174   volume for that
-0000cd90: 292c 0d0a 2020 2020 2020 2020 2020 2062  ),..           b
-0000cda0: 7574 2069 6e73 7465 6164 2074 6861 7420  ut instead that 
-0000cdb0: 7363 7265 656e 2073 6361 6c65 2077 696c  screen scale wil
-0000cdc0: 6c20 6265 2075 7365 6420 696e 7374 6561  l be used instea
-0000cdd0: 6420 6f66 2069 6e74 6572 7661 6c2d 7265  d of interval-re
-0000cde0: 6c61 7469 7665 2073 6361 6c65 2e27 2727  lative scale.'''
-0000cdf0: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-0000ce00: 7261 775f 7661 203d 2064 7261 775f 7661  raw_va = draw_va
-0000ce10: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-0000ce20: 7261 775f 7661 7720 3d20 6472 6177 5f76  raw_vaw = draw_v
-0000ce30: 6177 0d0a 2020 2020 2020 2020 7365 6c66  aw..        self
-0000ce40: 2e64 7261 775f 706f 6320 3d20 6472 6177  .draw_poc = draw
-0000ce50: 5f70 6f63 0d0a 2020 2020 2020 2020 2323  _poc..        ##
-0000ce60: 2073 656c 662e 636f 6c5f 6461 7461 5f65   self.col_data_e
-0000ce70: 6e64 203d 206c 656e 2864 6174 6173 7263  nd = len(datasrc
-0000ce80: 2e64 662e 636f 6c75 6d6e 7329 0d0a 2020  .df.columns)..  
-0000ce90: 2020 2020 2020 636f 6c6f 7266 756e 6320        colorfunc 
-0000cea0: 3d20 636f 6c6f 7266 756e 6320 6f72 2068  = colorfunc or h
-0000ceb0: 6f72 697a 766f 6c5f 636f 6c6f 7266 696c  orizvol_colorfil
-0000cec0: 7465 7228 2920 2320 7265 736f 6c76 6520  ter() # resolve 
-0000ced0: 6675 6e63 7469 6f6e 206c 6f77 6572 2064  function lower d
-0000cee0: 6f77 6e20 696e 2073 6f75 7263 6520 636f  own in source co
-0000cef0: 6465 0d0a 2020 2020 2020 2020 7375 7065  de..        supe
-0000cf00: 7228 292e 5f5f 696e 6974 5f5f 2861 782c  r().__init__(ax,
-0000cf10: 2064 6174 6173 7263 2c20 6472 6177 5f73   datasrc, draw_s
-0000cf20: 6861 646f 773d 4661 6c73 652c 2063 616e  hadow=False, can
-0000cf30: 646c 655f 7769 6474 683d 6361 6e64 6c65  dle_width=candle
-0000cf40: 5f77 6964 7468 2c20 6472 6177 5f62 6f64  _width, draw_bod
-0000cf50: 793d 6472 6177 5f62 6f64 792c 2063 6f6c  y=draw_body, col
-0000cf60: 6f72 6675 6e63 3d63 6f6c 6f72 6675 6e63  orfunc=colorfunc
-0000cf70: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0000cf80: 6c6f 6420 3d20 4661 6c73 650d 0a20 2020  lod = False..   
-0000cf90: 2020 2020 2073 656c 662e 636f 6c6f 7273       self.colors
-0000cfa0: 2e75 7064 6174 6528 6469 6374 286e 6575  .update(dict(neu
-0000cfb0: 7472 616c 5f73 6861 646f 7720 203d 2076  tral_shadow  = v
-0000cfc0: 6f6c 756d 655f 6e65 7574 7261 6c5f 636f  olume_neutral_co
-0000cfd0: 6c6f 722c 0d0a 2020 2020 2020 2020 2020  lor,..          
-0000cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cff0: 2020 2020 2020 6e65 7574 7261 6c5f 6672        neutral_fr
-0000d000: 616d 6520 2020 3d20 766f 6c75 6d65 5f6e  ame   = volume_n
-0000d010: 6575 7472 616c 5f63 6f6c 6f72 2c0d 0a20  eutral_color,.. 
-0000d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d030: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000d040: 6575 7472 616c 5f62 6f64 7920 2020 203d  eutral_body    =
-0000d050: 2076 6f6c 756d 655f 6e65 7574 7261 6c5f   volume_neutral_
-0000d060: 636f 6c6f 722c 0d0a 2020 2020 2020 2020  color,..        
-0000d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d080: 2020 2020 2020 2020 6275 6c6c 5f62 6f64          bull_bod
-0000d090: 7920 2020 2020 2020 3d20 6361 6e64 6c65  y       = candle
-0000d0a0: 5f62 756c 6c5f 636f 6c6f 7229 290d 0a0d  _bull_color))...
-0000d0b0: 0a20 2020 2064 6566 2067 656e 6572 6174  .    def generat
-0000d0c0: 655f 7069 6374 7572 6528 7365 6c66 2c20  e_picture(self, 
-0000d0d0: 626f 756e 6469 6e67 5265 6374 293a 0d0a  boundingRect):..
-0000d0e0: 2020 2020 2020 2020 7469 6d65 7320 3d20          times = 
-0000d0f0: 7365 6c66 2e64 6174 6173 7263 2e64 662e  self.datasrc.df.
-0000d100: 696c 6f63 5b3a 2c20 305d 0d0a 2020 2020  iloc[:, 0]..    
-0000d110: 2020 2020 7661 6c73 203d 2073 656c 662e      vals = self.
-0000d120: 6461 7461 7372 632e 6466 2e76 616c 7565  datasrc.df.value
-0000d130: 730d 0a20 2020 2020 2020 2070 7269 6365  s..        price
-0000d140: 7320 3d20 7661 6c73 5b3a 2c20 7365 6c66  s = vals[:, self
-0000d150: 2e64 6174 6173 7263 2e63 6f6c 5f64 6174  .datasrc.col_dat
-0000d160: 615f 6f66 6673 6574 3a3a 325d 0d0a 2020  a_offset::2]..  
-0000d170: 2020 2020 2020 766f 6c75 6d65 7320 3d20        volumes = 
-0000d180: 7661 6c73 5b3a 2c20 7365 6c66 2e64 6174  vals[:, self.dat
-0000d190: 6173 7263 2e63 6f6c 5f64 6174 615f 6f66  asrc.col_data_of
-0000d1a0: 6673 6574 2b31 3a3a 325d 2e54 0d0a 2020  fset+1::2].T..  
-0000d1b0: 2020 2020 2020 2320 6e6f 726d 616c 697a        # normaliz
-0000d1c0: 650d 0a20 2020 2020 2020 2074 7279 3a0d  e..        try:.
-0000d1d0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-0000d1e0: 6578 203d 205f 7064 7469 6d65 3269 6e64  ex = _pdtime2ind
-0000d1f0: 6578 2873 656c 662e 6178 2c20 7469 6d65  ex(self.ax, time
-0000d200: 732c 2072 6571 7569 7265 5f74 696d 653d  s, require_time=
-0000d210: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
-0000d220: 2020 2069 6e64 6578 5f73 7465 7073 203d     index_steps =
-0000d230: 2070 642e 5365 7269 6573 2869 6e64 6578   pd.Series(index
-0000d240: 292e 6469 6666 2829 2e73 6869 6674 282d  ).diff().shift(-
-0000d250: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-0000d260: 696e 6465 785f 7374 6570 735b 696e 6465  index_steps[inde
-0000d270: 785f 7374 6570 732e 696e 6465 785b 2d31  x_steps.index[-1
-0000d280: 5d5d 203d 2069 6e64 6578 5f73 7465 7073  ]] = index_steps
-0000d290: 2e6d 6564 6961 6e28 290d 0a20 2020 2020  .median()..     
-0000d2a0: 2020 2065 7863 6570 7420 4173 7365 7274     except Assert
-0000d2b0: 696f 6e45 7272 6f72 3a0d 0a20 2020 2020  ionError:..     
-0000d2c0: 2020 2020 2020 2069 6e64 6578 203d 2074         index = t
-0000d2d0: 696d 6573 0d0a 2020 2020 2020 2020 2020  imes..          
-0000d2e0: 2020 696e 6465 785f 7374 6570 7320 3d20    index_steps = 
-0000d2f0: 5b31 5d2a 6c65 6e28 696e 6465 7829 0d0a  [1]*len(index)..
-0000d300: 2020 2020 2020 2020 6472 6177 5f62 6f64          draw_bod
-0000d310: 7920 3d20 7365 6c66 2e64 7261 775f 626f  y = self.draw_bo
-0000d320: 6479 0d0a 2020 2020 2020 2020 7766 203d  dy..        wf =
-0000d330: 2031 0d0a 2020 2020 2020 2020 6966 2064   1..        if d
-0000d340: 7261 775f 626f 6479 203c 2030 3a0d 0a20  raw_body < 0:.. 
-0000d350: 2020 2020 2020 2020 2020 2077 6620 3d20             wf = 
-0000d360: 2d64 7261 775f 626f 6479 202a 2073 656c  -draw_body * sel
-0000d370: 662e 6178 2e76 622e 7461 7267 6574 5265  f.ax.vb.targetRe
-0000d380: 6374 2829 2e77 6964 7468 2829 0d0a 2020  ct().width()..  
-0000d390: 2020 2020 2020 2020 2020 6472 6177 5f62            draw_b
-0000d3a0: 6f64 7920 3d20 310d 0a20 2020 2020 2020  ody = 1..       
-0000d3b0: 2062 696e 6320 3d20 6c65 6e28 766f 6c75   binc = len(volu
-0000d3c0: 6d65 7329 0d0a 2020 2020 2020 2020 6966  mes)..        if
-0000d3d0: 206e 6f74 2062 696e 633a 0d0a 2020 2020   not binc:..    
-0000d3e0: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
-0000d3f0: 2020 2020 2020 2020 6469 7676 6f6c 203d          divvol =
-0000d400: 206e 702e 6e61 6e6d 6178 286e 702e 6162   np.nanmax(np.ab
-0000d410: 7328 766f 6c75 6d65 7329 2c20 6178 6973  s(volumes), axis
-0000d420: 3d30 290d 0a20 2020 2020 2020 2064 6976  =0)..        div
-0000d430: 766f 6c5b 6469 7676 6f6c 3d3d 305d 203d  vol[divvol==0] =
-0000d440: 2031 0d0a 2020 2020 2020 2020 766f 6c75   1..        volu
-0000d450: 6d65 7320 3d20 2876 6f6c 756d 6573 202a  mes = (volumes *
-0000d460: 2077 6620 2f20 6469 7676 6f6c 292e 540d   wf / divvol).T.
-0000d470: 0a20 2020 2020 2020 2070 203d 2073 656c  .        p = sel
-0000d480: 662e 7061 696e 7465 720d 0a20 2020 2020  f.painter..     
-0000d490: 2020 2068 203d 2031 652d 3130 0d0a 2020     h = 1e-10..  
-0000d4a0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-0000d4b0: 616e 6765 286c 656e 2870 7269 6365 7329  ange(len(prices)
-0000d4c0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000d4d0: 6620 3d20 696e 6465 785f 7374 6570 735b  f = index_steps[
-0000d4e0: 695d 202a 2077 660d 0a20 2020 2020 2020  i] * wf..       
-0000d4f0: 2020 2020 2070 7263 7220 3d20 7072 6963       prcr = pric
-0000d500: 6573 5b69 5d0d 0a20 2020 2020 2020 2020  es[i]..         
-0000d510: 2020 2070 7276 203d 2070 7263 725b 7e6e     prv = prcr[~n
-0000d520: 702e 6973 6e61 6e28 7072 6372 295d 0d0a  p.isnan(prcr)]..
-0000d530: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000d540: 656e 2870 7276 2920 3e20 313a 0d0a 2020  en(prv) > 1:..  
-0000d550: 2020 2020 2020 2020 2020 2020 2020 6820                h 
-0000d560: 3d20 6e70 2e64 6966 6628 7072 7629 2e6d  = np.diff(prv).m
-0000d570: 696e 2829 0d0a 2020 2020 2020 2020 2020  in()..          
-0000d580: 2020 7420 3d20 696e 6465 785b 695d 0d0a    t = index[i]..
-0000d590: 2020 2020 2020 2020 2020 2020 766f 6c72              volr
-0000d5a0: 203d 206e 702e 6e61 6e5f 746f 5f6e 756d   = np.nan_to_num
-0000d5b0: 2876 6f6c 756d 6573 5b69 5d29 0d0a 0d0a  (volumes[i])....
-0000d5c0: 2020 2020 2020 2020 2020 2020 2320 6361              # ca
-0000d5d0: 6c63 2070 6f63 0d0a 2020 2020 2020 2020  lc poc..        
-0000d5e0: 2020 2020 706f 6369 6478 203d 206e 702e      pocidx = np.
-0000d5f0: 6e61 6e61 7267 6d61 7828 766f 6c72 290d  nanargmax(volr).
-0000d600: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-0000d610: 2064 7261 7720 7661 6c75 6520 6172 6561   draw value area
-0000d620: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000d630: 2073 656c 662e 6472 6177 5f76 613a 0d0a   self.draw_va:..
-0000d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d650: 766f 6c72 7320 3d20 766f 6c72 202f 206e  volrs = volr / n
-0000d660: 702e 6e61 6e73 756d 2876 6f6c 7229 0d0a  p.nansum(volr)..
-0000d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d680: 7620 3d20 766f 6c72 735b 706f 6369 6478  v = volrs[pocidx
-0000d690: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0000d6a0: 2020 2061 203d 2062 203d 2070 6f63 6964     a = b = pocid
-0000d6b0: 780d 0a20 2020 2020 2020 2020 2020 2020  x..             
-0000d6c0: 2020 2077 6869 6c65 2054 7275 653a 0d0a     while True:..
-0000d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6e0: 2020 2020 6966 2076 203e 3d20 7365 6c66      if v >= self
-0000d6f0: 2e64 7261 775f 7661 202d 2031 652d 353a  .draw_va - 1e-5:
-0000d700: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d710: 2020 2020 2020 2020 2020 6272 6561 6b0d            break.
-0000d720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d730: 2020 2020 2061 6120 3d20 6120 2d20 310d       aa = a - 1.
-0000d740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d750: 2020 2020 2062 6220 3d20 6220 2b20 310d       bb = b + 1.
-0000d760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d770: 2020 2020 2076 6120 3d20 766f 6c72 735b       va = volrs[
-0000d780: 6161 5d20 6966 2061 613e 3d30 2065 6c73  aa] if aa>=0 els
-0000d790: 6520 300d 0a20 2020 2020 2020 2020 2020  e 0..           
-0000d7a0: 2020 2020 2020 2020 2076 6220 3d20 766f           vb = vo
-0000d7b0: 6c72 735b 6262 5d20 6966 2062 623c 6269  lrs[bb] if bb<bi
-0000d7c0: 6e63 2065 6c73 6520 300d 0a20 2020 2020  nc else 0..     
-0000d7d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000d7e0: 6620 7661 203e 3d20 7662 3a20 2320 4e4f  f va >= vb: # NO
-0000d7f0: 5445 2062 6f74 6820 3d3d 2069 7320 616c  TE both == is al
-0000d800: 736f 206f 6b0d 0a20 2020 2020 2020 2020  so ok..         
-0000d810: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000d820: 203d 206d 6178 2830 2c20 6161 290d 0a20   = max(0, aa).. 
-0000d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d840: 2020 2020 2020 2076 202b 3d20 7661 0d0a         v += va..
-0000d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d860: 2020 2020 6966 2076 6120 3c3d 2076 623a      if va <= vb:
-0000d870: 2023 204e 4f54 4520 626f 7468 203d 3d20   # NOTE both == 
-0000d880: 6973 2061 6c73 6f20 6f6b 0d0a 2020 2020  is also ok..    
-0000d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d8a0: 2020 2020 6220 3d20 6d69 6e28 6269 6e63      b = min(binc
-0000d8b0: 2d31 2c20 6262 290d 0a20 2020 2020 2020  -1, bb)..       
+0000be70: 2020 2020 2020 2020 2062 756c 6c5f 6672           bull_fr
+0000be80: 616d 6520 2020 2020 2020 3d20 6361 6e64  ame       = cand
+0000be90: 6c65 5f62 756c 6c5f 636f 6c6f 722c 0d0a  le_bull_color,..
+0000bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000beb0: 2020 2020 2020 2020 2020 2062 756c 6c5f             bull_
+0000bec0: 626f 6479 2020 2020 2020 2020 3d20 6361  body        = ca
+0000bed0: 6e64 6c65 5f62 756c 6c5f 626f 6479 5f63  ndle_bull_body_c
+0000bee0: 6f6c 6f72 2c0d 0a20 2020 2020 2020 2020  olor,..         
+0000bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf00: 2020 6265 6172 5f73 6861 646f 7720 2020    bear_shadow   
+0000bf10: 2020 203d 2063 616e 646c 655f 6265 6172     = candle_bear
+0000bf20: 5f63 6f6c 6f72 2c0d 0a20 2020 2020 2020  _color,..       
+0000bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf40: 2020 2020 6265 6172 5f66 7261 6d65 2020      bear_frame  
+0000bf50: 2020 2020 203d 2063 616e 646c 655f 6265       = candle_be
+0000bf60: 6172 5f63 6f6c 6f72 2c0d 0a20 2020 2020  ar_color,..     
+0000bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf80: 2020 2020 2020 6265 6172 5f62 6f64 7920        bear_body 
+0000bf90: 2020 2020 2020 203d 2063 616e 646c 655f         = candle_
+0000bfa0: 6265 6172 5f62 6f64 795f 636f 6c6f 722c  bear_body_color,
+0000bfb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bfc0: 2020 2020 2020 2020 2020 2020 2077 6561               wea
+0000bfd0: 6b5f 6275 6c6c 5f73 6861 646f 7720 3d20  k_bull_shadow = 
+0000bfe0: 6272 6967 6874 656e 2863 616e 646c 655f  brighten(candle_
+0000bff0: 6275 6c6c 5f63 6f6c 6f72 2c20 312e 3229  bull_color, 1.2)
+0000c000: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000c010: 2020 2020 2020 2020 2020 2020 2020 7765                we
+0000c020: 616b 5f62 756c 6c5f 6672 616d 6520 203d  ak_bull_frame  =
+0000c030: 2062 7269 6768 7465 6e28 6361 6e64 6c65   brighten(candle
+0000c040: 5f62 756c 6c5f 636f 6c6f 722c 2031 2e32  _bull_color, 1.2
+0000c050: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0000c060: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000c070: 6561 6b5f 6275 6c6c 5f62 6f64 7920 2020  eak_bull_body   
+0000c080: 3d20 6272 6967 6874 656e 2863 616e 646c  = brighten(candl
+0000c090: 655f 6275 6c6c 5f63 6f6c 6f72 2c20 312e  e_bull_color, 1.
+0000c0a0: 3229 2c0d 0a20 2020 2020 2020 2020 2020  2),..           
+0000c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0c0: 7765 616b 5f62 6561 725f 7368 6164 6f77  weak_bear_shadow
+0000c0d0: 203d 2062 7269 6768 7465 6e28 6361 6e64   = brighten(cand
+0000c0e0: 6c65 5f62 6561 725f 636f 6c6f 722c 2031  le_bear_color, 1
+0000c0f0: 2e35 292c 0d0a 2020 2020 2020 2020 2020  .5),..          
+0000c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c110: 2077 6561 6b5f 6265 6172 5f66 7261 6d65   weak_bear_frame
+0000c120: 2020 3d20 6272 6967 6874 656e 2863 616e    = brighten(can
+0000c130: 646c 655f 6265 6172 5f63 6f6c 6f72 2c20  dle_bear_color, 
+0000c140: 312e 3529 2c0d 0a20 2020 2020 2020 2020  1.5),..         
+0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c160: 2020 7765 616b 5f62 6561 725f 626f 6479    weak_bear_body
+0000c170: 2020 203d 2062 7269 6768 7465 6e28 6361     = brighten(ca
+0000c180: 6e64 6c65 5f62 6561 725f 636f 6c6f 722c  ndle_bear_color,
+0000c190: 2031 2e35 2929 0d0a 2020 2020 2020 2020   1.5))..        
+0000c1a0: 7365 6c66 2e64 7261 775f 626f 6479 203d  self.draw_body =
+0000c1b0: 2064 7261 775f 626f 6479 0d0a 2020 2020   draw_body..    
+0000c1c0: 2020 2020 7365 6c66 2e64 7261 775f 7368      self.draw_sh
+0000c1d0: 6164 6f77 203d 2064 7261 775f 7368 6164  adow = draw_shad
+0000c1e0: 6f77 0d0a 2020 2020 2020 2020 7365 6c66  ow..        self
+0000c1f0: 2e63 616e 646c 655f 7769 6474 6820 3d20  .candle_width = 
+0000c200: 6361 6e64 6c65 5f77 6964 7468 0d0a 2020  candle_width..  
+0000c210: 2020 2020 2020 7365 6c66 2e73 6861 646f        self.shado
+0000c220: 775f 7769 6474 6820 3d20 6361 6e64 6c65  w_width = candle
+0000c230: 5f73 6861 646f 775f 7769 6474 680d 0a20  _shadow_width.. 
+0000c240: 2020 2020 2020 2073 656c 662e 636f 6c6f         self.colo
+0000c250: 7266 756e 6320 3d20 636f 6c6f 7266 756e  rfunc = colorfun
+0000c260: 630d 0a20 2020 2020 2020 2073 656c 662e  c..        self.
+0000c270: 7265 7361 6d70 203d 2072 6573 616d 700d  resamp = resamp.
+0000c280: 0a20 2020 2020 2020 2073 656c 662e 785f  .        self.x_
+0000c290: 6f66 6673 6574 203d 2030 0d0a 2020 2020  offset = 0..    
+0000c2a0: 2020 2020 7375 7065 7228 292e 5f5f 696e      super().__in
+0000c2b0: 6974 5f5f 2861 782c 2064 6174 6173 7263  it__(ax, datasrc
+0000c2c0: 2c20 6c6f 643d 5472 7565 290d 0a0d 0a20  , lod=True).... 
+0000c2d0: 2020 2064 6566 2067 656e 6572 6174 655f     def generate_
+0000c2e0: 7069 6374 7572 6528 7365 6c66 2c20 626f  picture(self, bo
+0000c2f0: 756e 6469 6e67 5265 6374 293a 0d0a 2020  undingRect):..  
+0000c300: 2020 2020 2020 6c65 6674 2c72 6967 6874        left,right
+0000c310: 203d 2062 6f75 6e64 696e 6752 6563 742e   = boundingRect.
+0000c320: 6c65 6674 2829 2c20 626f 756e 6469 6e67  left(), bounding
+0000c330: 5265 6374 2e72 6967 6874 2829 0d0a 2020  Rect.right()..  
+0000c340: 2020 2020 2020 7020 3d20 7365 6c66 2e70        p = self.p
+0000c350: 6169 6e74 6572 0d0a 2020 2020 2020 2020  ainter..        
+0000c360: 6466 2c6f 7269 676c 656e 203d 2073 656c  df,origlen = sel
+0000c370: 662e 6461 7461 7372 632e 726f 7773 2835  f.datasrc.rows(5
+0000c380: 2c20 6c65 6674 2c20 7269 6768 742c 2079  , left, right, y
+0000c390: 7363 616c 653d 7365 6c66 2e61 782e 7662  scale=self.ax.vb
+0000c3a0: 2e79 7363 616c 652c 2072 6573 616d 703d  .yscale, resamp=
+0000c3b0: 7365 6c66 2e72 6573 616d 7029 0d0a 2020  self.resamp)..  
+0000c3c0: 2020 2020 2020 6620 3d20 6f72 6967 6c65        f = origle
+0000c3d0: 6e20 2f20 6c65 6e28 6466 2920 6966 206c  n / len(df) if l
+0000c3e0: 656e 2864 6629 2065 6c73 6520 310d 0a20  en(df) else 1.. 
+0000c3f0: 2020 2020 2020 2077 203d 2073 656c 662e         w = self.
+0000c400: 6361 6e64 6c65 5f77 6964 7468 202a 2066  candle_width * f
+0000c410: 0d0a 2020 2020 2020 2020 7732 203d 2077  ..        w2 = w
+0000c420: 202a 2030 2e35 0d0a 2020 2020 2020 2020   * 0.5..        
+0000c430: 666f 7220 7368 6164 6f77 2c66 7261 6d65  for shadow,frame
+0000c440: 2c62 6f64 792c 6466 5f72 6f77 7320 696e  ,body,df_rows in
+0000c450: 2073 656c 662e 636f 6c6f 7266 756e 6328   self.colorfunc(
+0000c460: 7365 6c66 2c20 7365 6c66 2e64 6174 6173  self, self.datas
+0000c470: 7263 2c20 6466 293a 0d0a 2020 2020 2020  rc, df):..      
+0000c480: 2020 2020 2020 6964 7873 203d 2064 665f        idxs = df_
+0000c490: 726f 7773 2e69 6e64 6578 0d0a 2020 2020  rows.index..    
+0000c4a0: 2020 2020 2020 2020 726f 7773 203d 2064          rows = d
+0000c4b0: 665f 726f 7773 2e76 616c 7565 730d 0a20  f_rows.values.. 
+0000c4c0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000c4d0: 6c66 2e78 5f6f 6666 7365 743a 0d0a 2020  lf.x_offset:..  
+0000c4e0: 2020 2020 2020 2020 2020 2020 2020 6964                id
+0000c4f0: 7873 202b 3d20 7365 6c66 2e78 5f6f 6666  xs += self.x_off
+0000c500: 7365 740d 0a20 2020 2020 2020 2020 2020  set..           
+0000c510: 2069 6620 7365 6c66 2e64 7261 775f 7368   if self.draw_sh
+0000c520: 6164 6f77 3a0d 0a20 2020 2020 2020 2020  adow:..         
+0000c530: 2020 2020 2020 2070 2e73 6574 5065 6e28         p.setPen(
+0000c540: 7067 2e6d 6b50 656e 2873 6861 646f 772c  pg.mkPen(shadow,
+0000c550: 2077 6964 7468 3d73 656c 662e 7368 6164   width=self.shad
+0000c560: 6f77 5f77 6964 7468 2929 0d0a 2020 2020  ow_width))..    
+0000c570: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000c580: 782c 2874 2c6f 7065 6e2c 636c 6f73 652c  x,(t,open,close,
+0000c590: 6869 6768 2c6c 6f77 2920 696e 207a 6970  high,low) in zip
+0000c5a0: 2869 6478 732c 2072 6f77 7329 3a0d 0a20  (idxs, rows):.. 
+0000c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5c0: 2020 2069 6620 6869 6768 203e 206c 6f77     if high > low
+0000c5d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000c5e0: 2020 2020 2020 2020 2020 2070 2e64 7261             p.dra
+0000c5f0: 774c 696e 6528 5174 436f 7265 2e51 506f  wLine(QtCore.QPo
+0000c600: 696e 7446 2878 2c20 6c6f 7729 2c20 5174  intF(x, low), Qt
+0000c610: 436f 7265 2e51 506f 696e 7446 2878 2c20  Core.QPointF(x, 
+0000c620: 6869 6768 2929 0d0a 2020 2020 2020 2020  high))..        
+0000c630: 2020 2020 6966 2073 656c 662e 6472 6177      if self.draw
+0000c640: 5f62 6f64 793a 0d0a 2020 2020 2020 2020  _body:..        
+0000c650: 2020 2020 2020 2020 702e 7365 7450 656e          p.setPen
+0000c660: 2870 672e 6d6b 5065 6e28 6672 616d 6529  (pg.mkPen(frame)
+0000c670: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000c680: 2020 2070 2e73 6574 4272 7573 6828 7067     p.setBrush(pg
+0000c690: 2e6d 6b42 7275 7368 2862 6f64 7929 290d  .mkBrush(body)).
+0000c6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c6b0: 2066 6f72 2078 2c28 742c 6f70 656e 2c63   for x,(t,open,c
+0000c6c0: 6c6f 7365 2c68 6967 682c 6c6f 7729 2069  lose,high,low) i
+0000c6d0: 6e20 7a69 7028 6964 7873 2c20 726f 7773  n zip(idxs, rows
+0000c6e0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000c6f0: 2020 2020 2020 2020 702e 6472 6177 5265          p.drawRe
+0000c700: 6374 2851 7443 6f72 652e 5152 6563 7446  ct(QtCore.QRectF
+0000c710: 2878 2d77 322c 206f 7065 6e2c 2077 2c20  (x-w2, open, w, 
+0000c720: 636c 6f73 652d 6f70 656e 2929 0d0a 0d0a  close-open))....
+0000c730: 2020 2020 6465 6620 726f 7763 6f6c 6f72      def rowcolor
+0000c740: 7328 7365 6c66 2c20 7072 6566 6978 293a  s(self, prefix):
+0000c750: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000c760: 205b 7365 6c66 2e63 6f6c 6f72 735b 7072   [self.colors[pr
+0000c770: 6566 6978 2b27 5f73 6861 646f 7727 5d2c  efix+'_shadow'],
+0000c780: 2073 656c 662e 636f 6c6f 7273 5b70 7265   self.colors[pre
+0000c790: 6669 782b 275f 6672 616d 6527 5d2c 2073  fix+'_frame'], s
+0000c7a0: 656c 662e 636f 6c6f 7273 5b70 7265 6669  elf.colors[prefi
+0000c7b0: 782b 275f 626f 6479 275d 5d0d 0a0d 0a0d  x+'_body']].....
+0000c7c0: 0a0d 0a63 6c61 7373 2048 6561 746d 6170  ...class Heatmap
+0000c7d0: 4974 656d 2846 696e 506c 6f74 4974 656d  Item(FinPlotItem
+0000c7e0: 293a 0d0a 2020 2020 6465 6620 5f5f 696e  ):..    def __in
+0000c7f0: 6974 5f5f 2873 656c 662c 2061 782c 2064  it__(self, ax, d
+0000c800: 6174 6173 7263 2c20 7265 6374 5f73 697a  atasrc, rect_siz
+0000c810: 653d 302e 392c 2066 696c 7465 725f 6c69  e=0.9, filter_li
+0000c820: 6d69 743d 302c 2063 6f6c 6d61 703d 636f  mit=0, colmap=co
+0000c830: 6c6d 6170 5f63 6c61 7368 2c20 7768 6974  lmap_clash, whit
+0000c840: 656f 7574 3d30 2e30 2c20 636f 6c63 7572  eout=0.0, colcur
+0000c850: 7665 3d6c 616d 6264 6120 783a 706f 7728  ve=lambda x:pow(
+0000c860: 782c 3429 293a 0d0a 2020 2020 2020 2020  x,4)):..        
+0000c870: 7365 6c66 2e72 6563 745f 7369 7a65 203d  self.rect_size =
+0000c880: 2072 6563 745f 7369 7a65 0d0a 2020 2020   rect_size..    
+0000c890: 2020 2020 7365 6c66 2e66 696c 7465 725f      self.filter_
+0000c8a0: 6c69 6d69 7420 3d20 6669 6c74 6572 5f6c  limit = filter_l
+0000c8b0: 696d 6974 0d0a 2020 2020 2020 2020 7365  imit..        se
+0000c8c0: 6c66 2e63 6f6c 6d61 7020 3d20 636f 6c6d  lf.colmap = colm
+0000c8d0: 6170 0d0a 2020 2020 2020 2020 7365 6c66  ap..        self
+0000c8e0: 2e77 6869 7465 6f75 7420 3d20 7768 6974  .whiteout = whit
+0000c8f0: 656f 7574 0d0a 2020 2020 2020 2020 7365  eout..        se
+0000c900: 6c66 2e63 6f6c 6375 7276 6520 3d20 636f  lf.colcurve = co
+0000c910: 6c63 7572 7665 0d0a 2020 2020 2020 2020  lcurve..        
+0000c920: 7365 6c66 2e63 6f6c 5f64 6174 615f 656e  self.col_data_en
+0000c930: 6420 3d20 6c65 6e28 6461 7461 7372 632e  d = len(datasrc.
+0000c940: 6466 2e63 6f6c 756d 6e73 290d 0a20 2020  df.columns)..   
+0000c950: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
+0000c960: 6e69 745f 5f28 6178 2c20 6461 7461 7372  nit__(ax, datasr
+0000c970: 632c 206c 6f64 3d46 616c 7365 290d 0a0d  c, lod=False)...
+0000c980: 0a20 2020 2064 6566 2067 656e 6572 6174  .    def generat
+0000c990: 655f 7069 6374 7572 6528 7365 6c66 2c20  e_picture(self, 
+0000c9a0: 626f 756e 6469 6e67 5265 6374 293a 0d0a  boundingRect):..
+0000c9b0: 2020 2020 2020 2020 7072 6963 6573 203d          prices =
+0000c9c0: 2073 656c 662e 6461 7461 7372 632e 6466   self.datasrc.df
+0000c9d0: 2e63 6f6c 756d 6e73 5b73 656c 662e 6461  .columns[self.da
+0000c9e0: 7461 7372 632e 636f 6c5f 6461 7461 5f6f  tasrc.col_data_o
+0000c9f0: 6666 7365 743a 7365 6c66 2e63 6f6c 5f64  ffset:self.col_d
+0000ca00: 6174 615f 656e 645d 0d0a 2020 2020 2020  ata_end]..      
+0000ca10: 2020 6830 203d 2028 7072 6963 6573 5b30    h0 = (prices[0
+0000ca20: 5d20 2d20 7072 6963 6573 5b31 5d29 202a  ] - prices[1]) *
+0000ca30: 2028 312d 7365 6c66 2e72 6563 745f 7369   (1-self.rect_si
+0000ca40: 7a65 290d 0a20 2020 2020 2020 2068 3120  ze)..        h1 
+0000ca50: 3d20 2870 7269 6365 735b 305d 202d 2070  = (prices[0] - p
+0000ca60: 7269 6365 735b 315d 2920 2a20 2831 2d28  rices[1]) * (1-(
+0000ca70: 312d 7365 6c66 2e72 6563 745f 7369 7a65  1-self.rect_size
+0000ca80: 292a 3229 0d0a 2020 2020 2020 2020 7265  )*2)..        re
+0000ca90: 6374 5f73 697a 6532 203d 2030 2e35 202a  ct_size2 = 0.5 *
+0000caa0: 2073 656c 662e 7265 6374 5f73 697a 650d   self.rect_size.
+0000cab0: 0a20 2020 2020 2020 2064 6620 3d20 7365  .        df = se
+0000cac0: 6c66 2e64 6174 6173 7263 2e64 662e 696c  lf.datasrc.df.il
+0000cad0: 6f63 5b3a 2c20 7365 6c66 2e64 6174 6173  oc[:, self.datas
+0000cae0: 7263 2e63 6f6c 5f64 6174 615f 6f66 6673  rc.col_data_offs
+0000caf0: 6574 3a73 656c 662e 636f 6c5f 6461 7461  et:self.col_data
+0000cb00: 5f65 6e64 5d0d 0a20 2020 2020 2020 2076  _end]..        v
+0000cb10: 616c 7565 7320 3d20 6466 2e76 616c 7565  alues = df.value
+0000cb20: 730d 0a20 2020 2020 2020 2023 206e 6f72  s..        # nor
+0000cb30: 6d61 6c69 7a65 0d0a 2020 2020 2020 2020  malize..        
+0000cb40: 7661 6c75 6573 202d 3d20 6e70 2e6e 616e  values -= np.nan
+0000cb50: 6d69 6e28 7661 6c75 6573 290d 0a20 2020  min(values)..   
+0000cb60: 2020 2020 2076 616c 7565 7320 3d20 7661       values = va
+0000cb70: 6c75 6573 202f 2028 6e70 2e6e 616e 6d61  lues / (np.nanma
+0000cb80: 7828 7661 6c75 6573 2920 2f20 2831 2b73  x(values) / (1+s
+0000cb90: 656c 662e 7768 6974 656f 7574 2929 2023  elf.whiteout)) #
+0000cba0: 206f 7665 7273 686f 6f74 2066 6f72 2063   overshoot for c
+0000cbb0: 6f6c 6f72 696e 670d 0a20 2020 2020 2020  oloring..       
+0000cbc0: 206c 696d 203d 2073 656c 662e 6669 6c74   lim = self.filt
+0000cbd0: 6572 5f6c 696d 6974 202a 2028 312b 7365  er_limit * (1+se
+0000cbe0: 6c66 2e77 6869 7465 6f75 7429 0d0a 2020  lf.whiteout)..  
+0000cbf0: 2020 2020 2020 7020 3d20 7365 6c66 2e70        p = self.p
+0000cc00: 6169 6e74 6572 0d0a 2020 2020 2020 2020  ainter..        
+0000cc10: 666f 7220 742c 726f 7720 696e 2065 6e75  for t,row in enu
+0000cc20: 6d65 7261 7465 2876 616c 7565 7329 3a0d  merate(values):.
+0000cc30: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000cc40: 2063 692c 7072 6963 6520 696e 2065 6e75   ci,price in enu
+0000cc50: 6d65 7261 7465 2870 7269 6365 7329 3a0d  merate(prices):.
+0000cc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cc70: 2076 203d 2072 6f77 5b63 695d 0d0a 2020   v = row[ci]..  
+0000cc80: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000cc90: 2076 203e 3d20 6c69 6d3a 0d0a 2020 2020   v >= lim:..    
+0000cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ccb0: 7620 3d20 3120 2d20 7365 6c66 2e63 6f6c  v = 1 - self.col
+0000ccc0: 6375 7276 6528 3120 2d20 2876 2d6c 696d  curve(1 - (v-lim
+0000ccd0: 292f 2831 2d6c 696d 2929 0d0a 2020 2020  )/(1-lim))..    
+0000cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ccf0: 636f 6c6f 7220 3d20 7365 6c66 2e63 6f6c  color = self.col
+0000cd00: 6d61 702e 6d61 7028 762c 206d 6f64 653d  map.map(v, mode=
+0000cd10: 2771 636f 6c6f 7227 290d 0a20 2020 2020  'qcolor')..     
+0000cd20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000cd30: 2e66 696c 6c52 6563 7428 5174 436f 7265  .fillRect(QtCore
+0000cd40: 2e51 5265 6374 4628 742d 7265 6374 5f73  .QRectF(t-rect_s
+0000cd50: 697a 6532 2c20 7365 6c66 2e61 782e 7662  ize2, self.ax.vb
+0000cd60: 2e79 7363 616c 652e 696e 7678 666f 726d  .yscale.invxform
+0000cd70: 2870 7269 6365 2b68 3029 2c20 7365 6c66  (price+h0), self
+0000cd80: 2e72 6563 745f 7369 7a65 2c20 7365 6c66  .rect_size, self
+0000cd90: 2e61 782e 7662 2e79 7363 616c 652e 696e  .ax.vb.yscale.in
+0000cda0: 7678 666f 726d 2868 3129 292c 2063 6f6c  vxform(h1)), col
+0000cdb0: 6f72 290d 0a0d 0a0d 0a0d 0a63 6c61 7373  or)........class
+0000cdc0: 2048 6f72 697a 6f6e 7461 6c54 696d 6556   HorizontalTimeV
+0000cdd0: 6f6c 756d 6549 7465 6d28 4361 6e64 6c65  olumeItem(Candle
+0000cde0: 7374 6963 6b49 7465 6d29 3a0d 0a20 2020  stickItem):..   
+0000cdf0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+0000ce00: 6c66 2c20 6178 2c20 6461 7461 7372 632c  lf, ax, datasrc,
+0000ce10: 2063 616e 646c 655f 7769 6474 683d 302e   candle_width=0.
+0000ce20: 382c 2064 7261 775f 7661 3d30 2e30 2c20  8, draw_va=0.0, 
+0000ce30: 6472 6177 5f76 6177 3d31 2e30 2c20 6472  draw_vaw=1.0, dr
+0000ce40: 6177 5f62 6f64 793d 302e 342c 2064 7261  aw_body=0.4, dra
+0000ce50: 775f 706f 633d 302e 302c 2063 6f6c 6f72  w_poc=0.0, color
+0000ce60: 6675 6e63 3d4e 6f6e 6529 3a0d 0a20 2020  func=None):..   
+0000ce70: 2020 2020 2027 2727 4120 6e65 6761 7469       '''A negati
+0000ce80: 7665 2064 7261 775f 626f 6479 2064 6f65  ve draw_body doe
+0000ce90: 7320 6e6f 7420 6d65 616e 2074 6861 7420  s not mean that 
+0000cea0: 7468 6520 6361 6e64 6c65 2069 7320 6472  the candle is dr
+0000ceb0: 6177 6e20 696e 2074 6865 206f 7070 6f73  awn in the oppos
+0000cec0: 6974 6520 6469 7265 6374 696f 6e20 2875  ite direction (u
+0000ced0: 7365 206e 6567 6174 6976 6520 766f 6c75  se negative volu
+0000cee0: 6d65 2066 6f72 2074 6861 7429 2c0d 0a20  me for that),.. 
+0000cef0: 2020 2020 2020 2020 2020 6275 7420 696e            but in
+0000cf00: 7374 6561 6420 7468 6174 2073 6372 6565  stead that scree
+0000cf10: 6e20 7363 616c 6520 7769 6c6c 2062 6520  n scale will be 
+0000cf20: 7573 6564 2069 6e73 7465 6164 206f 6620  used instead of 
+0000cf30: 696e 7465 7276 616c 2d72 656c 6174 6976  interval-relativ
+0000cf40: 6520 7363 616c 652e 2727 270d 0a20 2020  e scale.'''..   
+0000cf50: 2020 2020 2073 656c 662e 6472 6177 5f76       self.draw_v
+0000cf60: 6120 3d20 6472 6177 5f76 610d 0a20 2020  a = draw_va..   
+0000cf70: 2020 2020 2073 656c 662e 6472 6177 5f76       self.draw_v
+0000cf80: 6177 203d 2064 7261 775f 7661 770d 0a20  aw = draw_vaw.. 
+0000cf90: 2020 2020 2020 2073 656c 662e 6472 6177         self.draw
+0000cfa0: 5f70 6f63 203d 2064 7261 775f 706f 630d  _poc = draw_poc.
+0000cfb0: 0a20 2020 2020 2020 2023 2320 7365 6c66  .        ## self
+0000cfc0: 2e63 6f6c 5f64 6174 615f 656e 6420 3d20  .col_data_end = 
+0000cfd0: 6c65 6e28 6461 7461 7372 632e 6466 2e63  len(datasrc.df.c
+0000cfe0: 6f6c 756d 6e73 290d 0a20 2020 2020 2020  olumns)..       
+0000cff0: 2063 6f6c 6f72 6675 6e63 203d 2063 6f6c   colorfunc = col
+0000d000: 6f72 6675 6e63 206f 7220 686f 7269 7a76  orfunc or horizv
+0000d010: 6f6c 5f63 6f6c 6f72 6669 6c74 6572 2829  ol_colorfilter()
+0000d020: 2023 2072 6573 6f6c 7665 2066 756e 6374   # resolve funct
+0000d030: 696f 6e20 6c6f 7765 7220 646f 776e 2069  ion lower down i
+0000d040: 6e20 736f 7572 6365 2063 6f64 650d 0a20  n source code.. 
+0000d050: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
+0000d060: 5f69 6e69 745f 5f28 6178 2c20 6461 7461  _init__(ax, data
+0000d070: 7372 632c 2064 7261 775f 7368 6164 6f77  src, draw_shadow
+0000d080: 3d46 616c 7365 2c20 6361 6e64 6c65 5f77  =False, candle_w
+0000d090: 6964 7468 3d63 616e 646c 655f 7769 6474  idth=candle_widt
+0000d0a0: 682c 2064 7261 775f 626f 6479 3d64 7261  h, draw_body=dra
+0000d0b0: 775f 626f 6479 2c20 636f 6c6f 7266 756e  w_body, colorfun
+0000d0c0: 633d 636f 6c6f 7266 756e 6329 0d0a 2020  c=colorfunc)..  
+0000d0d0: 2020 2020 2020 7365 6c66 2e6c 6f64 203d        self.lod =
+0000d0e0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0000d0f0: 7365 6c66 2e63 6f6c 6f72 732e 7570 6461  self.colors.upda
+0000d100: 7465 2864 6963 7428 6e65 7574 7261 6c5f  te(dict(neutral_
+0000d110: 7368 6164 6f77 2020 3d20 766f 6c75 6d65  shadow  = volume
+0000d120: 5f6e 6575 7472 616c 5f63 6f6c 6f72 2c0d  _neutral_color,.
+0000d130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d150: 206e 6575 7472 616c 5f66 7261 6d65 2020   neutral_frame  
+0000d160: 203d 2076 6f6c 756d 655f 6e65 7574 7261   = volume_neutra
+0000d170: 6c5f 636f 6c6f 722c 0d0a 2020 2020 2020  l_color,..      
+0000d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d190: 2020 2020 2020 2020 2020 6e65 7574 7261            neutra
+0000d1a0: 6c5f 626f 6479 2020 2020 3d20 766f 6c75  l_body    = volu
+0000d1b0: 6d65 5f6e 6575 7472 616c 5f63 6f6c 6f72  me_neutral_color
+0000d1c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1e0: 2020 2062 756c 6c5f 626f 6479 2020 2020     bull_body    
+0000d1f0: 2020 203d 2063 616e 646c 655f 6275 6c6c     = candle_bull
+0000d200: 5f63 6f6c 6f72 2929 0d0a 0d0a 2020 2020  _color))....    
+0000d210: 6465 6620 6765 6e65 7261 7465 5f70 6963  def generate_pic
+0000d220: 7475 7265 2873 656c 662c 2062 6f75 6e64  ture(self, bound
+0000d230: 696e 6752 6563 7429 3a0d 0a20 2020 2020  ingRect):..     
+0000d240: 2020 2074 696d 6573 203d 2073 656c 662e     times = self.
+0000d250: 6461 7461 7372 632e 6466 2e69 6c6f 635b  datasrc.df.iloc[
+0000d260: 3a2c 2030 5d0d 0a20 2020 2020 2020 2076  :, 0]..        v
+0000d270: 616c 7320 3d20 7365 6c66 2e64 6174 6173  als = self.datas
+0000d280: 7263 2e64 662e 7661 6c75 6573 0d0a 2020  rc.df.values..  
+0000d290: 2020 2020 2020 7072 6963 6573 203d 2076        prices = v
+0000d2a0: 616c 735b 3a2c 2073 656c 662e 6461 7461  als[:, self.data
+0000d2b0: 7372 632e 636f 6c5f 6461 7461 5f6f 6666  src.col_data_off
+0000d2c0: 7365 743a 3a32 5d0d 0a20 2020 2020 2020  set::2]..       
+0000d2d0: 2076 6f6c 756d 6573 203d 2076 616c 735b   volumes = vals[
+0000d2e0: 3a2c 2073 656c 662e 6461 7461 7372 632e  :, self.datasrc.
+0000d2f0: 636f 6c5f 6461 7461 5f6f 6666 7365 742b  col_data_offset+
+0000d300: 313a 3a32 5d2e 540d 0a20 2020 2020 2020  1::2].T..       
+0000d310: 2023 206e 6f72 6d61 6c69 7a65 0d0a 2020   # normalize..  
+0000d320: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0000d330: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
+0000d340: 5f70 6474 696d 6532 696e 6465 7828 7365  _pdtime2index(se
+0000d350: 6c66 2e61 782c 2074 696d 6573 2c20 7265  lf.ax, times, re
+0000d360: 7175 6972 655f 7469 6d65 3d54 7275 6529  quire_time=True)
+0000d370: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+0000d380: 6465 785f 7374 6570 7320 3d20 7064 2e53  dex_steps = pd.S
+0000d390: 6572 6965 7328 696e 6465 7829 2e64 6966  eries(index).dif
+0000d3a0: 6628 292e 7368 6966 7428 2d31 290d 0a20  f().shift(-1).. 
+0000d3b0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0000d3c0: 5f73 7465 7073 5b69 6e64 6578 5f73 7465  _steps[index_ste
+0000d3d0: 7073 2e69 6e64 6578 5b2d 315d 5d20 3d20  ps.index[-1]] = 
+0000d3e0: 696e 6465 785f 7374 6570 732e 6d65 6469  index_steps.medi
+0000d3f0: 616e 2829 0d0a 2020 2020 2020 2020 6578  an()..        ex
+0000d400: 6365 7074 2041 7373 6572 7469 6f6e 4572  cept AssertionEr
+0000d410: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+0000d420: 2020 696e 6465 7820 3d20 7469 6d65 730d    index = times.
+0000d430: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+0000d440: 6578 5f73 7465 7073 203d 205b 315d 2a6c  ex_steps = [1]*l
+0000d450: 656e 2869 6e64 6578 290d 0a20 2020 2020  en(index)..     
+0000d460: 2020 2064 7261 775f 626f 6479 203d 2073     draw_body = s
+0000d470: 656c 662e 6472 6177 5f62 6f64 790d 0a20  elf.draw_body.. 
+0000d480: 2020 2020 2020 2077 6620 3d20 310d 0a20         wf = 1.. 
+0000d490: 2020 2020 2020 2069 6620 6472 6177 5f62         if draw_b
+0000d4a0: 6f64 7920 3c20 303a 0d0a 2020 2020 2020  ody < 0:..      
+0000d4b0: 2020 2020 2020 7766 203d 202d 6472 6177        wf = -draw
+0000d4c0: 5f62 6f64 7920 2a20 7365 6c66 2e61 782e  _body * self.ax.
+0000d4d0: 7662 2e74 6172 6765 7452 6563 7428 292e  vb.targetRect().
+0000d4e0: 7769 6474 6828 290d 0a20 2020 2020 2020  width()..       
+0000d4f0: 2020 2020 2064 7261 775f 626f 6479 203d       draw_body =
+0000d500: 2031 0d0a 2020 2020 2020 2020 6269 6e63   1..        binc
+0000d510: 203d 206c 656e 2876 6f6c 756d 6573 290d   = len(volumes).
+0000d520: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000d530: 6269 6e63 3a0d 0a20 2020 2020 2020 2020  binc:..         
+0000d540: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+0000d550: 2020 2064 6976 766f 6c20 3d20 6e70 2e6e     divvol = np.n
+0000d560: 616e 6d61 7828 6e70 2e61 6273 2876 6f6c  anmax(np.abs(vol
+0000d570: 756d 6573 292c 2061 7869 733d 3029 0d0a  umes), axis=0)..
+0000d580: 2020 2020 2020 2020 6469 7676 6f6c 5b64          divvol[d
+0000d590: 6976 766f 6c3d 3d30 5d20 3d20 310d 0a20  ivvol==0] = 1.. 
+0000d5a0: 2020 2020 2020 2076 6f6c 756d 6573 203d         volumes =
+0000d5b0: 2028 766f 6c75 6d65 7320 2a20 7766 202f   (volumes * wf /
+0000d5c0: 2064 6976 766f 6c29 2e54 0d0a 2020 2020   divvol).T..    
+0000d5d0: 2020 2020 7020 3d20 7365 6c66 2e70 6169      p = self.pai
+0000d5e0: 6e74 6572 0d0a 2020 2020 2020 2020 6820  nter..        h 
+0000d5f0: 3d20 3165 2d31 300d 0a20 2020 2020 2020  = 1e-10..       
+0000d600: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0000d610: 6c65 6e28 7072 6963 6573 2929 3a0d 0a20  len(prices)):.. 
+0000d620: 2020 2020 2020 2020 2020 2066 203d 2069             f = i
+0000d630: 6e64 6578 5f73 7465 7073 5b69 5d20 2a20  ndex_steps[i] * 
+0000d640: 7766 0d0a 2020 2020 2020 2020 2020 2020  wf..            
+0000d650: 7072 6372 203d 2070 7269 6365 735b 695d  prcr = prices[i]
+0000d660: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+0000d670: 7620 3d20 7072 6372 5b7e 6e70 2e69 736e  v = prcr[~np.isn
+0000d680: 616e 2870 7263 7229 5d0d 0a20 2020 2020  an(prcr)]..     
+0000d690: 2020 2020 2020 2069 6620 6c65 6e28 7072         if len(pr
+0000d6a0: 7629 203e 2031 3a0d 0a20 2020 2020 2020  v) > 1:..       
+0000d6b0: 2020 2020 2020 2020 2068 203d 206e 702e           h = np.
+0000d6c0: 6469 6666 2870 7276 292e 6d69 6e28 290d  diff(prv).min().
+0000d6d0: 0a20 2020 2020 2020 2020 2020 2074 203d  .            t =
+0000d6e0: 2069 6e64 6578 5b69 5d0d 0a20 2020 2020   index[i]..     
+0000d6f0: 2020 2020 2020 2076 6f6c 7220 3d20 6e70         volr = np
+0000d700: 2e6e 616e 5f74 6f5f 6e75 6d28 766f 6c75  .nan_to_num(volu
+0000d710: 6d65 735b 695d 290d 0a0d 0a20 2020 2020  mes[i])....     
+0000d720: 2020 2020 2020 2023 2063 616c 6320 706f         # calc po
+0000d730: 630d 0a20 2020 2020 2020 2020 2020 2070  c..            p
+0000d740: 6f63 6964 7820 3d20 6e70 2e6e 616e 6172  ocidx = np.nanar
+0000d750: 676d 6178 2876 6f6c 7229 0d0a 0d0a 2020  gmax(volr)....  
+0000d760: 2020 2020 2020 2020 2020 2320 6472 6177            # draw
+0000d770: 2076 616c 7565 2061 7265 610d 0a20 2020   value area..   
+0000d780: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000d790: 2e64 7261 775f 7661 3a0d 0a20 2020 2020  .draw_va:..     
+0000d7a0: 2020 2020 2020 2020 2020 2076 6f6c 7273             volrs
+0000d7b0: 203d 2076 6f6c 7220 2f20 6e70 2e6e 616e   = volr / np.nan
+0000d7c0: 7375 6d28 766f 6c72 290d 0a20 2020 2020  sum(volr)..     
+0000d7d0: 2020 2020 2020 2020 2020 2076 203d 2076             v = v
+0000d7e0: 6f6c 7273 5b70 6f63 6964 785d 0d0a 2020  olrs[pocidx]..  
+0000d7f0: 2020 2020 2020 2020 2020 2020 2020 6120                a 
+0000d800: 3d20 6220 3d20 706f 6369 6478 0d0a 2020  = b = pocidx..  
+0000d810: 2020 2020 2020 2020 2020 2020 2020 7768                wh
+0000d820: 696c 6520 5472 7565 3a0d 0a20 2020 2020  ile True:..     
+0000d830: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000d840: 6620 7620 3e3d 2073 656c 662e 6472 6177  f v >= self.draw
+0000d850: 5f76 6120 2d20 3165 2d35 3a0d 0a20 2020  _va - 1e-5:..   
+0000d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d870: 2020 2020 2062 7265 616b 0d0a 2020 2020       break..    
+0000d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d890: 6161 203d 2061 202d 2031 0d0a 2020 2020  aa = a - 1..    
+0000d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8b0: 6262 203d 2062 202b 2031 0d0a 2020 2020  bb = b + 1..    
 0000d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d8d0: 2076 202b 3d20 7662 0d0a 2020 2020 2020   v += vb..      
-0000d8e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000d8f0: 2061 3d3d 3020 616e 6420 623d 3d62 696e   a==0 and b==bin
-0000d900: 632d 313a 0d0a 2020 2020 2020 2020 2020  c-1:..          
-0000d910: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0000d920: 6561 6b0d 0a20 2020 2020 2020 2020 2020  eak..           
-0000d930: 2020 2020 2063 6f6c 6f72 203d 2070 672e       color = pg.
-0000d940: 6d6b 436f 6c6f 7228 6261 6e64 5f63 6f6c  mkColor(band_col
-0000d950: 6f72 290d 0a20 2020 2020 2020 2020 2020  or)..           
-0000d960: 2020 2020 2070 2e66 696c 6c52 6563 7428       p.fillRect(
-0000d970: 5174 436f 7265 2e51 5265 6374 4628 742c  QtCore.QRectF(t,
-0000d980: 2070 7263 725b 615d 2c20 662a 7365 6c66   prcr[a], f*self
-0000d990: 2e64 7261 775f 7661 772c 2070 7263 725b  .draw_vaw, prcr[
-0000d9a0: 625d 2d70 7263 725b 615d 2b68 292c 2063  b]-prcr[a]+h), c
-0000d9b0: 6f6c 6f72 290d 0a0d 0a20 2020 2020 2020  olor)....       
-0000d9c0: 2020 2020 2023 2064 7261 7720 686f 7269       # draw hori
-0000d9d0: 7a6f 6e74 616c 2062 6172 730d 0a20 2020  zontal bars..   
-0000d9e0: 2020 2020 2020 2020 2069 6620 6472 6177           if draw
-0000d9f0: 5f62 6f64 793a 0d0a 2020 2020 2020 2020  _body:..        
-0000da00: 2020 2020 2020 2020 6830 203d 2068 202a          h0 = h *
-0000da10: 2028 312d 7365 6c66 2e63 616e 646c 655f   (1-self.candle_
-0000da20: 7769 6474 6829 2f32 0d0a 2020 2020 2020  width)/2..      
-0000da30: 2020 2020 2020 2020 2020 6831 203d 2068            h1 = h
-0000da40: 202a 2073 656c 662e 6361 6e64 6c65 5f77   * self.candle_w
-0000da50: 6964 7468 0d0a 2020 2020 2020 2020 2020  idth..          
-0000da60: 2020 2020 2020 666f 7220 7368 6164 6f77        for shadow
-0000da70: 2c66 7261 6d65 2c62 6f64 792c 6461 7461  ,frame,body,data
-0000da80: 2069 6e20 7365 6c66 2e63 6f6c 6f72 6675   in self.colorfu
-0000da90: 6e63 2873 656c 662c 2073 656c 662e 6461  nc(self, self.da
-0000daa0: 7461 7372 632c 206e 702e 6172 7261 7928  tasrc, np.array(
-0000dab0: 5b70 7263 722c 2076 6f6c 725d 2929 3a0d  [prcr, volr])):.
-0000dac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dad0: 2020 2020 2070 2e73 6574 5065 6e28 7067       p.setPen(pg
-0000dae0: 2e6d 6b50 656e 2866 7261 6d65 2929 0d0a  .mkPen(frame))..
-0000daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db00: 2020 2020 702e 7365 7442 7275 7368 2870      p.setBrush(p
-0000db10: 672e 6d6b 4272 7573 6828 626f 6479 2929  g.mkBrush(body))
-0000db20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000db30: 2020 2020 2020 7072 6372 5f2c 766f 6c72        prcr_,volr
-0000db40: 5f20 3d20 6461 7461 0d0a 2020 2020 2020  _ = data..      
-0000db50: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000db60: 7220 772c 7920 696e 207a 6970 2876 6f6c  r w,y in zip(vol
-0000db70: 725f 2c20 7072 6372 5f29 3a0d 0a20 2020  r_, prcr_):..   
-0000db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db90: 2020 2020 2069 6620 6162 7328 7729 203e       if abs(w) >
-0000dba0: 2031 652d 3135 3a0d 0a20 2020 2020 2020   1e-15:..       
-0000dbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbc0: 2020 2020 2070 2e64 7261 7752 6563 7428       p.drawRect(
-0000dbd0: 5174 436f 7265 2e51 5265 6374 4628 742c  QtCore.QRectF(t,
-0000dbe0: 2079 2b68 302c 2077 2a66 2a64 7261 775f   y+h0, w*f*draw_
-0000dbf0: 626f 6479 2c20 6831 2929 0d0a 0d0a 2020  body, h1))....  
-0000dc00: 2020 2020 2020 2020 2020 2320 6472 6177            # draw
-0000dc10: 2070 6f63 206c 696e 650d 0a20 2020 2020   poc line..     
-0000dc20: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
-0000dc30: 7261 775f 706f 633a 0d0a 2020 2020 2020  raw_poc:..      
-0000dc40: 2020 2020 2020 2020 2020 7920 3d20 7072            y = pr
-0000dc50: 6372 5b70 6f63 6964 785d 202b 2068 202f  cr[pocidx] + h /
-0000dc60: 2032 0d0a 2020 2020 2020 2020 2020 2020   2..            
-0000dc70: 2020 2020 702e 7365 7450 656e 2870 672e      p.setPen(pg.
-0000dc80: 6d6b 5065 6e28 706f 635f 636f 6c6f 7229  mkPen(poc_color)
-0000dc90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000dca0: 2020 2070 2e64 7261 774c 696e 6528 5174     p.drawLine(Qt
-0000dcb0: 436f 7265 2e51 506f 696e 7446 2874 2c20  Core.QPointF(t, 
-0000dcc0: 7929 2c20 5174 436f 7265 2e51 506f 696e  y), QtCore.QPoin
-0000dcd0: 7446 2874 2b66 2a73 656c 662e 6472 6177  tF(t+f*self.draw
-0000dce0: 5f70 6f63 2c20 7929 290d 0a0d 0a0d 0a0d  _poc, y)).......
-0000dcf0: 0a63 6c61 7373 2053 6361 7474 6572 4c61  .class ScatterLa
-0000dd00: 6265 6c49 7465 6d28 4669 6e50 6c6f 7449  belItem(FinPlotI
-0000dd10: 7465 6d29 3a0d 0a20 2020 2064 6566 205f  tem):..    def _
-0000dd20: 5f69 6e69 745f 5f28 7365 6c66 2c20 6178  _init__(self, ax
-0000dd30: 2c20 6461 7461 7372 632c 2063 6f6c 6f72  , datasrc, color
-0000dd40: 2c20 616e 6368 6f72 293a 0d0a 2020 2020  , anchor):..    
-0000dd50: 2020 2020 7365 6c66 2e63 6f6c 6f72 203d      self.color =
-0000dd60: 2063 6f6c 6f72 0d0a 2020 2020 2020 2020   color..        
-0000dd70: 7365 6c66 2e74 6578 745f 6974 656d 7320  self.text_items 
-0000dd80: 3d20 7b7d 0d0a 2020 2020 2020 2020 7365  = {}..        se
-0000dd90: 6c66 2e61 6e63 686f 7220 3d20 616e 6368  lf.anchor = anch
-0000dda0: 6f72 0d0a 2020 2020 2020 2020 7365 6c66  or..        self
-0000ddb0: 2e73 686f 7720 3d20 4661 6c73 650d 0a20  .show = False.. 
-0000ddc0: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-0000ddd0: 5f69 6e69 745f 5f28 6178 2c20 6461 7461  _init__(ax, data
-0000dde0: 7372 632c 206c 6f64 3d54 7275 6529 0d0a  src, lod=True)..
-0000ddf0: 0d0a 2020 2020 6465 6620 6765 6e65 7261  ..    def genera
-0000de00: 7465 5f70 6963 7475 7265 2873 656c 662c  te_picture(self,
-0000de10: 2062 6f75 6e64 696e 675f 7265 6374 293a   bounding_rect):
-0000de20: 0d0a 2020 2020 2020 2020 726f 7773 203d  ..        rows =
-0000de30: 2073 656c 662e 6765 7472 6f77 7328 626f   self.getrows(bo
-0000de40: 756e 6469 6e67 5f72 6563 7429 0d0a 2020  unding_rect)..  
-0000de50: 2020 2020 2020 6966 206c 656e 2872 6f77        if len(row
-0000de60: 7329 203e 206c 6f64 5f6c 6162 656c 733a  s) > lod_labels:
-0000de70: 2023 2064 6f6e 2774 2065 7665 6e20 6765   # don't even ge
-0000de80: 6e65 7261 7465 2077 6865 6e20 7468 6572  nerate when ther
-0000de90: 6527 7320 746f 6f20 6d61 6e79 206f 6620  e's too many of 
-0000dea0: 7468 656d 0d0a 2020 2020 2020 2020 2020  them..          
-0000deb0: 2020 7365 6c66 2e63 6c65 6172 5f69 7465    self.clear_ite
-0000dec0: 6d73 286c 6973 7428 7365 6c66 2e74 6578  ms(list(self.tex
-0000ded0: 745f 6974 656d 732e 6b65 7973 2829 2929  t_items.keys()))
-0000dee0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000def0: 7475 726e 0d0a 2020 2020 2020 2020 6472  turn..        dr
-0000df00: 6f70 7320 3d20 7365 7428 7365 6c66 2e74  ops = set(self.t
-0000df10: 6578 745f 6974 656d 732e 6b65 7973 2829  ext_items.keys()
-0000df20: 290d 0a20 2020 2020 2020 2063 7265 6174  )..        creat
-0000df30: 6564 203d 2030 0d0a 2020 2020 2020 2020  ed = 0..        
-0000df40: 666f 7220 782c 742c 792c 7478 7420 696e  for x,t,y,txt in
-0000df50: 2072 6f77 733a 0d0a 2020 2020 2020 2020   rows:..        
-0000df60: 2020 2020 7478 7420 3d20 7374 7228 7478      txt = str(tx
-0000df70: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-0000df80: 6973 6874 6d6c 203d 2027 3c27 2069 6e20  ishtml = '<' in 
-0000df90: 7478 7420 616e 6420 273e 2720 696e 2074  txt and '>' in t
-0000dfa0: 7874 0d0a 2020 2020 2020 2020 2020 2020  xt..            
-0000dfb0: 6b65 7920 3d20 2725 733a 252e 3866 2720  key = '%s:%.8f' 
-0000dfc0: 2520 2874 2c20 7929 0d0a 2020 2020 2020  % (t, y)..      
-0000dfd0: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
-0000dfe0: 7365 6c66 2e74 6578 745f 6974 656d 733a  self.text_items:
-0000dff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e000: 2020 6974 656d 203d 2073 656c 662e 7465    item = self.te
-0000e010: 7874 5f69 7465 6d73 5b6b 6579 5d0d 0a20  xt_items[key].. 
-0000e020: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000e030: 6974 656d 2e73 6574 4874 6d6c 2069 6620  item.setHtml if 
-0000e040: 6973 6874 6d6c 2065 6c73 6520 6974 656d  ishtml else item
-0000e050: 2e73 6574 5465 7874 2928 7478 7429 0d0a  .setText)(txt)..
-0000e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e070: 6974 656d 2e73 6574 506f 7328 782c 2079  item.setPos(x, y
-0000e080: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000e090: 2020 2064 726f 7073 2e72 656d 6f76 6528     drops.remove(
-0000e0a0: 6b65 7929 0d0a 2020 2020 2020 2020 2020  key)..          
-0000e0b0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0000e0c0: 2020 2020 2020 2020 206b 7773 203d 207b           kws = {
-0000e0d0: 2768 746d 6c27 3a74 7874 7d20 6966 2069  'html':txt} if i
-0000e0e0: 7368 746d 6c20 656c 7365 207b 2774 6578  shtml else {'tex
-0000e0f0: 7427 3a74 7874 7d0d 0a20 2020 2020 2020  t':txt}..       
-0000e100: 2020 2020 2020 2020 2073 656c 662e 7465           self.te
-0000e110: 7874 5f69 7465 6d73 5b6b 6579 5d20 3d20  xt_items[key] = 
-0000e120: 6974 656d 203d 2070 672e 5465 7874 4974  item = pg.TextIt
-0000e130: 656d 2863 6f6c 6f72 3d73 656c 662e 636f  em(color=self.co
-0000e140: 6c6f 722c 2061 6e63 686f 723d 7365 6c66  lor, anchor=self
-0000e150: 2e61 6e63 686f 722c 202a 2a6b 7773 290d  .anchor, **kws).
-0000e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e170: 2069 7465 6d2e 7365 7450 6f73 2878 2c20   item.setPos(x, 
-0000e180: 7929 0d0a 2020 2020 2020 2020 2020 2020  y)..            
-0000e190: 2020 2020 6974 656d 2e73 6574 5061 7265      item.setPare
-0000e1a0: 6e74 4974 656d 2873 656c 6629 0d0a 2020  ntItem(self)..  
-0000e1b0: 2020 2020 2020 2020 2020 2020 2020 6372                cr
-0000e1c0: 6561 7465 6420 2b3d 2031 0d0a 2020 2020  eated += 1..    
-0000e1d0: 2020 2020 6966 2063 7265 6174 6564 203e      if created >
-0000e1e0: 2030 206f 7220 7365 6c66 2e64 6972 7479   0 or self.dirty
-0000e1f0: 3a20 2320 6f6e 6c79 2072 6564 7563 6520  : # only reduce 
-0000e200: 6361 6368 6520 6966 2077 6527 7665 2061  cache if we've a
-0000e210: 6464 6564 2073 6f6d 6520 6e65 7720 6f72  dded some new or
-0000e220: 2075 7064 6174 6564 0d0a 2020 2020 2020   updated..      
-0000e230: 2020 2020 2020 7365 6c66 2e63 6c65 6172        self.clear
-0000e240: 5f69 7465 6d73 2864 726f 7073 290d 0a0d  _items(drops)...
-0000e250: 0a20 2020 2064 6566 2063 6c65 6172 5f69  .    def clear_i
-0000e260: 7465 6d73 2873 656c 662c 2064 726f 705f  tems(self, drop_
-0000e270: 6b65 7973 293a 0d0a 2020 2020 2020 2020  keys):..        
-0000e280: 666f 7220 6b65 7920 696e 2064 726f 705f  for key in drop_
-0000e290: 6b65 7973 3a0d 0a20 2020 2020 2020 2020  keys:..         
-0000e2a0: 2020 2069 7465 6d20 3d20 7365 6c66 2e74     item = self.t
-0000e2b0: 6578 745f 6974 656d 735b 6b65 795d 0d0a  ext_items[key]..
+0000d8d0: 7661 203d 2076 6f6c 7273 5b61 615d 2069  va = volrs[aa] i
+0000d8e0: 6620 6161 3e3d 3020 656c 7365 2030 0d0a  f aa>=0 else 0..
+0000d8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d900: 2020 2020 7662 203d 2076 6f6c 7273 5b62      vb = volrs[b
+0000d910: 625d 2069 6620 6262 3c62 696e 6320 656c  b] if bb<binc el
+0000d920: 7365 2030 0d0a 2020 2020 2020 2020 2020  se 0..          
+0000d930: 2020 2020 2020 2020 2020 6966 2076 6120            if va 
+0000d940: 3e3d 2076 623a 2023 204e 4f54 4520 626f  >= vb: # NOTE bo
+0000d950: 7468 203d 3d20 6973 2061 6c73 6f20 6f6b  th == is also ok
+0000d960: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d970: 2020 2020 2020 2020 2020 6120 3d20 6d61            a = ma
+0000d980: 7828 302c 2061 6129 0d0a 2020 2020 2020  x(0, aa)..      
+0000d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9a0: 2020 7620 2b3d 2076 610d 0a20 2020 2020    v += va..     
+0000d9b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000d9c0: 6620 7661 203c 3d20 7662 3a20 2320 4e4f  f va <= vb: # NO
+0000d9d0: 5445 2062 6f74 6820 3d3d 2069 7320 616c  TE both == is al
+0000d9e0: 736f 206f 6b0d 0a20 2020 2020 2020 2020  so ok..         
+0000d9f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000da00: 203d 206d 696e 2862 696e 632d 312c 2062   = min(binc-1, b
+0000da10: 6229 0d0a 2020 2020 2020 2020 2020 2020  b)..            
+0000da20: 2020 2020 2020 2020 2020 2020 7620 2b3d              v +=
+0000da30: 2076 620d 0a20 2020 2020 2020 2020 2020   vb..           
+0000da40: 2020 2020 2020 2020 2069 6620 613d 3d30           if a==0
+0000da50: 2061 6e64 2062 3d3d 6269 6e63 2d31 3a0d   and b==binc-1:.
+0000da60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000da70: 2020 2020 2020 2020 2062 7265 616b 0d0a           break..
+0000da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da90: 636f 6c6f 7220 3d20 7067 2e6d 6b43 6f6c  color = pg.mkCol
+0000daa0: 6f72 2862 616e 645f 636f 6c6f 7229 0d0a  or(band_color)..
+0000dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dac0: 702e 6669 6c6c 5265 6374 2851 7443 6f72  p.fillRect(QtCor
+0000dad0: 652e 5152 6563 7446 2874 2c20 7072 6372  e.QRectF(t, prcr
+0000dae0: 5b61 5d2c 2066 2a73 656c 662e 6472 6177  [a], f*self.draw
+0000daf0: 5f76 6177 2c20 7072 6372 5b62 5d2d 7072  _vaw, prcr[b]-pr
+0000db00: 6372 5b61 5d2b 6829 2c20 636f 6c6f 7229  cr[a]+h), color)
+0000db10: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0000db20: 2320 6472 6177 2068 6f72 697a 6f6e 7461  # draw horizonta
+0000db30: 6c20 6261 7273 0d0a 2020 2020 2020 2020  l bars..        
+0000db40: 2020 2020 6966 2064 7261 775f 626f 6479      if draw_body
+0000db50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000db60: 2020 2068 3020 3d20 6820 2a20 2831 2d73     h0 = h * (1-s
+0000db70: 656c 662e 6361 6e64 6c65 5f77 6964 7468  elf.candle_width
+0000db80: 292f 320d 0a20 2020 2020 2020 2020 2020  )/2..           
+0000db90: 2020 2020 2068 3120 3d20 6820 2a20 7365       h1 = h * se
+0000dba0: 6c66 2e63 616e 646c 655f 7769 6474 680d  lf.candle_width.
+0000dbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dbc0: 2066 6f72 2073 6861 646f 772c 6672 616d   for shadow,fram
+0000dbd0: 652c 626f 6479 2c64 6174 6120 696e 2073  e,body,data in s
+0000dbe0: 656c 662e 636f 6c6f 7266 756e 6328 7365  elf.colorfunc(se
+0000dbf0: 6c66 2c20 7365 6c66 2e64 6174 6173 7263  lf, self.datasrc
+0000dc00: 2c20 6e70 2e61 7272 6179 285b 7072 6372  , np.array([prcr
+0000dc10: 2c20 766f 6c72 5d29 293a 0d0a 2020 2020  , volr])):..    
+0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc30: 702e 7365 7450 656e 2870 672e 6d6b 5065  p.setPen(pg.mkPe
+0000dc40: 6e28 6672 616d 6529 290d 0a20 2020 2020  n(frame))..     
+0000dc50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000dc60: 2e73 6574 4272 7573 6828 7067 2e6d 6b42  .setBrush(pg.mkB
+0000dc70: 7275 7368 2862 6f64 7929 290d 0a20 2020  rush(body))..   
+0000dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc90: 2070 7263 725f 2c76 6f6c 725f 203d 2064   prcr_,volr_ = d
+0000dca0: 6174 610d 0a20 2020 2020 2020 2020 2020  ata..           
+0000dcb0: 2020 2020 2020 2020 2066 6f72 2077 2c79           for w,y
+0000dcc0: 2069 6e20 7a69 7028 766f 6c72 5f2c 2070   in zip(volr_, p
+0000dcd0: 7263 725f 293a 0d0a 2020 2020 2020 2020  rcr_):..        
+0000dce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dcf0: 6966 2061 6273 2877 2920 3e20 3165 2d31  if abs(w) > 1e-1
+0000dd00: 353a 0d0a 2020 2020 2020 2020 2020 2020  5:..            
+0000dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd20: 702e 6472 6177 5265 6374 2851 7443 6f72  p.drawRect(QtCor
+0000dd30: 652e 5152 6563 7446 2874 2c20 792b 6830  e.QRectF(t, y+h0
+0000dd40: 2c20 772a 662a 6472 6177 5f62 6f64 792c  , w*f*draw_body,
+0000dd50: 2068 3129 290d 0a0d 0a20 2020 2020 2020   h1))....       
+0000dd60: 2020 2020 2023 2064 7261 7720 706f 6320       # draw poc 
+0000dd70: 6c69 6e65 0d0a 2020 2020 2020 2020 2020  line..          
+0000dd80: 2020 6966 2073 656c 662e 6472 6177 5f70    if self.draw_p
+0000dd90: 6f63 3a0d 0a20 2020 2020 2020 2020 2020  oc:..           
+0000dda0: 2020 2020 2079 203d 2070 7263 725b 706f       y = prcr[po
+0000ddb0: 6369 6478 5d20 2b20 6820 2f20 320d 0a20  cidx] + h / 2.. 
+0000ddc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000ddd0: 2e73 6574 5065 6e28 7067 2e6d 6b50 656e  .setPen(pg.mkPen
+0000dde0: 2870 6f63 5f63 6f6c 6f72 2929 0d0a 2020  (poc_color))..  
+0000ddf0: 2020 2020 2020 2020 2020 2020 2020 702e                p.
+0000de00: 6472 6177 4c69 6e65 2851 7443 6f72 652e  drawLine(QtCore.
+0000de10: 5150 6f69 6e74 4628 742c 2079 292c 2051  QPointF(t, y), Q
+0000de20: 7443 6f72 652e 5150 6f69 6e74 4628 742b  tCore.QPointF(t+
+0000de30: 662a 7365 6c66 2e64 7261 775f 706f 632c  f*self.draw_poc,
+0000de40: 2079 2929 0d0a 0d0a 0d0a 0d0a 636c 6173   y))........clas
+0000de50: 7320 5363 6174 7465 724c 6162 656c 4974  s ScatterLabelIt
+0000de60: 656d 2846 696e 506c 6f74 4974 656d 293a  em(FinPlotItem):
+0000de70: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0000de80: 5f5f 2873 656c 662c 2061 782c 2064 6174  __(self, ax, dat
+0000de90: 6173 7263 2c20 636f 6c6f 722c 2061 6e63  asrc, color, anc
+0000dea0: 686f 7229 3a0d 0a20 2020 2020 2020 2073  hor):..        s
+0000deb0: 656c 662e 636f 6c6f 7220 3d20 636f 6c6f  elf.color = colo
+0000dec0: 720d 0a20 2020 2020 2020 2073 656c 662e  r..        self.
+0000ded0: 7465 7874 5f69 7465 6d73 203d 207b 7d0d  text_items = {}.
+0000dee0: 0a20 2020 2020 2020 2073 656c 662e 616e  .        self.an
+0000def0: 6368 6f72 203d 2061 6e63 686f 720d 0a20  chor = anchor.. 
+0000df00: 2020 2020 2020 2073 656c 662e 7368 6f77         self.show
+0000df10: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+0000df20: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
+0000df30: 5f5f 2861 782c 2064 6174 6173 7263 2c20  __(ax, datasrc, 
+0000df40: 6c6f 643d 5472 7565 290d 0a0d 0a20 2020  lod=True)....   
+0000df50: 2064 6566 2067 656e 6572 6174 655f 7069   def generate_pi
+0000df60: 6374 7572 6528 7365 6c66 2c20 626f 756e  cture(self, boun
+0000df70: 6469 6e67 5f72 6563 7429 3a0d 0a20 2020  ding_rect):..   
+0000df80: 2020 2020 2072 6f77 7320 3d20 7365 6c66       rows = self
+0000df90: 2e67 6574 726f 7773 2862 6f75 6e64 696e  .getrows(boundin
+0000dfa0: 675f 7265 6374 290d 0a20 2020 2020 2020  g_rect)..       
+0000dfb0: 2069 6620 6c65 6e28 726f 7773 2920 3e20   if len(rows) > 
+0000dfc0: 6c6f 645f 6c61 6265 6c73 3a20 2320 646f  lod_labels: # do
+0000dfd0: 6e27 7420 6576 656e 2067 656e 6572 6174  n't even generat
+0000dfe0: 6520 7768 656e 2074 6865 7265 2773 2074  e when there's t
+0000dff0: 6f6f 206d 616e 7920 6f66 2074 6865 6d0d  oo many of them.
+0000e000: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000e010: 662e 636c 6561 725f 6974 656d 7328 6c69  f.clear_items(li
+0000e020: 7374 2873 656c 662e 7465 7874 5f69 7465  st(self.text_ite
+0000e030: 6d73 2e6b 6579 7328 2929 290d 0a20 2020  ms.keys()))..   
+0000e040: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+0000e050: 0a20 2020 2020 2020 2064 726f 7073 203d  .        drops =
+0000e060: 2073 6574 2873 656c 662e 7465 7874 5f69   set(self.text_i
+0000e070: 7465 6d73 2e6b 6579 7328 2929 0d0a 2020  tems.keys())..  
+0000e080: 2020 2020 2020 6372 6561 7465 6420 3d20        created = 
+0000e090: 300d 0a20 2020 2020 2020 2066 6f72 2078  0..        for x
+0000e0a0: 2c74 2c79 2c74 7874 2069 6e20 726f 7773  ,t,y,txt in rows
+0000e0b0: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
+0000e0c0: 7874 203d 2073 7472 2874 7874 290d 0a20  xt = str(txt).. 
+0000e0d0: 2020 2020 2020 2020 2020 2069 7368 746d             ishtm
+0000e0e0: 6c20 3d20 273c 2720 696e 2074 7874 2061  l = '<' in txt a
+0000e0f0: 6e64 2027 3e27 2069 6e20 7478 740d 0a20  nd '>' in txt.. 
+0000e100: 2020 2020 2020 2020 2020 206b 6579 203d             key =
+0000e110: 2027 2573 3a25 2e38 6627 2025 2028 742c   '%s:%.8f' % (t,
+0000e120: 2079 290d 0a20 2020 2020 2020 2020 2020   y)..           
+0000e130: 2069 6620 6b65 7920 696e 2073 656c 662e   if key in self.
+0000e140: 7465 7874 5f69 7465 6d73 3a0d 0a20 2020  text_items:..   
+0000e150: 2020 2020 2020 2020 2020 2020 2069 7465               ite
+0000e160: 6d20 3d20 7365 6c66 2e74 6578 745f 6974  m = self.text_it
+0000e170: 656d 735b 6b65 795d 0d0a 2020 2020 2020  ems[key]..      
+0000e180: 2020 2020 2020 2020 2020 2869 7465 6d2e            (item.
+0000e190: 7365 7448 746d 6c20 6966 2069 7368 746d  setHtml if ishtm
+0000e1a0: 6c20 656c 7365 2069 7465 6d2e 7365 7454  l else item.setT
+0000e1b0: 6578 7429 2874 7874 290d 0a20 2020 2020  ext)(txt)..     
+0000e1c0: 2020 2020 2020 2020 2020 2069 7465 6d2e             item.
+0000e1d0: 7365 7450 6f73 2878 2c20 7929 0d0a 2020  setPos(x, y)..  
+0000e1e0: 2020 2020 2020 2020 2020 2020 2020 6472                dr
+0000e1f0: 6f70 732e 7265 6d6f 7665 286b 6579 290d  ops.remove(key).
+0000e200: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000e210: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000e220: 2020 2020 6b77 7320 3d20 7b27 6874 6d6c      kws = {'html
+0000e230: 273a 7478 747d 2069 6620 6973 6874 6d6c  ':txt} if ishtml
+0000e240: 2065 6c73 6520 7b27 7465 7874 273a 7478   else {'text':tx
+0000e250: 747d 0d0a 2020 2020 2020 2020 2020 2020  t}..            
+0000e260: 2020 2020 7365 6c66 2e74 6578 745f 6974      self.text_it
+0000e270: 656d 735b 6b65 795d 203d 2069 7465 6d20  ems[key] = item 
+0000e280: 3d20 7067 2e54 6578 7449 7465 6d28 636f  = pg.TextItem(co
+0000e290: 6c6f 723d 7365 6c66 2e63 6f6c 6f72 2c20  lor=self.color, 
+0000e2a0: 616e 6368 6f72 3d73 656c 662e 616e 6368  anchor=self.anch
+0000e2b0: 6f72 2c20 2a2a 6b77 7329 0d0a 2020 2020  or, **kws)..    
 0000e2c0: 2020 2020 2020 2020 2020 2020 6974 656d              item
-0000e2d0: 2e73 6365 6e65 2829 2e72 656d 6f76 6549  .scene().removeI
-0000e2e0: 7465 6d28 6974 656d 290d 0a20 2020 2020  tem(item)..     
-0000e2f0: 2020 2020 2020 2064 656c 2073 656c 662e         del self.
-0000e300: 7465 7874 5f69 7465 6d73 5b6b 6579 5d0d  text_items[key].
-0000e310: 0a0d 0a20 2020 2064 6566 2067 6574 726f  ...    def getro
-0000e320: 7773 2873 656c 662c 2062 6f75 6e64 696e  ws(self, boundin
-0000e330: 675f 7265 6374 293a 0d0a 2020 2020 2020  g_rect):..      
-0000e340: 2020 6c65 6674 2c72 6967 6874 203d 2062    left,right = b
-0000e350: 6f75 6e64 696e 675f 7265 6374 2e6c 6566  ounding_rect.lef
-0000e360: 7428 292c 2062 6f75 6e64 696e 675f 7265  t(), bounding_re
-0000e370: 6374 2e72 6967 6874 2829 0d0a 2020 2020  ct.right()..    
-0000e380: 2020 2020 6466 2c5f 203d 2073 656c 662e      df,_ = self.
-0000e390: 6461 7461 7372 632e 726f 7773 2833 2c20  datasrc.rows(3, 
-0000e3a0: 6c65 6674 2c20 7269 6768 742c 2079 7363  left, right, ysc
-0000e3b0: 616c 653d 7365 6c66 2e61 782e 7662 2e79  ale=self.ax.vb.y
-0000e3c0: 7363 616c 652c 206c 6f64 3d46 616c 7365  scale, lod=False
-0000e3d0: 290d 0a20 2020 2020 2020 2072 6f77 7320  )..        rows 
-0000e3e0: 3d20 6466 2e64 726f 706e 6128 290d 0a20  = df.dropna().. 
-0000e3f0: 2020 2020 2020 2069 6478 7320 3d20 726f         idxs = ro
-0000e400: 7773 2e69 6e64 6578 0d0a 2020 2020 2020  ws.index..      
-0000e410: 2020 726f 7773 203d 2072 6f77 732e 7661    rows = rows.va
-0000e420: 6c75 6573 0d0a 2020 2020 2020 2020 726f  lues..        ro
-0000e430: 7773 203d 205b 2869 2c74 2c79 2c74 7874  ws = [(i,t,y,txt
-0000e440: 2920 666f 7220 692c 2874 2c79 2c74 7874  ) for i,(t,y,txt
-0000e450: 2920 696e 207a 6970 2869 6478 732c 2072  ) in zip(idxs, r
-0000e460: 6f77 7329 2069 6620 7478 745d 0d0a 2020  ows) if txt]..  
-0000e470: 2020 2020 2020 7265 7475 726e 2072 6f77        return row
-0000e480: 730d 0a0d 0a20 2020 2064 6566 2062 6f75  s....    def bou
-0000e490: 6e64 696e 6752 6563 7428 7365 6c66 293a  ndingRect(self):
-0000e4a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000e4b0: 2073 656c 662e 7669 6577 5265 6374 2829   self.viewRect()
-0000e4c0: 0d0a 0d0a 0d0a 6465 6620 6372 6561 7465  ......def create
-0000e4d0: 5f70 6c6f 7428 7469 746c 653d 2746 696e  _plot(title='Fin
-0000e4e0: 616e 6365 2050 6c6f 7427 2c20 726f 7773  ance Plot', rows
-0000e4f0: 3d31 2c20 696e 6974 5f7a 6f6f 6d5f 7065  =1, init_zoom_pe
-0000e500: 7269 6f64 733d 3165 3130 2c20 6d61 7869  riods=1e10, maxi
-0000e510: 6d69 7a65 3d54 7275 652c 2079 7363 616c  mize=True, yscal
-0000e520: 653d 276c 696e 6561 7227 293a 0d0a 2020  e='linear'):..  
-0000e530: 2020 7067 2e73 6574 436f 6e66 6967 4f70    pg.setConfigOp
-0000e540: 7469 6f6e 7328 666f 7265 6772 6f75 6e64  tions(foreground
-0000e550: 3d66 6f72 6567 726f 756e 642c 2062 6163  =foreground, bac
-0000e560: 6b67 726f 756e 643d 6261 636b 6772 6f75  kground=backgrou
-0000e570: 6e64 290d 0a20 2020 2077 696e 203d 2046  nd)..    win = F
-0000e580: 696e 5769 6e64 6f77 2874 6974 6c65 290d  inWindow(title).
-0000e590: 0a20 2020 2077 696e 2e73 686f 775f 6d61  .    win.show_ma
-0000e5a0: 7869 6d69 7a65 6420 3d20 6d61 7869 6d69  ximized = maximi
-0000e5b0: 7a65 0d0a 2020 2020 6178 3020 3d20 6178  ze..    ax0 = ax
-0000e5c0: 7320 3d20 6372 6561 7465 5f70 6c6f 745f  s = create_plot_
-0000e5d0: 7769 6467 6574 286d 6173 7465 723d 7769  widget(master=wi
-0000e5e0: 6e2c 2072 6f77 733d 726f 7773 2c20 696e  n, rows=rows, in
-0000e5f0: 6974 5f7a 6f6f 6d5f 7065 7269 6f64 733d  it_zoom_periods=
-0000e600: 696e 6974 5f7a 6f6f 6d5f 7065 7269 6f64  init_zoom_period
-0000e610: 732c 2079 7363 616c 653d 7973 6361 6c65  s, yscale=yscale
-0000e620: 290d 0a20 2020 2061 7873 203d 2061 7873  )..    axs = axs
-0000e630: 2069 6620 7479 7065 2861 7873 2920 696e   if type(axs) in
-0000e640: 2028 7475 706c 652c 6c69 7374 2920 656c   (tuple,list) el
-0000e650: 7365 205b 6178 735d 0d0a 2020 2020 666f  se [axs]..    fo
-0000e660: 7220 6178 2069 6e20 6178 733a 0d0a 2020  r ax in axs:..  
-0000e670: 2020 2020 2020 7769 6e2e 6164 6449 7465        win.addIte
-0000e680: 6d28 6178 2c20 636f 6c3d 3129 0d0a 2020  m(ax, col=1)..  
-0000e690: 2020 2020 2020 7769 6e2e 6e65 7874 526f        win.nextRo
-0000e6a0: 7728 290d 0a20 2020 2072 6574 7572 6e20  w()..    return 
-0000e6b0: 6178 300d 0a0d 0a0d 0a64 6566 2063 7265  ax0......def cre
-0000e6c0: 6174 655f 706c 6f74 5f77 6964 6765 7428  ate_plot_widget(
-0000e6d0: 6d61 7374 6572 2c20 726f 7773 3d31 2c20  master, rows=1, 
-0000e6e0: 696e 6974 5f7a 6f6f 6d5f 7065 7269 6f64  init_zoom_period
-0000e6f0: 733d 3165 3130 2c20 7973 6361 6c65 3d27  s=1e10, yscale='
-0000e700: 6c69 6e65 6172 2729 3a0d 0a20 2020 2070  linear'):..    p
-0000e710: 672e 7365 7443 6f6e 6669 674f 7074 696f  g.setConfigOptio
-0000e720: 6e73 2866 6f72 6567 726f 756e 643d 666f  ns(foreground=fo
-0000e730: 7265 6772 6f75 6e64 2c20 6261 636b 6772  reground, backgr
-0000e740: 6f75 6e64 3d62 6163 6b67 726f 756e 6429  ound=background)
-0000e750: 0d0a 2020 2020 676c 6f62 616c 206c 6173  ..    global las
-0000e760: 745f 6178 0d0a 2020 2020 6966 206d 6173  t_ax..    if mas
-0000e770: 7465 7220 6e6f 7420 696e 2077 696e 646f  ter not in windo
-0000e780: 7773 3a0d 0a20 2020 2020 2020 2077 696e  ws:..        win
-0000e790: 646f 7773 2e61 7070 656e 6428 6d61 7374  dows.append(mast
-0000e7a0: 6572 290d 0a20 2020 2061 7873 203d 205b  er)..    axs = [
-0000e7b0: 5d0d 0a20 2020 2070 7265 765f 6178 203d  ]..    prev_ax =
-0000e7c0: 204e 6f6e 650d 0a20 2020 2066 6f72 206e   None..    for n
-0000e7d0: 2069 6e20 7261 6e67 6528 726f 7773 293a   in range(rows):
-0000e7e0: 0d0a 2020 2020 2020 2020 7973 6320 3d20  ..        ysc = 
-0000e7f0: 7973 6361 6c65 5b6e 5d20 6966 2074 7970  yscale[n] if typ
-0000e800: 6528 7973 6361 6c65 2920 696e 2028 6c69  e(yscale) in (li
-0000e810: 7374 2c74 7570 6c65 2920 656c 7365 2079  st,tuple) else y
-0000e820: 7363 616c 650d 0a20 2020 2020 2020 2079  scale..        y
-0000e830: 7363 203d 2059 5363 616c 6528 7973 632c  sc = YScale(ysc,
-0000e840: 2031 290d 0a20 2020 2020 2020 2076 6965   1)..        vie
-0000e850: 7762 6f78 203d 2046 696e 5669 6577 426f  wbox = FinViewBo
-0000e860: 7828 6d61 7374 6572 2c20 696e 6974 5f73  x(master, init_s
-0000e870: 7465 7073 3d69 6e69 745f 7a6f 6f6d 5f70  teps=init_zoom_p
-0000e880: 6572 696f 6473 2c20 7973 6361 6c65 3d79  eriods, yscale=y
-0000e890: 7363 2c20 765f 7a6f 6f6d 5f73 6361 6c65  sc, v_zoom_scale
-0000e8a0: 3d31 2d79 5f70 6164 2c20 656e 6162 6c65  =1-y_pad, enable
-0000e8b0: 4d65 6e75 3d46 616c 7365 290d 0a20 2020  Menu=False)..   
-0000e8c0: 2020 2020 2061 7820 3d20 7072 6576 5f61       ax = prev_a
-0000e8d0: 7820 3d20 5f61 6464 5f74 696d 6573 7461  x = _add_timesta
-0000e8e0: 6d70 5f70 6c6f 7428 6d61 7374 6572 3d6d  mp_plot(master=m
-0000e8f0: 6173 7465 722c 2070 7265 765f 6178 3d70  aster, prev_ax=p
-0000e900: 7265 765f 6178 2c20 7669 6577 626f 783d  rev_ax, viewbox=
-0000e910: 7669 6577 626f 782c 2069 6e64 6578 3d6e  viewbox, index=n
-0000e920: 2c20 7973 6361 6c65 3d79 7363 290d 0a20  , yscale=ysc).. 
-0000e930: 2020 2020 2020 2069 6620 6178 733a 0d0a         if axs:..
-0000e940: 2020 2020 2020 2020 2020 2020 6178 2e73              ax.s
-0000e950: 6574 584c 696e 6b28 6178 735b 305d 2e76  etXLink(axs[0].v
-0000e960: 6229 0d0a 2020 2020 2020 2020 656c 7365  b)..        else
-0000e970: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
-0000e980: 6965 7762 6f78 2e73 6574 466f 6375 7328  iewbox.setFocus(
-0000e990: 290d 0a20 2020 2020 2020 2061 7873 202b  )..        axs +
-0000e9a0: 3d20 5b61 785d 0d0a 2020 2020 6966 206d  = [ax]..    if m
-0000e9b0: 6173 7465 7220 6e6f 7420 696e 206d 6173  aster not in mas
-0000e9c0: 7465 725f 6461 7461 3a0d 0a20 2020 2020  ter_data:..     
-0000e9d0: 2020 206d 6173 7465 725f 6461 7461 5b6d     master_data[m
-0000e9e0: 6173 7465 725d 203d 207b 7d0d 0a20 2020  aster] = {}..   
-0000e9f0: 2069 6620 6973 696e 7374 616e 6365 286d   if isinstance(m
-0000ea00: 6173 7465 722c 2070 672e 4772 6170 6869  aster, pg.Graphi
-0000ea10: 6373 4c61 796f 7574 5769 6467 6574 293a  csLayoutWidget):
-0000ea20: 0d0a 2020 2020 2020 2020 7072 6f78 7920  ..        proxy 
-0000ea30: 3d20 7067 2e53 6967 6e61 6c50 726f 7879  = pg.SignalProxy
-0000ea40: 286d 6173 7465 722e 7363 656e 6528 292e  (master.scene().
-0000ea50: 7369 674d 6f75 7365 4d6f 7665 642c 2072  sigMouseMoved, r
-0000ea60: 6174 654c 696d 6974 3d31 3434 2c20 736c  ateLimit=144, sl
-0000ea70: 6f74 3d70 6172 7469 616c 285f 6d6f 7573  ot=partial(_mous
-0000ea80: 655f 6d6f 7665 642c 206d 6173 7465 722c  e_moved, master,
-0000ea90: 2061 7873 5b30 5d2e 7662 2929 0d0a 2020   axs[0].vb))..  
-0000eaa0: 2020 2020 2020 6d61 7374 6572 5f64 6174        master_dat
-0000eab0: 615b 6d61 7374 6572 5d5b 6178 735b 305d  a[master][axs[0]
-0000eac0: 2e76 625d 203d 2064 6963 7428 7072 6f78  .vb] = dict(prox
-0000ead0: 796d 6d3d 7072 6f78 792c 206c 6173 745f  ymm=proxy, last_
-0000eae0: 6d6f 7573 655f 6576 733d 4e6f 6e65 2c20  mouse_evs=None, 
-0000eaf0: 6c61 7374 5f6d 6f75 7365 5f79 3d30 290d  last_mouse_y=0).
-0000eb00: 0a20 2020 2020 2020 2069 6620 2764 6566  .        if 'def
-0000eb10: 6175 6c74 2720 6e6f 7420 696e 206d 6173  ault' not in mas
-0000eb20: 7465 725f 6461 7461 5b6d 6173 7465 725d  ter_data[master]
-0000eb30: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-0000eb40: 6173 7465 725f 6461 7461 5b6d 6173 7465  aster_data[maste
-0000eb50: 725d 5b27 6465 6661 756c 7427 5d20 3d20  r]['default'] = 
-0000eb60: 6d61 7374 6572 5f64 6174 615b 6d61 7374  master_data[mast
-0000eb70: 6572 5d5b 6178 735b 305d 2e76 625d 0d0a  er][axs[0].vb]..
-0000eb80: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000eb90: 2020 2066 6f72 2061 7820 696e 2061 7873     for ax in axs
-0000eba0: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-0000ebb0: 726f 7879 203d 2070 672e 5369 676e 616c  roxy = pg.Signal
-0000ebc0: 5072 6f78 7928 6178 2e61 785f 7769 6467  Proxy(ax.ax_widg
-0000ebd0: 6574 2e73 6365 6e65 2829 2e73 6967 4d6f  et.scene().sigMo
-0000ebe0: 7573 654d 6f76 6564 2c20 7261 7465 4c69  useMoved, rateLi
-0000ebf0: 6d69 743d 3134 342c 2073 6c6f 743d 7061  mit=144, slot=pa
-0000ec00: 7274 6961 6c28 5f6d 6f75 7365 5f6d 6f76  rtial(_mouse_mov
-0000ec10: 6564 2c20 6d61 7374 6572 2c20 6178 2e76  ed, master, ax.v
-0000ec20: 6229 290d 0a20 2020 2020 2020 2020 2020  b))..           
-0000ec30: 206d 6173 7465 725f 6461 7461 5b6d 6173   master_data[mas
-0000ec40: 7465 725d 5b61 782e 7662 5d20 3d20 6469  ter][ax.vb] = di
-0000ec50: 6374 2870 726f 7879 6d6d 3d70 726f 7879  ct(proxymm=proxy
-0000ec60: 2c20 6c61 7374 5f6d 6f75 7365 5f65 7673  , last_mouse_evs
-0000ec70: 3d4e 6f6e 652c 206c 6173 745f 6d6f 7573  =None, last_mous
-0000ec80: 655f 793d 3029 0d0a 2020 2020 6c61 7374  e_y=0)..    last
-0000ec90: 5f61 7820 3d20 6178 735b 305d 0d0a 2020  _ax = axs[0]..  
-0000eca0: 2020 7265 7475 726e 2061 7873 5b30 5d20    return axs[0] 
-0000ecb0: 6966 206c 656e 2861 7873 2920 3d3d 2031  if len(axs) == 1
-0000ecc0: 2065 6c73 6520 6178 730d 0a0d 0a0d 0a64   else axs......d
-0000ecd0: 6566 2063 6c6f 7365 2829 3a0d 0a20 2020  ef close():..   
-0000ece0: 2066 6f72 2077 696e 2069 6e20 7769 6e64   for win in wind
-0000ecf0: 6f77 733a 0d0a 2020 2020 2020 2020 7472  ows:..        tr
-0000ed00: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0000ed10: 7769 6e2e 636c 6f73 6528 290d 0a20 2020  win.close()..   
-0000ed20: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-0000ed30: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
-0000ed40: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0000ed50: 5769 6e64 6f77 2063 6c6f 7369 6e67 2065  Window closing e
-0000ed60: 7272 6f72 3a27 2c20 7479 7065 2865 292c  rror:', type(e),
-0000ed70: 2065 290d 0a20 2020 2067 6c6f 6261 6c20   e)..    global 
-0000ed80: 6c61 7374 5f61 780d 0a20 2020 2077 696e  last_ax..    win
-0000ed90: 646f 7773 2e63 6c65 6172 2829 0d0a 2020  dows.clear()..  
-0000eda0: 2020 6f76 6572 6c61 795f 6178 732e 636c    overlay_axs.cl
-0000edb0: 6561 7228 290d 0a20 2020 205f 636c 6561  ear()..    _clea
-0000edc0: 725f 7469 6d65 7273 2829 0d0a 2020 2020  r_timers()..    
-0000edd0: 736f 756e 6473 2e63 6c65 6172 2829 0d0a  sounds.clear()..
-0000ede0: 2020 2020 6d61 7374 6572 5f64 6174 612e      master_data.
-0000edf0: 636c 6561 7228 290d 0a20 2020 206c 6173  clear()..    las
-0000ee00: 745f 6178 203d 204e 6f6e 650d 0a0d 0a0d  t_ax = None.....
-0000ee10: 0a64 6566 2070 7269 6365 5f63 6f6c 6f72  .def price_color
-0000ee20: 6669 6c74 6572 2869 7465 6d2c 2064 6174  filter(item, dat
-0000ee30: 6173 7263 2c20 6466 293a 0d0a 2020 2020  asrc, df):..    
-0000ee40: 6f70 656e 636f 6c20 3d20 6466 2e63 6f6c  opencol = df.col
-0000ee50: 756d 6e73 5b31 5d0d 0a20 2020 2063 6c6f  umns[1]..    clo
-0000ee60: 7365 636f 6c20 3d20 6466 2e63 6f6c 756d  secol = df.colum
-0000ee70: 6e73 5b32 5d0d 0a20 2020 2069 735f 7570  ns[2]..    is_up
-0000ee80: 203d 2064 665b 6f70 656e 636f 6c5d 203c   = df[opencol] <
-0000ee90: 3d20 6466 5b63 6c6f 7365 636f 6c5d 2023  = df[closecol] #
-0000eea0: 206f 7065 6e20 6c6f 7765 7220 7468 616e   open lower than
-0000eeb0: 2063 6c6f 7365 203d 2067 6f65 7320 7570   close = goes up
-0000eec0: 0d0a 2020 2020 7969 656c 6420 6974 656d  ..    yield item
-0000eed0: 2e72 6f77 636f 6c6f 7273 2827 6275 6c6c  .rowcolors('bull
-0000eee0: 2729 202b 205b 6466 2e6c 6f63 5b69 735f  ') + [df.loc[is_
-0000eef0: 7570 2c20 3a5d 5d0d 0a20 2020 2079 6965  up, :]]..    yie
-0000ef00: 6c64 2069 7465 6d2e 726f 7763 6f6c 6f72  ld item.rowcolor
-0000ef10: 7328 2762 6561 7227 2920 2b20 5b64 662e  s('bear') + [df.
-0000ef20: 6c6f 635b 7e69 735f 7570 2c20 3a5d 5d0d  loc[~is_up, :]].
-0000ef30: 0a0d 0a0d 0a64 6566 2076 6f6c 756d 655f  .....def volume_
-0000ef40: 636f 6c6f 7266 696c 7465 7228 6974 656d  colorfilter(item
-0000ef50: 2c20 6461 7461 7372 632c 2064 6629 3a0d  , datasrc, df):.
-0000ef60: 0a20 2020 206f 7065 6e63 6f6c 203d 2064  .    opencol = d
-0000ef70: 662e 636f 6c75 6d6e 735b 335d 0d0a 2020  f.columns[3]..  
-0000ef80: 2020 636c 6f73 6563 6f6c 203d 2064 662e    closecol = df.
-0000ef90: 636f 6c75 6d6e 735b 345d 0d0a 2020 2020  columns[4]..    
-0000efa0: 6973 5f75 7020 3d20 6466 5b6f 7065 6e63  is_up = df[openc
-0000efb0: 6f6c 5d20 3c3d 2064 665b 636c 6f73 6563  ol] <= df[closec
-0000efc0: 6f6c 5d20 2320 6f70 656e 206c 6f77 6572  ol] # open lower
-0000efd0: 2074 6861 6e20 636c 6f73 6520 3d20 676f   than close = go
-0000efe0: 6573 2075 700d 0a20 2020 2079 6965 6c64  es up..    yield
-0000eff0: 2069 7465 6d2e 726f 7763 6f6c 6f72 7328   item.rowcolors(
-0000f000: 2762 756c 6c27 2920 2b20 5b64 662e 6c6f  'bull') + [df.lo
-0000f010: 635b 6973 5f75 702c 203a 5d5d 0d0a 2020  c[is_up, :]]..  
-0000f020: 2020 7969 656c 6420 6974 656d 2e72 6f77    yield item.row
-0000f030: 636f 6c6f 7273 2827 6265 6172 2729 202b  colors('bear') +
-0000f040: 205b 6466 2e6c 6f63 5b7e 6973 5f75 702c   [df.loc[~is_up,
-0000f050: 203a 5d5d 0d0a 0d0a 0d0a 6465 6620 7374   :]]......def st
-0000f060: 7265 6e67 7468 5f63 6f6c 6f72 6669 6c74  rength_colorfilt
-0000f070: 6572 2869 7465 6d2c 2064 6174 6173 7263  er(item, datasrc
-0000f080: 2c20 6466 293a 0d0a 2020 2020 6f70 656e  , df):..    open
-0000f090: 636f 6c20 3d20 6466 2e63 6f6c 756d 6e73  col = df.columns
-0000f0a0: 5b31 5d0d 0a20 2020 2063 6c6f 7365 636f  [1]..    closeco
-0000f0b0: 6c20 3d20 6466 2e63 6f6c 756d 6e73 5b32  l = df.columns[2
-0000f0c0: 5d0d 0a20 2020 2073 7461 7274 636f 6c20  ]..    startcol 
-0000f0d0: 3d20 6466 2e63 6f6c 756d 6e73 5b33 5d0d  = df.columns[3].
-0000f0e0: 0a20 2020 2065 6e64 636f 6c20 3d20 6466  .    endcol = df
-0000f0f0: 2e63 6f6c 756d 6e73 5b34 5d0d 0a20 2020  .columns[4]..   
-0000f100: 2069 735f 7570 203d 2064 665b 6f70 656e   is_up = df[open
-0000f110: 636f 6c5d 203c 3d20 6466 5b63 6c6f 7365  col] <= df[close
-0000f120: 636f 6c5d 2023 206f 7065 6e20 6c6f 7765  col] # open lowe
-0000f130: 7220 7468 616e 2063 6c6f 7365 203d 2067  r than close = g
-0000f140: 6f65 7320 7570 0d0a 2020 2020 6973 5f73  oes up..    is_s
-0000f150: 7472 6f6e 6720 3d20 6466 5b73 7461 7274  trong = df[start
-0000f160: 636f 6c5d 203c 3d20 6466 5b65 6e64 636f  col] <= df[endco
-0000f170: 6c5d 0d0a 2020 2020 7969 656c 6420 6974  l]..    yield it
-0000f180: 656d 2e72 6f77 636f 6c6f 7273 2827 6275  em.rowcolors('bu
-0000f190: 6c6c 2729 202b 205b 6466 2e6c 6f63 5b69  ll') + [df.loc[i
-0000f1a0: 735f 7570 2669 735f 7374 726f 6e67 2c20  s_up&is_strong, 
-0000f1b0: 3a5d 5d0d 0a20 2020 2079 6965 6c64 2069  :]]..    yield i
-0000f1c0: 7465 6d2e 726f 7763 6f6c 6f72 7328 2777  tem.rowcolors('w
-0000f1d0: 6561 6b5f 6275 6c6c 2729 202b 205b 6466  eak_bull') + [df
-0000f1e0: 2e6c 6f63 5b69 735f 7570 2628 7e69 735f  .loc[is_up&(~is_
-0000f1f0: 7374 726f 6e67 292c 203a 5d5d 0d0a 2020  strong), :]]..  
-0000f200: 2020 7969 656c 6420 6974 656d 2e72 6f77    yield item.row
-0000f210: 636f 6c6f 7273 2827 7765 616b 5f62 6561  colors('weak_bea
-0000f220: 7227 2920 2b20 5b64 662e 6c6f 635b 287e  r') + [df.loc[(~
-0000f230: 6973 5f75 7029 2669 735f 7374 726f 6e67  is_up)&is_strong
-0000f240: 2c20 3a5d 5d0d 0a20 2020 2079 6965 6c64  , :]]..    yield
-0000f250: 2069 7465 6d2e 726f 7763 6f6c 6f72 7328   item.rowcolors(
-0000f260: 2762 6561 7227 2920 2b20 5b64 662e 6c6f  'bear') + [df.lo
-0000f270: 635b 287e 6973 5f75 7029 2628 7e69 735f  c[(~is_up)&(~is_
-0000f280: 7374 726f 6e67 292c 203a 5d5d 0d0a 0d0a  strong), :]]....
-0000f290: 0d0a 6465 6620 766f 6c75 6d65 5f63 6f6c  ..def volume_col
-0000f2a0: 6f72 6669 6c74 6572 5f73 6563 7469 6f6e  orfilter_section
-0000f2b0: 2873 6563 7469 6f6e 733d 5b5d 293a 0d0a  (sections=[]):..
-0000f2c0: 2020 2020 2727 2754 6865 2073 6563 7469      '''The secti
-0000f2d0: 6f6e 7320 6172 6775 6d65 6e74 2069 7320  ons argument is 
-0000f2e0: 6120 2873 7461 7274 696e 675f 696e 6465  a (starting_inde
-0000f2f0: 782c 2063 6f6c 6f72 5f6e 616d 6529 2061  x, color_name) a
-0000f300: 7272 6179 2e27 2727 0d0a 2020 2020 6465  rray.'''..    de
-0000f310: 6620 5f63 6f6c 6f72 6669 6c74 6572 2873  f _colorfilter(s
-0000f320: 6563 7469 6f6e 732c 2069 7465 6d2c 2064  ections, item, d
-0000f330: 6174 6173 7263 2c20 6466 293a 0d0a 2020  atasrc, df):..  
-0000f340: 2020 2020 2020 6966 206e 6f74 2073 6563        if not sec
-0000f350: 7469 6f6e 733a 0d0a 2020 2020 2020 2020  tions:..        
-0000f360: 2020 2020 7265 7475 726e 2076 6f6c 756d      return volum
-0000f370: 655f 636f 6c6f 7266 696c 7465 7228 6974  e_colorfilter(it
-0000f380: 656d 2c20 6461 7461 7372 632c 2064 6629  em, datasrc, df)
-0000f390: 0d0a 2020 2020 2020 2020 666f 7220 2869  ..        for (i
-0000f3a0: 302c 636f 6c6e 616d 6529 2c28 6931 2c5f  0,colname),(i1,_
-0000f3b0: 2920 696e 207a 6970 2873 6563 7469 6f6e  ) in zip(section
-0000f3c0: 732c 2073 6563 7469 6f6e 735b 313a 5d2b  s, sections[1:]+
-0000f3d0: 5b28 4e6f 6e65 2c27 6e65 7574 7261 6c27  [(None,'neutral'
-0000f3e0: 295d 293a 0d0a 2020 2020 2020 2020 2020  )]):..          
-0000f3f0: 2020 726f 7773 203d 2064 662e 696c 6f63    rows = df.iloc
-0000f400: 5b69 303a 6931 2c20 3a5d 0d0a 2020 2020  [i0:i1, :]..    
-0000f410: 2020 2020 2020 2020 7969 656c 6420 6974          yield it
-0000f420: 656d 2e72 6f77 636f 6c6f 7273 2863 6f6c  em.rowcolors(col
-0000f430: 6e61 6d65 2920 2b20 5b72 6f77 735d 0d0a  name) + [rows]..
-0000f440: 2020 2020 7265 7475 726e 2070 6172 7469      return parti
-0000f450: 616c 285f 636f 6c6f 7266 696c 7465 722c  al(_colorfilter,
-0000f460: 2073 6563 7469 6f6e 7329 0d0a 0d0a 0d0a   sections)......
-0000f470: 6465 6620 686f 7269 7a76 6f6c 5f63 6f6c  def horizvol_col
-0000f480: 6f72 6669 6c74 6572 2873 6563 7469 6f6e  orfilter(section
-0000f490: 733d 5b5d 293a 0d0a 2020 2020 2727 2754  s=[]):..    '''T
-0000f4a0: 6865 2073 6563 7469 6f6e 7320 6172 6775  he sections argu
-0000f4b0: 6d65 6e74 2069 7320 6120 2873 7461 7274  ment is a (start
-0000f4c0: 696e 675f 696e 6465 782c 2063 6f6c 6f72  ing_index, color
-0000f4d0: 5f6e 616d 6529 2061 7272 6179 2e27 2727  _name) array.'''
-0000f4e0: 0d0a 2020 2020 6465 6620 5f63 6f6c 6f72  ..    def _color
-0000f4f0: 6669 6c74 6572 2873 6563 7469 6f6e 732c  filter(sections,
-0000f500: 2069 7465 6d2c 2064 6174 6173 7263 2c20   item, datasrc, 
-0000f510: 6461 7461 293a 0d0a 2020 2020 2020 2020  data):..        
-0000f520: 6966 206e 6f74 2073 6563 7469 6f6e 733a  if not sections:
-0000f530: 0d0a 2020 2020 2020 2020 2020 2020 7969  ..            yi
-0000f540: 656c 6420 6974 656d 2e72 6f77 636f 6c6f  eld item.rowcolo
-0000f550: 7273 2827 6e65 7574 7261 6c27 2920 2b20  rs('neutral') + 
-0000f560: 5b64 6174 615d 0d0a 2020 2020 2020 2020  [data]..        
-0000f570: 666f 7220 2869 302c 636f 6c6e 616d 6529  for (i0,colname)
-0000f580: 2c28 6931 2c5f 2920 696e 207a 6970 2873  ,(i1,_) in zip(s
-0000f590: 6563 7469 6f6e 732c 2073 6563 7469 6f6e  ections, section
-0000f5a0: 735b 313a 5d2b 5b28 4e6f 6e65 2c27 6e65  s[1:]+[(None,'ne
-0000f5b0: 7574 7261 6c27 295d 293a 0d0a 2020 2020  utral')]):..    
-0000f5c0: 2020 2020 2020 2020 726f 7773 203d 2064          rows = d
-0000f5d0: 6174 615b 3a2c 2069 303a 6931 5d0d 0a20  ata[:, i0:i1].. 
-0000f5e0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-0000f5f0: 2069 7465 6d2e 726f 7763 6f6c 6f72 7328   item.rowcolors(
-0000f600: 636f 6c6e 616d 6529 202b 205b 726f 7773  colname) + [rows
-0000f610: 5d0d 0a20 2020 2072 6574 7572 6e20 7061  ]..    return pa
-0000f620: 7274 6961 6c28 5f63 6f6c 6f72 6669 6c74  rtial(_colorfilt
-0000f630: 6572 2c20 7365 6374 696f 6e73 290d 0a0d  er, sections)...
-0000f640: 0a0d 0a64 6566 2063 616e 646c 6573 7469  ...def candlesti
-0000f650: 636b 5f6f 6368 6c28 6461 7461 7372 632c  ck_ochl(datasrc,
-0000f660: 2064 7261 775f 626f 6479 3d54 7275 652c   draw_body=True,
-0000f670: 2064 7261 775f 7368 6164 6f77 3d54 7275   draw_shadow=Tru
-0000f680: 652c 2063 616e 646c 655f 7769 6474 683d  e, candle_width=
-0000f690: 302e 362c 2061 783d 4e6f 6e65 2c20 636f  0.6, ax=None, co
-0000f6a0: 6c6f 7266 756e 633d 7072 6963 655f 636f  lorfunc=price_co
-0000f6b0: 6c6f 7266 696c 7465 7229 3a0d 0a20 2020  lorfilter):..   
-0000f6c0: 2061 7820 3d20 5f63 7265 6174 655f 706c   ax = _create_pl
-0000f6d0: 6f74 2861 783d 6178 2c20 6d61 7869 6d69  ot(ax=ax, maximi
-0000f6e0: 7a65 3d46 616c 7365 290d 0a20 2020 2064  ze=False)..    d
-0000f6f0: 6174 6173 7263 203d 205f 6372 6561 7465  atasrc = _create
-0000f700: 5f64 6174 6173 7263 2861 782c 2064 6174  _datasrc(ax, dat
-0000f710: 6173 7263 2c20 6e63 6f6c 733d 3529 0d0a  asrc, ncols=5)..
-0000f720: 2020 2020 6461 7461 7372 632e 7363 616c      datasrc.scal
-0000f730: 655f 636f 6c73 203d 205b 332c 345d 2023  e_cols = [3,4] #
-0000f740: 206f 6e6c 7920 6869 2b6c 6f20 7363 616c   only hi+lo scal
-0000f750: 6573 0d0a 2020 2020 5f73 6574 5f64 6174  es..    _set_dat
-0000f760: 6173 7263 2861 782c 2064 6174 6173 7263  asrc(ax, datasrc
-0000f770: 290d 0a20 2020 2069 7465 6d20 3d20 4361  )..    item = Ca
-0000f780: 6e64 6c65 7374 6963 6b49 7465 6d28 6178  ndlestickItem(ax
-0000f790: 3d61 782c 2064 6174 6173 7263 3d64 6174  =ax, datasrc=dat
-0000f7a0: 6173 7263 2c20 6472 6177 5f62 6f64 793d  asrc, draw_body=
-0000f7b0: 6472 6177 5f62 6f64 792c 2064 7261 775f  draw_body, draw_
-0000f7c0: 7368 6164 6f77 3d64 7261 775f 7368 6164  shadow=draw_shad
-0000f7d0: 6f77 2c20 6361 6e64 6c65 5f77 6964 7468  ow, candle_width
-0000f7e0: 3d63 616e 646c 655f 7769 6474 682c 2063  =candle_width, c
-0000f7f0: 6f6c 6f72 6675 6e63 3d63 6f6c 6f72 6675  olorfunc=colorfu
-0000f800: 6e63 2c20 7265 7361 6d70 3d27 6869 6c6f  nc, resamp='hilo
-0000f810: 2729 0d0a 2020 2020 5f75 7064 6174 655f  ')..    _update_
-0000f820: 7369 676e 6966 6963 616e 7473 2861 782c  significants(ax,
-0000f830: 2064 6174 6173 7263 2c20 666f 7263 653d   datasrc, force=
-0000f840: 5472 7565 290d 0a20 2020 2069 7465 6d2e  True)..    item.
-0000f850: 7570 6461 7465 5f64 6174 6120 3d20 7061  update_data = pa
-0000f860: 7274 6961 6c28 5f75 7064 6174 655f 6461  rtial(_update_da
-0000f870: 7461 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20  ta, None, None, 
-0000f880: 6974 656d 290d 0a20 2020 2069 7465 6d2e  item)..    item.
-0000f890: 7570 6461 7465 5f67 6678 203d 2070 6172  update_gfx = par
-0000f8a0: 7469 616c 285f 7570 6461 7465 5f67 6678  tial(_update_gfx
-0000f8b0: 2c20 6974 656d 290d 0a20 2020 2061 782e  , item)..    ax.
-0000f8c0: 6164 6449 7465 6d28 6974 656d 290d 0a20  addItem(item).. 
-0000f8d0: 2020 2072 6574 7572 6e20 6974 656d 0d0a     return item..
-0000f8e0: 0d0a 0d0a 6465 6620 7265 6e6b 6f28 782c  ....def renko(x,
-0000f8f0: 2079 3d4e 6f6e 652c 2062 696e 733d 4e6f   y=None, bins=No
-0000f900: 6e65 2c20 7374 6570 3d4e 6f6e 652c 2061  ne, step=None, a
-0000f910: 783d 4e6f 6e65 2c20 636f 6c6f 7266 756e  x=None, colorfun
-0000f920: 633d 7072 6963 655f 636f 6c6f 7266 696c  c=price_colorfil
-0000f930: 7465 7229 3a0d 0a20 2020 2061 7820 3d20  ter):..    ax = 
-0000f940: 5f63 7265 6174 655f 706c 6f74 2861 783d  _create_plot(ax=
-0000f950: 6178 2c20 6d61 7869 6d69 7a65 3d46 616c  ax, maximize=Fal
-0000f960: 7365 290d 0a20 2020 2064 6174 6173 7263  se)..    datasrc
-0000f970: 203d 205f 6372 6561 7465 5f64 6174 6173   = _create_datas
-0000f980: 7263 2861 782c 2078 2c20 792c 206e 636f  rc(ax, x, y, nco
-0000f990: 6c73 3d33 290d 0a20 2020 206f 7269 6764  ls=3)..    origd
-0000f9a0: 6620 3d20 6461 7461 7372 632e 6466 0d0a  f = datasrc.df..
-0000f9b0: 2020 2020 6164 6a20 3d20 5f61 646a 7573      adj = _adjus
-0000f9c0: 745f 7265 6e6b 6f5f 6c6f 675f 6461 7461  t_renko_log_data
-0000f9d0: 7372 6320 6966 2061 782e 7662 2e79 7363  src if ax.vb.ysc
-0000f9e0: 616c 652e 7363 616c 6574 7970 6520 3d3d  ale.scaletype ==
-0000f9f0: 2027 6c6f 6727 2065 6c73 6520 5f61 646a   'log' else _adj
-0000fa00: 7573 745f 7265 6e6b 6f5f 6461 7461 7372  ust_renko_datasr
-0000fa10: 630d 0a20 2020 2073 7465 705f 6164 6a75  c..    step_adju
-0000fa20: 7374 5f72 656e 6b6f 5f64 6174 6173 7263  st_renko_datasrc
-0000fa30: 203d 2070 6172 7469 616c 2861 646a 2c20   = partial(adj, 
-0000fa40: 6269 6e73 2c20 7374 6570 290d 0a20 2020  bins, step)..   
-0000fa50: 2073 7465 705f 6164 6a75 7374 5f72 656e   step_adjust_ren
-0000fa60: 6b6f 5f64 6174 6173 7263 2864 6174 6173  ko_datasrc(datas
-0000fa70: 7263 290d 0a20 2020 2061 782e 6465 636f  rc)..    ax.deco
-0000fa80: 7570 6c65 2829 0d0a 2020 2020 6974 656d  uple()..    item
-0000fa90: 203d 2063 616e 646c 6573 7469 636b 5f6f   = candlestick_o
-0000faa0: 6368 6c28 6461 7461 7372 632c 2064 7261  chl(datasrc, dra
-0000fab0: 775f 7368 6164 6f77 3d46 616c 7365 2c20  w_shadow=False, 
-0000fac0: 6361 6e64 6c65 5f77 6964 7468 3d31 2c20  candle_width=1, 
-0000fad0: 6178 3d61 782c 2063 6f6c 6f72 6675 6e63  ax=ax, colorfunc
-0000fae0: 3d63 6f6c 6f72 6675 6e63 290d 0a20 2020  =colorfunc)..   
-0000faf0: 2069 7465 6d2e 636f 6c6f 7273 5b27 6275   item.colors['bu
-0000fb00: 6c6c 5f62 6f64 7927 5d20 3d20 6974 656d  ll_body'] = item
-0000fb10: 2e63 6f6c 6f72 735b 2762 756c 6c5f 6672  .colors['bull_fr
-0000fb20: 616d 6527 5d0d 0a20 2020 2069 7465 6d2e  ame']..    item.
-0000fb30: 7570 6461 7465 5f64 6174 6120 3d20 7061  update_data = pa
-0000fb40: 7274 6961 6c28 5f75 7064 6174 655f 6461  rtial(_update_da
-0000fb50: 7461 2c20 4e6f 6e65 2c20 7374 6570 5f61  ta, None, step_a
-0000fb60: 646a 7573 745f 7265 6e6b 6f5f 6461 7461  djust_renko_data
-0000fb70: 7372 632c 2069 7465 6d29 0d0a 2020 2020  src, item)..    
-0000fb80: 6974 656d 2e75 7064 6174 655f 6766 7820  item.update_gfx 
-0000fb90: 3d20 7061 7274 6961 6c28 5f75 7064 6174  = partial(_updat
-0000fba0: 655f 6766 782c 2069 7465 6d29 0d0a 2020  e_gfx, item)..  
-0000fbb0: 2020 676c 6f62 616c 2065 706f 6368 5f70    global epoch_p
-0000fbc0: 6572 696f 640d 0a20 2020 2065 706f 6368  eriod..    epoch
-0000fbd0: 5f70 6572 696f 6420 3d20 286f 7269 6764  _period = (origd
-0000fbe0: 662e 696c 6f63 5b31 2c30 5d20 2d20 6f72  f.iloc[1,0] - or
-0000fbf0: 6967 6466 2e69 6c6f 635b 302c 305d 2920  igdf.iloc[0,0]) 
-0000fc00: 2f2f 2069 6e74 2831 6539 290d 0a20 2020  // int(1e9)..   
-0000fc10: 2072 6574 7572 6e20 6974 656d 0d0a 0d0a   return item....
-0000fc20: 0d0a 6465 6620 766f 6c75 6d65 5f6f 6376  ..def volume_ocv
-0000fc30: 2864 6174 6173 7263 2c20 6361 6e64 6c65  (datasrc, candle
-0000fc40: 5f77 6964 7468 3d30 2e38 2c20 6178 3d4e  _width=0.8, ax=N
-0000fc50: 6f6e 652c 2063 6f6c 6f72 6675 6e63 3d76  one, colorfunc=v
-0000fc60: 6f6c 756d 655f 636f 6c6f 7266 696c 7465  olume_colorfilte
-0000fc70: 7229 3a0d 0a20 2020 2061 7820 3d20 5f63  r):..    ax = _c
-0000fc80: 7265 6174 655f 706c 6f74 2861 783d 6178  reate_plot(ax=ax
-0000fc90: 2c20 6d61 7869 6d69 7a65 3d46 616c 7365  , maximize=False
-0000fca0: 290d 0a20 2020 2064 6174 6173 7263 203d  )..    datasrc =
-0000fcb0: 205f 6372 6561 7465 5f64 6174 6173 7263   _create_datasrc
-0000fcc0: 2861 782c 2064 6174 6173 7263 2c20 6e63  (ax, datasrc, nc
-0000fcd0: 6f6c 733d 3429 0d0a 2020 2020 5f61 646a  ols=4)..    _adj
-0000fce0: 7573 745f 766f 6c75 6d65 5f64 6174 6173  ust_volume_datas
-0000fcf0: 7263 2864 6174 6173 7263 290d 0a20 2020  rc(datasrc)..   
-0000fd00: 205f 7365 745f 6461 7461 7372 6328 6178   _set_datasrc(ax
-0000fd10: 2c20 6461 7461 7372 6329 0d0a 2020 2020  , datasrc)..    
-0000fd20: 6974 656d 203d 2043 616e 646c 6573 7469  item = Candlesti
-0000fd30: 636b 4974 656d 2861 783d 6178 2c20 6461  ckItem(ax=ax, da
-0000fd40: 7461 7372 633d 6461 7461 7372 632c 2064  tasrc=datasrc, d
-0000fd50: 7261 775f 626f 6479 3d54 7275 652c 2064  raw_body=True, d
-0000fd60: 7261 775f 7368 6164 6f77 3d46 616c 7365  raw_shadow=False
-0000fd70: 2c20 6361 6e64 6c65 5f77 6964 7468 3d63  , candle_width=c
-0000fd80: 616e 646c 655f 7769 6474 682c 2063 6f6c  andle_width, col
-0000fd90: 6f72 6675 6e63 3d63 6f6c 6f72 6675 6e63  orfunc=colorfunc
-0000fda0: 2c20 7265 7361 6d70 3d27 7375 6d27 290d  , resamp='sum').
-0000fdb0: 0a20 2020 205f 7570 6461 7465 5f73 6967  .    _update_sig
-0000fdc0: 6e69 6669 6361 6e74 7328 6178 2c20 6461  nificants(ax, da
-0000fdd0: 7461 7372 632c 2066 6f72 6365 3d54 7275  tasrc, force=Tru
-0000fde0: 6529 0d0a 2020 2020 6974 656d 2e63 6f6c  e)..    item.col
-0000fdf0: 6f72 735b 2762 756c 6c5f 626f 6479 275d  ors['bull_body']
-0000fe00: 203d 2069 7465 6d2e 636f 6c6f 7273 5b27   = item.colors['
-0000fe10: 6275 6c6c 5f66 7261 6d65 275d 0d0a 2020  bull_frame']..  
-0000fe20: 2020 6966 2063 6f6c 6f72 6675 6e63 203d    if colorfunc =
-0000fe30: 3d20 766f 6c75 6d65 5f63 6f6c 6f72 6669  = volume_colorfi
-0000fe40: 6c74 6572 3a20 2320 6173 7375 6d65 206e  lter: # assume n
-0000fe50: 6f72 6d61 6c20 766f 6c75 6d65 2070 6c6f  ormal volume plo
-0000fe60: 740d 0a20 2020 2020 2020 2069 7465 6d2e  t..        item.
-0000fe70: 636f 6c6f 7273 5b27 6275 6c6c 5f66 7261  colors['bull_fra
-0000fe80: 6d65 275d 203d 2076 6f6c 756d 655f 6275  me'] = volume_bu
-0000fe90: 6c6c 5f63 6f6c 6f72 0d0a 2020 2020 2020  ll_color..      
-0000fea0: 2020 6974 656d 2e63 6f6c 6f72 735b 2762    item.colors['b
-0000feb0: 756c 6c5f 626f 6479 275d 2020 3d20 766f  ull_body']  = vo
-0000fec0: 6c75 6d65 5f62 756c 6c5f 626f 6479 5f63  lume_bull_body_c
-0000fed0: 6f6c 6f72 0d0a 2020 2020 2020 2020 6974  olor..        it
-0000fee0: 656d 2e63 6f6c 6f72 735b 2762 6561 725f  em.colors['bear_
-0000fef0: 6672 616d 6527 5d20 3d20 766f 6c75 6d65  frame'] = volume
-0000ff00: 5f62 6561 725f 636f 6c6f 720d 0a20 2020  _bear_color..   
-0000ff10: 2020 2020 2069 7465 6d2e 636f 6c6f 7273       item.colors
-0000ff20: 5b27 6265 6172 5f62 6f64 7927 5d20 203d  ['bear_body']  =
-0000ff30: 2076 6f6c 756d 655f 6265 6172 5f63 6f6c   volume_bear_col
-0000ff40: 6f72 0d0a 2020 2020 2020 2020 6178 2e76  or..        ax.v
-0000ff50: 622e 765f 7a6f 6f6d 5f62 6173 656c 696e  b.v_zoom_baselin
-0000ff60: 6520 3d20 300d 0a20 2020 2065 6c73 653a  e = 0..    else:
-0000ff70: 0d0a 2020 2020 2020 2020 6974 656d 2e63  ..        item.c
-0000ff80: 6f6c 6f72 735b 2777 6561 6b5f 6275 6c6c  olors['weak_bull
-0000ff90: 5f66 7261 6d65 275d 203d 2062 7269 6768  _frame'] = brigh
-0000ffa0: 7465 6e28 766f 6c75 6d65 5f62 756c 6c5f  ten(volume_bull_
-0000ffb0: 636f 6c6f 722c 2031 2e32 290d 0a20 2020  color, 1.2)..   
-0000ffc0: 2020 2020 2069 7465 6d2e 636f 6c6f 7273       item.colors
-0000ffd0: 5b27 7765 616b 5f62 756c 6c5f 626f 6479  ['weak_bull_body
-0000ffe0: 275d 2020 3d20 6272 6967 6874 656e 2876  ']  = brighten(v
-0000fff0: 6f6c 756d 655f 6275 6c6c 5f63 6f6c 6f72  olume_bull_color
-00010000: 2c20 312e 3229 0d0a 2020 2020 6974 656d  , 1.2)..    item
-00010010: 2e75 7064 6174 655f 6461 7461 203d 2070  .update_data = p
-00010020: 6172 7469 616c 285f 7570 6461 7465 5f64  artial(_update_d
-00010030: 6174 612c 204e 6f6e 652c 205f 6164 6a75  ata, None, _adju
-00010040: 7374 5f76 6f6c 756d 655f 6461 7461 7372  st_volume_datasr
-00010050: 632c 2069 7465 6d29 0d0a 2020 2020 6974  c, item)..    it
-00010060: 656d 2e75 7064 6174 655f 6766 7820 3d20  em.update_gfx = 
-00010070: 7061 7274 6961 6c28 5f75 7064 6174 655f  partial(_update_
-00010080: 6766 782c 2069 7465 6d29 0d0a 2020 2020  gfx, item)..    
-00010090: 6178 2e61 6464 4974 656d 2869 7465 6d29  ax.addItem(item)
-000100a0: 0d0a 2020 2020 6974 656d 2e73 6574 5a56  ..    item.setZV
-000100b0: 616c 7565 282d 3230 290d 0a20 2020 2072  alue(-20)..    r
-000100c0: 6574 7572 6e20 6974 656d 0d0a 0d0a 0d0a  eturn item......
-000100d0: 6465 6620 686f 7269 7a5f 7469 6d65 5f76  def horiz_time_v
-000100e0: 6f6c 756d 6528 6461 7461 7372 632c 2061  olume(datasrc, a
-000100f0: 783d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  x=None, **kwargs
-00010100: 293a 0d0a 2020 2020 2727 2744 7261 7773  ):..    '''Draws
-00010110: 206d 756c 7469 706c 6520 6669 7865 6420   multiple fixed 
-00010120: 686f 7269 7a6f 6e74 616c 2076 6f6c 756d  horizontal volum
-00010130: 6573 2e20 5468 6520 696e 7075 7420 666f  es. The input fo
-00010140: 726d 6174 2069 733a 0d0a 2020 2020 2020  rmat is:..      
-00010150: 205b 5b74 696d 6530 2c20 5b28 7072 6963   [[time0, [(pric
-00010160: 6530 2c76 6f6c 756d 6530 292c 2870 7269  e0,volume0),(pri
-00010170: 6365 312c 766f 6c75 6d65 3129 2c2e 2e2e  ce1,volume1),...
-00010180: 5d5d 2c20 2e2e 2e5d 0d0a 0d0a 2020 2020  ]], ...]....    
-00010190: 2020 2054 6869 7320 6368 6172 7420 6e65     This chart ne
-000101a0: 6564 7320 746f 2062 6520 706c 6f74 206c  eds to be plot l
-000101b0: 6173 742c 2073 6f20 6974 206b 6e6f 7773  ast, so it knows
-000101c0: 2069 6620 6974 2063 6f6e 7472 6f6c 730d   if it controls.
-000101d0: 0a20 2020 2020 2020 7768 6174 2074 696d  .       what tim
-000101e0: 6520 7065 7269 6f64 7320 6172 6520 7368  e periods are sh
-000101f0: 6f77 6e2c 206f 7220 6966 2069 7473 2075  own, or if its u
-00010200: 7369 6e67 2074 696d 6520 616c 7265 6164  sing time alread
-00010210: 7920 696e 0d0a 2020 2020 2020 2070 6c61  y in..       pla
-00010220: 6365 2062 7920 616e 6f74 6865 7220 706c  ce by another pl
-00010230: 6f74 2e27 2727 0d0a 2020 2020 2320 7570  ot.'''..    # up
-00010240: 6461 7465 2068 616e 646c 696e 6720 6465  date handling de
-00010250: 6661 756c 7420 6966 206e 6563 6573 7361  fault if necessa
-00010260: 7279 0d0a 2020 2020 676c 6f62 616c 206d  ry..    global m
-00010270: 6178 5f7a 6f6f 6d5f 706f 696e 7473 2c20  ax_zoom_points, 
-00010280: 7269 6768 745f 6d61 7267 696e 5f63 616e  right_margin_can
-00010290: 646c 6573 0d0a 2020 2020 6966 206d 6178  dles..    if max
-000102a0: 5f7a 6f6f 6d5f 706f 696e 7473 203e 2031  _zoom_points > 1
-000102b0: 353a 0d0a 2020 2020 2020 2020 6d61 785f  5:..        max_
-000102c0: 7a6f 6f6d 5f70 6f69 6e74 7320 3d20 340d  zoom_points = 4.
-000102d0: 0a20 2020 2069 6620 7269 6768 745f 6d61  .    if right_ma
-000102e0: 7267 696e 5f63 616e 646c 6573 203e 2033  rgin_candles > 3
-000102f0: 3a0d 0a20 2020 2020 2020 2072 6967 6874  :..        right
-00010300: 5f6d 6172 6769 6e5f 6361 6e64 6c65 7320  _margin_candles 
-00010310: 3d20 310d 0a0d 0a20 2020 2061 7820 3d20  = 1....    ax = 
-00010320: 5f63 7265 6174 655f 706c 6f74 2861 783d  _create_plot(ax=
-00010330: 6178 2c20 6d61 7869 6d69 7a65 3d46 616c  ax, maximize=Fal
-00010340: 7365 290d 0a20 2020 2064 6174 6173 7263  se)..    datasrc
-00010350: 203d 205f 7072 6561 646a 7573 745f 686f   = _preadjust_ho
-00010360: 7269 7a5f 6461 7461 7372 6328 6461 7461  riz_datasrc(data
-00010370: 7372 6329 0d0a 2020 2020 6461 7461 7372  src)..    datasr
-00010380: 6320 3d20 5f63 7265 6174 655f 6461 7461  c = _create_data
-00010390: 7372 6328 6178 2c20 6461 7461 7372 632c  src(ax, datasrc,
-000103a0: 2061 6c6c 6f77 5f73 6361 6c69 6e67 3d46   allow_scaling=F
-000103b0: 616c 7365 290d 0a20 2020 205f 6164 6a75  alse)..    _adju
-000103c0: 7374 5f68 6f72 697a 5f64 6174 6173 7263  st_horiz_datasrc
-000103d0: 2864 6174 6173 7263 290d 0a20 2020 2069  (datasrc)..    i
-000103e0: 6620 6178 2e76 622e 6461 7461 7372 6320  f ax.vb.datasrc 
-000103f0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00010400: 2020 2020 2020 6461 7461 7372 632e 7374        datasrc.st
-00010410: 616e 6461 6c6f 6e65 203d 2054 7275 6520  andalone = True 
-00010420: 2320 6f6e 6c79 2066 6f72 6365 2073 7461  # only force sta
-00010430: 6e64 616c 6f6e 6520 6966 2074 6865 7265  ndalone if there
-00010440: 2069 7320 736f 6d65 7468 696e 6720 6f6e   is something on
-00010450: 206f 7572 2063 6861 7274 7320 616c 7265   our charts alre
-00010460: 6164 790d 0a20 2020 2064 6174 6173 7263  ady..    datasrc
-00010470: 2e73 6361 6c65 5f63 6f6c 7320 3d20 5b64  .scale_cols = [d
-00010480: 6174 6173 7263 2e63 6f6c 5f64 6174 615f  atasrc.col_data_
-00010490: 6f66 6673 6574 2c20 6c65 6e28 6461 7461  offset, len(data
-000104a0: 7372 632e 6466 2e63 6f6c 756d 6e73 292d  src.df.columns)-
-000104b0: 325d 2023 2066 6972 7374 2061 6e64 206c  2] # first and l
-000104c0: 6173 7420 7072 6963 6520 636f 6c75 6d6e  ast price column
-000104d0: 730d 0a20 2020 2064 6174 6173 7263 2e70  s..    datasrc.p
-000104e0: 7265 5f75 7064 6174 6520 3d20 6c61 6d62  re_update = lamb
-000104f0: 6461 2064 663a 2064 662e 6c6f 635b 3a2c  da df: df.loc[:,
-00010500: 203a 6466 2e63 6f6c 756d 6e73 5b30 5d5d   :df.columns[0]]
-00010510: 2023 2074 6872 6f77 2061 7761 7920 7072   # throw away pr
-00010520: 6576 696f 7573 2064 6174 610d 0a20 2020  evious data..   
-00010530: 2064 6174 6173 7263 2e70 6f73 745f 7570   datasrc.post_up
-00010540: 6461 7465 203d 206c 616d 6264 6120 6466  date = lambda df
-00010550: 3a20 6466 2e64 726f 706e 6128 686f 773d  : df.dropna(how=
-00010560: 2761 6c6c 2729 2023 206b 696c 6c20 616c  'all') # kill al
-00010570: 6c2d 4e61 4e73 0d0a 2020 2020 5f73 6574  l-NaNs..    _set
-00010580: 5f64 6174 6173 7263 2861 782c 2064 6174  _datasrc(ax, dat
-00010590: 6173 7263 290d 0a20 2020 2069 7465 6d20  asrc)..    item 
-000105a0: 3d20 486f 7269 7a6f 6e74 616c 5469 6d65  = HorizontalTime
-000105b0: 566f 6c75 6d65 4974 656d 2861 783d 6178  VolumeItem(ax=ax
-000105c0: 2c20 6461 7461 7372 633d 6461 7461 7372  , datasrc=datasr
-000105d0: 632c 202a 2a6b 7761 7267 7329 0d0a 2020  c, **kwargs)..  
-000105e0: 2020 6974 656d 2e75 7064 6174 655f 6461    item.update_da
-000105f0: 7461 203d 2070 6172 7469 616c 285f 7570  ta = partial(_up
-00010600: 6461 7465 5f64 6174 612c 205f 7072 6561  date_data, _prea
-00010610: 646a 7573 745f 686f 7269 7a5f 6461 7461  djust_horiz_data
-00010620: 7372 632c 205f 6164 6a75 7374 5f68 6f72  src, _adjust_hor
-00010630: 697a 5f64 6174 6173 7263 2c20 6974 656d  iz_datasrc, item
-00010640: 290d 0a20 2020 2069 7465 6d2e 7570 6461  )..    item.upda
-00010650: 7465 5f67 6678 203d 2070 6172 7469 616c  te_gfx = partial
-00010660: 285f 7570 6461 7465 5f67 6678 2c20 6974  (_update_gfx, it
-00010670: 656d 290d 0a20 2020 2069 7465 6d2e 7365  em)..    item.se
-00010680: 745a 5661 6c75 6528 2d31 3029 0d0a 2020  tZValue(-10)..  
-00010690: 2020 6178 2e61 6464 4974 656d 2869 7465    ax.addItem(ite
-000106a0: 6d29 0d0a 2020 2020 7265 7475 726e 2069  m)..    return i
-000106b0: 7465 6d0d 0a0d 0a0d 0a64 6566 2068 6561  tem......def hea
-000106c0: 746d 6170 2864 6174 6173 7263 2c20 6178  tmap(datasrc, ax
-000106d0: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
-000106e0: 3a0d 0a20 2020 2027 2727 4578 7065 6e73  :..    '''Expens
-000106f0: 6976 6520 6675 6e63 7469 6f6e 2e20 4f6e  ive function. On
-00010700: 6c79 2075 7365 206f 6e20 736d 616c 6c20  ly use on small 
-00010710: 6461 7461 2073 6574 732e 2053 6565 2048  data sets. See H
-00010720: 6561 746d 6170 4974 656d 2066 6f72 206b  eatmapItem for k
-00010730: 7761 7267 732e 2049 6e70 7574 2064 6174  wargs. Input dat
-00010740: 6173 7263 0d0a 2020 2020 2020 2068 6173  asrc..       has
-00010750: 2078 2028 7469 6d65 2920 696e 2069 6e64   x (time) in ind
-00010760: 6578 206f 7220 6669 7273 7420 636f 6c75  ex or first colu
-00010770: 6d6e 2c20 7920 2870 7269 6365 2920 6173  mn, y (price) as
-00010780: 2063 6f6c 756d 6e20 6e61 6d65 732c 2061   column names, a
-00010790: 6e64 2069 6e74 656e 7369 7479 2028 636f  nd intensity (co
-000107a0: 6c6f 7229 2061 730d 0a20 2020 2020 2020  lor) as..       
-000107b0: 6365 6c6c 2076 616c 7565 732e 2727 270d  cell values.'''.
-000107c0: 0a20 2020 2061 7820 3d20 5f63 7265 6174  .    ax = _creat
-000107d0: 655f 706c 6f74 2861 783d 6178 2c20 6d61  e_plot(ax=ax, ma
-000107e0: 7869 6d69 7a65 3d46 616c 7365 290d 0a20  ximize=False).. 
-000107f0: 2020 2069 6620 6178 2e76 622e 765f 7a6f     if ax.vb.v_zo
-00010800: 6f6d 5f73 6361 6c65 203e 3d20 302e 393a  om_scale >= 0.9:
-00010810: 0d0a 2020 2020 2020 2020 6178 2e76 622e  ..        ax.vb.
-00010820: 765f 7a6f 6f6d 5f73 6361 6c65 203d 2030  v_zoom_scale = 0
-00010830: 2e36 0d0a 2020 2020 6461 7461 7372 6320  .6..    datasrc 
-00010840: 3d20 5f63 7265 6174 655f 6461 7461 7372  = _create_datasr
-00010850: 6328 6178 2c20 6461 7461 7372 6329 0d0a  c(ax, datasrc)..
-00010860: 2020 2020 6461 7461 7372 632e 7363 616c      datasrc.scal
-00010870: 655f 636f 6c73 203d 205b 5d20 2320 646f  e_cols = [] # do
-00010880: 6573 6e27 7420 7363 616c 650d 0a20 2020  esn't scale..   
-00010890: 205f 7365 745f 6461 7461 7372 6328 6178   _set_datasrc(ax
-000108a0: 2c20 6461 7461 7372 6329 0d0a 2020 2020  , datasrc)..    
-000108b0: 6974 656d 203d 2048 6561 746d 6170 4974  item = HeatmapIt
-000108c0: 656d 2861 783d 6178 2c20 6461 7461 7372  em(ax=ax, datasr
-000108d0: 633d 6461 7461 7372 632c 202a 2a6b 7761  c=datasrc, **kwa
-000108e0: 7267 7329 0d0a 2020 2020 6974 656d 2e75  rgs)..    item.u
-000108f0: 7064 6174 655f 6461 7461 203d 2070 6172  pdate_data = par
-00010900: 7469 616c 285f 7570 6461 7465 5f64 6174  tial(_update_dat
-00010910: 612c 204e 6f6e 652c 204e 6f6e 652c 2069  a, None, None, i
-00010920: 7465 6d29 0d0a 2020 2020 6974 656d 2e75  tem)..    item.u
-00010930: 7064 6174 655f 6766 7820 3d20 7061 7274  pdate_gfx = part
-00010940: 6961 6c28 5f75 7064 6174 655f 6766 782c  ial(_update_gfx,
-00010950: 2069 7465 6d29 0d0a 2020 2020 6974 656d   item)..    item
-00010960: 2e73 6574 5a56 616c 7565 282d 3330 290d  .setZValue(-30).
-00010970: 0a20 2020 2061 782e 6164 6449 7465 6d28  .    ax.addItem(
-00010980: 6974 656d 290d 0a20 2020 2069 6620 6178  item)..    if ax
-00010990: 2e76 622e 6461 7461 7372 6320 6973 206e  .vb.datasrc is n
-000109a0: 6f74 204e 6f6e 6520 616e 6420 6e6f 7420  ot None and not 
-000109b0: 6178 2e76 622e 6461 7461 7372 632e 7469  ax.vb.datasrc.ti
-000109c0: 6d65 6261 7365 6428 293a 2023 206d 616e  mebased(): # man
-000109d0: 7561 6c20 7a6f 6f6d 2075 7064 6174 650d  ual zoom update.
-000109e0: 0a20 2020 2020 2020 2061 782e 7365 7458  .        ax.setX
-000109f0: 4c69 6e6b 284e 6f6e 6529 0d0a 2020 2020  Link(None)..    
-00010a00: 2020 2020 6966 2061 782e 7072 6576 5f61      if ax.prev_a
-00010a10: 783a 0d0a 2020 2020 2020 2020 2020 2020  x:..            
-00010a20: 6178 2e70 7265 765f 6178 2e73 6574 5f76  ax.prev_ax.set_v
-00010a30: 6973 6962 6c65 2878 6178 6973 3d54 7275  isible(xaxis=Tru
-00010a40: 6529 0d0a 2020 2020 2020 2020 6466 203d  e)..        df =
-00010a50: 2061 782e 7662 2e64 6174 6173 7263 2e64   ax.vb.datasrc.d
-00010a60: 660d 0a20 2020 2020 2020 2070 7269 6365  f..        price
-00010a70: 7320 3d20 6466 2e63 6f6c 756d 6e73 5b61  s = df.columns[a
-00010a80: 782e 7662 2e64 6174 6173 7263 2e63 6f6c  x.vb.datasrc.col
-00010a90: 5f64 6174 615f 6f66 6673 6574 3a69 7465  _data_offset:ite
-00010aa0: 6d2e 636f 6c5f 6461 7461 5f65 6e64 5d0d  m.col_data_end].
-00010ab0: 0a20 2020 2020 2020 2064 656c 7461 5f70  .        delta_p
-00010ac0: 7269 6365 203d 2061 6273 2870 7269 6365  rice = abs(price
-00010ad0: 735b 305d 202d 2070 7269 6365 735b 315d  s[0] - prices[1]
-00010ae0: 290d 0a20 2020 2020 2020 2061 782e 7662  )..        ax.vb
-00010af0: 2e73 6574 5f72 616e 6765 2830 2c20 6d69  .set_range(0, mi
-00010b00: 6e28 6466 2e63 6f6c 756d 6e73 5b31 3a5d  n(df.columns[1:]
-00010b10: 292c 206c 656e 2864 6629 2c20 6d61 7828  ), len(df), max(
-00010b20: 6466 2e63 6f6c 756d 6e73 5b31 3a5d 292b  df.columns[1:])+
-00010b30: 6465 6c74 615f 7072 6963 6529 0d0a 2020  delta_price)..  
-00010b40: 2020 7265 7475 726e 2069 7465 6d0d 0a0d    return item...
-00010b50: 0a0d 0a64 6566 2062 6172 2878 2c20 793d  ...def bar(x, y=
-00010b60: 4e6f 6e65 2c20 7769 6474 683d 302e 382c  None, width=0.8,
-00010b70: 2061 783d 4e6f 6e65 2c20 636f 6c6f 7266   ax=None, colorf
-00010b80: 756e 633d 7374 7265 6e67 7468 5f63 6f6c  unc=strength_col
-00010b90: 6f72 6669 6c74 6572 2c20 2a2a 6b77 6172  orfilter, **kwar
-00010ba0: 6773 293a 0d0a 2020 2020 2727 2742 6172  gs):..    '''Bar
-00010bb0: 2070 6c6f 7473 2061 7265 2064 6563 6f75   plots are decou
-00010bc0: 706c 6564 2e20 5573 6520 766f 6c75 6d65  pled. Use volume
-00010bd0: 5f6f 6376 2829 2069 6620 796f 7520 7761  _ocv() if you wa
-00010be0: 6e74 2061 2062 6172 2070 6c6f 7420 7768  nt a bar plot wh
-00010bf0: 6963 6820 7265 6c61 7465 7320 746f 206f  ich relates to o
-00010c00: 7468 6572 2074 696d 6520 706c 6f74 732e  ther time plots.
-00010c10: 2727 270d 0a20 2020 2067 6c6f 6261 6c20  '''..    global 
-00010c20: 7269 6768 745f 6d61 7267 696e 5f63 616e  right_margin_can
-00010c30: 646c 6573 2c20 6d61 785f 7a6f 6f6d 5f70  dles, max_zoom_p
-00010c40: 6f69 6e74 730d 0a20 2020 2072 6967 6874  oints..    right
-00010c50: 5f6d 6172 6769 6e5f 6361 6e64 6c65 7320  _margin_candles 
-00010c60: 3d20 300d 0a20 2020 206d 6178 5f7a 6f6f  = 0..    max_zoo
-00010c70: 6d5f 706f 696e 7473 203d 206d 696e 286d  m_points = min(m
-00010c80: 6178 5f7a 6f6f 6d5f 706f 696e 7473 2c20  ax_zoom_points, 
-00010c90: 3829 0d0a 2020 2020 6178 203d 205f 6372  8)..    ax = _cr
-00010ca0: 6561 7465 5f70 6c6f 7428 6178 3d61 782c  eate_plot(ax=ax,
-00010cb0: 206d 6178 696d 697a 653d 4661 6c73 6529   maximize=False)
-00010cc0: 0d0a 2020 2020 6178 2e64 6563 6f75 706c  ..    ax.decoupl
-00010cd0: 6528 290d 0a20 2020 2064 6174 6173 7263  e()..    datasrc
-00010ce0: 203d 205f 6372 6561 7465 5f64 6174 6173   = _create_datas
-00010cf0: 7263 2861 782c 2078 2c20 792c 206e 636f  rc(ax, x, y, nco
-00010d00: 6c73 3d31 290d 0a20 2020 205f 6164 6a75  ls=1)..    _adju
-00010d10: 7374 5f62 6172 5f64 6174 6173 7263 2864  st_bar_datasrc(d
-00010d20: 6174 6173 7263 2c20 6f72 6465 725f 636f  atasrc, order_co
-00010d30: 6c73 3d46 616c 7365 2920 2320 646f 6e27  ls=False) # don'
-00010d40: 7420 7265 6172 7261 6e67 6520 636f 6c75  t rearrange colu
-00010d50: 6d6e 732c 2064 6f6e 6520 666f 7220 7573  mns, done for us
-00010d60: 2069 6e20 766f 6c75 6d65 5f6f 6376 2829   in volume_ocv()
-00010d70: 0d0a 2020 2020 6974 656d 203d 2076 6f6c  ..    item = vol
-00010d80: 756d 655f 6f63 7628 6461 7461 7372 632c  ume_ocv(datasrc,
-00010d90: 2063 616e 646c 655f 7769 6474 683d 7769   candle_width=wi
-00010da0: 6474 682c 2061 783d 6178 2c20 636f 6c6f  dth, ax=ax, colo
-00010db0: 7266 756e 633d 636f 6c6f 7266 756e 6329  rfunc=colorfunc)
-00010dc0: 0d0a 2020 2020 6974 656d 2e75 7064 6174  ..    item.updat
-00010dd0: 655f 6461 7461 203d 2070 6172 7469 616c  e_data = partial
-00010de0: 285f 7570 6461 7465 5f64 6174 612c 204e  (_update_data, N
-00010df0: 6f6e 652c 205f 6164 6a75 7374 5f62 6172  one, _adjust_bar
-00010e00: 5f64 6174 6173 7263 2c20 6974 656d 290d  _datasrc, item).
-00010e10: 0a20 2020 2069 7465 6d2e 7570 6461 7465  .    item.update
-00010e20: 5f67 6678 203d 2070 6172 7469 616c 285f  _gfx = partial(_
-00010e30: 7570 6461 7465 5f67 6678 2c20 6974 656d  update_gfx, item
-00010e40: 290d 0a20 2020 2061 782e 7662 2e70 7265  )..    ax.vb.pre
-00010e50: 5f70 726f 6365 7373 5f64 6174 6128 290d  _process_data().
-00010e60: 0a20 2020 2069 6620 6178 2e76 622e 795f  .    if ax.vb.y_
-00010e70: 6d69 6e20 3e3d 2030 3a0d 0a20 2020 2020  min >= 0:..     
-00010e80: 2020 2061 782e 7662 2e76 5f7a 6f6f 6d5f     ax.vb.v_zoom_
-00010e90: 6261 7365 6c69 6e65 203d 2030 0d0a 2020  baseline = 0..  
-00010ea0: 2020 7265 7475 726e 2069 7465 6d0d 0a0d    return item...
-00010eb0: 0a0d 0a64 6566 2068 6973 7428 782c 2062  ...def hist(x, b
-00010ec0: 696e 732c 2061 783d 4e6f 6e65 2c20 2a2a  ins, ax=None, **
-00010ed0: 6b77 6172 6773 293a 0d0a 2020 2020 6869  kwargs):..    hi
-00010ee0: 7374 5f64 6174 6120 3d20 7064 2e63 7574  st_data = pd.cut
-00010ef0: 2878 2c20 6269 6e73 3d62 696e 7329 2e76  (x, bins=bins).v
-00010f00: 616c 7565 5f63 6f75 6e74 7328 290d 0a20  alue_counts().. 
-00010f10: 2020 2064 6174 6120 3d20 5b28 692e 6d69     data = [(i.mi
-00010f20: 642c 302c 6869 7374 5f64 6174 612e 6c6f  d,0,hist_data.lo
-00010f30: 635b 695d 2c68 6973 745f 6461 7461 2e6c  c[i],hist_data.l
-00010f40: 6f63 5b69 5d29 2066 6f72 2069 2069 6e20  oc[i]) for i in 
-00010f50: 736f 7274 6564 2868 6973 745f 6461 7461  sorted(hist_data
-00010f60: 2e69 6e64 6578 295d 0d0a 2020 2020 6466  .index)]..    df
-00010f70: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
-00010f80: 6461 7461 2c20 636f 6c75 6d6e 733d 5b27  data, columns=['
-00010f90: 7827 2c27 5f6f 705f 272c 275f 636c 5f27  x','_op_','_cl_'
-00010fa0: 2c27 6269 6e27 5d29 0d0a 2020 2020 6466  ,'bin'])..    df
-00010fb0: 2e73 6574 5f69 6e64 6578 2827 7827 2c20  .set_index('x', 
-00010fc0: 696e 706c 6163 653d 5472 7565 290d 0a20  inplace=True).. 
-00010fd0: 2020 2069 7465 6d20 3d20 6261 7228 6466     item = bar(df
-00010fe0: 2c20 6178 3d61 7829 0d0a 2020 2020 6465  , ax=ax)..    de
-00010ff0: 6c20 6974 656d 2e75 7064 6174 655f 6461  l item.update_da
-00011000: 7461 0d0a 2020 2020 7265 7475 726e 2069  ta..    return i
-00011010: 7465 6d0d 0a0d 0a0d 0a64 6566 2070 6c6f  tem......def plo
-00011020: 7428 782c 2079 3d4e 6f6e 652c 2063 6f6c  t(x, y=None, col
-00011030: 6f72 3d4e 6f6e 652c 2077 6964 7468 3d31  or=None, width=1
-00011040: 2c20 6178 3d4e 6f6e 652c 2073 7479 6c65  , ax=None, style
-00011050: 3d4e 6f6e 652c 206c 6567 656e 643d 4e6f  =None, legend=No
-00011060: 6e65 2c20 7a6f 6f6d 7363 616c 653d 5472  ne, zoomscale=Tr
-00011070: 7565 2c20 2a2a 6b77 6172 6773 293a 0d0a  ue, **kwargs):..
-00011080: 2020 2020 6178 203d 205f 6372 6561 7465      ax = _create
-00011090: 5f70 6c6f 7428 6178 3d61 782c 206d 6178  _plot(ax=ax, max
-000110a0: 696d 697a 653d 4661 6c73 6529 0d0a 2020  imize=False)..  
-000110b0: 2020 7573 6564 5f63 6f6c 6f72 203d 205f    used_color = _
-000110c0: 6765 745f 636f 6c6f 7228 6178 2c20 7374  get_color(ax, st
-000110d0: 796c 652c 2063 6f6c 6f72 290d 0a20 2020  yle, color)..   
-000110e0: 2064 6174 6173 7263 203d 205f 6372 6561   datasrc = _crea
-000110f0: 7465 5f64 6174 6173 7263 2861 782c 2078  te_datasrc(ax, x
-00011100: 2c20 792c 206e 636f 6c73 3d31 290d 0a20  , y, ncols=1).. 
-00011110: 2020 2069 6620 6e6f 7420 7a6f 6f6d 7363     if not zoomsc
-00011120: 616c 653a 0d0a 2020 2020 2020 2020 6461  ale:..        da
-00011130: 7461 7372 632e 7363 616c 655f 636f 6c73  tasrc.scale_cols
-00011140: 203d 205b 5d0d 0a20 2020 205f 7365 745f   = []..    _set_
-00011150: 6461 7461 7372 6328 6178 2c20 6461 7461  datasrc(ax, data
-00011160: 7372 6329 0d0a 2020 2020 6966 206c 6567  src)..    if leg
-00011170: 656e 6420 6973 206e 6f74 204e 6f6e 653a  end is not None:
-00011180: 0d0a 2020 2020 2020 2020 5f63 7265 6174  ..        _creat
-00011190: 655f 6c65 6765 6e64 2861 7829 0d0a 2020  e_legend(ax)..  
-000111a0: 2020 7820 3d20 6461 7461 7372 632e 7820    x = datasrc.x 
-000111b0: 6966 206e 6f74 2061 782e 7662 2e78 5f69  if not ax.vb.x_i
-000111c0: 6e64 6578 6564 2065 6c73 6520 6461 7461  ndexed else data
-000111d0: 7372 632e 696e 6465 780d 0a20 2020 2079  src.index..    y
-000111e0: 203d 2064 6174 6173 7263 2e79 202f 2061   = datasrc.y / a
-000111f0: 782e 7662 2e79 7363 616c 652e 7363 616c  x.vb.yscale.scal
-00011200: 6566 0d0a 2020 2020 6966 2061 782e 7662  ef..    if ax.vb
-00011210: 2e79 7363 616c 652e 7363 616c 6574 7970  .yscale.scaletyp
-00011220: 6520 3d3d 2027 6c6f 6727 3a0d 0a20 2020  e == 'log':..   
-00011230: 2020 2020 2079 203d 2079 202b 206c 6f67       y = y + log
-00011240: 5f70 6c6f 745f 6f66 6673 6574 0d0a 2020  _plot_offset..  
-00011250: 2020 6966 2073 7479 6c65 2069 7320 4e6f    if style is No
-00011260: 6e65 206f 7220 616e 7928 6368 2069 6e20  ne or any(ch in 
-00011270: 7374 796c 6520 666f 7220 6368 2069 6e20  style for ch in 
-00011280: 272d 5f2e 2729 3a0d 0a20 2020 2020 2020  '-_.'):..       
-00011290: 2063 6f6e 6e65 6374 5f64 6f74 7320 3d20   connect_dots = 
-000112a0: 2766 696e 6974 6527 2023 2073 616d 6520  'finite' # same 
-000112b0: 6173 206d 6174 706c 6f74 6c69 623b 2075  as matplotlib; u
-000112c0: 7365 2064 6174 6173 7263 2e73 7461 6e64  se datasrc.stand
-000112d0: 616c 6f6e 653d 5472 7565 2069 6620 796f  alone=True if yo
-000112e0: 7520 7761 6e74 2074 6f20 6b65 6570 2073  u want to keep s
-000112f0: 6570 6172 6174 6520 696e 7465 7276 616c  eparate interval
-00011300: 7320 6f6e 2061 2070 6c6f 740d 0a20 2020  s on a plot..   
-00011310: 2020 2020 2069 7465 6d20 3d20 6178 2e70       item = ax.p
-00011320: 6c6f 7428 782c 2079 2c20 7065 6e3d 5f6d  lot(x, y, pen=_m
-00011330: 616b 6570 656e 2863 6f6c 6f72 3d75 7365  akepen(color=use
-00011340: 645f 636f 6c6f 722c 2073 7479 6c65 3d73  d_color, style=s
-00011350: 7479 6c65 2c20 7769 6474 683d 7769 6474  tyle, width=widt
-00011360: 6829 2c20 6e61 6d65 3d6c 6567 656e 642c  h), name=legend,
-00011370: 2063 6f6e 6e65 6374 3d63 6f6e 6e65 6374   connect=connect
-00011380: 5f64 6f74 7329 0d0a 2020 2020 2020 2020  _dots)..        
-00011390: 6974 656d 2e73 6574 5a56 616c 7565 2835  item.setZValue(5
-000113a0: 290d 0a20 2020 2065 6c73 653a 0d0a 2020  )..    else:..  
-000113b0: 2020 2020 2020 7379 6d62 6f6c 203d 207b        symbol = {
-000113c0: 2776 273a 2774 272c 2027 5e27 3a27 7431  'v':'t', '^':'t1
-000113d0: 272c 2027 3e27 3a27 7432 272c 2027 3c27  ', '>':'t2', '<'
-000113e0: 3a27 7433 277d 2e67 6574 2873 7479 6c65  :'t3'}.get(style
-000113f0: 2c20 7374 796c 6529 2023 2074 7261 6e73  , style) # trans
-00011400: 6c61 7465 2073 6f6d 6520 7369 6d69 6c61  late some simila
-00011410: 7220 7374 796c 6573 0d0a 2020 2020 2020  r styles..      
-00011420: 2020 7966 696c 7465 7220 3d20 792e 6e6f    yfilter = y.no
-00011430: 746e 756c 6c28 290d 0a20 2020 2020 2020  tnull()..       
-00011440: 2073 6572 203d 2079 2e6c 6f63 5b79 6669   ser = y.loc[yfi
-00011450: 6c74 6572 5d0d 0a20 2020 2020 2020 2078  lter]..        x
-00011460: 203d 2078 2e6c 6f63 5b79 6669 6c74 6572   = x.loc[yfilter
-00011470: 5d2e 7661 6c75 6573 2069 6620 6861 7361  ].values if hasa
-00011480: 7474 7228 782c 2027 6c6f 6327 2920 656c  ttr(x, 'loc') el
-00011490: 7365 2078 5b79 6669 6c74 6572 5d0d 0a20  se x[yfilter].. 
-000114a0: 2020 2020 2020 2069 7465 6d20 3d20 6178         item = ax
-000114b0: 2e70 6c6f 7428 782c 2073 6572 2e76 616c  .plot(x, ser.val
-000114c0: 7565 732c 2070 656e 3d4e 6f6e 652c 2073  ues, pen=None, s
-000114d0: 796d 626f 6c3d 7379 6d62 6f6c 2c20 7379  ymbol=symbol, sy
-000114e0: 6d62 6f6c 5065 6e3d 4e6f 6e65 2c20 7379  mbolPen=None, sy
-000114f0: 6d62 6f6c 5369 7a65 3d37 2a77 6964 7468  mbolSize=7*width
-00011500: 2c20 7379 6d62 6f6c 4272 7573 683d 7067  , symbolBrush=pg
-00011510: 2e6d 6b42 7275 7368 2875 7365 645f 636f  .mkBrush(used_co
-00011520: 6c6f 7229 2c20 6e61 6d65 3d6c 6567 656e  lor), name=legen
-00011530: 6429 0d0a 2020 2020 2020 2020 6966 2077  d)..        if w
-00011540: 6964 7468 203c 2031 3a0d 0a20 2020 2020  idth < 1:..     
-00011550: 2020 2020 2020 2069 7465 6d2e 6f70 7473         item.opts
-00011560: 5b27 616e 7469 616c 6961 7327 5d20 3d20  ['antialias'] = 
-00011570: 5472 7565 0d0a 2020 2020 2020 2020 6974  True..        it
-00011580: 656d 2e73 6361 7474 6572 2e5f 646f 7061  em.scatter._dopa
-00011590: 696e 7420 3d20 6974 656d 2e73 6361 7474  int = item.scatt
-000115a0: 6572 2e70 6169 6e74 0d0a 2020 2020 2020  er.paint..      
-000115b0: 2020 6974 656d 2e73 6361 7474 6572 2e70    item.scatter.p
-000115c0: 6169 6e74 203d 2070 6172 7469 616c 285f  aint = partial(_
-000115d0: 7061 696e 745f 7363 6174 7465 722c 2069  paint_scatter, i
-000115e0: 7465 6d2e 7363 6174 7465 7229 0d0a 2020  tem.scatter)..  
-000115f0: 2020 2020 2020 2320 6f70 7469 6d69 7a65        # optimize
-00011600: 2028 7768 656e 2068 6176 696e 6720 6c61   (when having la
-00011610: 7267 6520 6e75 6d62 6572 206f 6620 706f  rge number of po
-00011620: 696e 7473 2920 6279 2069 676e 6f72 696e  ints) by ignorin
-00011630: 6720 7363 6174 7465 7220 636c 6963 6b20  g scatter click 
-00011640: 6465 7465 6374 696f 6e0d 0a20 2020 2020  detection..     
-00011650: 2020 205f 6475 6d6d 795f 6d6f 7573 655f     _dummy_mouse_
-00011660: 636c 6963 6b20 3d20 6c61 6d62 6461 2065  click = lambda e
-00011670: 763a 2030 0d0a 2020 2020 2020 2020 6974  v: 0..        it
-00011680: 656d 2e73 6361 7474 6572 2e6d 6f75 7365  em.scatter.mouse
-00011690: 436c 6963 6b45 7665 6e74 203d 205f 6475  ClickEvent = _du
-000116a0: 6d6d 795f 6d6f 7573 655f 636c 6963 6b0d  mmy_mouse_click.
-000116b0: 0a20 2020 2020 2020 2069 7465 6d2e 7365  .        item.se
-000116c0: 745a 5661 6c75 6528 3130 290d 0a20 2020  tZValue(10)..   
-000116d0: 2069 7465 6d2e 6f70 7473 5b27 6861 6e64   item.opts['hand
-000116e0: 6564 5f63 6f6c 6f72 275d 203d 2063 6f6c  ed_color'] = col
-000116f0: 6f72 0d0a 2020 2020 6974 656d 2e61 7820  or..    item.ax 
-00011700: 3d20 6178 0d0a 2020 2020 6974 656d 2e64  = ax..    item.d
-00011710: 6174 6173 7263 203d 2064 6174 6173 7263  atasrc = datasrc
-00011720: 0d0a 2020 2020 5f75 7064 6174 655f 7369  ..    _update_si
-00011730: 676e 6966 6963 616e 7473 2861 782c 2064  gnificants(ax, d
-00011740: 6174 6173 7263 2c20 666f 7263 653d 4661  atasrc, force=Fa
-00011750: 6c73 6529 0d0a 2020 2020 6974 656d 2e75  lse)..    item.u
-00011760: 7064 6174 655f 6461 7461 203d 2070 6172  pdate_data = par
-00011770: 7469 616c 285f 7570 6461 7465 5f64 6174  tial(_update_dat
-00011780: 612c 204e 6f6e 652c 204e 6f6e 652c 2069  a, None, None, i
-00011790: 7465 6d29 0d0a 2020 2020 6974 656d 2e75  tem)..    item.u
-000117a0: 7064 6174 655f 6766 7820 3d20 7061 7274  pdate_gfx = part
-000117b0: 6961 6c28 5f75 7064 6174 655f 6766 782c  ial(_update_gfx,
-000117c0: 2069 7465 6d29 0d0a 2020 2020 2320 6164   item)..    # ad
-000117d0: 6420 6c65 6765 6e64 2074 6f20 6d61 696e  d legend to main
-000117e0: 2061 782c 206e 6f74 2074 6f20 6f76 6572   ax, not to over
-000117f0: 6c61 790d 0a20 2020 2061 786d 203d 2061  lay..    axm = a
-00011800: 782e 7662 2e6d 6173 7465 725f 7669 6577  x.vb.master_view
-00011810: 626f 782e 7061 7265 6e74 2829 2069 6620  box.parent() if 
-00011820: 6178 2e76 622e 6d61 7374 6572 5f76 6965  ax.vb.master_vie
-00011830: 7762 6f78 2065 6c73 6520 6178 0d0a 2020  wbox else ax..  
-00011840: 2020 6966 2061 786d 2e6c 6567 656e 6420    if axm.legend 
-00011850: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00011860: 2020 2020 2020 6966 206c 6567 656e 6420        if legend 
-00011870: 616e 6420 6178 6d20 213d 2061 783a 0d0a  and axm != ax:..
-00011880: 2020 2020 2020 2020 2020 2020 6178 6d2e              axm.
-00011890: 6c65 6765 6e64 2e61 6464 4974 656d 2869  legend.addItem(i
-000118a0: 7465 6d2c 206e 616d 653d 6c65 6765 6e64  tem, name=legend
-000118b0: 290d 0a20 2020 2020 2020 2066 6f72 205f  )..        for _
-000118c0: 2c6c 6162 656c 2069 6e20 6178 6d2e 6c65  ,label in axm.le
-000118d0: 6765 6e64 2e69 7465 6d73 3a0d 0a20 2020  gend.items:..   
-000118e0: 2020 2020 2020 2020 2069 6620 6c61 6265           if labe
-000118f0: 6c2e 7465 7874 203d 3d20 6c65 6765 6e64  l.text == legend
-00011900: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011910: 2020 206c 6162 656c 2e73 6574 4174 7472     label.setAttr
-00011920: 2827 6a75 7374 6966 7927 2c20 276c 6566  ('justify', 'lef
-00011930: 7427 290d 0a20 2020 2020 2020 2020 2020  t')..           
-00011940: 2020 2020 206c 6162 656c 2e73 6574 5465       label.setTe
-00011950: 7874 286c 6162 656c 2e74 6578 742c 2063  xt(label.text, c
-00011960: 6f6c 6f72 3d6c 6567 656e 645f 7465 7874  olor=legend_text
-00011970: 5f63 6f6c 6f72 290d 0a20 2020 2072 6574  _color)..    ret
-00011980: 7572 6e20 6974 656d 0d0a 0d0a 0d0a 6465  urn item......de
-00011990: 6620 6c61 6265 6c73 2878 2c20 793d 4e6f  f labels(x, y=No
-000119a0: 6e65 2c20 6c61 6265 6c73 3d4e 6f6e 652c  ne, labels=None,
-000119b0: 2063 6f6c 6f72 3d4e 6f6e 652c 2061 783d   color=None, ax=
-000119c0: 4e6f 6e65 2c20 616e 6368 6f72 3d28 302e  None, anchor=(0.
-000119d0: 352c 3129 293a 0d0a 2020 2020 6178 203d  5,1)):..    ax =
-000119e0: 205f 6372 6561 7465 5f70 6c6f 7428 6178   _create_plot(ax
-000119f0: 3d61 782c 206d 6178 696d 697a 653d 4661  =ax, maximize=Fa
-00011a00: 6c73 6529 0d0a 2020 2020 7573 6564 5f63  lse)..    used_c
-00011a10: 6f6c 6f72 203d 205f 6765 745f 636f 6c6f  olor = _get_colo
-00011a20: 7228 6178 2c20 273f 272c 2063 6f6c 6f72  r(ax, '?', color
-00011a30: 290d 0a20 2020 2064 6174 6173 7263 203d  )..    datasrc =
-00011a40: 205f 6372 6561 7465 5f64 6174 6173 7263   _create_datasrc
-00011a50: 2861 782c 2078 2c20 792c 206c 6162 656c  (ax, x, y, label
-00011a60: 732c 206e 636f 6c73 3d33 290d 0a20 2020  s, ncols=3)..   
-00011a70: 2064 6174 6173 7263 2e73 6361 6c65 5f63   datasrc.scale_c
-00011a80: 6f6c 7320 3d20 5b5d 2023 2064 6f6e 2774  ols = [] # don't
-00011a90: 2075 7365 2074 6869 7320 666f 7220 7363   use this for sc
-00011aa0: 616c 696e 670d 0a20 2020 205f 7365 745f  aling..    _set_
-00011ab0: 6461 7461 7372 6328 6178 2c20 6461 7461  datasrc(ax, data
-00011ac0: 7372 6329 0d0a 2020 2020 6974 656d 203d  src)..    item =
-00011ad0: 2053 6361 7474 6572 4c61 6265 6c49 7465   ScatterLabelIte
-00011ae0: 6d28 6178 3d61 782c 2064 6174 6173 7263  m(ax=ax, datasrc
-00011af0: 3d64 6174 6173 7263 2c20 636f 6c6f 723d  =datasrc, color=
-00011b00: 7573 6564 5f63 6f6c 6f72 2c20 616e 6368  used_color, anch
-00011b10: 6f72 3d61 6e63 686f 7229 0d0a 2020 2020  or=anchor)..    
-00011b20: 5f75 7064 6174 655f 7369 676e 6966 6963  _update_signific
-00011b30: 616e 7473 2861 782c 2064 6174 6173 7263  ants(ax, datasrc
-00011b40: 2c20 666f 7263 653d 4661 6c73 6529 0d0a  , force=False)..
-00011b50: 2020 2020 6974 656d 2e75 7064 6174 655f      item.update_
-00011b60: 6461 7461 203d 2070 6172 7469 616c 285f  data = partial(_
-00011b70: 7570 6461 7465 5f64 6174 612c 204e 6f6e  update_data, Non
-00011b80: 652c 204e 6f6e 652c 2069 7465 6d29 0d0a  e, None, item)..
-00011b90: 2020 2020 6974 656d 2e75 7064 6174 655f      item.update_
-00011ba0: 6766 7820 3d20 7061 7274 6961 6c28 5f75  gfx = partial(_u
-00011bb0: 7064 6174 655f 6766 782c 2069 7465 6d29  pdate_gfx, item)
-00011bc0: 0d0a 2020 2020 6178 2e61 6464 4974 656d  ..    ax.addItem
-00011bd0: 2869 7465 6d29 0d0a 2020 2020 6966 2061  (item)..    if a
-00011be0: 782e 7662 2e76 5f7a 6f6f 6d5f 7363 616c  x.vb.v_zoom_scal
-00011bf0: 6520 3e20 302e 393a 2023 2061 646a 7573  e > 0.9: # adjus
-00011c00: 7420 746f 206d 616b 6520 6869 2f6c 6f20  t to make hi/lo 
-00011c10: 7465 7874 2066 6974 0d0a 2020 2020 2020  text fit..      
-00011c20: 2020 6178 2e76 622e 765f 7a6f 6f6d 5f73    ax.vb.v_zoom_s
-00011c30: 6361 6c65 203d 2030 2e39 0d0a 2020 2020  cale = 0.9..    
-00011c40: 7265 7475 726e 2069 7465 6d0d 0a0d 0a0d  return item.....
-00011c50: 0a64 6566 206c 6976 6528 706c 6f74 733d  .def live(plots=
-00011c60: 3129 3a0d 0a20 2020 2069 6620 706c 6f74  1):..    if plot
-00011c70: 7320 3d3d 2031 3a0d 0a20 2020 2020 2020  s == 1:..       
-00011c80: 2072 6574 7572 6e20 4c69 7665 2829 0d0a   return Live()..
-00011c90: 2020 2020 7265 7475 726e 205b 4c69 7665      return [Live
-00011ca0: 2829 2066 6f72 205f 2069 6e20 7261 6e67  () for _ in rang
-00011cb0: 6528 706c 6f74 7329 5d0d 0a0d 0a0d 0a64  e(plots)]......d
-00011cc0: 6566 2061 6464 5f6c 6567 656e 6428 7465  ef add_legend(te
-00011cd0: 7874 2c20 6178 3d4e 6f6e 6529 3a0d 0a20  xt, ax=None):.. 
-00011ce0: 2020 2061 7820 3d20 5f63 7265 6174 655f     ax = _create_
-00011cf0: 706c 6f74 2861 783d 6178 2c20 6d61 7869  plot(ax=ax, maxi
-00011d00: 6d69 7a65 3d46 616c 7365 290d 0a20 2020  mize=False)..   
-00011d10: 205f 6372 6561 7465 5f6c 6567 656e 6428   _create_legend(
-00011d20: 6178 290d 0a20 2020 2072 6f77 203d 2061  ax)..    row = a
-00011d30: 782e 6c65 6765 6e64 2e6c 6179 6f75 742e  x.legend.layout.
-00011d40: 726f 7743 6f75 6e74 2829 0d0a 2020 2020  rowCount()..    
-00011d50: 6c61 6265 6c20 3d20 7067 2e4c 6162 656c  label = pg.Label
-00011d60: 4974 656d 2874 6578 742c 2063 6f6c 6f72  Item(text, color
-00011d70: 3d6c 6567 656e 645f 7465 7874 5f63 6f6c  =legend_text_col
-00011d80: 6f72 2c20 6a75 7374 6966 793d 276c 6566  or, justify='lef
-00011d90: 7427 290d 0a20 2020 2061 782e 6c65 6765  t')..    ax.lege
-00011da0: 6e64 2e6c 6179 6f75 742e 6164 6449 7465  nd.layout.addIte
-00011db0: 6d28 6c61 6265 6c2c 2072 6f77 2c20 302c  m(label, row, 0,
-00011dc0: 2031 2c20 3229 0d0a 2020 2020 7265 7475   1, 2)..    retu
-00011dd0: 726e 206c 6162 656c 0d0a 0d0a 0d0a 6465  rn label......de
-00011de0: 6620 6669 6c6c 5f62 6574 7765 656e 2870  f fill_between(p
-00011df0: 6c6f 7430 2c20 706c 6f74 312c 2063 6f6c  lot0, plot1, col
-00011e00: 6f72 3d4e 6f6e 6529 3a0d 0a20 2020 2075  or=None):..    u
-00011e10: 7365 645f 636f 6c6f 7220 3d20 6272 6967  sed_color = brig
-00011e20: 6874 656e 285f 6765 745f 636f 6c6f 7228  hten(_get_color(
-00011e30: 706c 6f74 302e 6178 2c20 4e6f 6e65 2c20  plot0.ax, None, 
-00011e40: 636f 6c6f 7229 2c20 312e 3329 0d0a 2020  color), 1.3)..  
-00011e50: 2020 6974 656d 203d 2070 672e 4669 6c6c    item = pg.Fill
-00011e60: 4265 7477 6565 6e49 7465 6d28 706c 6f74  BetweenItem(plot
-00011e70: 302c 2070 6c6f 7431 2c20 6272 7573 683d  0, plot1, brush=
-00011e80: 7067 2e6d 6b42 7275 7368 2875 7365 645f  pg.mkBrush(used_
-00011e90: 636f 6c6f 7229 290d 0a20 2020 2069 7465  color))..    ite
-00011ea0: 6d2e 6178 203d 2070 6c6f 7430 2e61 780d  m.ax = plot0.ax.
-00011eb0: 0a20 2020 2069 7465 6d2e 7365 745a 5661  .    item.setZVa
-00011ec0: 6c75 6528 2d34 3029 0d0a 2020 2020 6974  lue(-40)..    it
-00011ed0: 656d 2e61 782e 6164 6449 7465 6d28 6974  em.ax.addItem(it
-00011ee0: 656d 290d 0a20 2020 2023 2055 676c 7920  em)..    # Ugly 
-00011ef0: 6275 6720 6669 7820 666f 7220 5079 5174  bug fix for PyQt
-00011f00: 4772 6170 6820 6275 6720 7768 6572 6520  Graph bug where 
-00011f10: 646f 776e 7361 6d70 6c65 642f 636c 6970  downsampled/clip
-00011f20: 7065 6420 706c 6f74 7320 6172 6520 7573  ped plots are us
-00011f30: 6564 2069 6e20 636f 6e6a 756e 6374 696f  ed in conjunctio
-00011f40: 6e0d 0a20 2020 2023 2077 6974 6820 6669  n..    # with fi
-00011f50: 6c6c 2062 6574 7765 656e 2e20 5468 6520  ll between. The 
-00011f60: 7265 6173 6f6e 2069 7320 7468 6174 2074  reason is that t
-00011f70: 6865 2063 7572 7665 7320 6f66 2074 6865  he curves of the
-00011f80: 2064 6f77 6e73 616d 706c 6564 2070 6c6f   downsampled plo
-00011f90: 7473 2061 7265 206f 6e6c 790d 0a20 2020  ts are only..   
-00011fa0: 2023 2063 616c 6375 6c61 7465 6420 7768   # calculated wh
-00011fb0: 656e 2073 686f 776e 2c20 6275 7420 6e6f  en shown, but no
-00011fc0: 7420 7768 656e 2061 6464 6564 2074 6f20  t when added to 
-00011fd0: 7468 6520 6178 6973 2e20 5765 2066 6978  the axis. We fix
-00011fe0: 2062 7920 7361 7969 6e67 2074 6865 2070   by saying the p
-00011ff0: 6c6f 7420 6973 0d0a 2020 2020 2320 6368  lot is..    # ch
-00012000: 616e 6765 6420 6576 6572 7920 7469 6d65  anged every time
-00012010: 2074 6865 207a 6f6f 6d20 6973 2063 6861   the zoom is cha
-00012020: 6e67 6564 202d 2069 6e63 6c75 6469 6e67  nged - including
-00012030: 2069 6e69 7469 616c 206c 6f61 642e 0d0a   initial load...
-00012040: 2020 2020 6465 6620 7570 6461 7465 5f66      def update_f
-00012050: 696c 6c28 7662 293a 0d0a 2020 2020 2020  ill(vb):..      
-00012060: 2020 706c 6f74 302e 7369 6750 6c6f 7443    plot0.sigPlotC
-00012070: 6861 6e67 6564 2e65 6d69 7428 706c 6f74  hanged.emit(plot
-00012080: 3029 0d0a 2020 2020 706c 6f74 302e 6178  0)..    plot0.ax
-00012090: 2e76 622e 7a6f 6f6d 5f6c 6973 7465 6e65  .vb.zoom_listene
-000120a0: 7273 2e61 6464 2875 7064 6174 655f 6669  rs.add(update_fi
-000120b0: 6c6c 290d 0a20 2020 2072 6574 7572 6e20  ll)..    return 
-000120c0: 6974 656d 0d0a 0d0a 0d0a 6465 6620 7365  item......def se
-000120d0: 745f 785f 706f 7328 786d 696e 2c20 786d  t_x_pos(xmin, xm
-000120e0: 6178 2c20 6178 3d4e 6f6e 6529 3a0d 0a20  ax, ax=None):.. 
-000120f0: 2020 2061 7820 3d20 5f63 7265 6174 655f     ax = _create_
-00012100: 706c 6f74 2861 783d 6178 2c20 6d61 7869  plot(ax=ax, maxi
-00012110: 6d69 7a65 3d46 616c 7365 290d 0a20 2020  mize=False)..   
-00012120: 2078 6964 7830 2c78 6964 7831 203d 205f   xidx0,xidx1 = _
-00012130: 7064 7469 6d65 3269 6e64 6578 2861 782c  pdtime2index(ax,
-00012140: 2070 642e 5365 7269 6573 285b 786d 696e   pd.Series([xmin
-00012150: 2c20 786d 6178 5d29 290d 0a20 2020 2061  , xmax]))..    a
-00012160: 782e 7662 2e75 7064 6174 655f 795f 7a6f  x.vb.update_y_zo
-00012170: 6f6d 2878 6964 7830 2c20 7869 6478 3129  om(xidx0, xidx1)
-00012180: 0d0a 2020 2020 5f72 6570 6169 6e74 5f63  ..    _repaint_c
-00012190: 616e 646c 6573 2829 0d0a 0d0a 0d0a 6465  andles()......de
-000121a0: 6620 7365 745f 795f 7261 6e67 6528 796d  f set_y_range(ym
-000121b0: 696e 2c20 796d 6178 2c20 6178 3d4e 6f6e  in, ymax, ax=Non
-000121c0: 6529 3a0d 0a20 2020 2061 7820 3d20 5f63  e):..    ax = _c
-000121d0: 7265 6174 655f 706c 6f74 2861 783d 6178  reate_plot(ax=ax
-000121e0: 2c20 6d61 7869 6d69 7a65 3d46 616c 7365  , maximize=False
-000121f0: 290d 0a20 2020 2061 782e 7365 744c 696d  )..    ax.setLim
-00012200: 6974 7328 794d 696e 3d79 6d69 6e2c 2079  its(yMin=ymin, y
-00012210: 4d61 783d 796d 6178 290d 0a20 2020 2061  Max=ymax)..    a
-00012220: 782e 7662 2e76 5f61 7574 6f7a 6f6f 6d20  x.vb.v_autozoom 
-00012230: 3d20 4661 6c73 650d 0a20 2020 2061 782e  = False..    ax.
-00012240: 7662 2e73 6574 5f72 616e 6765 284e 6f6e  vb.set_range(Non
-00012250: 652c 2079 6d69 6e2c 204e 6f6e 652c 2079  e, ymin, None, y
-00012260: 6d61 7829 0d0a 0d0a 0d0a 6465 6620 7365  max)......def se
-00012270: 745f 795f 7363 616c 6528 7973 6361 6c65  t_y_scale(yscale
-00012280: 3d27 6c69 6e65 6172 272c 2061 783d 4e6f  ='linear', ax=No
-00012290: 6e65 293a 0d0a 2020 2020 6178 203d 205f  ne):..    ax = _
-000122a0: 6372 6561 7465 5f70 6c6f 7428 6178 3d61  create_plot(ax=a
-000122b0: 782c 206d 6178 696d 697a 653d 4661 6c73  x, maximize=Fals
-000122c0: 6529 0d0a 2020 2020 6178 2e73 6574 4c6f  e)..    ax.setLo
-000122d0: 674d 6f64 6528 793d 2879 7363 616c 653d  gMode(y=(yscale=
-000122e0: 3d27 6c6f 6727 2929 0d0a 2020 2020 6178  ='log'))..    ax
-000122f0: 2e76 622e 7973 6361 6c65 203d 2059 5363  .vb.yscale = YSc
-00012300: 616c 6528 7973 6361 6c65 2c20 6178 2e76  ale(yscale, ax.v
-00012310: 622e 7973 6361 6c65 2e73 6361 6c65 6629  b.yscale.scalef)
-00012320: 0d0a 0d0a 0d0a 6465 6620 6164 645f 6261  ......def add_ba
-00012330: 6e64 2879 302c 2079 312c 2063 6f6c 6f72  nd(y0, y1, color
-00012340: 3d62 616e 645f 636f 6c6f 722c 2061 783d  =band_color, ax=
-00012350: 4e6f 6e65 293a 0d0a 2020 2020 6178 203d  None):..    ax =
-00012360: 205f 6372 6561 7465 5f70 6c6f 7428 6178   _create_plot(ax
-00012370: 3d61 782c 206d 6178 696d 697a 653d 4661  =ax, maximize=Fa
-00012380: 6c73 6529 0d0a 2020 2020 636f 6c6f 7220  lse)..    color 
-00012390: 3d20 5f67 6574 5f63 6f6c 6f72 2861 782c  = _get_color(ax,
-000123a0: 204e 6f6e 652c 2063 6f6c 6f72 290d 0a20   None, color).. 
-000123b0: 2020 2069 7820 3d20 6178 2e76 622e 7973     ix = ax.vb.ys
-000123c0: 6361 6c65 2e69 6e76 7866 6f72 6d0d 0a20  cale.invxform.. 
-000123d0: 2020 206c 7220 3d20 7067 2e4c 696e 6561     lr = pg.Linea
-000123e0: 7252 6567 696f 6e49 7465 6d28 5b69 7828  rRegionItem([ix(
-000123f0: 7930 292c 6978 2879 3129 5d2c 206f 7269  y0),ix(y1)], ori
-00012400: 656e 7461 7469 6f6e 3d70 672e 4c69 6e65  entation=pg.Line
-00012410: 6172 5265 6769 6f6e 4974 656d 2e48 6f72  arRegionItem.Hor
-00012420: 697a 6f6e 7461 6c2c 2062 7275 7368 3d70  izontal, brush=p
-00012430: 672e 6d6b 4272 7573 6828 636f 6c6f 7229  g.mkBrush(color)
-00012440: 2c20 6d6f 7661 626c 653d 4661 6c73 6529  , movable=False)
-00012450: 0d0a 2020 2020 6c72 2e6c 696e 6573 5b30  ..    lr.lines[0
-00012460: 5d2e 7365 7450 656e 2870 672e 6d6b 5065  ].setPen(pg.mkPe
-00012470: 6e28 4e6f 6e65 2929 0d0a 2020 2020 6c72  n(None))..    lr
-00012480: 2e6c 696e 6573 5b31 5d2e 7365 7450 656e  .lines[1].setPen
-00012490: 2870 672e 6d6b 5065 6e28 4e6f 6e65 2929  (pg.mkPen(None))
-000124a0: 0d0a 2020 2020 6c72 2e73 6574 5a56 616c  ..    lr.setZVal
-000124b0: 7565 282d 3530 290d 0a20 2020 206c 722e  ue(-50)..    lr.
-000124c0: 6178 203d 2061 780d 0a20 2020 2061 782e  ax = ax..    ax.
-000124d0: 6164 6449 7465 6d28 6c72 290d 0a20 2020  addItem(lr)..   
-000124e0: 2072 6574 7572 6e20 6c72 0d0a 0d0a 0d0a   return lr......
-000124f0: 6465 6620 6164 645f 7265 6374 2870 302c  def add_rect(p0,
-00012500: 2070 312c 2063 6f6c 6f72 3d62 616e 645f   p1, color=band_
-00012510: 636f 6c6f 722c 2069 6e74 6572 6163 7469  color, interacti
-00012520: 7665 3d46 616c 7365 2c20 6178 3d4e 6f6e  ve=False, ax=Non
-00012530: 6529 3a0d 0a20 2020 2061 7820 3d20 5f63  e):..    ax = _c
-00012540: 7265 6174 655f 706c 6f74 2861 783d 6178  reate_plot(ax=ax
-00012550: 2c20 6d61 7869 6d69 7a65 3d46 616c 7365  , maximize=False
-00012560: 290d 0a20 2020 2078 5f70 7473 203d 205f  )..    x_pts = _
-00012570: 7064 7469 6d65 3269 6e64 6578 2861 782c  pdtime2index(ax,
-00012580: 2070 642e 5365 7269 6573 285b 7030 5b30   pd.Series([p0[0
-00012590: 5d2c 2070 315b 305d 5d29 290d 0a20 2020  ], p1[0]]))..   
-000125a0: 2069 7820 3d20 6178 2e76 622e 7973 6361   ix = ax.vb.ysca
-000125b0: 6c65 2e69 6e76 7866 6f72 6d0d 0a20 2020  le.invxform..   
-000125c0: 2079 302c 7931 203d 2073 6f72 7465 6428   y0,y1 = sorted(
-000125d0: 5b70 305b 315d 2c20 7031 5b31 5d5d 290d  [p0[1], p1[1]]).
-000125e0: 0a20 2020 2070 6f73 2020 3d20 2878 5f70  .    pos  = (x_p
-000125f0: 7473 5b30 5d2c 2069 7828 7930 2929 0d0a  ts[0], ix(y0))..
-00012600: 2020 2020 7369 7a65 203d 2028 785f 7074      size = (x_pt
-00012610: 735b 315d 2d70 6f73 5b30 5d2c 2069 7828  s[1]-pos[0], ix(
-00012620: 7931 292d 6978 2879 3029 290d 0a20 2020  y1)-ix(y0))..   
-00012630: 2072 6563 7420 3d20 4669 6e52 6563 7428   rect = FinRect(
-00012640: 6178 3d61 782c 2062 7275 7368 3d70 672e  ax=ax, brush=pg.
-00012650: 6d6b 4272 7573 6828 636f 6c6f 7229 2c20  mkBrush(color), 
-00012660: 706f 733d 706f 732c 2073 697a 653d 7369  pos=pos, size=si
-00012670: 7a65 2c20 6d6f 7661 626c 653d 696e 7465  ze, movable=inte
-00012680: 7261 6374 6976 652c 2072 6573 697a 6162  ractive, resizab
-00012690: 6c65 3d69 6e74 6572 6163 7469 7665 2c20  le=interactive, 
-000126a0: 726f 7461 7461 626c 653d 4661 6c73 6529  rotatable=False)
-000126b0: 0d0a 2020 2020 7265 6374 2e73 6574 5a56  ..    rect.setZV
-000126c0: 616c 7565 282d 3430 290d 0a20 2020 2069  alue(-40)..    i
-000126d0: 6620 696e 7465 7261 6374 6976 653a 0d0a  f interactive:..
-000126e0: 2020 2020 2020 2020 6178 2e76 622e 726f          ax.vb.ro
-000126f0: 6973 2e61 7070 656e 6428 7265 6374 290d  is.append(rect).
-00012700: 0a20 2020 2072 6563 742e 6178 203d 2061  .    rect.ax = a
-00012710: 780d 0a20 2020 2061 782e 6164 6449 7465  x..    ax.addIte
-00012720: 6d28 7265 6374 290d 0a20 2020 2072 6574  m(rect)..    ret
-00012730: 7572 6e20 7265 6374 0d0a 0d0a 0d0a 6465  urn rect......de
-00012740: 6620 6164 645f 6c69 6e65 2870 302c 2070  f add_line(p0, p
-00012750: 312c 2063 6f6c 6f72 3d64 7261 775f 6c69  1, color=draw_li
-00012760: 6e65 5f63 6f6c 6f72 2c20 7769 6474 683d  ne_color, width=
-00012770: 312c 2073 7479 6c65 3d4e 6f6e 652c 2069  1, style=None, i
-00012780: 6e74 6572 6163 7469 7665 3d46 616c 7365  nteractive=False
-00012790: 2c20 6178 3d4e 6f6e 6529 3a0d 0a20 2020  , ax=None):..   
-000127a0: 2061 7820 3d20 5f63 7265 6174 655f 706c   ax = _create_pl
-000127b0: 6f74 2861 783d 6178 2c20 6d61 7869 6d69  ot(ax=ax, maximi
-000127c0: 7a65 3d46 616c 7365 290d 0a20 2020 2075  ze=False)..    u
-000127d0: 7365 645f 636f 6c6f 7220 3d20 5f67 6574  sed_color = _get
-000127e0: 5f63 6f6c 6f72 2861 782c 2073 7479 6c65  _color(ax, style
-000127f0: 2c20 636f 6c6f 7229 0d0a 2020 2020 7065  , color)..    pe
-00012800: 6e20 3d20 5f6d 616b 6570 656e 2863 6f6c  n = _makepen(col
-00012810: 6f72 3d75 7365 645f 636f 6c6f 722c 2073  or=used_color, s
-00012820: 7479 6c65 3d73 7479 6c65 2c20 7769 6474  tyle=style, widt
-00012830: 683d 7769 6474 6829 0d0a 2020 2020 785f  h=width)..    x_
-00012840: 7074 7320 3d20 5f70 6474 696d 6532 696e  pts = _pdtime2in
-00012850: 6465 7828 6178 2c20 7064 2e53 6572 6965  dex(ax, pd.Serie
-00012860: 7328 5b70 305b 305d 2c20 7031 5b30 5d5d  s([p0[0], p1[0]]
-00012870: 2929 0d0a 2020 2020 6978 203d 2061 782e  ))..    ix = ax.
-00012880: 7662 2e79 7363 616c 652e 696e 7678 666f  vb.yscale.invxfo
-00012890: 726d 0d0a 2020 2020 7074 7320 3d20 5b28  rm..    pts = [(
-000128a0: 785f 7074 735b 305d 2c20 6978 2870 305b  x_pts[0], ix(p0[
-000128b0: 315d 2929 2c20 2878 5f70 7473 5b31 5d2c  1])), (x_pts[1],
-000128c0: 2069 7828 7031 5b31 5d29 295d 0d0a 2020   ix(p1[1]))]..  
-000128d0: 2020 6966 2069 6e74 6572 6163 7469 7665    if interactive
-000128e0: 3a0d 0a20 2020 2020 2020 206c 696e 6520  :..        line 
-000128f0: 3d20 5f63 7265 6174 655f 706f 6c79 5f6c  = _create_poly_l
-00012900: 696e 6528 6178 2e76 622c 2070 7473 2c20  ine(ax.vb, pts, 
-00012910: 636c 6f73 6564 3d46 616c 7365 2c20 7065  closed=False, pe
-00012920: 6e3d 7065 6e2c 206d 6f76 6162 6c65 3d46  n=pen, movable=F
-00012930: 616c 7365 290d 0a20 2020 2020 2020 2061  alse)..        a
-00012940: 782e 7662 2e72 6f69 732e 6170 7065 6e64  x.vb.rois.append
-00012950: 286c 696e 6529 0d0a 2020 2020 656c 7365  (line)..    else
-00012960: 3a0d 0a20 2020 2020 2020 206c 696e 6520  :..        line 
-00012970: 3d20 4669 6e4c 696e 6528 7074 732c 2070  = FinLine(pts, p
-00012980: 656e 3d70 656e 290d 0a20 2020 206c 696e  en=pen)..    lin
-00012990: 652e 6178 203d 2061 780d 0a20 2020 2061  e.ax = ax..    a
-000129a0: 782e 6164 6449 7465 6d28 6c69 6e65 290d  x.addItem(line).
-000129b0: 0a20 2020 2072 6574 7572 6e20 6c69 6e65  .    return line
-000129c0: 0d0a 0d0a 0d0a 6465 6620 6164 645f 7465  ......def add_te
-000129d0: 7874 2870 6f73 2c20 732c 2063 6f6c 6f72  xt(pos, s, color
-000129e0: 3d64 7261 775f 6c69 6e65 5f63 6f6c 6f72  =draw_line_color
-000129f0: 2c20 616e 6368 6f72 3d28 302c 3029 2c20  , anchor=(0,0), 
-00012a00: 6178 3d4e 6f6e 6529 3a0d 0a20 2020 2061  ax=None):..    a
-00012a10: 7820 3d20 5f63 7265 6174 655f 706c 6f74  x = _create_plot
-00012a20: 2861 783d 6178 2c20 6d61 7869 6d69 7a65  (ax=ax, maximize
-00012a30: 3d46 616c 7365 290d 0a20 2020 2063 6f6c  =False)..    col
-00012a40: 6f72 203d 205f 6765 745f 636f 6c6f 7228  or = _get_color(
-00012a50: 6178 2c20 4e6f 6e65 2c20 636f 6c6f 7229  ax, None, color)
-00012a60: 0d0a 2020 2020 7465 7874 203d 2070 672e  ..    text = pg.
-00012a70: 5465 7874 4974 656d 2873 2c20 636f 6c6f  TextItem(s, colo
-00012a80: 723d 636f 6c6f 722c 2061 6e63 686f 723d  r=color, anchor=
-00012a90: 616e 6368 6f72 290d 0a20 2020 2078 203d  anchor)..    x =
-00012aa0: 2070 6f73 5b30 5d0d 0a20 2020 2069 6620   pos[0]..    if 
-00012ab0: 6178 2e76 622e 6461 7461 7372 6320 6973  ax.vb.datasrc is
-00012ac0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00012ad0: 2020 2020 7820 3d20 5f70 6474 696d 6532      x = _pdtime2
-00012ae0: 696e 6465 7828 6178 2c20 7064 2e53 6572  index(ax, pd.Ser
-00012af0: 6965 7328 5b70 6f73 5b30 5d5d 2929 5b30  ies([pos[0]]))[0
-00012b00: 5d0d 0a20 2020 2079 203d 2061 782e 7662  ]..    y = ax.vb
-00012b10: 2e79 7363 616c 652e 696e 7678 666f 726d  .yscale.invxform
-00012b20: 2870 6f73 5b31 5d29 0d0a 2020 2020 7465  (pos[1])..    te
-00012b30: 7874 2e73 6574 506f 7328 782c 2079 290d  xt.setPos(x, y).
-00012b40: 0a20 2020 2074 6578 742e 7365 745a 5661  .    text.setZVa
-00012b50: 6c75 6528 3530 290d 0a20 2020 2074 6578  lue(50)..    tex
-00012b60: 742e 6178 203d 2061 780d 0a20 2020 2061  t.ax = ax..    a
-00012b70: 782e 6164 6449 7465 6d28 7465 7874 2c20  x.addItem(text, 
-00012b80: 6967 6e6f 7265 426f 756e 6473 3d54 7275  ignoreBounds=Tru
-00012b90: 6529 0d0a 2020 2020 7265 7475 726e 2074  e)..    return t
-00012ba0: 6578 740d 0a0d 0a0d 0a64 6566 2072 656d  ext......def rem
-00012bb0: 6f76 655f 6c69 6e65 286c 696e 6529 3a0d  ove_line(line):.
-00012bc0: 0a20 2020 2070 7269 6e74 2827 7265 6d6f  .    print('remo
-00012bd0: 7665 5f6c 696e 6528 2920 6973 2064 6570  ve_line() is dep
-00012be0: 7265 6361 7465 642c 2075 7365 2072 656d  recated, use rem
-00012bf0: 6f76 655f 7072 696d 6974 6976 6528 2920  ove_primitive() 
-00012c00: 696e 7374 6561 6427 290d 0a20 2020 2072  instead')..    r
-00012c10: 656d 6f76 655f 7072 696d 6974 6976 6528  emove_primitive(
-00012c20: 6c69 6e65 290d 0a0d 0a0d 0a64 6566 2072  line)......def r
-00012c30: 656d 6f76 655f 7465 7874 2874 6578 7429  emove_text(text)
-00012c40: 3a0d 0a20 2020 2070 7269 6e74 2827 7265  :..    print('re
-00012c50: 6d6f 7665 5f74 6578 7428 2920 6973 2064  move_text() is d
-00012c60: 6570 7265 6361 7465 642c 2075 7365 2072  eprecated, use r
-00012c70: 656d 6f76 655f 7072 696d 6974 6976 6528  emove_primitive(
-00012c80: 2920 696e 7374 6561 6427 290d 0a20 2020  ) instead')..   
-00012c90: 2072 656d 6f76 655f 7072 696d 6974 6976   remove_primitiv
-00012ca0: 6528 7465 7874 290d 0a0d 0a0d 0a64 6566  e(text)......def
-00012cb0: 2072 656d 6f76 655f 7072 696d 6974 6976   remove_primitiv
-00012cc0: 6528 7072 696d 6974 6976 6529 3a0d 0a20  e(primitive):.. 
-00012cd0: 2020 2061 7820 3d20 7072 696d 6974 6976     ax = primitiv
-00012ce0: 652e 6178 0d0a 2020 2020 6178 2e72 656d  e.ax..    ax.rem
-00012cf0: 6f76 6549 7465 6d28 7072 696d 6974 6976  oveItem(primitiv
-00012d00: 6529 0d0a 2020 2020 6966 2070 7269 6d69  e)..    if primi
-00012d10: 7469 7665 2069 6e20 6178 2e76 622e 726f  tive in ax.vb.ro
-00012d20: 6973 3a0d 0a20 2020 2020 2020 2061 782e  is:..        ax.
-00012d30: 7662 2e72 6f69 732e 7265 6d6f 7665 2870  vb.rois.remove(p
-00012d40: 7269 6d69 7469 7665 290d 0a20 2020 2069  rimitive)..    i
-00012d50: 6620 6861 7361 7474 7228 7072 696d 6974  f hasattr(primit
-00012d60: 6976 652c 2027 7465 7874 7327 293a 0d0a  ive, 'texts'):..
-00012d70: 2020 2020 2020 2020 666f 7220 7478 7420          for txt 
-00012d80: 696e 2070 7269 6d69 7469 7665 2e74 6578  in primitive.tex
-00012d90: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-00012da0: 2061 782e 7662 2e72 656d 6f76 6549 7465   ax.vb.removeIte
-00012db0: 6d28 7478 7429 0d0a 0d0a 0d0a 6465 6620  m(txt)......def 
-00012dc0: 7365 745f 6d6f 7573 655f 6361 6c6c 6261  set_mouse_callba
-00012dd0: 636b 2863 616c 6c62 6163 6b2c 2061 783d  ck(callback, ax=
-00012de0: 4e6f 6e65 2c20 7768 656e 3d27 636c 6963  None, when='clic
-00012df0: 6b27 293a 0d0a 2020 2020 2727 2743 616c  k'):..    '''Cal
-00012e00: 6c62 6163 6b20 7768 656e 2063 6c69 636b  lback when click
-00012e10: 6564 206c 696b 6520 736f 3a20 6361 6c6c  ed like so: call
-00012e20: 6261 636b 2878 2c20 7929 2e27 2727 0d0a  back(x, y).'''..
-00012e30: 2020 2020 6178 203d 2061 7820 6966 2061      ax = ax if a
-00012e40: 7820 656c 7365 206c 6173 745f 6178 0d0a  x else last_ax..
-00012e50: 2020 2020 6d61 7374 6572 203d 2061 782e      master = ax.
-00012e60: 6178 5f77 6964 6765 7420 6966 2068 6173  ax_widget if has
-00012e70: 6174 7472 2861 782c 2027 6178 5f77 6964  attr(ax, 'ax_wid
-00012e80: 6765 7427 2920 656c 7365 2061 782e 7662  get') else ax.vb
-00012e90: 2e77 696e 0d0a 2020 2020 6966 2077 6865  .win..    if whe
-00012ea0: 6e20 3d3d 2027 686f 7665 7227 3a0d 0a20  n == 'hover':.. 
-00012eb0: 2020 2020 2020 206d 6173 7465 722e 7072         master.pr
-00012ec0: 6f78 795f 686f 7665 7220 3d20 7067 2e53  oxy_hover = pg.S
-00012ed0: 6967 6e61 6c50 726f 7879 286d 6173 7465  ignalProxy(maste
-00012ee0: 722e 7363 656e 6528 292e 7369 674d 6f75  r.scene().sigMou
-00012ef0: 7365 4d6f 7665 642c 2072 6174 654c 696d  seMoved, rateLim
-00012f00: 6974 3d31 352c 2073 6c6f 743d 7061 7274  it=15, slot=part
-00012f10: 6961 6c28 5f6d 6361 6c6c 6261 636b 5f70  ial(_mcallback_p
-00012f20: 6f73 2c20 6178 2c20 6361 6c6c 6261 636b  os, ax, callback
-00012f30: 2929 0d0a 2020 2020 656c 6966 2077 6865  ))..    elif whe
-00012f40: 6e20 696e 2028 2764 636c 6963 6b27 2c20  n in ('dclick', 
-00012f50: 2764 6f75 626c 652d 636c 6963 6b27 293a  'double-click'):
-00012f60: 0d0a 2020 2020 2020 2020 6d61 7374 6572  ..        master
-00012f70: 2e70 726f 7879 5f64 636c 6963 6b20 3d20  .proxy_dclick = 
-00012f80: 7067 2e53 6967 6e61 6c50 726f 7879 286d  pg.SignalProxy(m
-00012f90: 6173 7465 722e 7363 656e 6528 292e 7369  aster.scene().si
-00012fa0: 674d 6f75 7365 436c 6963 6b65 642c 2073  gMouseClicked, s
-00012fb0: 6c6f 743d 7061 7274 6961 6c28 5f6d 6361  lot=partial(_mca
-00012fc0: 6c6c 6261 636b 5f63 6c69 636b 2c20 6178  llback_click, ax
-00012fd0: 2c20 6361 6c6c 6261 636b 2c20 2764 636c  , callback, 'dcl
-00012fe0: 6963 6b27 2929 0d0a 2020 2020 656c 6966  ick'))..    elif
-00012ff0: 2077 6865 6e20 696e 2028 2763 6c69 636b   when in ('click
-00013000: 272c 2027 6c63 6c69 636b 2729 3a0d 0a20  ', 'lclick'):.. 
-00013010: 2020 2020 2020 206d 6173 7465 722e 7072         master.pr
-00013020: 6f78 795f 636c 6963 6b20 3d20 7067 2e53  oxy_click = pg.S
-00013030: 6967 6e61 6c50 726f 7879 286d 6173 7465  ignalProxy(maste
-00013040: 722e 7363 656e 6528 292e 7369 674d 6f75  r.scene().sigMou
-00013050: 7365 436c 6963 6b65 642c 2073 6c6f 743d  seClicked, slot=
-00013060: 7061 7274 6961 6c28 5f6d 6361 6c6c 6261  partial(_mcallba
-00013070: 636b 5f63 6c69 636b 2c20 6178 2c20 6361  ck_click, ax, ca
-00013080: 6c6c 6261 636b 2c20 276c 636c 6963 6b27  llback, 'lclick'
-00013090: 2929 0d0a 2020 2020 656c 6966 2077 6865  ))..    elif whe
-000130a0: 6e20 696e 2028 276d 636c 6963 6b27 2c29  n in ('mclick',)
-000130b0: 3a0d 0a20 2020 2020 2020 206d 6173 7465  :..        maste
-000130c0: 722e 7072 6f78 795f 636c 6963 6b20 3d20  r.proxy_click = 
-000130d0: 7067 2e53 6967 6e61 6c50 726f 7879 286d  pg.SignalProxy(m
-000130e0: 6173 7465 722e 7363 656e 6528 292e 7369  aster.scene().si
-000130f0: 674d 6f75 7365 436c 6963 6b65 642c 2073  gMouseClicked, s
-00013100: 6c6f 743d 7061 7274 6961 6c28 5f6d 6361  lot=partial(_mca
-00013110: 6c6c 6261 636b 5f63 6c69 636b 2c20 6178  llback_click, ax
-00013120: 2c20 6361 6c6c 6261 636b 2c20 276d 636c  , callback, 'mcl
-00013130: 6963 6b27 2929 0d0a 2020 2020 656c 6966  ick'))..    elif
-00013140: 2077 6865 6e20 696e 2028 2772 636c 6963   when in ('rclic
-00013150: 6b27 2c29 3a0d 0a20 2020 2020 2020 206d  k',):..        m
-00013160: 6173 7465 722e 7072 6f78 795f 636c 6963  aster.proxy_clic
-00013170: 6b20 3d20 7067 2e53 6967 6e61 6c50 726f  k = pg.SignalPro
-00013180: 7879 286d 6173 7465 722e 7363 656e 6528  xy(master.scene(
-00013190: 292e 7369 674d 6f75 7365 436c 6963 6b65  ).sigMouseClicke
-000131a0: 642c 2073 6c6f 743d 7061 7274 6961 6c28  d, slot=partial(
-000131b0: 5f6d 6361 6c6c 6261 636b 5f63 6c69 636b  _mcallback_click
-000131c0: 2c20 6178 2c20 6361 6c6c 6261 636b 2c20  , ax, callback, 
-000131d0: 2772 636c 6963 6b27 2929 0d0a 2020 2020  'rclick'))..    
-000131e0: 656c 6966 2077 6865 6e20 696e 2028 2761  elif when in ('a
-000131f0: 6e79 272c 293a 0d0a 2020 2020 2020 2020  ny',):..        
-00013200: 6d61 7374 6572 2e70 726f 7879 5f63 6c69  master.proxy_cli
-00013210: 636b 203d 2070 672e 5369 676e 616c 5072  ck = pg.SignalPr
-00013220: 6f78 7928 6d61 7374 6572 2e73 6365 6e65  oxy(master.scene
-00013230: 2829 2e73 6967 4d6f 7573 6543 6c69 636b  ().sigMouseClick
-00013240: 6564 2c20 736c 6f74 3d70 6172 7469 616c  ed, slot=partial
-00013250: 285f 6d63 616c 6c62 6163 6b5f 636c 6963  (_mcallback_clic
-00013260: 6b2c 2061 782c 2063 616c 6c62 6163 6b2c  k, ax, callback,
-00013270: 2027 616e 7927 2929 0d0a 2020 2020 656c   'any'))..    el
-00013280: 7365 3a0d 0a20 2020 2020 2020 2070 7269  se:..        pri
-00013290: 6e74 2866 2757 6172 6e69 6e67 3a20 756e  nt(f'Warning: un
-000132a0: 6b6e 6f77 6e20 636c 6963 6b20 227b 7768  known click "{wh
-000132b0: 656e 7d22 2073 656e 7420 746f 2073 6574  en}" sent to set
-000132c0: 5f6d 6f75 7365 5f63 616c 6c62 6163 6b28  _mouse_callback(
-000132d0: 2927 290d 0a0d 0a0d 0a64 6566 2073 6574  )')......def set
-000132e0: 5f74 696d 655f 696e 7370 6563 746f 7228  _time_inspector(
-000132f0: 6361 6c6c 6261 636b 2c20 6178 3d4e 6f6e  callback, ax=Non
-00013300: 652c 2077 6865 6e3d 2763 6c69 636b 2729  e, when='click')
-00013310: 3a0d 0a20 2020 2070 7269 6e74 2827 5761  :..    print('Wa
-00013320: 726e 696e 673a 2073 6574 5f74 696d 655f  rning: set_time_
-00013330: 696e 7370 6563 746f 7228 2920 6973 2061  inspector() is a
-00013340: 206d 6973 6e6f 6d65 7220 6672 6f6d 206f   misnomer from o
-00013350: 6c64 656e 2064 6179 732e 2050 6c65 6173  lden days. Pleas
-00013360: 6520 7573 6520 7365 745f 6d6f 7573 655f  e use set_mouse_
-00013370: 6361 6c6c 6261 636b 2829 2069 6e73 7465  callback() inste
-00013380: 6164 2e27 290d 0a20 2020 2073 6574 5f6d  ad.')..    set_m
-00013390: 6f75 7365 5f63 616c 6c62 6163 6b28 6361  ouse_callback(ca
-000133a0: 6c6c 6261 636b 2c20 6178 2c20 7768 656e  llback, ax, when
-000133b0: 290d 0a0d 0a0d 0a64 6566 2061 6464 5f63  )......def add_c
-000133c0: 726f 7373 6861 6972 5f69 6e66 6f28 696e  rosshair_info(in
-000133d0: 666f 6675 6e63 2c20 6178 3d4e 6f6e 6529  fofunc, ax=None)
-000133e0: 3a0d 0a20 2020 2027 2727 4361 6c6c 6261  :..    '''Callba
-000133f0: 636b 2077 6865 6e20 6372 6f73 7368 6169  ck when crosshai
-00013400: 7220 7570 6461 7465 6420 6c69 6b65 2073  r updated like s
-00013410: 6f3a 2069 6e66 6f28 6178 2c78 2c79 2c78  o: info(ax,x,y,x
-00013420: 7465 7874 2c79 7465 7874 293b 2074 6865  text,ytext); the
-00013430: 2069 6e66 6f28 290d 0a20 2020 2020 2020   info()..       
-00013440: 6361 6c6c 6261 636b 206d 7573 7420 7265  callback must re
-00013450: 7475 726e 2074 776f 2076 616c 7565 733a  turn two values:
-00013460: 2078 7465 7874 2061 6e64 2079 7465 7874   xtext and ytext
-00013470: 2e27 2727 0d0a 2020 2020 6178 203d 205f  .'''..    ax = _
-00013480: 6372 6561 7465 5f70 6c6f 7428 6178 3d61  create_plot(ax=a
-00013490: 782c 206d 6178 696d 697a 653d 4661 6c73  x, maximize=Fals
-000134a0: 6529 0d0a 2020 2020 6178 2e63 726f 7373  e)..    ax.cross
-000134b0: 6861 6972 2e69 6e66 6f73 2e61 7070 656e  hair.infos.appen
-000134c0: 6428 696e 666f 6675 6e63 290d 0a0d 0a0d  d(infofunc).....
-000134d0: 0a64 6566 2074 696d 6572 5f63 616c 6c62  .def timer_callb
-000134e0: 6163 6b28 7570 6461 7465 5f66 756e 632c  ack(update_func,
-000134f0: 2073 6563 6f6e 6473 2c20 7369 6e67 6c65   seconds, single
-00013500: 5f73 686f 743d 4661 6c73 6529 3a0d 0a20  _shot=False):.. 
-00013510: 2020 2067 6c6f 6261 6c20 7469 6d65 7273     global timers
-00013520: 0d0a 2020 2020 7469 6d65 7220 3d20 5174  ..    timer = Qt
-00013530: 436f 7265 2e51 5469 6d65 7228 290d 0a20  Core.QTimer().. 
-00013540: 2020 2074 696d 6572 2e74 696d 656f 7574     timer.timeout
-00013550: 2e63 6f6e 6e65 6374 2875 7064 6174 655f  .connect(update_
-00013560: 6675 6e63 290d 0a20 2020 2069 6620 7369  func)..    if si
-00013570: 6e67 6c65 5f73 686f 743a 0d0a 2020 2020  ngle_shot:..    
-00013580: 2020 2020 7469 6d65 722e 7365 7453 696e      timer.setSin
-00013590: 676c 6553 686f 7428 5472 7565 290d 0a20  gleShot(True).. 
-000135a0: 2020 2074 696d 6572 2e73 7461 7274 2869     timer.start(i
-000135b0: 6e74 2873 6563 6f6e 6473 2a31 3030 3029  nt(seconds*1000)
-000135c0: 290d 0a20 2020 2074 696d 6572 732e 6170  )..    timers.ap
-000135d0: 7065 6e64 2874 696d 6572 290d 0a20 2020  pend(timer)..   
-000135e0: 2072 6574 7572 6e20 7469 6d65 720d 0a0d   return timer...
-000135f0: 0a0d 0a64 6566 2061 7574 6f76 6965 7772  ...def autoviewr
-00013600: 6573 746f 7265 2865 6e61 626c 653d 5472  estore(enable=Tr
-00013610: 7565 293a 0d0a 2020 2020 2727 2752 6573  ue):..    '''Res
-00013620: 746f 7220 6675 6e63 7469 6f6e 616c 6974  tor functionalit
-00013630: 7920 7361 7665 7320 7669 6577 207a 6f6f  y saves view zoo
-00013640: 6d20 636f 6f72 6469 6e61 7465 7320 7768  m coordinates wh
-00013650: 656e 2063 6c6f 7369 6e67 2061 2077 696e  en closing a win
-00013660: 646f 772c 2061 6e64 0d0a 2020 2020 2020  dow, and..      
-00013670: 206c 6f61 6420 7468 656d 2077 6865 6e20   load them when 
-00013680: 6372 6561 7469 6e67 2074 6865 2070 6c6f  creating the plo
-00013690: 7420 2877 6974 6820 7468 6520 7361 6d65  t (with the same
-000136a0: 206e 616d 6529 2061 6761 696e 2e27 2727   name) again.'''
-000136b0: 0d0a 2020 2020 676c 6f62 616c 2076 6965  ..    global vie
-000136c0: 7772 6573 746f 7265 0d0a 2020 2020 7669  wrestore..    vi
-000136d0: 6577 7265 7374 6f72 6520 3d20 656e 6162  ewrestore = enab
-000136e0: 6c65 0d0a 0d0a 0d0a 6465 6620 7265 6672  le......def refr
-000136f0: 6573 6828 293a 0d0a 2020 2020 666f 7220  esh():..    for 
-00013700: 7769 6e20 696e 2077 696e 646f 7773 3a0d  win in windows:.
-00013710: 0a20 2020 2020 2020 2061 7873 203d 2077  .        axs = w
-00013720: 696e 2e61 7873 202b 205b 6178 2066 6f72  in.axs + [ax for
-00013730: 2061 7820 696e 206f 7665 726c 6179 5f61   ax in overlay_a
-00013740: 7873 2069 6620 6178 2e76 622e 7769 6e3d  xs if ax.vb.win=
-00013750: 3d77 696e 5d0d 0a20 2020 2020 2020 2066  =win]..        f
-00013760: 6f72 2061 7820 696e 2061 7873 3a0d 0a20  or ax in axs:.. 
-00013770: 2020 2020 2020 2020 2020 205f 696d 7072             _impr
-00013780: 6f76 655f 7369 676e 6966 6963 616e 7473  ove_significants
-00013790: 2861 7829 0d0a 2020 2020 2020 2020 7662  (ax)..        vb
-000137a0: 7320 3d20 5b61 782e 7662 2066 6f72 2061  s = [ax.vb for a
-000137b0: 7820 696e 2061 7873 5d0d 0a20 2020 2020  x in axs]..     
-000137c0: 2020 2066 6f72 2076 6220 696e 2076 6273     for vb in vbs
-000137d0: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
-000137e0: 622e 7072 655f 7072 6f63 6573 735f 6461  b.pre_process_da
-000137f0: 7461 2829 0d0a 2020 2020 2020 2020 6966  ta()..        if
-00013800: 2076 6965 7772 6573 746f 7265 3a0d 0a20   viewrestore:.. 
-00013810: 2020 2020 2020 2020 2020 2069 6620 5f6c             if _l
-00013820: 6f61 6477 696e 6461 7461 2877 696e 293a  oadwindata(win):
-00013830: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013840: 2020 636f 6e74 696e 7565 0d0a 2020 2020    continue..    
-00013850: 2020 2020 5f73 6574 5f6d 6178 5f7a 6f6f      _set_max_zoo
-00013860: 6d28 7662 7329 0d0a 2020 2020 2020 2020  m(vbs)..        
-00013870: 666f 7220 7662 2069 6e20 7662 733a 0d0a  for vb in vbs:..
-00013880: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00013890: 7372 6320 3d20 7662 2e64 6174 6173 7263  src = vb.datasrc
-000138a0: 5f6f 725f 7374 616e 6461 6c6f 6e65 0d0a  _or_standalone..
-000138b0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-000138c0: 6174 6173 7263 2061 6e64 2028 7662 2e6c  atasrc and (vb.l
-000138d0: 696e 6b65 6456 6965 7728 3029 2069 7320  inkedView(0) is 
-000138e0: 4e6f 6e65 206f 7220 7662 2e6c 696e 6b65  None or vb.linke
-000138f0: 6456 6965 7728 3029 2e64 6174 6173 7263  dView(0).datasrc
-00013900: 2069 7320 4e6f 6e65 206f 7220 7662 2e6d   is None or vb.m
-00013910: 6173 7465 725f 7669 6577 626f 7829 3a0d  aster_viewbox):.
-00013920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013930: 2076 622e 7570 6461 7465 5f79 5f7a 6f6f   vb.update_y_zoo
-00013940: 6d28 6461 7461 7372 632e 696e 6974 5f78  m(datasrc.init_x
-00013950: 302c 2064 6174 6173 7263 2e69 6e69 745f  0, datasrc.init_
-00013960: 7831 290d 0a20 2020 205f 7265 7061 696e  x1)..    _repain
-00013970: 745f 6361 6e64 6c65 7328 290d 0a20 2020  t_candles()..   
-00013980: 2066 6f72 206d 6420 696e 206d 6173 7465   for md in maste
-00013990: 725f 6461 7461 2e76 616c 7565 7328 293a  r_data.values():
-000139a0: 0d0a 2020 2020 2020 2020 666f 7220 7662  ..        for vb
-000139b0: 2069 6e20 6d64 3a0d 0a20 2020 2020 2020   in md:..       
-000139c0: 2020 2020 2069 6620 7479 7065 2876 6229       if type(vb)
-000139d0: 2021 3d20 7374 723a 2023 2069 676e 6f72   != str: # ignor
-000139e0: 6520 2764 6566 6175 6c74 270d 0a20 2020  e 'default'..   
-000139f0: 2020 2020 2020 2020 2020 2020 205f 6d6f               _mo
-00013a00: 7573 655f 6d6f 7665 6428 7769 6e2c 2076  use_moved(win, v
-00013a10: 622c 204e 6f6e 6529 0d0a 0d0a 0d0a 6465  b, None)......de
-00013a20: 6620 7368 6f77 2871 745f 6578 6563 3d54  f show(qt_exec=T
-00013a30: 7275 6529 3a0d 0a20 2020 2072 6566 7265  rue):..    refre
-00013a40: 7368 2829 0d0a 2020 2020 666f 7220 7769  sh()..    for wi
-00013a50: 6e20 696e 2077 696e 646f 7773 3a0d 0a20  n in windows:.. 
-00013a60: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00013a70: 616e 6365 2877 696e 2c20 4669 6e57 696e  ance(win, FinWin
-00013a80: 646f 7729 206f 7220 7174 5f65 7865 633a  dow) or qt_exec:
-00013a90: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00013aa0: 2077 696e 2e73 686f 775f 6d61 7869 6d69   win.show_maximi
-00013ab0: 7a65 643a 0d0a 2020 2020 2020 2020 2020  zed:..          
-00013ac0: 2020 2020 2020 7769 6e2e 7368 6f77 4d61        win.showMa
-00013ad0: 7869 6d69 7a65 6428 290d 0a20 2020 2020  ximized()..     
-00013ae0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00013af0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-00013b00: 6e2e 7368 6f77 2829 0d0a 2020 2020 6966  n.show()..    if
-00013b10: 2077 696e 646f 7773 2061 6e64 2071 745f   windows and qt_
-00013b20: 6578 6563 3a0d 0a20 2020 2020 2020 2067  exec:..        g
-00013b30: 6c6f 6261 6c20 6c61 7374 5f61 782c 2061  lobal last_ax, a
-00013b40: 7070 0d0a 2020 2020 2020 2020 6170 7020  pp..        app 
-00013b50: 3d20 5174 4775 692e 5147 7569 4170 706c  = QtGui.QGuiAppl
-00013b60: 6963 6174 696f 6e2e 696e 7374 616e 6365  ication.instance
-00013b70: 2829 0d0a 2020 2020 2020 2020 6170 702e  ()..        app.
-00013b80: 6578 6563 2829 0d0a 2020 2020 2020 2020  exec()..        
-00013b90: 7769 6e64 6f77 732e 636c 6561 7228 290d  windows.clear().
-00013ba0: 0a20 2020 2020 2020 206f 7665 726c 6179  .        overlay
-00013bb0: 5f61 7873 2e63 6c65 6172 2829 0d0a 2020  _axs.clear()..  
-00013bc0: 2020 2020 2020 5f63 6c65 6172 5f74 696d        _clear_tim
-00013bd0: 6572 7328 290d 0a20 2020 2020 2020 2073  ers()..        s
-00013be0: 6f75 6e64 732e 636c 6561 7228 290d 0a20  ounds.clear().. 
-00013bf0: 2020 2020 2020 206d 6173 7465 725f 6461         master_da
-00013c00: 7461 2e63 6c65 6172 2829 0d0a 2020 2020  ta.clear()..    
-00013c10: 2020 2020 6c61 7374 5f61 7820 3d20 4e6f      last_ax = No
-00013c20: 6e65 0d0a 0d0a 0d0a 6465 6620 706c 6179  ne......def play
-00013c30: 5f73 6f75 6e64 2866 696c 656e 616d 6529  _sound(filename)
-00013c40: 3a0d 0a20 2020 2069 6620 6669 6c65 6e61  :..    if filena
-00013c50: 6d65 206e 6f74 2069 6e20 736f 756e 6473  me not in sounds
-00013c60: 3a0d 0a20 2020 2020 2020 2066 726f 6d20  :..        from 
-00013c70: 5079 5174 362e 5174 4d75 6c74 696d 6564  PyQt6.QtMultimed
-00013c80: 6961 2069 6d70 6f72 7420 5153 6f75 6e64  ia import QSound
-00013c90: 4566 6665 6374 0d0a 2020 2020 2020 2020  Effect..        
-00013ca0: 7320 3d20 736f 756e 6473 5b66 696c 656e  s = sounds[filen
-00013cb0: 616d 655d 203d 2051 536f 756e 6445 6666  ame] = QSoundEff
-00013cc0: 6563 7428 2920 2320 6469 7361 6c6c 6f77  ect() # disallow
-00013cd0: 2067 630d 0a20 2020 2020 2020 2073 2e73   gc..        s.s
-00013ce0: 6574 536f 7572 6365 2851 7443 6f72 652e  etSource(QtCore.
-00013cf0: 5155 726c 2e66 726f 6d4c 6f63 616c 4669  QUrl.fromLocalFi
-00013d00: 6c65 2866 696c 656e 616d 6529 290d 0a20  le(filename)).. 
-00013d10: 2020 2073 203d 2073 6f75 6e64 735b 6669     s = sounds[fi
-00013d20: 6c65 6e61 6d65 5d0d 0a20 2020 2073 2e70  lename]..    s.p
-00013d30: 6c61 7928 290d 0a0d 0a0d 0a64 6566 2073  lay()......def s
-00013d40: 6372 6565 6e73 686f 7428 6669 6c65 2c20  creenshot(file, 
-00013d50: 666d 743d 2770 6e67 2729 3a0d 0a20 2020  fmt='png'):..   
-00013d60: 2069 6620 5f69 6e74 6572 6e61 6c5f 7769   if _internal_wi
-00013d70: 6e64 6f77 735f 6f6e 6c79 2829 2061 6e64  ndows_only() and
-00013d80: 206e 6f74 2061 7070 3a0d 0a20 2020 2020   not app:..     
-00013d90: 2020 2070 7269 6e74 2827 4552 524f 523a     print('ERROR:
-00013da0: 2073 6372 6565 6e73 686f 7420 6d75 7374   screenshot must
-00013db0: 2062 6520 6361 6c6c 6261 636b 6564 2066   be callbacked f
-00013dc0: 726f 6d20 652e 672e 2074 696d 6572 5f63  rom e.g. timer_c
-00013dd0: 616c 6c62 6163 6b28 2927 290d 0a20 2020  allback()')..   
-00013de0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00013df0: 650d 0a20 2020 2074 7279 3a0d 0a20 2020  e..    try:..   
-00013e00: 2020 2020 2062 7566 6665 7220 3d20 5174       buffer = Qt
-00013e10: 436f 7265 2e51 4275 6666 6572 2829 0d0a  Core.QBuffer()..
-00013e20: 2020 2020 2020 2020 6170 702e 7072 696d          app.prim
-00013e30: 6172 7953 6372 6565 6e28 292e 6772 6162  aryScreen().grab
-00013e40: 5769 6e64 6f77 2877 696e 646f 7773 5b30  Window(windows[0
-00013e50: 5d2e 7769 6e49 6428 2929 2e73 6176 6528  ].winId()).save(
-00013e60: 6275 6666 6572 2c20 666d 7429 0d0a 2020  buffer, fmt)..  
-00013e70: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
-00013e80: 2862 7566 6665 722e 6461 7461 2829 290d  (buffer.data()).
-00013e90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00013ea0: 5472 7565 0d0a 2020 2020 6578 6365 7074  True..    except
-00013eb0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-00013ec0: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-00013ed0: 2753 6372 6565 6e73 686f 7420 6572 726f  'Screenshot erro
-00013ee0: 723a 272c 2074 7970 6528 6529 2c20 6529  r:', type(e), e)
-00013ef0: 0d0a 2020 2020 7265 7475 726e 2046 616c  ..    return Fal
-00013f00: 7365 0d0a 0d0a 0d0a 6465 6620 6578 7065  se......def expe
-00013f10: 7269 6d65 6e74 282a 6172 6773 2c20 2a2a  riment(*args, **
-00013f20: 6b77 6172 6773 293a 0d0a 2020 2020 6966  kwargs):..    if
-00013f30: 2027 6f70 656e 676c 2720 696e 2061 7267   'opengl' in arg
-00013f40: 7320 6f72 206b 7761 7267 732e 6765 7428  s or kwargs.get(
-00013f50: 276f 7065 6e67 6c27 293a 0d0a 2020 2020  'opengl'):..    
-00013f60: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-00013f70: 2020 2020 2020 2320 7069 7020 696e 7374        # pip inst
-00013f80: 616c 6c20 5079 4f70 656e 474c 2050 794f  all PyOpenGL PyO
-00013f90: 7065 6e47 4c2d 6163 6365 6c65 7261 7465  penGL-accelerate
-00013fa0: 2074 6f20 6765 7420 7468 6973 2067 6f69   to get this goi
-00013fb0: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
-00013fc0: 696d 706f 7274 204f 7065 6e47 4c0d 0a20  import OpenGL.. 
-00013fd0: 2020 2020 2020 2020 2020 2070 672e 7365             pg.se
-00013fe0: 7443 6f6e 6669 674f 7074 696f 6e73 2875  tConfigOptions(u
-00013ff0: 7365 4f70 656e 474c 3d54 7275 652c 2065  seOpenGL=True, e
-00014000: 6e61 626c 6545 7870 6572 696d 656e 7461  nableExperimenta
-00014010: 6c3d 5472 7565 290d 0a20 2020 2020 2020  l=True)..       
-00014020: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00014030: 6e20 6173 2065 3a0d 0a20 2020 2020 2020  n as e:..       
-00014040: 2020 2020 2070 7269 6e74 2827 5741 524e       print('WARN
-00014050: 494e 473a 204f 7065 6e47 4c20 696e 6974  ING: OpenGL init
-00014060: 2065 7272 6f72 2e27 2c20 7479 7065 2865   error.', type(e
-00014070: 292c 2065 290d 0a0d 0a0d 0a23 2323 2323  ), e)......#####
-00014080: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
-00014090: 494e 5445 524e 414c 5320 2323 2323 2323  INTERNALS ######
-000140a0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-000140b0: 0d0a 0d0a 6465 6620 5f6f 7065 6e66 696c  ....def _openfil
-000140c0: 6528 2a61 7267 7329 3a0d 0a20 2020 2072  e(*args):..    r
-000140d0: 6574 7572 6e20 6f70 656e 282a 6172 6773  eturn open(*args
-000140e0: 290d 0a0d 0a0d 0a64 6566 205f 6c6f 6164  )......def _load
-000140f0: 7769 6e64 6174 6128 7769 6e29 3a0d 0a20  windata(win):.. 
-00014100: 2020 2074 7279 3a20 6f73 2e6d 6b64 6972     try: os.mkdir
-00014110: 286f 732e 7061 7468 2e65 7870 616e 6475  (os.path.expandu
-00014120: 7365 7228 277e 2f2e 6669 6e70 6c6f 7427  ser('~/.finplot'
-00014130: 2929 0d0a 2020 2020 6578 6365 7074 3a20  ))..    except: 
-00014140: 7061 7373 0d0a 2020 2020 7472 793a 0d0a  pass..    try:..
-00014150: 2020 2020 2020 2020 6620 3d20 6f73 2e70          f = os.p
-00014160: 6174 682e 6578 7061 6e64 7573 6572 2827  ath.expanduser('
-00014170: 7e2f 2e66 696e 706c 6f74 2f27 2b77 696e  ~/.finplot/'+win
-00014180: 2e74 6974 6c65 2e72 6570 6c61 6365 2827  .title.replace('
-00014190: 2f27 2c27 2d27 292b 272e 696e 6927 290d  /','-')+'.ini').
-000141a0: 0a20 2020 2020 2020 2073 6574 7469 6e67  .        setting
-000141b0: 7320 3d20 5b28 6b2e 7374 7269 7028 292c  s = [(k.strip(),
-000141c0: 6c69 7465 7261 6c5f 6576 616c 2876 2e73  literal_eval(v.s
-000141d0: 7472 6970 2829 2929 2066 6f72 206c 696e  trip())) for lin
-000141e0: 6520 696e 205f 6f70 656e 6669 6c65 2866  e in _openfile(f
-000141f0: 2920 666f 7220 6b2c 642c 7620 696e 205b  ) for k,d,v in [
-00014200: 6c69 6e65 2e70 6172 7469 7469 6f6e 2827  line.partition('
-00014210: 3d27 295d 2069 6620 765d 0d0a 2020 2020  =')] if v]..    
-00014220: 2020 2020 6966 206e 6f74 2073 6574 7469      if not setti
-00014230: 6e67 733a 0d0a 2020 2020 2020 2020 2020  ngs:..          
-00014240: 2020 7265 7475 726e 0d0a 2020 2020 6578    return..    ex
-00014250: 6365 7074 3a0d 0a20 2020 2020 2020 2072  cept:..        r
-00014260: 6574 7572 6e0d 0a20 2020 206b 7673 203d  eturn..    kvs =
-00014270: 207b 6b3a 7620 666f 7220 6b2c 7620 696e   {k:v for k,v in
-00014280: 2073 6574 7469 6e67 737d 0d0a 2020 2020   settings}..    
-00014290: 7662 7320 3d20 7365 7428 6178 2e76 6220  vbs = set(ax.vb 
-000142a0: 666f 7220 6178 2069 6e20 7769 6e2e 6178  for ax in win.ax
-000142b0: 7329 0d0a 2020 2020 7a6f 6f6d 5f73 6574  s)..    zoom_set
-000142c0: 203d 2046 616c 7365 0d0a 2020 2020 666f   = False..    fo
-000142d0: 7220 7662 2069 6e20 7662 733a 0d0a 2020  r vb in vbs:..  
-000142e0: 2020 2020 2020 6473 203d 2076 622e 6461        ds = vb.da
-000142f0: 7461 7372 630d 0a20 2020 2020 2020 2069  tasrc..        i
-00014300: 6620 6473 2061 6e64 2028 7662 2e6c 696e  f ds and (vb.lin
-00014310: 6b65 6456 6965 7728 3029 2069 7320 4e6f  kedView(0) is No
-00014320: 6e65 206f 7220 7662 2e6c 696e 6b65 6456  ne or vb.linkedV
-00014330: 6965 7728 3029 2e64 6174 6173 7263 2069  iew(0).datasrc i
-00014340: 7320 4e6f 6e65 206f 7220 7662 2e6d 6173  s None or vb.mas
-00014350: 7465 725f 7669 6577 626f 7829 3a0d 0a20  ter_viewbox):.. 
-00014360: 2020 2020 2020 2020 2020 2070 6572 696f             perio
-00014370: 645f 6e73 203d 2064 732e 7065 7269 6f64  d_ns = ds.period
-00014380: 5f6e 730d 0a20 2020 2020 2020 2020 2020  _ns..           
-00014390: 2069 6620 6b76 735b 276d 696e 5f78 275d   if kvs['min_x']
-000143a0: 203e 3d20 6473 2e78 2e69 6c6f 635b 305d   >= ds.x.iloc[0]
-000143b0: 2d70 6572 696f 645f 6e73 2061 6e64 206b  -period_ns and k
-000143c0: 7673 5b27 6d61 785f 7827 5d20 3c3d 2064  vs['max_x'] <= d
-000143d0: 732e 782e 696c 6f63 5b2d 315d 2b70 6572  s.x.iloc[-1]+per
-000143e0: 696f 645f 6e73 3a0d 0a20 2020 2020 2020  iod_ns:..       
-000143f0: 2020 2020 2020 2020 2078 302c 7831 203d           x0,x1 =
-00014400: 2064 732e 782e 6c6f 635b 6473 2e78 3e3d   ds.x.loc[ds.x>=
-00014410: 6b76 735b 276d 696e 5f78 275d 5d2e 696e  kvs['min_x']].in
-00014420: 6465 785b 305d 2c20 6473 2e78 2e6c 6f63  dex[0], ds.x.loc
-00014430: 5b64 732e 783c 3d6b 7673 5b27 6d61 785f  [ds.x<=kvs['max_
-00014440: 7827 5d5d 2e69 6e64 6578 5b2d 315d 0d0a  x']].index[-1]..
-00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014460: 6966 2078 3120 3d3d 206c 656e 2864 732e  if x1 == len(ds.
-00014470: 7829 2d31 3a0d 0a20 2020 2020 2020 2020  x)-1:..         
-00014480: 2020 2020 2020 2020 2020 2078 3120 2b3d             x1 +=
-00014490: 2072 6967 6874 5f6d 6172 6769 6e5f 6361   right_margin_ca
-000144a0: 6e64 6c65 730d 0a20 2020 2020 2020 2020  ndles..         
-000144b0: 2020 2020 2020 2078 3120 2b3d 2030 2e35         x1 += 0.5
-000144c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000144d0: 2020 7a6f 6f6d 5f73 6574 203d 2076 622e    zoom_set = vb.
-000144e0: 7570 6461 7465 5f79 5f7a 6f6f 6d28 7830  update_y_zoom(x0
-000144f0: 2c20 7831 290d 0a20 2020 2072 6574 7572  , x1)..    retur
-00014500: 6e20 7a6f 6f6d 5f73 6574 0d0a 0d0a 0d0a  n zoom_set......
-00014510: 6465 6620 5f73 6176 6577 696e 6461 7461  def _savewindata
-00014520: 2877 696e 293a 0d0a 2020 2020 6966 206e  (win):..    if n
-00014530: 6f74 2076 6965 7772 6573 746f 7265 3a0d  ot viewrestore:.
-00014540: 0a20 2020 2020 2020 2072 6574 7572 6e0d  .        return.
-00014550: 0a20 2020 2074 7279 3a0d 0a20 2020 2020  .    try:..     
-00014560: 2020 206d 696e 5f78 203d 2069 6e74 2831     min_x = int(1
-00014570: 6531 3030 290d 0a20 2020 2020 2020 206d  e100)..        m
-00014580: 6178 5f78 203d 2069 6e74 282d 3165 3130  ax_x = int(-1e10
-00014590: 3029 0d0a 2020 2020 2020 2020 666f 7220  0)..        for 
-000145a0: 6178 2069 6e20 7769 6e2e 6178 733a 0d0a  ax in win.axs:..
-000145b0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-000145c0: 782e 7662 2e74 6172 6765 7452 6563 7428  x.vb.targetRect(
-000145d0: 292e 7269 6768 7428 2920 3c20 343a 2023  ).right() < 4: #
-000145e0: 2069 676e 6f72 6520 656d 7074 7920 706c   ignore empty pl
-000145f0: 6f74 730d 0a20 2020 2020 2020 2020 2020  ots..           
-00014600: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
-00014610: 2020 2020 2020 2020 2020 2069 6620 6178             if ax
-00014620: 2e76 622e 6461 7461 7372 6320 6973 204e  .vb.datasrc is N
-00014630: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00014640: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
-00014650: 2020 2020 2020 2020 2020 2020 7430 2c74              t0,t
-00014660: 312c 5f2c 5f2c 5f20 3d20 6178 2e76 622e  1,_,_,_ = ax.vb.
-00014670: 6461 7461 7372 632e 6869 6c6f 2861 782e  datasrc.hilo(ax.
-00014680: 7662 2e74 6172 6765 7452 6563 7428 292e  vb.targetRect().
-00014690: 6c65 6674 2829 2c20 6178 2e76 622e 7461  left(), ax.vb.ta
-000146a0: 7267 6574 5265 6374 2829 2e72 6967 6874  rgetRect().right
-000146b0: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
-000146c0: 206d 696e 5f78 203d 206e 702e 6e61 6e6d   min_x = np.nanm
-000146d0: 696e 285b 6d69 6e5f 782c 2074 305d 290d  in([min_x, t0]).
-000146e0: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
-000146f0: 5f78 203d 206e 702e 6e61 6e6d 6178 285b  _x = np.nanmax([
-00014700: 6d61 785f 782c 2074 315d 290d 0a20 2020  max_x, t1])..   
-00014710: 2020 2020 2069 6620 6e70 2e6d 6178 286e       if np.max(n
-00014720: 702e 6162 7328 5b6d 696e 5f78 2c20 6d61  p.abs([min_x, ma
-00014730: 785f 785d 2929 203c 2031 6539 393a 0d0a  x_x])) < 1e99:..
-00014740: 2020 2020 2020 2020 2020 2020 7320 3d20              s = 
-00014750: 276d 696e 5f78 203d 2025 735c 6e6d 6178  'min_x = %s\nmax
-00014760: 5f78 203d 2025 735c 6e27 2025 2028 6d69  _x = %s\n' % (mi
-00014770: 6e5f 782c 206d 6178 5f78 290d 0a20 2020  n_x, max_x)..   
-00014780: 2020 2020 2020 2020 2066 203d 206f 732e           f = os.
-00014790: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-000147a0: 277e 2f2e 6669 6e70 6c6f 742f 272b 7769  '~/.finplot/'+wi
-000147b0: 6e2e 7469 746c 652e 7265 706c 6163 6528  n.title.replace(
-000147c0: 272f 272c 272d 2729 2b27 2e69 6e69 2729  '/','-')+'.ini')
-000147d0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-000147e0: 793a 2063 6861 6e67 6564 203d 205f 6f70  y: changed = _op
-000147f0: 656e 6669 6c65 2866 292e 7265 6164 2829  enfile(f).read()
-00014800: 2021 3d20 730d 0a20 2020 2020 2020 2020   != s..         
-00014810: 2020 2065 7863 6570 743a 2063 6861 6e67     except: chang
-00014820: 6564 203d 2054 7275 650d 0a20 2020 2020  ed = True..     
-00014830: 2020 2020 2020 2069 6620 6368 616e 6765         if change
-00014840: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00014850: 2020 2020 5f6f 7065 6e66 696c 6528 662c      _openfile(f,
-00014860: 2027 7774 2729 2e77 7269 7465 2873 290d   'wt').write(s).
-00014870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014880: 2023 2320 7072 696e 7428 2725 7320 7361   ## print('%s sa
-00014890: 7665 6427 2025 2077 696e 2e74 6974 6c65  ved' % win.title
-000148a0: 290d 0a20 2020 2065 7863 6570 7420 4578  )..    except Ex
-000148b0: 6365 7074 696f 6e20 6173 2065 3a0d 0a20  ception as e:.. 
-000148c0: 2020 2020 2020 2070 7269 6e74 2827 4572         print('Er
-000148d0: 726f 7220 7361 7669 6e67 2070 6c6f 743a  ror saving plot:
-000148e0: 272c 2065 290d 0a0d 0a0d 0a64 6566 205f  ', e)......def _
-000148f0: 696e 7465 726e 616c 5f77 696e 646f 7773  internal_windows
-00014900: 5f6f 6e6c 7928 293a 0d0a 2020 2020 2072  _only():..     r
-00014910: 6574 7572 6e20 616c 6c28 6973 696e 7374  eturn all(isinst
-00014920: 616e 6365 2877 696e 2c46 696e 5769 6e64  ance(win,FinWind
-00014930: 6f77 2920 666f 7220 7769 6e20 696e 2077  ow) for win in w
-00014940: 696e 646f 7773 290d 0a0d 0a0d 0a64 6566  indows)......def
-00014950: 205f 6372 6561 7465 5f70 6c6f 7428 6178   _create_plot(ax
-00014960: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
-00014970: 3a0d 0a20 2020 2069 6620 6178 3a0d 0a20  :..    if ax:.. 
-00014980: 2020 2020 2020 2072 6574 7572 6e20 6178         return ax
-00014990: 0d0a 2020 2020 6966 206c 6173 745f 6178  ..    if last_ax
-000149a0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-000149b0: 6e20 6c61 7374 5f61 780d 0a20 2020 2072  n last_ax..    r
-000149c0: 6574 7572 6e20 6372 6561 7465 5f70 6c6f  eturn create_plo
-000149d0: 7428 2a2a 6b77 6172 6773 290d 0a0d 0a0d  t(**kwargs).....
-000149e0: 0a64 6566 205f 6372 6561 7465 5f61 7869  .def _create_axi
-000149f0: 7328 706f 732c 202a 2a6b 7761 7267 7329  s(pos, **kwargs)
-00014a00: 3a0d 0a20 2020 2069 6620 706f 7320 3d3d  :..    if pos ==
-00014a10: 2027 7827 3a0d 0a20 2020 2020 2020 2072   'x':..        r
-00014a20: 6574 7572 6e20 4570 6f63 6841 7869 7349  eturn EpochAxisI
-00014a30: 7465 6d28 2a2a 6b77 6172 6773 290d 0a20  tem(**kwargs).. 
-00014a40: 2020 2065 6c69 6620 706f 7320 3d3d 2027     elif pos == '
-00014a50: 7927 3a0d 0a20 2020 2020 2020 2072 6574  y':..        ret
-00014a60: 7572 6e20 5941 7869 7349 7465 6d28 2a2a  urn YAxisItem(**
-00014a70: 6b77 6172 6773 290d 0a0d 0a0d 0a64 6566  kwargs)......def
-00014a80: 205f 636c 6561 725f 7469 6d65 7273 2829   _clear_timers()
-00014a90: 3a0d 0a20 2020 2066 6f72 2074 696d 6572  :..    for timer
-00014aa0: 2069 6e20 7469 6d65 7273 3a0d 0a20 2020   in timers:..   
-00014ab0: 2020 2020 2074 696d 6572 2e74 696d 656f       timer.timeo
-00014ac0: 7574 2e64 6973 636f 6e6e 6563 7428 290d  ut.disconnect().
-00014ad0: 0a20 2020 2074 696d 6572 732e 636c 6561  .    timers.clea
-00014ae0: 7228 290d 0a0d 0a0d 0a64 6566 205f 6164  r()......def _ad
-00014af0: 645f 7469 6d65 7374 616d 705f 706c 6f74  d_timestamp_plot
-00014b00: 286d 6173 7465 722c 2070 7265 765f 6178  (master, prev_ax
-00014b10: 2c20 7669 6577 626f 782c 2069 6e64 6578  , viewbox, index
-00014b20: 2c20 7973 6361 6c65 293a 0d0a 2020 2020  , yscale):..    
-00014b30: 6e61 7469 7665 5f77 696e 203d 2069 7369  native_win = isi
-00014b40: 6e73 7461 6e63 6528 6d61 7374 6572 2c20  nstance(master, 
-00014b50: 7067 2e47 7261 7068 6963 734c 6179 6f75  pg.GraphicsLayou
-00014b60: 7457 6964 6765 7429 0d0a 2020 2020 6966  tWidget)..    if
-00014b70: 206e 6174 6976 655f 7769 6e20 616e 6420   native_win and 
-00014b80: 7072 6576 5f61 7820 6973 206e 6f74 204e  prev_ax is not N
-00014b90: 6f6e 653a 0d0a 2020 2020 2020 2020 7072  one:..        pr
-00014ba0: 6576 5f61 782e 7365 745f 7669 7369 626c  ev_ax.set_visibl
-00014bb0: 6528 7861 7869 733d 4661 6c73 6529 2023  e(xaxis=False) #
-00014bc0: 2068 6964 6520 7468 6520 7768 6f6c 6520   hide the whole 
-00014bd0: 7072 6576 696f 7573 2061 7869 730d 0a20  previous axis.. 
-00014be0: 2020 2061 7865 7320 3d20 7b27 626f 7474     axes = {'bott
-00014bf0: 6f6d 273a 205f 6372 6561 7465 5f61 7869  om': _create_axi
-00014c00: 7328 706f 733d 2778 272c 2076 623d 7669  s(pos='x', vb=vi
-00014c10: 6577 626f 782c 206f 7269 656e 7461 7469  ewbox, orientati
-00014c20: 6f6e 3d27 626f 7474 6f6d 2729 2c0d 0a20  on='bottom'),.. 
-00014c30: 2020 2020 2020 2020 2020 2027 7269 6768             'righ
-00014c40: 7427 3a20 205f 6372 6561 7465 5f61 7869  t':  _create_axi
-00014c50: 7328 706f 733d 2779 272c 2076 623d 7669  s(pos='y', vb=vi
-00014c60: 6577 626f 782c 206f 7269 656e 7461 7469  ewbox, orientati
-00014c70: 6f6e 3d27 7269 6768 7427 297d 0d0a 2020  on='right')}..  
-00014c80: 2020 6966 206e 6174 6976 655f 7769 6e3a    if native_win:
-00014c90: 0d0a 2020 2020 2020 2020 6178 203d 2070  ..        ax = p
-00014ca0: 672e 506c 6f74 4974 656d 2876 6965 7742  g.PlotItem(viewB
-00014cb0: 6f78 3d76 6965 7762 6f78 2c20 6178 6973  ox=viewbox, axis
-00014cc0: 4974 656d 733d 6178 6573 2c20 6e61 6d65  Items=axes, name
-00014cd0: 3d27 706c 6f74 2d25 6927 2569 6e64 6578  ='plot-%i'%index
-00014ce0: 2c20 656e 6162 6c65 4d65 6e75 3d46 616c  , enableMenu=Fal
-00014cf0: 7365 290d 0a20 2020 2065 6c73 653a 0d0a  se)..    else:..
-00014d00: 2020 2020 2020 2020 6178 7720 3d20 7067          axw = pg
-00014d10: 2e50 6c6f 7457 6964 6765 7428 7669 6577  .PlotWidget(view
-00014d20: 426f 783d 7669 6577 626f 782c 2061 7869  Box=viewbox, axi
-00014d30: 7349 7465 6d73 3d61 7865 732c 206e 616d  sItems=axes, nam
-00014d40: 653d 2770 6c6f 742d 2569 2725 696e 6465  e='plot-%i'%inde
-00014d50: 782c 2065 6e61 626c 654d 656e 753d 4661  x, enableMenu=Fa
-00014d60: 6c73 6529 0d0a 2020 2020 2020 2020 6178  lse)..        ax
-00014d70: 203d 2061 7877 2e70 6c6f 7449 7465 6d0d   = axw.plotItem.
-00014d80: 0a20 2020 2020 2020 2061 782e 6178 5f77  .        ax.ax_w
-00014d90: 6964 6765 7420 3d20 6178 770d 0a20 2020  idget = axw..   
-00014da0: 2061 782e 7365 7443 6c69 7054 6f56 6965   ax.setClipToVie
-00014db0: 7728 5472 7565 290d 0a20 2020 2061 782e  w(True)..    ax.
-00014dc0: 7365 7444 6f77 6e73 616d 706c 696e 6728  setDownsampling(
-00014dd0: 6175 746f 3d54 7275 652c 206d 6f64 653d  auto=True, mode=
-00014de0: 2773 7562 7361 6d70 6c65 2729 0d0a 2020  'subsample')..  
-00014df0: 2020 6178 2e68 6964 6541 7869 7328 276c    ax.hideAxis('l
-00014e00: 6566 7427 290d 0a20 2020 2069 6620 795f  eft')..    if y_
-00014e10: 6c61 6265 6c5f 7769 6474 683a 0d0a 2020  label_width:..  
-00014e20: 2020 2020 2020 6178 2e61 7865 735b 2772        ax.axes['r
-00014e30: 6967 6874 275d 5b27 6974 656d 275d 2e73  ight']['item'].s
-00014e40: 6574 5769 6474 6828 795f 6c61 6265 6c5f  etWidth(y_label_
-00014e50: 7769 6474 6829 2023 2074 6869 7320 6973  width) # this is
-00014e60: 2074 6f20 7075 7420 616c 6c20 6772 6170   to put all grap
-00014e70: 6873 206f 6e20 6571 7561 6c20 666f 6f74  hs on equal foot
-00014e80: 696e 6720 7768 656e 2074 6578 7473 2076  ing when texts v
-00014e90: 6172 7920 6672 6f6d 2030 2e34 2074 6f20  ary from 0.4 to 
-00014ea0: 3230 3030 3030 300d 0a20 2020 2061 782e  2000000..    ax.
-00014eb0: 6178 6573 5b27 7269 6768 7427 5d5b 2769  axes['right']['i
-00014ec0: 7465 6d27 5d2e 7365 7453 7479 6c65 2874  tem'].setStyle(t
-00014ed0: 6963 6b4c 656e 6774 683d 2d35 2920 2320  ickLength=-5) # 
-00014ee0: 736f 6d65 2062 7567 2c20 746f 7461 6c6c  some bug, totall
-00014ef0: 7920 756e 6578 706c 6963 6162 6c65 2028  y unexplicable (
-00014f00: 7768 7920 7365 7474 696e 6720 7468 6520  why setting the 
-00014f10: 6465 6661 756c 7420 7661 6c75 6520 6167  default value ag
-00014f20: 6169 6e20 776f 756c 6420 6669 7820 7265  ain would fix re
-00014f30: 7061 696e 7420 7769 6474 6820 6173 2061  paint width as a
-00014f40: 7869 7320 7363 616c 6520 646f 776e 290d  xis scale down).
-00014f50: 0a20 2020 2061 782e 6178 6573 5b27 7269  .    ax.axes['ri
-00014f60: 6768 7427 5d5b 2769 7465 6d27 5d2e 7365  ght']['item'].se
-00014f70: 745a 5661 6c75 6528 3330 2920 2320 7075  tZValue(30) # pu
-00014f80: 7420 6178 6973 2069 6e20 6672 6f6e 7420  t axis in front 
-00014f90: 696e 7374 6561 6420 6f66 2062 6568 696e  instead of behin
-00014fa0: 6420 6461 7461 0d0a 2020 2020 6178 2e61  d data..    ax.a
-00014fb0: 7865 735b 2762 6f74 746f 6d27 5d5b 2769  xes['bottom']['i
-00014fc0: 7465 6d27 5d2e 7365 745a 5661 6c75 6528  tem'].setZValue(
-00014fd0: 3330 290d 0a20 2020 2061 782e 7365 744c  30)..    ax.setL
-00014fe0: 6f67 4d6f 6465 2879 3d28 7973 6361 6c65  ogMode(y=(yscale
-00014ff0: 2e73 6361 6c65 7479 7065 3d3d 276c 6f67  .scaletype=='log
-00015000: 2729 290d 0a20 2020 2061 782e 7369 676e  '))..    ax.sign
-00015010: 6966 6963 616e 745f 666f 7263 6564 203d  ificant_forced =
-00015020: 2046 616c 7365 0d0a 2020 2020 6178 2e73   False..    ax.s
-00015030: 6967 6e69 6669 6361 6e74 5f64 6563 696d  ignificant_decim
-00015040: 616c 7320 3d20 7369 676e 6966 6963 616e  als = significan
-00015050: 745f 6465 6369 6d61 6c73 0d0a 2020 2020  t_decimals..    
-00015060: 6178 2e73 6967 6e69 6669 6361 6e74 5f65  ax.significant_e
-00015070: 7073 203d 2073 6967 6e69 6669 6361 6e74  ps = significant
-00015080: 5f65 7073 0d0a 2020 2020 6178 2e69 6e76  _eps..    ax.inv
-00015090: 6572 7465 6420 3d20 4661 6c73 650d 0a20  erted = False.. 
-000150a0: 2020 2061 782e 6178 6f73 203d 205b 5d0d     ax.axos = [].
-000150b0: 0a20 2020 2061 782e 6372 6f73 7368 6169  .    ax.crosshai
-000150c0: 7220 3d20 4669 6e43 726f 7373 4861 6972  r = FinCrossHair
-000150d0: 2861 782c 2063 6f6c 6f72 3d63 726f 7373  (ax, color=cross
-000150e0: 5f68 6169 725f 636f 6c6f 7229 0d0a 2020  _hair_color)..  
-000150f0: 2020 6178 2e68 6964 6542 7574 746f 6e73    ax.hideButtons
-00015100: 2829 0d0a 2020 2020 6178 2e6f 7665 726c  ()..    ax.overl
-00015110: 6179 203d 2070 6172 7469 616c 285f 6178  ay = partial(_ax
-00015120: 5f6f 7665 726c 6179 2c20 6178 290d 0a20  _overlay, ax).. 
-00015130: 2020 2061 782e 7365 745f 7669 7369 626c     ax.set_visibl
-00015140: 6520 3d20 7061 7274 6961 6c28 5f61 785f  e = partial(_ax_
-00015150: 7365 745f 7669 7369 626c 652c 2061 7829  set_visible, ax)
-00015160: 0d0a 2020 2020 6178 2e64 6563 6f75 706c  ..    ax.decoupl
-00015170: 6520 3d20 7061 7274 6961 6c28 5f61 785f  e = partial(_ax_
-00015180: 6465 636f 7570 6c65 2c20 6178 290d 0a20  decouple, ax).. 
-00015190: 2020 2061 782e 6469 7361 626c 655f 785f     ax.disable_x_
-000151a0: 696e 6465 7820 3d20 7061 7274 6961 6c28  index = partial(
-000151b0: 5f61 785f 6469 7361 626c 655f 785f 696e  _ax_disable_x_in
-000151c0: 6465 782c 2061 7829 0d0a 2020 2020 6178  dex, ax)..    ax
-000151d0: 2e72 6573 6574 203d 2070 6172 7469 616c  .reset = partial
-000151e0: 285f 6178 5f72 6573 6574 2c20 6178 290d  (_ax_reset, ax).
-000151f0: 0a20 2020 2061 782e 696e 7665 7274 5f79  .    ax.invert_y
-00015200: 203d 2070 6172 7469 616c 285f 6178 5f69   = partial(_ax_i
-00015210: 6e76 6572 745f 792c 2061 7829 0d0a 2020  nvert_y, ax)..  
-00015220: 2020 6178 2e65 7870 616e 6420 3d20 7061    ax.expand = pa
-00015230: 7274 6961 6c28 5f61 785f 6578 7061 6e64  rtial(_ax_expand
-00015240: 2c20 6178 290d 0a20 2020 2061 782e 7072  , ax)..    ax.pr
-00015250: 6576 5f61 7820 3d20 7072 6576 5f61 780d  ev_ax = prev_ax.
-00015260: 0a20 2020 2061 782e 7769 6e5f 696e 6465  .    ax.win_inde
-00015270: 7820 3d20 696e 6465 780d 0a20 2020 2069  x = index..    i
-00015280: 6620 696e 6465 7825 323a 0d0a 2020 2020  f index%2:..    
-00015290: 2020 2020 7669 6577 626f 782e 7365 7442      viewbox.setB
-000152a0: 6163 6b67 726f 756e 6443 6f6c 6f72 286f  ackgroundColor(o
-000152b0: 6464 5f70 6c6f 745f 6261 636b 6772 6f75  dd_plot_backgrou
-000152c0: 6e64 290d 0a20 2020 2076 6965 7762 6f78  nd)..    viewbox
-000152d0: 2e73 6574 5061 7265 6e74 2861 7829 0d0a  .setParent(ax)..
-000152e0: 2020 2020 7265 7475 726e 2061 780d 0a0d      return ax...
-000152f0: 0a0d 0a64 6566 205f 6178 5f6f 7665 726c  ...def _ax_overl
-00015300: 6179 2861 782c 2073 6361 6c65 3d30 2e32  ay(ax, scale=0.2
-00015310: 352c 2079 6178 6973 3d46 616c 7365 293a  5, yaxis=False):
-00015320: 0d0a 2020 2020 2727 2754 6865 2073 6361  ..    '''The sca
-00015330: 6c65 2070 6172 616d 6574 6572 2064 6566  le parameter def
-00015340: 696e 6573 2068 6f77 2022 6869 6768 2075  ines how "high u
-00015350: 7022 206f 6e20 7468 6520 696e 6974 6961  p" on the initia
-00015360: 6c20 706c 6f74 2074 6869 7320 6f76 6572  l plot this over
-00015370: 6c61 7920 7769 6c6c 2073 686f 772e 0d0a  lay will show...
-00015380: 2020 2020 2020 2054 6865 2079 6178 6973         The yaxis
-00015390: 2070 6172 616d 6574 6572 2063 616e 2062   parameter can b
-000153a0: 6520 6f6e 6520 6f66 205b 4661 6c73 652c  e one of [False,
-000153b0: 2027 6c69 6e65 6172 272c 2027 6c6f 6727   'linear', 'log'
-000153c0: 5d2e 2727 270d 0a20 2020 2079 7363 616c  ].'''..    yscal
-000153d0: 6520 3d20 7961 7869 7320 6966 2079 6178  e = yaxis if yax
-000153e0: 6973 2065 6c73 6520 276c 696e 6561 7227  is else 'linear'
-000153f0: 0d0a 2020 2020 7669 6577 626f 7820 3d20  ..    viewbox = 
-00015400: 4669 6e56 6965 7742 6f78 2861 782e 7662  FinViewBox(ax.vb
-00015410: 2e77 696e 2c20 696e 6974 5f73 7465 7073  .win, init_steps
-00015420: 3d61 782e 7662 2e69 6e69 745f 7374 6570  =ax.vb.init_step
-00015430: 732c 2079 7363 616c 653d 5953 6361 6c65  s, yscale=YScale
-00015440: 2879 7363 616c 652c 2031 292c 2065 6e61  (yscale, 1), ena
-00015450: 626c 654d 656e 753d 4661 6c73 6529 0d0a  bleMenu=False)..
-00015460: 2020 2020 7669 6577 626f 782e 6d61 7374      viewbox.mast
-00015470: 6572 5f76 6965 7762 6f78 203d 2061 782e  er_viewbox = ax.
-00015480: 7662 0d0a 2020 2020 7669 6577 626f 782e  vb..    viewbox.
-00015490: 7365 745a 5661 6c75 6528 2d35 290d 0a20  setZValue(-5).. 
-000154a0: 2020 2076 6965 7762 6f78 2e73 6574 4261     viewbox.setBa
-000154b0: 636b 6772 6f75 6e64 436f 6c6f 7228 6178  ckgroundColor(ax
-000154c0: 2e76 622e 7374 6174 655b 2762 6163 6b67  .vb.state['backg
-000154d0: 726f 756e 6427 5d29 0d0a 2020 2020 6178  round'])..    ax
-000154e0: 2e76 622e 7365 7442 6163 6b67 726f 756e  .vb.setBackgroun
-000154f0: 6443 6f6c 6f72 284e 6f6e 6529 0d0a 2020  dColor(None)..  
-00015500: 2020 7669 6577 626f 782e 765f 7a6f 6f6d    viewbox.v_zoom
-00015510: 5f73 6361 6c65 203d 2073 6361 6c65 0d0a  _scale = scale..
-00015520: 2020 2020 6966 2068 6173 6174 7472 2861      if hasattr(a
-00015530: 782c 2027 6178 5f77 6964 6765 7427 293a  x, 'ax_widget'):
-00015540: 0d0a 2020 2020 2020 2020 6178 2e61 785f  ..        ax.ax_
-00015550: 7769 6467 6574 2e73 6365 6e65 2829 2e61  widget.scene().a
-00015560: 6464 4974 656d 2876 6965 7762 6f78 290d  ddItem(viewbox).
-00015570: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
-00015580: 2020 2020 6178 2e76 622e 7769 6e2e 6365      ax.vb.win.ce
-00015590: 6e74 7261 6c57 6964 6765 742e 7363 656e  ntralWidget.scen
-000155a0: 6528 292e 6164 6449 7465 6d28 7669 6577  e().addItem(view
-000155b0: 626f 7829 0d0a 2020 2020 7669 6577 626f  box)..    viewbo
-000155c0: 782e 7365 7458 4c69 6e6b 2861 782e 7662  x.setXLink(ax.vb
-000155d0: 290d 0a20 2020 2064 6566 2075 7064 6174  )..    def updat
-000155e0: 6556 6965 7728 293a 0d0a 2020 2020 2020  eView():..      
-000155f0: 2020 7669 6577 626f 782e 7365 7447 656f    viewbox.setGeo
-00015600: 6d65 7472 7928 6178 2e76 622e 7363 656e  metry(ax.vb.scen
-00015610: 6542 6f75 6e64 696e 6752 6563 7428 2929  eBoundingRect())
-00015620: 0d0a 2020 2020 6178 6f20 3d20 7067 2e50  ..    axo = pg.P
-00015630: 6c6f 7449 7465 6d28 656e 6162 6c65 4d65  lotItem(enableMe
-00015640: 6e75 3d46 616c 7365 290d 0a20 2020 2061  nu=False)..    a
-00015650: 786f 2e73 6967 6e69 6669 6361 6e74 5f66  xo.significant_f
-00015660: 6f72 6365 6420 3d20 4661 6c73 650d 0a20  orced = False.. 
-00015670: 2020 2061 786f 2e73 6967 6e69 6669 6361     axo.significa
-00015680: 6e74 5f64 6563 696d 616c 7320 3d20 7369  nt_decimals = si
-00015690: 676e 6966 6963 616e 745f 6465 6369 6d61  gnificant_decima
-000156a0: 6c73 0d0a 2020 2020 6178 6f2e 7369 676e  ls..    axo.sign
-000156b0: 6966 6963 616e 745f 6570 7320 3d20 7369  ificant_eps = si
-000156c0: 676e 6966 6963 616e 745f 6570 730d 0a20  gnificant_eps.. 
-000156d0: 2020 2061 786f 2e70 7265 765f 6178 203d     axo.prev_ax =
-000156e0: 204e 6f6e 650d 0a20 2020 2061 786f 2e63   None..    axo.c
-000156f0: 726f 7373 6861 6972 203d 204e 6f6e 650d  rosshair = None.
-00015700: 0a20 2020 2061 786f 2e64 6563 6f75 706c  .    axo.decoupl
-00015710: 6520 3d20 7061 7274 6961 6c28 5f61 785f  e = partial(_ax_
-00015720: 6465 636f 7570 6c65 2c20 6178 6f29 0d0a  decouple, axo)..
-00015730: 2020 2020 6178 6f2e 6469 7361 626c 655f      axo.disable_
-00015740: 785f 696e 6465 7820 3d20 7061 7274 6961  x_index = partia
-00015750: 6c28 5f61 785f 6469 7361 626c 655f 785f  l(_ax_disable_x_
-00015760: 696e 6465 782c 2061 786f 290d 0a20 2020  index, axo)..   
-00015770: 2061 786f 2e72 6573 6574 203d 2070 6172   axo.reset = par
-00015780: 7469 616c 285f 6178 5f72 6573 6574 2c20  tial(_ax_reset, 
-00015790: 6178 6f29 0d0a 2020 2020 6178 6f2e 6869  axo)..    axo.hi
-000157a0: 6465 4178 6973 2827 6c65 6674 2729 0d0a  deAxis('left')..
-000157b0: 2020 2020 6178 6f2e 6869 6465 4178 6973      axo.hideAxis
-000157c0: 2827 7269 6768 7427 290d 0a20 2020 2061  ('right')..    a
-000157d0: 786f 2e68 6964 6541 7869 7328 2762 6f74  xo.hideAxis('bot
-000157e0: 746f 6d27 290d 0a20 2020 2061 786f 2e68  tom')..    axo.h
-000157f0: 6964 6542 7574 746f 6e73 2829 0d0a 2020  ideButtons()..  
-00015800: 2020 7669 6577 626f 782e 6164 6449 7465    viewbox.addIte
-00015810: 6d28 6178 6f29 0d0a 2020 2020 6178 6f2e  m(axo)..    axo.
-00015820: 7662 203d 2076 6965 7762 6f78 0d0a 2020  vb = viewbox..  
-00015830: 2020 6966 2079 6178 6973 2061 6e64 2069    if yaxis and i
-00015840: 7369 6e73 7461 6e63 6528 6178 6f2e 7662  sinstance(axo.vb
-00015850: 2e77 696e 2c20 7067 2e47 7261 7068 6963  .win, pg.Graphic
-00015860: 734c 6179 6f75 7457 6964 6765 7429 3a0d  sLayoutWidget):.
-00015870: 0a20 2020 2020 2020 2061 7869 203d 205f  .        axi = _
-00015880: 6372 6561 7465 5f61 7869 7328 706f 733d  create_axis(pos=
-00015890: 2779 272c 2076 623d 6178 6f2e 7662 2c20  'y', vb=axo.vb, 
-000158a0: 6f72 6965 6e74 6174 696f 6e3d 276c 6566  orientation='lef
-000158b0: 7427 290d 0a20 2020 2020 2020 2061 786f  t')..        axo
-000158c0: 2e73 6574 4178 6973 4974 656d 7328 7b27  .setAxisItems({'
-000158d0: 6c65 6674 273a 2061 7869 7d29 0d0a 2020  left': axi})..  
-000158e0: 2020 2020 2020 6178 6f2e 7662 2e77 696e        axo.vb.win
-000158f0: 2e61 6464 4974 656d 2861 7869 2c20 726f  .addItem(axi, ro
-00015900: 773d 302c 2063 6f6c 3d30 290d 0a20 2020  w=0, col=0)..   
-00015910: 2061 782e 7662 2e73 6967 5265 7369 7a65   ax.vb.sigResize
-00015920: 642e 636f 6e6e 6563 7428 7570 6461 7465  d.connect(update
-00015930: 5669 6577 290d 0a20 2020 206f 7665 726c  View)..    overl
-00015940: 6179 5f61 7873 2e61 7070 656e 6428 6178  ay_axs.append(ax
-00015950: 6f29 0d0a 2020 2020 6178 2e61 786f 732e  o)..    ax.axos.
-00015960: 6170 7065 6e64 2861 786f 290d 0a20 2020  append(axo)..   
-00015970: 2075 7064 6174 6556 6965 7728 290d 0a20   updateView().. 
-00015980: 2020 2072 6574 7572 6e20 6178 6f0d 0a0d     return axo...
-00015990: 0a0d 0a64 6566 205f 6178 5f73 6574 5f76  ...def _ax_set_v
-000159a0: 6973 6962 6c65 2861 782c 2063 726f 7373  isible(ax, cross
-000159b0: 6861 6972 3d4e 6f6e 652c 2078 6178 6973  hair=None, xaxis
-000159c0: 3d4e 6f6e 652c 2079 6178 6973 3d4e 6f6e  =None, yaxis=Non
-000159d0: 652c 2078 6772 6964 3d4e 6f6e 652c 2079  e, xgrid=None, y
-000159e0: 6772 6964 3d4e 6f6e 6529 3a0d 0a20 2020  grid=None):..   
-000159f0: 2069 6620 6372 6f73 7368 6169 7220 3d3d   if crosshair ==
-00015a00: 2046 616c 7365 3a0d 0a20 2020 2020 2020   False:..       
-00015a10: 2061 782e 6372 6f73 7368 6169 722e 6869   ax.crosshair.hi
-00015a20: 6465 2829 0d0a 2020 2020 6966 2078 6178  de()..    if xax
-00015a30: 6973 2069 7320 6e6f 7420 4e6f 6e65 3a0d  is is not None:.
-00015a40: 0a20 2020 2020 2020 2061 782e 6765 7441  .        ax.getA
-00015a50: 7869 7328 2762 6f74 746f 6d27 292e 7365  xis('bottom').se
-00015a60: 7453 7479 6c65 2873 686f 7756 616c 7565  tStyle(showValue
-00015a70: 733d 7861 7869 7329 0d0a 2020 2020 6966  s=xaxis)..    if
-00015a80: 2079 6178 6973 2069 7320 6e6f 7420 4e6f   yaxis is not No
-00015a90: 6e65 3a0d 0a20 2020 2020 2020 2061 782e  ne:..        ax.
-00015aa0: 6765 7441 7869 7328 2772 6967 6874 2729  getAxis('right')
-00015ab0: 2e73 6574 5374 796c 6528 7368 6f77 5661  .setStyle(showVa
-00015ac0: 6c75 6573 3d79 6178 6973 290d 0a20 2020  lues=yaxis)..   
-00015ad0: 2069 6620 7867 7269 6420 6973 206e 6f74   if xgrid is not
-00015ae0: 204e 6f6e 6520 6f72 2079 6772 6964 2069   None or ygrid i
-00015af0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00015b00: 2020 2020 2061 782e 7368 6f77 4772 6964       ax.showGrid
-00015b10: 2878 3d78 6772 6964 2c20 793d 7967 7269  (x=xgrid, y=ygri
-00015b20: 6429 0d0a 2020 2020 2020 2020 6966 2061  d)..        if a
-00015b30: 782e 6765 7441 7869 7328 2772 6967 6874  x.getAxis('right
-00015b40: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-00015b50: 2061 782e 6765 7441 7869 7328 2772 6967   ax.getAxis('rig
-00015b60: 6874 2729 2e73 6574 456e 6162 6c65 6428  ht').setEnabled(
-00015b70: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00015b80: 6966 2061 782e 6765 7441 7869 7328 2762  if ax.getAxis('b
-00015b90: 6f74 746f 6d27 293a 0d0a 2020 2020 2020  ottom'):..      
-00015ba0: 2020 2020 2020 6178 2e67 6574 4178 6973        ax.getAxis
-00015bb0: 2827 626f 7474 6f6d 2729 2e73 6574 456e  ('bottom').setEn
-00015bc0: 6162 6c65 6428 4661 6c73 6529 0d0a 0d0a  abled(False)....
-00015bd0: 0d0a 6465 6620 5f61 785f 6465 636f 7570  ..def _ax_decoup
-00015be0: 6c65 2861 7829 3a0d 0a20 2020 2061 782e  le(ax):..    ax.
-00015bf0: 7365 7458 4c69 6e6b 284e 6f6e 6529 0d0a  setXLink(None)..
-00015c00: 2020 2020 6966 2061 782e 7072 6576 5f61      if ax.prev_a
-00015c10: 783a 0d0a 2020 2020 2020 2020 6178 2e70  x:..        ax.p
-00015c20: 7265 765f 6178 2e73 6574 5f76 6973 6962  rev_ax.set_visib
-00015c30: 6c65 2878 6178 6973 3d54 7275 6529 0d0a  le(xaxis=True)..
-00015c40: 0d0a 0d0a 6465 6620 5f61 785f 6469 7361  ....def _ax_disa
-00015c50: 626c 655f 785f 696e 6465 7828 6178 2c20  ble_x_index(ax, 
-00015c60: 6465 636f 7570 6c65 3d54 7275 6529 3a0d  decouple=True):.
-00015c70: 0a20 2020 2061 782e 7662 2e78 5f69 6e64  .    ax.vb.x_ind
-00015c80: 6578 6564 203d 2046 616c 7365 0d0a 2020  exed = False..  
-00015c90: 2020 6966 2064 6563 6f75 706c 653a 0d0a    if decouple:..
-00015ca0: 2020 2020 2020 2020 5f61 785f 6465 636f          _ax_deco
-00015cb0: 7570 6c65 2861 7829 0d0a 0d0a 0d0a 6465  uple(ax)......de
-00015cc0: 6620 5f61 785f 7265 7365 7428 6178 293a  f _ax_reset(ax):
-00015cd0: 0d0a 2020 2020 6966 2061 782e 6372 6f73  ..    if ax.cros
-00015ce0: 7368 6169 7220 6973 206e 6f74 204e 6f6e  shair is not Non
-00015cf0: 653a 0d0a 2020 2020 2020 2020 6178 2e63  e:..        ax.c
-00015d00: 726f 7373 6861 6972 2e68 6964 6528 290d  rosshair.hide().
-00015d10: 0a20 2020 2066 6f72 2069 7465 6d20 696e  .    for item in
-00015d20: 206c 6973 7428 6178 2e69 7465 6d73 293a   list(ax.items):
-00015d30: 0d0a 2020 2020 2020 2020 6966 2061 6e79  ..        if any
-00015d40: 2869 7369 6e73 7461 6e63 6528 6974 656d  (isinstance(item
-00015d50: 2c20 6329 2066 6f72 2063 2069 6e20 5b46  , c) for c in [F
-00015d60: 696e 4c69 6e65 2c20 4669 6e50 6f6c 794c  inLine, FinPolyL
-00015d70: 696e 652c 2070 672e 5465 7874 4974 656d  ine, pg.TextItem
-00015d80: 5d29 3a0d 0a20 2020 2020 2020 2020 2020  ]):..           
-00015d90: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00015da0: 2020 2020 2020 2072 656d 6f76 655f 7072         remove_pr
-00015db0: 696d 6974 6976 6528 6974 656d 290d 0a20  imitive(item).. 
-00015dc0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00015dd0: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-00015de0: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
-00015df0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00015e00: 2020 2020 2061 782e 7265 6d6f 7665 4974       ax.removeIt
-00015e10: 656d 2869 7465 6d29 0d0a 2020 2020 2020  em(item)..      
-00015e20: 2020 6966 2061 782e 7662 2e6d 6173 7465    if ax.vb.maste
-00015e30: 725f 7669 6577 626f 7820 616e 6420 6861  r_viewbox and ha
-00015e40: 7361 7474 7228 6974 656d 2c20 276e 616d  sattr(item, 'nam
-00015e50: 6527 2920 616e 6420 6974 656d 2e6e 616d  e') and item.nam
-00015e60: 6528 293a 0d0a 2020 2020 2020 2020 2020  e():..          
-00015e70: 2020 6c65 6765 6e64 203d 2061 782e 7662    legend = ax.vb
-00015e80: 2e6d 6173 7465 725f 7669 6577 626f 782e  .master_viewbox.
-00015e90: 7061 7265 6e74 2829 2e6c 6567 656e 640d  parent().legend.
-00015ea0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00015eb0: 6c65 6765 6e64 3a0d 0a20 2020 2020 2020  legend:..       
-00015ec0: 2020 2020 2020 2020 206c 6567 656e 642e           legend.
-00015ed0: 7265 6d6f 7665 4974 656d 2869 7465 6d29  removeItem(item)
-00015ee0: 0d0a 2020 2020 6966 2061 782e 6c65 6765  ..    if ax.lege
-00015ef0: 6e64 3a0d 0a20 2020 2020 2020 2061 782e  nd:..        ax.
-00015f00: 6c65 6765 6e64 2e6f 7074 735b 276f 6666  legend.opts['off
-00015f10: 7365 7427 5d20 3d20 4e6f 6e65 0d0a 2020  set'] = None..  
-00015f20: 2020 2020 2020 6178 2e6c 6567 656e 642e        ax.legend.
-00015f30: 7365 7450 6172 656e 7449 7465 6d28 4e6f  setParentItem(No
-00015f40: 6e65 290d 0a20 2020 2020 2020 2061 782e  ne)..        ax.
-00015f50: 6c65 6765 6e64 203d 204e 6f6e 650d 0a20  legend = None.. 
-00015f60: 2020 2061 782e 7662 2e72 6573 6574 2829     ax.vb.reset()
-00015f70: 0d0a 2020 2020 6178 2e76 622e 7365 745f  ..    ax.vb.set_
-00015f80: 6461 7461 7372 6328 4e6f 6e65 290d 0a20  datasrc(None).. 
-00015f90: 2020 2069 6620 6178 2e63 726f 7373 6861     if ax.crossha
-00015fa0: 6972 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ir is not None:.
-00015fb0: 0a20 2020 2020 2020 2061 782e 6372 6f73  .        ax.cros
-00015fc0: 7368 6169 722e 7368 6f77 2829 0d0a 2020  shair.show()..  
-00015fd0: 2020 6178 2e73 6967 6e69 6669 6361 6e74    ax.significant
-00015fe0: 5f66 6f72 6365 6420 3d20 4661 6c73 650d  _forced = False.
-00015ff0: 0a0d 0a0d 0a64 6566 205f 6178 5f69 6e76  .....def _ax_inv
-00016000: 6572 745f 7928 6178 293a 0d0a 2020 2020  ert_y(ax):..    
-00016010: 6178 2e69 6e76 6572 7465 6420 3d20 6e6f  ax.inverted = no
-00016020: 7420 6178 2e69 6e76 6572 7465 640d 0a20  t ax.inverted.. 
-00016030: 2020 2061 782e 7365 7454 7261 6e73 666f     ax.setTransfo
-00016040: 726d 2861 782e 7472 616e 7366 6f72 6d28  rm(ax.transform(
-00016050: 292e 7363 616c 6528 312c 2d31 292e 7472  ).scale(1,-1).tr
-00016060: 616e 736c 6174 6528 302c 2d61 782e 6865  anslate(0,-ax.he
-00016070: 6967 6874 2829 2929 0d0a 0d0a 0d0a 6465  ight()))......de
-00016080: 6620 5f61 785f 6578 7061 6e64 2861 7829  f _ax_expand(ax)
-00016090: 3a0d 0a20 2020 2076 6220 3d20 6178 2e76  :..    vb = ax.v
-000160a0: 620d 0a20 2020 2061 7873 203d 2076 622e  b..    axs = vb.
-000160b0: 7769 6e2e 6178 730d 0a20 2020 2066 6f72  win.axs..    for
-000160c0: 2061 7878 2069 6e20 6178 733a 0d0a 2020   axx in axs:..  
-000160d0: 2020 2020 2020 6966 2061 7878 2e69 6e76        if axx.inv
-000160e0: 6572 7465 643a 2023 2072 6f6c 6c20 6261  erted: # roll ba
-000160f0: 636b 2069 6e76 6572 7369 6f6e 2069 6620  ck inversion if 
-00016100: 6368 616e 6769 6e67 2065 7870 616e 7369  changing expansi
-00016110: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
-00016120: 6178 782e 696e 7665 7274 5f79 2829 0d0a  axx.invert_y()..
-00016130: 2020 2020 7368 6f77 5f61 6c6c 203d 2061      show_all = a
-00016140: 6e79 286e 6f74 2061 782e 6973 5669 7369  ny(not ax.isVisi
-00016150: 626c 6528 2920 666f 7220 6178 2069 6e20  ble() for ax in 
-00016160: 6178 7329 0d0a 2020 2020 666f 7220 726f  axs)..    for ro
-00016170: 7769 2c61 7878 2069 6e20 656e 756d 6572  wi,axx in enumer
-00016180: 6174 6528 6178 7329 3a0d 0a20 2020 2020  ate(axs):..     
-00016190: 2020 2069 6620 6178 7820 213d 2061 783a     if axx != ax:
-000161a0: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-000161b0: 782e 7365 7456 6973 6962 6c65 2873 686f  x.setVisible(sho
-000161c0: 775f 616c 6c29 0d0a 2020 2020 2020 2020  w_all)..        
-000161d0: 2020 2020 666f 7220 6178 6f20 696e 2061      for axo in a
-000161e0: 7878 2e61 786f 733a 0d0a 2020 2020 2020  xx.axos:..      
-000161f0: 2020 2020 2020 2020 2020 6178 6f2e 7662            axo.vb
-00016200: 2e73 6574 5669 7369 626c 6528 7368 6f77  .setVisible(show
-00016210: 5f61 6c6c 290d 0a20 2020 2061 782e 7365  _all)..    ax.se
-00016220: 745f 7669 7369 626c 6528 7861 7869 733d  t_visible(xaxis=
-00016230: 6e6f 7420 7368 6f77 5f61 6c6c 290d 0a20  not show_all).. 
-00016240: 2020 2061 7873 5b2d 315d 2e73 6574 5f76     axs[-1].set_v
-00016250: 6973 6962 6c65 2878 6178 6973 3d54 7275  isible(xaxis=Tru
-00016260: 6529 0d0a 0d0a 0d0a 6465 6620 5f63 7265  e)......def _cre
-00016270: 6174 655f 6c65 6765 6e64 2861 7829 3a0d  ate_legend(ax):.
-00016280: 0a20 2020 2069 6620 6178 2e76 622e 6d61  .    if ax.vb.ma
-00016290: 7374 6572 5f76 6965 7762 6f78 3a0d 0a20  ster_viewbox:.. 
-000162a0: 2020 2020 2020 2061 7820 3d20 6178 2e76         ax = ax.v
-000162b0: 622e 6d61 7374 6572 5f76 6965 7762 6f78  b.master_viewbox
-000162c0: 2e70 6172 656e 7428 290d 0a20 2020 2069  .parent()..    i
-000162d0: 6620 6178 2e6c 6567 656e 6420 6973 204e  f ax.legend is N
-000162e0: 6f6e 653a 0d0a 2020 2020 2020 2020 6178  one:..        ax
-000162f0: 2e6c 6567 656e 6420 3d20 4669 6e4c 6567  .legend = FinLeg
-00016300: 656e 6449 7465 6d28 626f 7264 6572 5f63  endItem(border_c
-00016310: 6f6c 6f72 3d6c 6567 656e 645f 626f 7264  olor=legend_bord
-00016320: 6572 5f63 6f6c 6f72 2c20 6669 6c6c 5f63  er_color, fill_c
-00016330: 6f6c 6f72 3d6c 6567 656e 645f 6669 6c6c  olor=legend_fill
-00016340: 5f63 6f6c 6f72 2c20 7369 7a65 3d4e 6f6e  _color, size=Non
-00016350: 652c 206f 6666 7365 743d 2833 2c32 2929  e, offset=(3,2))
-00016360: 0d0a 2020 2020 2020 2020 6178 2e6c 6567  ..        ax.leg
-00016370: 656e 642e 7365 7450 6172 656e 7449 7465  end.setParentIte
-00016380: 6d28 6178 2e76 6229 0d0a 0d0a 0d0a 6465  m(ax.vb)......de
-00016390: 6620 5f75 7064 6174 655f 7369 676e 6966  f _update_signif
-000163a0: 6963 616e 7473 2861 782c 2064 6174 6173  icants(ax, datas
-000163b0: 7263 2c20 666f 7263 6529 3a0d 0a20 2020  rc, force):..   
-000163c0: 2023 2063 6865 636b 2069 6620 6e6f 2065   # check if no e
-000163d0: 7073 696c 6f6e 2073 6574 2079 6574 0d0a  psilon set yet..
-000163e0: 2020 2020 6465 6661 756c 745f 6465 6320      default_dec 
-000163f0: 3d20 302e 3939 203c 2061 782e 7369 676e  = 0.99 < ax.sign
-00016400: 6966 6963 616e 745f 6465 6369 6d61 6c73  ificant_decimals
-00016410: 2f73 6967 6e69 6669 6361 6e74 5f64 6563  /significant_dec
-00016420: 696d 616c 7320 3c20 312e 3031 0d0a 2020  imals < 1.01..  
-00016430: 2020 6465 6661 756c 745f 6570 7320 3d20    default_eps = 
-00016440: 302e 3939 203c 2061 782e 7369 676e 6966  0.99 < ax.signif
-00016450: 6963 616e 745f 6570 732f 7369 676e 6966  icant_eps/signif
-00016460: 6963 616e 745f 6570 7320 3c20 312e 3031  icant_eps < 1.01
-00016470: 0d0a 2020 2020 6966 2066 6f72 6365 206f  ..    if force o
-00016480: 7220 2864 6566 6175 6c74 5f64 6563 2061  r (default_dec a
-00016490: 6e64 2064 6566 6175 6c74 5f65 7073 293a  nd default_eps):
-000164a0: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
-000164b0: 2020 2020 2020 2020 2020 2020 7364 2c73              sd,s
-000164c0: 6520 3d20 6461 7461 7372 632e 6361 6c63  e = datasrc.calc
-000164d0: 5f73 6967 6e69 6669 6361 6e74 5f64 6563  _significant_dec
-000164e0: 696d 616c 7328 6675 6c6c 3d66 6f72 6365  imals(full=force
-000164f0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00016500: 6620 7364 206f 7220 7365 2021 3d20 7369  f sd or se != si
-00016510: 676e 6966 6963 616e 745f 6570 733a 0d0a  gnificant_eps:..
-00016520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016530: 6966 2028 666f 7263 6520 616e 6420 6e6f  if (force and no
-00016540: 7420 6178 2e73 6967 6e69 6669 6361 6e74  t ax.significant
-00016550: 5f66 6f72 6365 6429 206f 7220 6465 6661  _forced) or defa
-00016560: 756c 745f 6465 6320 6f72 2073 6420 3e20  ult_dec or sd > 
-00016570: 6178 2e73 6967 6e69 6669 6361 6e74 5f64  ax.significant_d
-00016580: 6563 696d 616c 733a 0d0a 2020 2020 2020  ecimals:..      
-00016590: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-000165a0: 2e73 6967 6e69 6669 6361 6e74 5f64 6563  .significant_dec
-000165b0: 696d 616c 7320 3d20 7364 0d0a 2020 2020  imals = sd..    
-000165c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165d0: 6178 2e73 6967 6e69 6669 6361 6e74 5f66  ax.significant_f
-000165e0: 6f72 6365 6420 7c3d 2066 6f72 6365 0d0a  orced |= force..
-000165f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016600: 6966 2028 666f 7263 6520 616e 6420 6e6f  if (force and no
-00016610: 7420 6178 2e73 6967 6e69 6669 6361 6e74  t ax.significant
-00016620: 5f66 6f72 6365 6429 206f 7220 6465 6661  _forced) or defa
-00016630: 756c 745f 6570 7320 6f72 2073 6520 3c20  ult_eps or se < 
-00016640: 6178 2e73 6967 6e69 6669 6361 6e74 5f65  ax.significant_e
-00016650: 7073 3a0d 0a20 2020 2020 2020 2020 2020  ps:..           
-00016660: 2020 2020 2020 2020 2061 782e 7369 676e           ax.sign
-00016670: 6966 6963 616e 745f 6570 7320 3d20 7365  ificant_eps = se
-00016680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016690: 2020 2020 2020 6178 2e73 6967 6e69 6669        ax.signifi
-000166a0: 6361 6e74 5f66 6f72 6365 6420 7c3d 2066  cant_forced |= f
-000166b0: 6f72 6365 0d0a 2020 2020 2020 2020 6578  orce..        ex
-000166c0: 6365 7074 3a0d 0a20 2020 2020 2020 2020  cept:..         
-000166d0: 2020 2070 6173 7320 2320 6461 7461 7372     pass # datasr
-000166e0: 6320 7072 6f62 6162 6c79 2066 756c 6c20  c probably full 
-000166f0: 6176 204e 614e 730d 0a0d 0a0d 0a64 6566  av NaNs......def
-00016700: 205f 696d 7072 6f76 655f 7369 676e 6966   _improve_signif
-00016710: 6963 616e 7473 2861 7829 3a0d 0a20 2020  icants(ax):..   
-00016720: 2027 2727 466f 7263 6520 7570 6461 7465   '''Force update
-00016730: 206f 6620 7468 6520 4550 5320 6966 2077   of the EPS if w
-00016740: 6520 626f 7468 2068 6176 6520 6e6f 2062  e both have no b
-00016750: 6172 732f 6361 6e64 6c65 7320 414e 4420  ars/candles AND 
-00016760: 6120 6c6f 6720 7363 616c 652e 0d0a 2020  a log scale...  
-00016770: 2020 2020 2054 6869 7320 6973 2069 6e74       This is int
-00016780: 656e 6465 6420 746f 2066 6978 2074 6865  ended to fix the
-00016790: 206c 6f77 6572 2070 6172 7420 6f66 2074   lower part of t
-000167a0: 6865 2067 7269 6420 6f6e 206c 696e 6520  he grid on line 
-000167b0: 706c 6f74 7320 6f6e 2061 206c 6f67 2073  plots on a log s
-000167c0: 6361 6c65 2e27 2727 0d0a 2020 2020 6966  cale.'''..    if
-000167d0: 2061 782e 7662 2e79 7363 616c 652e 7363   ax.vb.yscale.sc
-000167e0: 616c 6574 7970 6520 3d3d 2027 6c6f 6727  aletype == 'log'
-000167f0: 3a0d 0a20 2020 2020 2020 2069 6620 6e6f  :..        if no
-00016800: 7420 616e 7928 6973 696e 7374 616e 6365  t any(isinstance
-00016810: 2869 7465 6d2c 2043 616e 646c 6573 7469  (item, Candlesti
-00016820: 636b 4974 656d 2920 666f 7220 6974 656d  ckItem) for item
-00016830: 2069 6e20 6178 2e69 7465 6d73 293a 0d0a   in ax.items):..
-00016840: 2020 2020 2020 2020 2020 2020 5f75 7064              _upd
-00016850: 6174 655f 7369 676e 6966 6963 616e 7473  ate_significants
-00016860: 2861 782c 2061 782e 7662 2e64 6174 6173  (ax, ax.vb.datas
-00016870: 7263 2c20 666f 7263 653d 5472 7565 290d  rc, force=True).
-00016880: 0a0d 0a0d 0a64 6566 205f 6973 5f73 7461  .....def _is_sta
-00016890: 6e64 616c 6f6e 6528 7469 6d65 7365 7229  ndalone(timeser)
-000168a0: 3a0d 0a20 2020 2023 206d 6f72 6520 7468  :..    # more th
-000168b0: 616e 204e 2070 6572 6365 6e74 2067 6170  an N percent gap
-000168c0: 7320 6f72 2074 696d 6520 7265 7665 7273  s or time revers
-000168d0: 616c 7320 7072 6f62 6162 6c79 206d 6561  als probably mea
-000168e0: 6e73 2074 6869 7320 6973 2061 2073 7461  ns this is a sta
-000168f0: 6e64 616c 6f6e 6520 706c 6f74 0d0a 2020  ndalone plot..  
-00016900: 2020 7265 7475 726e 2074 696d 6573 6572    return timeser
-00016910: 2e69 736e 756c 6c28 292e 7375 6d28 2920  .isnull().sum() 
-00016920: 2b20 2874 696d 6573 6572 2e64 6966 6628  + (timeser.diff(
-00016930: 293c 3d30 292e 7375 6d28 2920 3e20 6c65  )<=0).sum() > le
-00016940: 6e28 7469 6d65 7365 7229 2a30 2e31 0d0a  n(timeser)*0.1..
-00016950: 0d0a 0d0a 6465 6620 5f63 7265 6174 655f  ....def _create_
-00016960: 706f 6c79 5f6c 696e 6528 2a61 7267 732c  poly_line(*args,
-00016970: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00016980: 2072 6574 7572 6e20 4669 6e50 6f6c 794c   return FinPolyL
-00016990: 696e 6528 2a61 7267 732c 202a 2a6b 7761  ine(*args, **kwa
-000169a0: 7267 7329 0d0a 0d0a 0d0a 6465 6620 5f63  rgs)......def _c
-000169b0: 7265 6174 655f 7365 7269 6573 2861 293a  reate_series(a):
-000169c0: 0d0a 2020 2020 7265 7475 726e 2061 2069  ..    return a i
-000169d0: 6620 6973 696e 7374 616e 6365 2861 2c20  f isinstance(a, 
-000169e0: 7064 2e53 6572 6965 7329 2065 6c73 6520  pd.Series) else 
-000169f0: 7064 2e53 6572 6965 7328 6129 0d0a 0d0a  pd.Series(a)....
-00016a00: 0d0a 6465 6620 5f63 7265 6174 655f 6461  ..def _create_da
-00016a10: 7461 7372 6328 6178 2c20 2a61 7267 732c  tasrc(ax, *args,
-00016a20: 206e 636f 6c73 3d2d 312c 2061 6c6c 6f77   ncols=-1, allow
-00016a30: 5f73 6361 6c69 6e67 3d54 7275 6529 3a0d  _scaling=True):.
-00016a40: 0a20 2020 2064 6566 2064 6f5f 6372 6561  .    def do_crea
-00016a50: 7465 2861 7267 7329 3a0d 0a20 2020 2020  te(args):..     
-00016a60: 2020 2069 6620 6c65 6e28 6172 6773 2920     if len(args) 
-00016a70: 3d3d 2031 2061 6e64 2074 7970 6528 6172  == 1 and type(ar
-00016a80: 6773 5b30 5d29 203d 3d20 5061 6e64 6173  gs[0]) == Pandas
-00016a90: 4461 7461 536f 7572 6365 3a0d 0a20 2020  DataSource:..   
-00016aa0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00016ab0: 6172 6773 5b30 5d0d 0a20 2020 2020 2020  args[0]..       
-00016ac0: 2069 6620 6c65 6e28 6172 6773 2920 3d3d   if len(args) ==
-00016ad0: 2031 2061 6e64 2074 7970 6528 6172 6773   1 and type(args
-00016ae0: 5b30 5d29 2069 6e20 286c 6973 742c 2074  [0]) in (list, t
-00016af0: 7570 6c65 293a 0d0a 2020 2020 2020 2020  uple):..        
-00016b00: 2020 2020 6172 6773 203d 205b 6e70 2e61      args = [np.a
-00016b10: 7272 6179 2861 7267 735b 305d 295d 0d0a  rray(args[0])]..
-00016b20: 2020 2020 2020 2020 6966 206c 656e 2861          if len(a
-00016b30: 7267 7329 203d 3d20 3120 616e 6420 7479  rgs) == 1 and ty
-00016b40: 7065 2861 7267 735b 305d 2920 3d3d 206e  pe(args[0]) == n
-00016b50: 702e 6e64 6172 7261 793a 0d0a 2020 2020  p.ndarray:..    
-00016b60: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
-00016b70: 7064 2e44 6174 6146 7261 6d65 2861 7267  pd.DataFrame(arg
-00016b80: 735b 305d 2e54 295d 0d0a 2020 2020 2020  s[0].T)]..      
-00016b90: 2020 6966 206c 656e 2861 7267 7329 203d    if len(args) =
-00016ba0: 3d20 3120 616e 6420 7479 7065 2861 7267  = 1 and type(arg
-00016bb0: 735b 305d 2920 3d3d 2070 642e 4461 7461  s[0]) == pd.Data
-00016bc0: 4672 616d 653a 0d0a 2020 2020 2020 2020  Frame:..        
-00016bd0: 2020 2020 7265 7475 726e 2050 616e 6461      return Panda
-00016be0: 7344 6174 6153 6f75 7263 6528 6172 6773  sDataSource(args
-00016bf0: 5b30 5d29 0d0a 2020 2020 2020 2020 6172  [0])..        ar
-00016c00: 6773 203d 205b 5f63 7265 6174 655f 7365  gs = [_create_se
-00016c10: 7269 6573 2861 2920 666f 7220 6120 696e  ries(a) for a in
-00016c20: 2061 7267 735d 0d0a 2020 2020 2020 2020   args]..        
-00016c30: 7265 7475 726e 2050 616e 6461 7344 6174  return PandasDat
-00016c40: 6153 6f75 7263 6528 7064 2e63 6f6e 6361  aSource(pd.conca
-00016c50: 7428 6172 6773 2c20 6178 6973 3d31 2929  t(args, axis=1))
-00016c60: 0d0a 2020 2020 6961 7267 7320 3d20 5b61  ..    iargs = [a
-00016c70: 2066 6f72 2061 2069 6e20 6172 6773 2069   for a in args i
-00016c80: 6620 6120 6973 206e 6f74 204e 6f6e 655d  f a is not None]
-00016c90: 0d0a 2020 2020 6461 7461 7372 6320 3d20  ..    datasrc = 
-00016ca0: 646f 5f63 7265 6174 6528 6961 7267 7329  do_create(iargs)
-00016cb0: 0d0a 2020 2020 2320 6368 6563 6b20 6966  ..    # check if
-00016cc0: 2074 696d 6520 636f 6c75 6d6e 206d 6973   time column mis
-00016cd0: 7369 6e67 0d0a 2020 2020 6966 206c 656e  sing..    if len
-00016ce0: 2864 6174 6173 7263 2e64 662e 636f 6c75  (datasrc.df.colu
-00016cf0: 6d6e 7329 2069 6e20 2831 2c20 6e63 6f6c  mns) in (1, ncol
-00016d00: 732d 3129 3a0d 0a20 2020 2020 2020 2023  s-1):..        #
-00016d10: 2061 7373 756d 6520 7469 6d65 2064 6174   assume time dat
-00016d20: 6120 6861 7320 616c 7265 6164 7920 6265  a has already be
-00016d30: 656e 2061 6464 6564 2062 6566 6f72 650d  en added before.
-00016d40: 0a20 2020 2020 2020 2066 6f72 2061 2069  .        for a i
-00016d50: 6e20 6178 2e76 622e 7769 6e2e 6178 733a  n ax.vb.win.axs:
-00016d60: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00016d70: 2061 2e76 622e 6461 7461 7372 6320 616e   a.vb.datasrc an
-00016d80: 6420 6c65 6e28 612e 7662 2e64 6174 6173  d len(a.vb.datas
-00016d90: 7263 2e64 662e 636f 6c75 6d6e 7329 203e  rc.df.columns) >
-00016da0: 3d20 323a 0d0a 2020 2020 2020 2020 2020  = 2:..          
-00016db0: 2020 2020 2020 6461 7461 7372 632e 6466        datasrc.df
-00016dc0: 2e63 6f6c 756d 6e73 203d 2061 2e76 622e  .columns = a.vb.
-00016dd0: 6461 7461 7372 632e 6466 2e63 6f6c 756d  datasrc.df.colum
-00016de0: 6e73 5b31 3a6c 656e 2864 6174 6173 7263  ns[1:len(datasrc
-00016df0: 2e64 662e 636f 6c75 6d6e 7329 2b31 5d0d  .df.columns)+1].
-00016e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016e10: 2063 6f6c 203d 2061 2e76 622e 6461 7461   col = a.vb.data
-00016e20: 7372 632e 6466 2e63 6f6c 756d 6e73 5b30  src.df.columns[0
-00016e30: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00016e40: 2020 2064 6174 6173 7263 2e64 662e 696e     datasrc.df.in
-00016e50: 7365 7274 2830 2c20 636f 6c2c 2061 2e76  sert(0, col, a.v
-00016e60: 622e 6461 7461 7372 632e 6466 5b63 6f6c  b.datasrc.df[col
-00016e70: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00016e80: 2020 2020 6461 7461 7372 6320 3d20 5061      datasrc = Pa
-00016e90: 6e64 6173 4461 7461 536f 7572 6365 2864  ndasDataSource(d
-00016ea0: 6174 6173 7263 2e64 6629 0d0a 2020 2020  atasrc.df)..    
-00016eb0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00016ec0: 6b0d 0a20 2020 2020 2020 2069 6620 6c65  k..        if le
-00016ed0: 6e28 6461 7461 7372 632e 6466 2e63 6f6c  n(datasrc.df.col
-00016ee0: 756d 6e73 2920 696e 2028 312c 206e 636f  umns) in (1, nco
-00016ef0: 6c73 2d31 293a 0d0a 2020 2020 2020 2020  ls-1):..        
-00016f00: 2020 2020 6966 206e 636f 6c73 203e 2031      if ncols > 1
-00016f10: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00016f20: 2020 2070 7269 6e74 2866 2257 4152 4e49     print(f"WARNI
-00016f30: 4e47 3a20 7468 6973 2074 7970 6520 6f66  NG: this type of
-00016f40: 2070 6c6f 7420 7761 6e74 7320 2569 2063   plot wants %i c
-00016f50: 6f6c 756d 6e73 2f61 7267 732c 2062 7574  olumns/args, but
-00016f60: 2079 6f75 2776 6520 6f6e 6c79 2073 7570   you've only sup
-00016f70: 706c 6965 6420 2569 2220 2520 286e 636f  plied %i" % (nco
-00016f80: 6c73 2c20 6c65 6e28 6461 7461 7372 632e  ls, len(datasrc.
-00016f90: 6466 2e63 6f6c 756d 6e73 2929 290d 0a20  df.columns))).. 
-00016fa0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00016fb0: 7269 6e74 2827 202d 2041 7373 756d 696e  rint(' - Assumin
-00016fc0: 6720 7469 6d65 2063 6f6c 756d 6e20 6973  g time column is
-00016fd0: 206d 6973 7369 6e67 2061 6e64 2075 7369   missing and usi
-00016fe0: 6e67 2069 6e64 6578 2069 6e73 7465 6164  ng index instead
-00016ff0: 2e27 290d 0a20 2020 2020 2020 2020 2020  .')..           
-00017000: 2064 6174 6173 7263 203d 2050 616e 6461   datasrc = Panda
-00017010: 7344 6174 6153 6f75 7263 6528 6461 7461  sDataSource(data
-00017020: 7372 632e 6466 2e72 6573 6574 5f69 6e64  src.df.reset_ind
-00017030: 6578 2829 290d 0a20 2020 2065 6c69 6620  ex())..    elif 
-00017040: 6c65 6e28 6961 7267 7329 203e 3d20 3220  len(iargs) >= 2 
-00017050: 616e 6420 6c65 6e28 6461 7461 7372 632e  and len(datasrc.
-00017060: 6466 2e63 6f6c 756d 6e73 2920 3d3d 206c  df.columns) == l
-00017070: 656e 2869 6172 6773 292b 3120 616e 6420  en(iargs)+1 and 
-00017080: 6c65 6e28 6961 7267 7329 203d 3d20 6c65  len(iargs) == le
-00017090: 6e28 6172 6773 293a 0d0a 2020 2020 2020  n(args):..      
-000170a0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-000170b0: 2020 2020 6966 2027 2e49 6e74 2720 696e      if '.Int' in
-000170c0: 2073 7472 2874 7970 6528 6961 7267 735b   str(type(iargs[
-000170d0: 305d 2e69 6e64 6578 2929 3a0d 0a20 2020  0].index)):..   
-000170e0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-000170f0: 6e74 2827 5741 524e 494e 473a 2070 6572  nt('WARNING: per
-00017100: 666f 726d 616e 6365 2070 656e 616c 7479  formance penalty
-00017110: 2061 6e64 2063 7261 7368 206d 6179 206f   and crash may o
-00017120: 6363 7572 2077 6865 6e20 7573 696e 6720  ccur when using 
-00017130: 696e 7436 3420 696e 7374 6561 6420 6f66  int64 instead of
-00017140: 2072 616e 6765 2069 6e64 6963 6573 2e27   range indices.'
-00017150: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00017160: 2020 2069 6620 2869 6172 6773 5b30 5d2e     if (iargs[0].
-00017170: 696e 6465 7820 3d3d 2072 616e 6765 286c  index == range(l
-00017180: 656e 2869 6172 6773 5b30 5d29 2929 2e61  en(iargs[0]))).a
-00017190: 6c6c 2829 3a0d 0a20 2020 2020 2020 2020  ll():..         
-000171a0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000171b0: 2827 202d 2046 6978 2062 7920 2e72 6573  (' - Fix by .res
-000171c0: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
-000171d0: 7565 2927 290d 0a20 2020 2020 2020 2020  ue)')..         
-000171e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000171f0: 6e20 5f63 7265 6174 655f 6461 7461 7372  n _create_datasr
-00017200: 6328 6178 2c20 6461 7461 7372 632e 6466  c(ax, datasrc.df
-00017210: 5b64 6174 6173 7263 2e64 662e 636f 6c75  [datasrc.df.colu
-00017220: 6d6e 735b 313a 5d5d 2c20 6e63 6f6c 733d  mns[1:]], ncols=
-00017230: 6e63 6f6c 7329 0d0a 2020 2020 2020 2020  ncols)..        
-00017240: 6578 6365 7074 3a0d 0a20 2020 2020 2020  except:..       
-00017250: 2020 2020 2070 7269 6e74 2827 5741 524e       print('WARN
-00017260: 494e 473a 2069 6e70 7574 2064 6174 6120  ING: input data 
-00017270: 736f 7572 6365 206d 6179 2063 6175 7365  source may cause
-00017280: 2070 6572 666f 726d 616e 6365 2070 656e   performance pen
-00017290: 616c 7479 2061 6e64 2063 7261 7368 2e27  alty and crash.'
-000172a0: 290d 0a0d 0a20 2020 2061 7373 6572 7420  )....    assert 
-000172b0: 6c65 6e28 6461 7461 7372 632e 6466 2e63  len(datasrc.df.c
-000172c0: 6f6c 756d 6e73 2920 3e3d 206e 636f 6c73  olumns) >= ncols
-000172d0: 2c20 2745 5252 4f52 3a20 746f 6f20 6665  , 'ERROR: too fe
-000172e0: 7720 636f 6c75 6d6e 732f 6172 6773 2073  w columns/args s
-000172f0: 7570 706c 6965 6420 666f 7220 7468 6973  upplied for this
-00017300: 2070 6c6f 7427 0d0a 0d0a 2020 2020 6966   plot'....    if
-00017310: 2064 6174 6173 7263 2e70 6572 696f 645f   datasrc.period_
-00017320: 6e73 203c 2030 3a0d 0a20 2020 2020 2020  ns < 0:..       
-00017330: 2070 7269 6e74 2827 5741 524e 494e 473a   print('WARNING:
-00017340: 2069 6e70 7574 2064 6174 6120 736f 7572   input data sour
-00017350: 6365 2068 6173 2074 696d 6520 696e 2064  ce has time in d
-00017360: 6573 6365 6e64 696e 6720 6f72 6465 722e  escending order.
-00017370: 2054 7279 2073 6f72 745f 7661 6c75 6573   Try sort_values
-00017380: 2829 2062 6566 6f72 6520 6361 6c6c 696e  () before callin
-00017390: 672e 2729 0d0a 0d0a 2020 2020 2320 4649  g.')....    # FI
-000173a0: 583a 2073 7475 7069 6420 5154 2062 7567  X: stupid QT bug
-000173b0: 2063 6175 7365 7320 7265 6374 616e 676c   causes rectangl
-000173c0: 6573 206c 6172 6765 7220 7468 616e 2032  es larger than 2
-000173d0: 4720 746f 2066 6c69 636b 6572 2c20 736f  G to flicker, so
-000173e0: 2073 6361 6c65 2072 656e 6465 7269 6e67   scale rendering
-000173f0: 2064 6f77 6e20 736f 6d65 0d0a 2020 2020   down some..    
-00017400: 2320 4649 583a 2050 7951 7420 352e 3135  # FIX: PyQt 5.15
-00017410: 2e32 206c 696e 6573 203e 3165 3620 6172  .2 lines >1e6 ar
-00017420: 6520 6265 696e 6720 636c 6970 7065 6420  e being clipped 
-00017430: 746f 2031 6536 2064 7572 696e 6720 7468  to 1e6 during th
-00017440: 6520 6669 7273 7420 7265 6e64 6572 2070  e first render p
-00017450: 6173 732c 2073 6f20 7363 616c 6520 646f  ass, so scale do
-00017460: 776e 2069 6620 3e31 6536 0d0a 2020 2020  wn if >1e6..    
-00017470: 6966 2061 6c6c 6f77 5f73 6361 6c69 6e67  if allow_scaling
-00017480: 2061 6e64 2064 6174 6173 7263 2e64 662e   and datasrc.df.
-00017490: 696c 6f63 5b3a 2c20 313a 5d2e 6d61 7828  iloc[:, 1:].max(
-000174a0: 6e75 6d65 7269 635f 6f6e 6c79 3d54 7275  numeric_only=Tru
-000174b0: 6529 2e6d 6178 2829 203e 2031 6536 3a0d  e).max() > 1e6:.
-000174c0: 0a20 2020 2020 2020 2061 782e 7662 2e79  .        ax.vb.y
-000174d0: 7363 616c 652e 7365 745f 7363 616c 6528  scale.set_scale(
-000174e0: 696e 7428 3165 3629 290d 0a20 2020 2072  int(1e6))..    r
-000174f0: 6574 7572 6e20 6461 7461 7372 630d 0a0d  eturn datasrc...
-00017500: 0a0d 0a64 6566 205f 7365 745f 6461 7461  ...def _set_data
-00017510: 7372 6328 6178 2c20 6461 7461 7372 632c  src(ax, datasrc,
-00017520: 2061 6464 636f 6c73 3d54 7275 6529 3a0d   addcols=True):.
-00017530: 0a20 2020 2076 6965 7762 6f78 203d 2061  .    viewbox = a
-00017540: 782e 7662 0d0a 2020 2020 6966 206e 6f74  x.vb..    if not
-00017550: 2064 6174 6173 7263 2e73 7461 6e64 616c   datasrc.standal
-00017560: 6f6e 653a 0d0a 2020 2020 2020 2020 6966  one:..        if
-00017570: 2076 6965 7762 6f78 2e64 6174 6173 7263   viewbox.datasrc
-00017580: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00017590: 2020 2020 2020 2076 6965 7762 6f78 2e73         viewbox.s
-000175a0: 6574 5f64 6174 6173 7263 2864 6174 6173  et_datasrc(datas
-000175b0: 7263 2920 2320 666f 7220 6d77 6865 656c  rc) # for mwheel
-000175c0: 207a 6f6f 6d2d 7363 616c 696e 670d 0a20   zoom-scaling.. 
-000175d0: 2020 2020 2020 2020 2020 205f 7365 745f             _set_
-000175e0: 785f 6c69 6d69 7473 2861 782c 2064 6174  x_limits(ax, dat
-000175f0: 6173 7263 290d 0a20 2020 2020 2020 2065  asrc)..        e
-00017600: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00017610: 2020 7430 203d 2076 6965 7762 6f78 2e64    t0 = viewbox.d
-00017620: 6174 6173 7263 2e78 2e6c 6f63 5b30 5d0d  atasrc.x.loc[0].
-00017630: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00017640: 6164 6463 6f6c 733a 0d0a 2020 2020 2020  addcols:..      
-00017650: 2020 2020 2020 2020 2020 7669 6577 626f            viewbo
-00017660: 782e 6461 7461 7372 632e 6164 6463 6f6c  x.datasrc.addcol
-00017670: 7328 6461 7461 7372 6329 0d0a 2020 2020  s(datasrc)..    
-00017680: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00017690: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000176a0: 6965 7762 6f78 2e64 6174 6173 7263 2e64  iewbox.datasrc.d
-000176b0: 6620 3d20 6461 7461 7372 632e 6466 0d0a  f = datasrc.df..
-000176c0: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
-000176d0: 6563 6b20 6966 2077 6520 6e65 6564 2074  eck if we need t
-000176e0: 6f20 7265 2d72 656e 6465 7220 7072 6576  o re-render prev
-000176f0: 696f 7573 2070 6c6f 7473 2064 7565 2074  ious plots due t
-00017700: 6f20 6368 616e 6765 6420 696e 6469 6365  o changed indice
-00017710: 730d 0a20 2020 2020 2020 2020 2020 2069  s..            i
-00017720: 6e64 6963 6573 5f75 7064 6174 6564 203d  ndices_updated =
-00017730: 2076 6965 7762 6f78 2e64 6174 6173 7263   viewbox.datasrc
-00017740: 2e74 696d 6562 6173 6564 2829 2061 6e64  .timebased() and
-00017750: 2074 3020 213d 2076 6965 7762 6f78 2e64   t0 != viewbox.d
-00017760: 6174 6173 7263 2e78 2e6c 6f63 5b30 5d0d  atasrc.x.loc[0].
-00017770: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00017780: 2069 7465 6d20 696e 2061 782e 6974 656d   item in ax.item
-00017790: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-000177a0: 2020 2020 6966 2068 6173 6174 7472 2869      if hasattr(i
-000177b0: 7465 6d2c 2027 6461 7461 7372 6327 2920  tem, 'datasrc') 
-000177c0: 616e 6420 6e6f 7420 6974 656d 2e64 6174  and not item.dat
-000177d0: 6173 7263 2e73 7461 6e64 616c 6f6e 653a  asrc.standalone:
-000177e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000177f0: 2020 2020 2020 6974 656d 2e64 6174 6173        item.datas
-00017800: 7263 2e73 6574 5f64 6628 7669 6577 626f  rc.set_df(viewbo
-00017810: 782e 6461 7461 7372 632e 6466 2920 2320  x.datasrc.df) # 
-00017820: 6576 6572 7920 706c 6f74 2068 6572 6520  every plot here 
-00017830: 6e6f 7720 6861 7320 7468 6520 7361 6d65  now has the same
-00017840: 2074 696d 652d 6672 616d 650d 0a20 2020   time-frame..   
-00017850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017860: 2069 6620 696e 6469 6365 735f 7570 6461   if indices_upda
-00017870: 7465 643a 0d0a 2020 2020 2020 2020 2020  ted:..          
-00017880: 2020 2020 2020 2020 2020 2020 2020 5f73                _s
-00017890: 7461 7274 5f76 6973 7561 6c5f 7570 6461  tart_visual_upda
-000178a0: 7465 2869 7465 6d29 0d0a 2020 2020 2020  te(item)..      
-000178b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178c0: 2020 5f65 6e64 5f76 6973 7561 6c5f 7570    _end_visual_up
-000178d0: 6461 7465 2869 7465 6d29 0d0a 2020 2020  date(item)..    
-000178e0: 2020 2020 2020 2020 5f73 6574 5f78 5f6c          _set_x_l
-000178f0: 696d 6974 7328 6178 2c20 6461 7461 7372  imits(ax, datasr
-00017900: 6329 0d0a 2020 2020 2020 2020 2020 2020  c)..            
-00017910: 7669 6577 626f 782e 7365 745f 6461 7461  viewbox.set_data
-00017920: 7372 6328 7669 6577 626f 782e 6461 7461  src(viewbox.data
-00017930: 7372 6329 2023 2075 7064 6174 6520 7a6f  src) # update zo
-00017940: 6f6d 0d0a 2020 2020 656c 7365 3a0d 0a20  om..    else:.. 
-00017950: 2020 2020 2020 2076 6965 7762 6f78 2e73         viewbox.s
-00017960: 7461 6e64 616c 6f6e 6573 2e61 6464 2864  tandalones.add(d
-00017970: 6174 6173 7263 290d 0a20 2020 2020 2020  atasrc)..       
-00017980: 2064 6174 6173 7263 2e75 7064 6174 655f   datasrc.update_
-00017990: 696e 6974 5f78 2876 6965 7762 6f78 2e69  init_x(viewbox.i
-000179a0: 6e69 745f 7374 6570 7329 0d0a 2020 2020  nit_steps)..    
-000179b0: 2020 2020 6966 2064 6174 6173 7263 2e74      if datasrc.t
-000179c0: 696d 6562 6173 6564 2829 2061 6e64 2076  imebased() and v
-000179d0: 6965 7762 6f78 2e64 6174 6173 7263 2069  iewbox.datasrc i
-000179e0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-000179f0: 2020 2020 2020 2020 2023 2320 7072 696e           ## prin
-00017a00: 7428 2757 4152 4e49 4e47 3a20 7265 2d69  t('WARNING: re-i
-00017a10: 6e64 6578 696e 6720 7374 616e 6461 6c6f  ndexing standalo
-00017a20: 6e65 2c20 7469 6d65 2d62 6173 6564 2070  ne, time-based p
-00017a30: 6c6f 7427 290d 0a20 2020 2020 2020 2020  lot')..         
-00017a40: 2020 2076 6466 203d 2076 6965 7762 6f78     vdf = viewbox
-00017a50: 2e64 6174 6173 7263 2e64 660d 0a20 2020  .datasrc.df..   
-00017a60: 2020 2020 2020 2020 2064 203d 207b 763a           d = {v:
-00017a70: 6b20 666f 7220 6b2c 7620 696e 2065 6e75  k for k,v in enu
-00017a80: 6d65 7261 7465 2876 6466 5b76 6466 2e63  merate(vdf[vdf.c
-00017a90: 6f6c 756d 6e73 5b30 5d5d 297d 0d0a 2020  olumns[0]])}..  
-00017aa0: 2020 2020 2020 2020 2020 6461 7461 7372            datasr
-00017ab0: 632e 6466 2e69 6e64 6578 203d 205b 645b  c.df.index = [d[
-00017ac0: 695d 2066 6f72 2069 2069 6e20 6461 7461  i] for i in data
-00017ad0: 7372 632e 6466 5b64 6174 6173 7263 2e64  src.df[datasrc.d
-00017ae0: 662e 636f 6c75 6d6e 735b 305d 5d5d 0d0a  f.columns[0]]]..
-00017af0: 2020 2020 2020 2020 2323 2069 6620 6e6f          ## if no
-00017b00: 7420 7669 6577 626f 782e 785f 696e 6465  t viewbox.x_inde
-00017b10: 7865 643a 0d0a 2020 2020 2020 2020 2020  xed:..          
-00017b20: 2020 2323 205f 7365 745f 785f 6c69 6d69    ## _set_x_limi
-00017b30: 7473 2861 782c 2064 6174 6173 7263 290d  ts(ax, datasrc).
-00017b40: 0a20 2020 2023 2075 7064 6174 6520 7065  .    # update pe
-00017b50: 7269 6f64 2069 6620 7468 6973 2064 6174  riod if this dat
-00017b60: 6173 7263 2068 6173 2068 6967 6865 7220  asrc has higher 
-00017b70: 7469 6d65 2072 6573 6f6c 7574 696f 6e0d  time resolution.
-00017b80: 0a20 2020 2067 6c6f 6261 6c20 6570 6f63  .    global epoc
-00017b90: 685f 7065 7269 6f64 0d0a 2020 2020 6966  h_period..    if
-00017ba0: 2064 6174 6173 7263 2e74 696d 6562 6173   datasrc.timebas
-00017bb0: 6564 2829 2061 6e64 2028 6570 6f63 685f  ed() and (epoch_
-00017bc0: 7065 7269 6f64 203e 2031 6537 206f 7220  period > 1e7 or 
-00017bd0: 6e6f 7420 6461 7461 7372 632e 7374 616e  not datasrc.stan
-00017be0: 6461 6c6f 6e65 293a 0d0a 2020 2020 2020  dalone):..      
-00017bf0: 2020 6570 5f73 6563 7320 3d20 6461 7461    ep_secs = data
-00017c00: 7372 632e 7065 7269 6f64 5f6e 7320 2f20  src.period_ns / 
-00017c10: 3165 390d 0a20 2020 2020 2020 2065 706f  1e9..        epo
-00017c20: 6368 5f70 6572 696f 6420 3d20 6570 5f73  ch_period = ep_s
-00017c30: 6563 7320 6966 2065 705f 7365 6373 203c  ecs if ep_secs <
-00017c40: 2065 706f 6368 5f70 6572 696f 6420 656c   epoch_period el
-00017c50: 7365 2065 706f 6368 5f70 6572 696f 640d  se epoch_period.
-00017c60: 0a0d 0a0d 0a64 6566 205f 6861 735f 7469  .....def _has_ti
-00017c70: 6d65 636f 6c28 6466 293a 0d0a 2020 2020  mecol(df):..    
-00017c80: 7265 7475 726e 206c 656e 2864 662e 636f  return len(df.co
-00017c90: 6c75 6d6e 7329 203e 3d20 320d 0a0d 0a0d  lumns) >= 2.....
-00017ca0: 0a64 6566 205f 7365 745f 6d61 785f 7a6f  .def _set_max_zo
-00017cb0: 6f6d 2876 6273 293a 0d0a 2020 2020 2727  om(vbs):..    ''
-00017cc0: 2753 6574 2074 6865 2072 656c 6174 6976  'Set the relativ
-00017cd0: 6520 616c 6c6f 7765 6420 7a6f 6f6d 206c  e allowed zoom l
-00017ce0: 6576 656c 2062 6574 7765 656e 2061 7865  evel between axe
-00017cf0: 7320 6772 6f75 7073 2c20 7768 6572 6520  s groups, where 
-00017d00: 7468 6520 6c6f 7765 7374 2d72 6573 6f6c  the lowest-resol
-00017d10: 7574 696f 6e0d 0a20 2020 2020 2020 706c  ution..       pl
-00017d20: 6f74 2069 6e20 6561 6368 2067 726f 7570  ot in each group
-00017d30: 2075 7365 7320 6d61 785f 7a6f 6f6d 5f70   uses max_zoom_p
-00017d40: 6f69 6e74 732c 2077 6869 6c65 2074 6865  oints, while the
-00017d50: 206f 7468 6572 7320 6765 7420 6120 7363   others get a sc
-00017d60: 616c 6520 3e3d 3120 6f66 2074 6865 6972  ale >=1 of their
-00017d70: 0d0a 2020 2020 2020 2072 6573 7065 6374  ..       respect
-00017d80: 6976 6520 6869 6768 6573 7420 7a6f 6f6d  ive highest zoom
-00017d90: 206c 6576 656c 2e27 2727 0d0a 2020 2020   level.'''..    
-00017da0: 6772 6f75 7073 203d 2064 6566 6175 6c74  groups = default
-00017db0: 6469 6374 2873 6574 290d 0a20 2020 2066  dict(set)..    f
-00017dc0: 6f72 2076 6220 696e 2076 6273 3a0d 0a20  or vb in vbs:.. 
-00017dd0: 2020 2020 2020 206d 6173 7465 725f 7662         master_vb
-00017de0: 203d 2076 622e 6c69 6e6b 6564 5669 6577   = vb.linkedView
-00017df0: 2830 290d 0a20 2020 2020 2020 2069 6620  (0)..        if 
-00017e00: 7662 2e64 6174 6173 7263 2061 6e64 206d  vb.datasrc and m
-00017e10: 6173 7465 725f 7662 2061 6e64 206d 6173  aster_vb and mas
-00017e20: 7465 725f 7662 2e64 6174 6173 7263 3a0d  ter_vb.datasrc:.
-00017e30: 0a20 2020 2020 2020 2020 2020 2067 726f  .            gro
-00017e40: 7570 735b 6d61 7374 6572 5f76 625d 2e61  ups[master_vb].a
-00017e50: 6464 2876 6229 0d0a 2020 2020 2020 2020  dd(vb)..        
-00017e60: 2020 2020 6772 6f75 7073 5b6d 6173 7465      groups[maste
-00017e70: 725f 7662 5d2e 6164 6428 6d61 7374 6572  r_vb].add(master
-00017e80: 5f76 6229 0d0a 2020 2020 666f 7220 6772  _vb)..    for gr
-00017e90: 6f75 7020 696e 2067 726f 7570 732e 7661  oup in groups.va
-00017ea0: 6c75 6573 2829 3a0d 0a20 2020 2020 2020  lues():..       
-00017eb0: 206d 696e 6c65 6e20 3d20 6d69 6e28 6c65   minlen = min(le
-00017ec0: 6e28 7662 2e64 6174 6173 7263 2e64 6629  n(vb.datasrc.df)
-00017ed0: 2066 6f72 2076 6220 696e 2067 726f 7570   for vb in group
-00017ee0: 290d 0a20 2020 2020 2020 2066 6f72 2076  )..        for v
-00017ef0: 6220 696e 2067 726f 7570 3a0d 0a20 2020  b in group:..   
-00017f00: 2020 2020 2020 2020 2076 622e 6d61 785f           vb.max_
-00017f10: 7a6f 6f6d 5f70 6f69 6e74 735f 6620 3d20  zoom_points_f = 
-00017f20: 6c65 6e28 7662 2e64 6174 6173 7263 2e64  len(vb.datasrc.d
-00017f30: 6629 202f 206d 696e 6c65 6e0d 0a0d 0a0d  f) / minlen.....
-00017f40: 0a64 6566 205f 6164 6a75 7374 5f72 656e  .def _adjust_ren
-00017f50: 6b6f 5f64 6174 6173 7263 2862 696e 732c  ko_datasrc(bins,
-00017f60: 2073 7465 702c 2064 6174 6173 7263 293a   step, datasrc):
-00017f70: 0d0a 2020 2020 6966 206e 6f74 2062 696e  ..    if not bin
-00017f80: 7320 616e 6420 6e6f 7420 7374 6570 3a0d  s and not step:.
-00017f90: 0a20 2020 2020 2020 2062 696e 7320 3d20  .        bins = 
-00017fa0: 3530 0d0a 2020 2020 6966 206e 6f74 2073  50..    if not s
-00017fb0: 7465 703a 0d0a 2020 2020 2020 2020 7374  tep:..        st
-00017fc0: 6570 203d 2028 6461 7461 7372 632e 792e  ep = (datasrc.y.
-00017fd0: 6d61 7828 292d 6461 7461 7372 632e 792e  max()-datasrc.y.
-00017fe0: 6d69 6e28 2929 202f 2062 696e 730d 0a20  min()) / bins.. 
-00017ff0: 2020 2062 7269 636b 7320 3d20 6461 7461     bricks = data
-00018000: 7372 632e 792e 6469 6666 2829 202f 2073  src.y.diff() / s
-00018010: 7465 700d 0a20 2020 2062 7269 636b 7320  tep..    bricks 
-00018020: 3d20 2864 6174 6173 7263 2e79 5b62 7269  = (datasrc.y[bri
-00018030: 636b 732e 6973 6e75 6c6c 2829 207c 2028  cks.isnull() | (
-00018040: 6272 6963 6b73 2e61 6273 2829 3e3d 302e  bricks.abs()>=0.
-00018050: 3529 5d20 2f20 7374 6570 292e 726f 756e  5)] / step).roun
-00018060: 6428 292e 6173 7479 7065 2869 6e74 290d  d().astype(int).
-00018070: 0a20 2020 2065 7874 7261 7320 3d20 6461  .    extras = da
-00018080: 7461 7372 632e 6466 2e69 6c6f 635b 3a2c  tasrc.df.iloc[:,
-00018090: 2064 6174 6173 7263 2e63 6f6c 5f64 6174   datasrc.col_dat
-000180a0: 615f 6f66 6673 6574 2b31 3a5d 0d0a 2020  a_offset+1:]..  
-000180b0: 2020 7473 203d 2064 6174 6173 7263 2e78    ts = datasrc.x
-000180c0: 5b62 7269 636b 732e 696e 6465 785d 0d0a  [bricks.index]..
-000180d0: 2020 2020 7570 203d 2062 7269 636b 732e      up = bricks.
-000180e0: 696c 6f63 5b30 5d20 2b20 310d 0a20 2020  iloc[0] + 1..   
-000180f0: 2064 6e20 3d20 7570 202d 2032 0d0a 2020   dn = up - 2..  
-00018100: 2020 6461 7461 203d 205b 5d0d 0a20 2020    data = []..   
-00018110: 2066 6f72 2074 2c69 2c62 7269 636b 2069   for t,i,brick i
-00018120: 6e20 7a69 7028 7473 2c20 6272 6963 6b73  n zip(ts, bricks
-00018130: 2e69 6e64 6578 2c20 6272 6963 6b73 293a  .index, bricks):
-00018140: 0d0a 2020 2020 2020 2020 7320 3d20 300d  ..        s = 0.
-00018150: 0a20 2020 2020 2020 2069 6620 6272 6963  .        if bric
-00018160: 6b20 3e3d 2075 703a 0d0a 2020 2020 2020  k >= up:..      
-00018170: 2020 2020 2020 7830 2c78 312c 7320 3d20        x0,x1,s = 
-00018180: 7570 2d31 2c62 7269 636b 2c2b 310d 0a20  up-1,brick,+1.. 
-00018190: 2020 2020 2020 2020 2020 2075 7020 3d20             up = 
-000181a0: 6272 6963 6b2b 310d 0a20 2020 2020 2020  brick+1..       
-000181b0: 2020 2020 2064 6e20 3d20 6272 6963 6b2d       dn = brick-
-000181c0: 320d 0a20 2020 2020 2020 2065 6c69 6620  2..        elif 
-000181d0: 6272 6963 6b20 3c3d 2064 6e3a 0d0a 2020  brick <= dn:..  
-000181e0: 2020 2020 2020 2020 2020 7830 2c78 312c            x0,x1,
-000181f0: 7320 3d20 646e 2c62 7269 636b 2d31 2c2d  s = dn,brick-1,-
-00018200: 310d 0a20 2020 2020 2020 2020 2020 2075  1..            u
-00018210: 7020 3d20 6272 6963 6b2b 320d 0a20 2020  p = brick+2..   
-00018220: 2020 2020 2020 2020 2064 6e20 3d20 6272           dn = br
-00018230: 6963 6b2d 310d 0a20 2020 2020 2020 2069  ick-1..        i
-00018240: 6620 733a 0d0a 2020 2020 2020 2020 2020  f s:..          
-00018250: 2020 666f 7220 7820 696e 2072 616e 6765    for x in range
-00018260: 2878 302c 2078 312c 2073 293a 0d0a 2020  (x0, x1, s):..  
-00018270: 2020 2020 2020 2020 2020 2020 2020 7464                td
-00018280: 203d 2061 6273 2878 312d 7829 2d31 0d0a   = abs(x1-x)-1..
-00018290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182a0: 6473 203d 2030 2069 6620 733e 3020 656c  ds = 0 if s>0 el
-000182b0: 7365 2073 7465 700d 0a20 2020 2020 2020  se step..       
-000182c0: 2020 2020 2020 2020 2079 203d 2078 2a73           y = x*s
-000182d0: 7465 700d 0a20 2020 2020 2020 2020 2020  tep..           
-000182e0: 2020 2020 207a 203d 206c 6973 7428 6578       z = list(ex
-000182f0: 7472 6173 2e6c 6f63 5b69 5d29 0d0a 2020  tras.loc[i])..  
-00018300: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00018310: 7461 2e61 7070 656e 6428 5b74 2d74 642c  ta.append([t-td,
-00018320: 2079 2b64 732c 2079 2b73 7465 702d 6473   y+ds, y+step-ds
-00018330: 2c20 792b 7374 6570 2c20 795d 202b 207a  , y+step, y] + z
-00018340: 290d 0a20 2020 2064 6174 6173 7263 2e73  )..    datasrc.s
-00018350: 6574 5f64 6628 7064 2e44 6174 6146 7261  et_df(pd.DataFra
-00018360: 6d65 2864 6174 612c 2063 6f6c 756d 6e73  me(data, columns
-00018370: 3d27 7469 6d65 206f 7065 6e20 636c 6f73  ='time open clos
-00018380: 6520 6869 6768 206c 6f77 272e 7370 6c69  e high low'.spli
-00018390: 7428 292b 6c69 7374 2865 7874 7261 732e  t()+list(extras.
-000183a0: 636f 6c75 6d6e 7329 2929 0d0a 0d0a 0d0a  columns)))......
-000183b0: 6465 6620 5f61 646a 7573 745f 7265 6e6b  def _adjust_renk
-000183c0: 6f5f 6c6f 675f 6461 7461 7372 6328 6269  o_log_datasrc(bi
-000183d0: 6e73 2c20 7374 6570 2c20 6461 7461 7372  ns, step, datasr
-000183e0: 6329 3a0d 0a20 2020 2064 6174 6173 7263  c):..    datasrc
-000183f0: 2e64 662e 6c6f 635b 3a2c 6461 7461 7372  .df.loc[:,datasr
-00018400: 632e 6466 2e63 6f6c 756d 735b 315d 5d20  c.df.colums[1]] 
-00018410: 3d20 6e70 2e6c 6f67 3130 2864 6174 6173  = np.log10(datas
-00018420: 7263 2e64 662e 696c 6f63 5b3a 2c31 5d29  rc.df.iloc[:,1])
-00018430: 0d0a 2020 2020 5f61 646a 7573 745f 7265  ..    _adjust_re
-00018440: 6e6b 6f5f 6461 7461 7372 6328 6269 6e73  nko_datasrc(bins
-00018450: 2c20 7374 6570 2c20 6461 7461 7372 6329  , step, datasrc)
-00018460: 0d0a 2020 2020 6461 7461 7372 632e 6466  ..    datasrc.df
-00018470: 2e6c 6f63 5b3a 2c64 6174 6173 7263 2e64  .loc[:,datasrc.d
-00018480: 662e 636f 6c75 6d73 5b31 3a35 5d5d 203d  f.colums[1:5]] =
-00018490: 2031 302a 2a64 6174 6173 7263 2e64 662e   10**datasrc.df.
-000184a0: 696c 6f63 5b3a 2c31 3a35 5d0d 0a0d 0a0d  iloc[:,1:5].....
-000184b0: 0a64 6566 205f 6164 6a75 7374 5f76 6f6c  .def _adjust_vol
-000184c0: 756d 655f 6461 7461 7372 6328 6461 7461  ume_datasrc(data
-000184d0: 7372 6329 3a0d 0a20 2020 2069 6620 6c65  src):..    if le
-000184e0: 6e28 6461 7461 7372 632e 6466 2e63 6f6c  n(datasrc.df.col
-000184f0: 756d 6e73 2920 3c3d 2034 3a0d 0a20 2020  umns) <= 4:..   
-00018500: 2020 2020 2064 6174 6173 7263 2e64 662e       datasrc.df.
-00018510: 696e 7365 7274 2833 2c20 275f 7a65 726f  insert(3, '_zero
-00018520: 5f27 2c20 5b30 5d2a 6c65 6e28 6461 7461  _', [0]*len(data
-00018530: 7372 632e 6466 2929 2023 2062 6173 6520  src.df)) # base 
-00018540: 6f66 2063 616e 646c 6573 2069 7320 616c  of candles is al
-00018550: 7761 7973 207a 6572 6f0d 0a20 2020 2064  ways zero..    d
-00018560: 6174 6173 7263 2e73 6574 5f64 6628 6461  atasrc.set_df(da
-00018570: 7461 7372 632e 6466 2e69 6c6f 635b 3a2c  tasrc.df.iloc[:,
-00018580: 5b30 2c33 2c34 2c31 2c32 5d5d 2920 2320  [0,3,4,1,2]]) # 
-00018590: 7265 2d61 7272 616e 6765 2063 6f6c 756d  re-arrange colum
-000185a0: 6e73 2066 6f72 2072 656e 6465 7269 6e67  ns for rendering
-000185b0: 0d0a 2020 2020 6461 7461 7372 632e 7363  ..    datasrc.sc
-000185c0: 616c 655f 636f 6c73 203d 205b 312c 2032  ale_cols = [1, 2
-000185d0: 5d20 2320 7363 616c 6520 6279 2062 6f74  ] # scale by bot
-000185e0: 6820 6261 7365 6c69 6e65 2061 6e64 2076  h baseline and v
-000185f0: 6f6c 756d 650d 0a0d 0a0d 0a64 6566 205f  olume......def _
-00018600: 7072 6561 646a 7573 745f 686f 7269 7a5f  preadjust_horiz_
-00018610: 6461 7461 7372 6328 6461 7461 7372 6329  datasrc(datasrc)
-00018620: 3a0d 0a20 2020 2061 7272 6179 6966 7920  :..    arrayify 
-00018630: 3d20 6c61 6d62 6461 2064 3a20 642e 7661  = lambda d: d.va
-00018640: 6c75 6573 2069 6620 7479 7065 2864 2920  lues if type(d) 
-00018650: 3d3d 2070 642e 4461 7461 4672 616d 6520  == pd.DataFrame 
-00018660: 656c 7365 2064 0d0a 2020 2020 2320 6372  else d..    # cr
-00018670: 6561 7465 2061 2064 6174 6166 7261 6d65  eate a dataframe
-00018680: 2066 726f 6d20 7468 6520 696e 7075 7420   from the input 
-00018690: 6172 7261 790d 0a20 2020 2074 696d 6573  array..    times
-000186a0: 203d 205b 7420 666f 7220 742c 726f 7720   = [t for t,row 
-000186b0: 696e 2064 6174 6173 7263 5d0d 0a20 2020  in datasrc]..   
-000186c0: 2069 6620 6c65 6e28 7469 6d65 7329 203d   if len(times) =
-000186d0: 3d20 313a 2023 2061 6464 2061 6e20 656d  = 1: # add an em
-000186e0: 7074 7920 7469 6d65 2073 6c6f 740d 0a20  pty time slot.. 
-000186f0: 2020 2020 2020 2074 696d 6573 203d 205b         times = [
-00018700: 7469 6d65 735b 305d 2c20 7469 6d65 735b  times[0], times[
-00018710: 305d 2b31 5d0d 0a20 2020 2020 2020 2064  0]+1]..        d
-00018720: 6174 6173 7263 203d 2064 6174 6173 7263  atasrc = datasrc
-00018730: 202b 205b 5b74 696d 6573 5b31 5d2c 205b   + [[times[1], [
-00018740: 2870 2c30 2920 666f 7220 702c 7620 696e  (p,0) for p,v in
-00018750: 2061 7272 6179 6966 7928 6461 7461 7372   arrayify(datasr
-00018760: 635b 305d 5b31 5d29 5d5d 5d0d 0a20 2020  c[0][1])]]]..   
-00018770: 2064 6174 6120 3d20 5b5b 6520 666f 7220   data = [[e for 
-00018780: 7620 696e 2061 7272 6179 6966 7928 726f  v in arrayify(ro
-00018790: 7729 2066 6f72 2065 2069 6e20 765d 2066  w) for e in v] f
-000187a0: 6f72 2074 2c72 6f77 2069 6e20 6461 7461  or t,row in data
-000187b0: 7372 635d 0d0a 2020 2020 6d61 7863 6f6c  src]..    maxcol
-000187c0: 7320 3d20 6d61 7828 6c65 6e28 726f 7729  s = max(len(row)
-000187d0: 2066 6f72 2072 6f77 2069 6e20 6461 7461   for row in data
-000187e0: 290d 0a20 2020 2072 6574 7572 6e20 7064  )..    return pd
-000187f0: 2e44 6174 6146 7261 6d65 2863 6f6c 756d  .DataFrame(colum
-00018800: 6e73 3d72 616e 6765 286d 6178 636f 6c73  ns=range(maxcols
-00018810: 292c 2064 6174 613d 6461 7461 2c20 696e  ), data=data, in
-00018820: 6465 783d 7469 6d65 7329 0d0a 0d0a 0d0a  dex=times)......
-00018830: 6465 6620 5f61 646a 7573 745f 686f 7269  def _adjust_hori
-00018840: 7a5f 6461 7461 7372 6328 6461 7461 7372  z_datasrc(datasr
-00018850: 6329 3a0d 0a20 2020 2023 2074 6f20 6265  c):..    # to be
-00018860: 2061 626c 6520 746f 2073 6361 6c65 2070   able to scale p
-00018870: 726f 7065 726c 792c 206d 6f76 6520 7468  roperly, move th
-00018880: 6520 6c61 7374 2074 776f 2076 616c 7565  e last two value
-00018890: 7320 746f 2074 6865 206c 6173 7420 7477  s to the last tw
-000188a0: 6f20 636f 6c75 6d6e 730d 0a20 2020 2076  o columns..    v
-000188b0: 616c 7565 7320 3d20 6461 7461 7372 632e  alues = datasrc.
-000188c0: 6466 2e69 6c6f 635b 3a2c 2031 3a5d 2e76  df.iloc[:, 1:].v
-000188d0: 616c 7565 730d 0a20 2020 2066 6f72 2069  alues..    for i
-000188e0: 2c6e 726f 7720 696e 2065 6e75 6d65 7261  ,nrow in enumera
-000188f0: 7465 2876 616c 7565 7329 3a0d 0a20 2020  te(values):..   
-00018900: 2020 2020 206f 726f 7720 3d20 6e72 6f77       orow = nrow
-00018910: 5b7e 6e70 2e69 736e 616e 286e 726f 7729  [~np.isnan(nrow)
-00018920: 5d0d 0a20 2020 2020 2020 2069 6620 6c65  ]..        if le
-00018930: 6e28 6e72 6f77 2920 3d3d 206c 656e 286f  n(nrow) == len(o
-00018940: 726f 7729 206f 7220 6c65 6e28 6f72 6f77  row) or len(orow
-00018950: 2920 3c3d 2032 3a0d 0a20 2020 2020 2020  ) <= 2:..       
-00018960: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
-00018970: 2020 2020 2020 206e 726f 775b 2d32 3a5d         nrow[-2:]
-00018980: 203d 206f 726f 775b 2d32 3a5d 0d0a 2020   = orow[-2:]..  
-00018990: 2020 2020 2020 6e72 6f77 5b6c 656e 286f        nrow[len(o
-000189a0: 726f 7729 2d32 3a6c 656e 286f 726f 7729  row)-2:len(orow)
-000189b0: 5d20 3d20 6e70 2e6e 616e 0d0a 2020 2020  ] = np.nan..    
-000189c0: 6461 7461 7372 632e 6466 5b64 6174 6173  datasrc.df[datas
-000189d0: 7263 2e64 662e 636f 6c75 6d6e 735b 313a  rc.df.columns[1:
-000189e0: 5d5d 203d 2076 616c 7565 730d 0a0d 0a0d  ]] = values.....
-000189f0: 0a64 6566 205f 6164 6a75 7374 5f62 6172  .def _adjust_bar
-00018a00: 5f64 6174 6173 7263 2864 6174 6173 7263  _datasrc(datasrc
-00018a10: 2c20 6f72 6465 725f 636f 6c73 3d54 7275  , order_cols=Tru
-00018a20: 6529 3a0d 0a20 2020 2069 6620 6c65 6e28  e):..    if len(
-00018a30: 6461 7461 7372 632e 6466 2e63 6f6c 756d  datasrc.df.colum
-00018a40: 6e73 2920 3c3d 2032 3a0d 0a20 2020 2020  ns) <= 2:..     
-00018a50: 2020 2064 6174 6173 7263 2e64 662e 696e     datasrc.df.in
-00018a60: 7365 7274 2831 2c20 275f 6261 7365 5f27  sert(1, '_base_'
-00018a70: 2c20 5b30 5d2a 6c65 6e28 6461 7461 7372  , [0]*len(datasr
-00018a80: 632e 6466 2929 2023 2062 6173 650d 0a20  c.df)) # base.. 
-00018a90: 2020 2069 6620 6c65 6e28 6461 7461 7372     if len(datasr
-00018aa0: 632e 6466 2e63 6f6c 756d 6e73 2920 3c3d  c.df.columns) <=
-00018ab0: 2034 3a0d 0a20 2020 2020 2020 2064 6174   4:..        dat
-00018ac0: 6173 7263 2e64 662e 696e 7365 7274 2831  asrc.df.insert(1
-00018ad0: 2c20 275f 6f70 656e 5f27 2c20 205b 305d  , '_open_',  [0]
-00018ae0: 2a6c 656e 2864 6174 6173 7263 2e64 6629  *len(datasrc.df)
-00018af0: 2920 2320 226f 7065 6e22 2066 6f72 2063  ) # "open" for c
-00018b00: 6f6c 6f72 0d0a 2020 2020 2020 2020 6461  olor..        da
-00018b10: 7461 7372 632e 6466 2e69 6e73 6572 7428  tasrc.df.insert(
-00018b20: 322c 2027 5f63 6c6f 7365 5f27 2c20 6461  2, '_close_', da
-00018b30: 7461 7372 632e 6466 2e69 6c6f 635b 3a2c  tasrc.df.iloc[:,
-00018b40: 2033 5d29 2023 2022 636c 6f73 6522 2028   3]) # "close" (
-00018b50: 6163 7475 616c 2062 6172 2076 616c 7565  actual bar value
-00018b60: 2920 666f 7220 636f 6c6f 720d 0a20 2020  ) for color..   
-00018b70: 2069 6620 6f72 6465 725f 636f 6c73 3a0d   if order_cols:.
-00018b80: 0a20 2020 2020 2020 2064 6174 6173 7263  .        datasrc
-00018b90: 2e73 6574 5f64 6628 6461 7461 7372 632e  .set_df(datasrc.
-00018ba0: 6466 2e69 6c6f 635b 3a2c 5b30 2c33 2c34  df.iloc[:,[0,3,4
-00018bb0: 2c31 2c32 5d5d 2920 2320 7265 2d61 7272  ,1,2]]) # re-arr
-00018bc0: 616e 6765 2063 6f6c 756d 6e73 2066 6f72  ange columns for
-00018bd0: 2072 656e 6465 7269 6e67 0d0a 2020 2020   rendering..    
-00018be0: 6461 7461 7372 632e 7363 616c 655f 636f  datasrc.scale_co
-00018bf0: 6c73 203d 205b 312c 2032 5d20 2320 7363  ls = [1, 2] # sc
-00018c00: 616c 6520 6279 2062 6f74 6820 6261 7365  ale by both base
-00018c10: 6c69 6e65 2061 6e64 2076 6f6c 756d 650d  line and volume.
-00018c20: 0a0d 0a0d 0a64 6566 205f 7570 6461 7465  .....def _update
-00018c30: 5f64 6174 6128 7072 6561 646a 7573 7466  _data(preadjustf
-00018c40: 756e 632c 2061 646a 7573 7466 756e 632c  unc, adjustfunc,
-00018c50: 2069 7465 6d2c 2064 732c 2067 6678 3d54   item, ds, gfx=T
-00018c60: 7275 6529 3a0d 0a20 2020 2069 6620 7072  rue):..    if pr
-00018c70: 6561 646a 7573 7466 756e 633a 0d0a 2020  eadjustfunc:..  
-00018c80: 2020 2020 2020 6473 203d 2070 7265 6164        ds = pread
-00018c90: 6a75 7374 6675 6e63 2864 7329 0d0a 2020  justfunc(ds)..  
-00018ca0: 2020 6473 203d 205f 6372 6561 7465 5f64    ds = _create_d
-00018cb0: 6174 6173 7263 2869 7465 6d2e 6178 2c20  atasrc(item.ax, 
-00018cc0: 6473 290d 0a20 2020 2069 6620 6164 6a75  ds)..    if adju
-00018cd0: 7374 6675 6e63 3a0d 0a20 2020 2020 2020  stfunc:..       
-00018ce0: 2061 646a 7573 7466 756e 6328 6473 290d   adjustfunc(ds).
-00018cf0: 0a20 2020 2063 7320 3d20 6c69 7374 2869  .    cs = list(i
-00018d00: 7465 6d2e 6461 7461 7372 632e 6466 2e63  tem.datasrc.df.c
-00018d10: 6f6c 756d 6e73 5b3a 315d 2920 2b20 6c69  olumns[:1]) + li
-00018d20: 7374 2869 7465 6d2e 6461 7461 7372 632e  st(item.datasrc.
-00018d30: 6466 2e63 6f6c 756d 6e73 5b69 7465 6d2e  df.columns[item.
-00018d40: 6461 7461 7372 632e 636f 6c5f 6461 7461  datasrc.col_data
-00018d50: 5f6f 6666 7365 743a 5d29 0d0a 2020 2020  _offset:])..    
-00018d60: 6966 206c 656e 2863 7329 203e 3d20 6c65  if len(cs) >= le
-00018d70: 6e28 6473 2e64 662e 636f 6c75 6d6e 7329  n(ds.df.columns)
-00018d80: 3a0d 0a20 2020 2020 2020 2064 732e 6466  :..        ds.df
-00018d90: 2e63 6f6c 756d 6e73 203d 2063 735b 3a6c  .columns = cs[:l
-00018da0: 656e 2864 732e 6466 2e63 6f6c 756d 6e73  en(ds.df.columns
-00018db0: 295d 0d0a 2020 2020 6974 656d 2e64 6174  )]..    item.dat
-00018dc0: 6173 7263 2e75 7064 6174 6528 6473 290d  asrc.update(ds).
-00018dd0: 0a20 2020 205f 7365 745f 6461 7461 7372  .    _set_datasr
-00018de0: 6328 6974 656d 2e61 782c 2069 7465 6d2e  c(item.ax, item.
-00018df0: 6461 7461 7372 632c 2061 6464 636f 6c73  datasrc, addcols
-00018e00: 3d46 616c 7365 290d 0a20 2020 2069 6620  =False)..    if 
-00018e10: 6766 783a 0d0a 2020 2020 2020 2020 6974  gfx:..        it
-00018e20: 656d 2e75 7064 6174 655f 6766 7828 290d  em.update_gfx().
-00018e30: 0a0d 0a0d 0a64 6566 205f 7570 6461 7465  .....def _update
-00018e40: 5f67 6678 2869 7465 6d29 3a0d 0a20 2020  _gfx(item):..   
-00018e50: 205f 7374 6172 745f 7669 7375 616c 5f75   _start_visual_u
-00018e60: 7064 6174 6528 6974 656d 290d 0a20 2020  pdate(item)..   
-00018e70: 2066 6f72 2069 2069 6e20 6974 656d 2e61   for i in item.a
-00018e80: 782e 6974 656d 733a 0d0a 2020 2020 2020  x.items:..      
-00018e90: 2020 6966 2069 203d 3d20 6974 656d 206f    if i == item o
-00018ea0: 7220 6e6f 7420 6861 7361 7474 7228 692c  r not hasattr(i,
-00018eb0: 2027 6461 7461 7372 6327 293a 0d0a 2020   'datasrc'):..  
-00018ec0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00018ed0: 7565 0d0a 2020 2020 2020 2020 6c63 203d  ue..        lc =
-00018ee0: 206c 656e 2869 7465 6d2e 6461 7461 7372   len(item.datasr
-00018ef0: 632e 6466 290d 0a20 2020 2020 2020 206c  c.df)..        l
-00018f00: 6920 3d20 6c65 6e28 692e 6461 7461 7372  i = len(i.datasr
-00018f10: 632e 6466 290d 0a20 2020 2020 2020 2069  c.df)..        i
-00018f20: 6620 6c63 2061 6e64 206c 6920 616e 6420  f lc and li and 
-00018f30: 6d61 7828 6c63 2c6c 6929 2f6d 696e 286c  max(lc,li)/min(l
-00018f40: 632c 6c69 2920 3e20 3130 303a 2023 2054  c,li) > 100: # T
-00018f50: 4f44 4f3a 2073 686f 756c 6420 6265 2074  ODO: should be t
-00018f60: 7970 6564 2069 6e73 7465 6164 0d0a 2020  yped instead..  
-00018f70: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00018f80: 7565 0d0a 2020 2020 2020 2020 6363 203d  ue..        cc =
-00018f90: 2069 7465 6d2e 6461 7461 7372 632e 6466   item.datasrc.df
-00018fa0: 2e63 6f6c 756d 6e73 0d0a 2020 2020 2020  .columns..      
-00018fb0: 2020 6369 203d 2069 2e64 6174 6173 7263    ci = i.datasrc
-00018fc0: 2e64 662e 636f 6c75 6d6e 730d 0a20 2020  .df.columns..   
-00018fd0: 2020 2020 2063 3020 3d20 5b63 2066 6f72       c0 = [c for
-00018fe0: 2063 2069 6e20 6369 2069 6620 6320 696e   c in ci if c in
-00018ff0: 2063 635d 0d0a 2020 2020 2020 2020 6331   cc]..        c1
-00019000: 203d 205b 6320 666f 7220 6320 696e 2063   = [c for c in c
-00019010: 6920 6966 206e 6f74 2063 2069 6e20 6363  i if not c in cc
-00019020: 5d0d 0a20 2020 2020 2020 2064 665f 636c  ]..        df_cl
-00019030: 6970 7065 6420 3d20 6974 656d 2e64 6174  ipped = item.dat
-00019040: 6173 7263 2e64 665b 6330 5d0d 0a20 2020  asrc.df[c0]..   
-00019050: 2020 2020 2069 6620 6331 3a0d 0a20 2020       if c1:..   
-00019060: 2020 2020 2020 2020 2064 665f 636c 6970           df_clip
-00019070: 7065 6420 3d20 6466 5f63 6c69 7070 6564  ped = df_clipped
-00019080: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
-00019090: 2020 2020 2066 6f72 2063 2069 6e20 6331       for c in c1
-000190a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000190b0: 2020 2064 665f 636c 6970 7065 645b 635d     df_clipped[c]
-000190c0: 203d 2069 2e64 6174 6173 7263 2e64 665b   = i.datasrc.df[
-000190d0: 635d 0d0a 2020 2020 2020 2020 692e 6461  c]..        i.da
-000190e0: 7461 7372 632e 7365 745f 6466 2864 665f  tasrc.set_df(df_
-000190f0: 636c 6970 7065 6429 0d0a 2020 2020 2020  clipped)..      
-00019100: 2020 6272 6561 6b0d 0a20 2020 2075 7064    break..    upd
-00019110: 6174 655f 7369 6764 6967 203d 2046 616c  ate_sigdig = Fal
-00019120: 7365 0d0a 2020 2020 6966 206e 6f74 2069  se..    if not i
-00019130: 7465 6d2e 6461 7461 7372 632e 7374 616e  tem.datasrc.stan
-00019140: 6461 6c6f 6e65 2061 6e64 206e 6f74 2069  dalone and not i
-00019150: 7465 6d2e 6178 2e76 622e 7769 6e2e 5f69  tem.ax.vb.win._i
-00019160: 734d 6f75 7365 4c65 6674 4472 6167 3a0d  sMouseLeftDrag:.
-00019170: 0a20 2020 2020 2020 2023 206e 6577 206c  .        # new l
-00019180: 696d 6974 7320 7768 656e 2065 7874 656e  imits when exten
-00019190: 6469 6e67 2f72 6564 7563 696e 6720 616d  ding/reducing am
-000191a0: 6f75 6e74 206f 6620 6461 7461 0d0a 2020  ount of data..  
-000191b0: 2020 2020 2020 785f 6d69 6e2c 7831 203d        x_min,x1 =
-000191c0: 205f 7365 745f 785f 6c69 6d69 7473 2869   _set_x_limits(i
-000191d0: 7465 6d2e 6178 2c20 6974 656d 2e64 6174  tem.ax, item.dat
-000191e0: 6173 7263 290d 0a20 2020 2020 2020 2023  asrc)..        #
-000191f0: 2073 6372 6f6c 6c20 616c 6c20 706c 6f74   scroll all plot
-00019200: 7320 6966 2077 6527 7265 2061 7420 7468  s if we're at th
-00019210: 6520 6661 7220 7269 6768 740d 0a20 2020  e far right..   
-00019220: 2020 2020 2074 7220 3d20 6974 656d 2e61       tr = item.a
-00019230: 782e 7662 2e74 6172 6765 7452 6563 7428  x.vb.targetRect(
-00019240: 290d 0a20 2020 2020 2020 2078 3020 3d20  )..        x0 = 
-00019250: 7831 202d 2074 722e 7769 6474 6828 290d  x1 - tr.width().
-00019260: 0a20 2020 2020 2020 2069 6620 7830 203c  .        if x0 <
-00019270: 2072 6967 6874 5f6d 6172 6769 6e5f 6361   right_margin_ca
-00019280: 6e64 6c65 7320 2b20 7369 6465 5f6d 6172  ndles + side_mar
-00019290: 6769 6e3a 0d0a 2020 2020 2020 2020 2020  gin:..          
-000192a0: 2020 7830 203d 202d 7369 6465 5f6d 6172    x0 = -side_mar
-000192b0: 6769 6e0d 0a20 2020 2020 2020 2069 6620  gin..        if 
-000192c0: 7472 2e72 6967 6874 2829 203c 2078 3120  tr.right() < x1 
-000192d0: 2d20 3520 2d20 322a 7269 6768 745f 6d61  - 5 - 2*right_ma
-000192e0: 7267 696e 5f63 616e 646c 6573 3a0d 0a20  rgin_candles:.. 
-000192f0: 2020 2020 2020 2020 2020 2078 3020 3d20             x0 = 
-00019300: 7831 203d 204e 6f6e 650d 0a20 2020 2020  x1 = None..     
-00019310: 2020 2070 7265 765f 746f 7020 3d20 6974     prev_top = it
-00019320: 656d 2e61 782e 7662 2e74 6172 6765 7452  em.ax.vb.targetR
-00019330: 6563 7428 292e 746f 7028 290d 0a20 2020  ect().top()..   
-00019340: 2020 2020 2069 7465 6d2e 6178 2e76 622e       item.ax.vb.
-00019350: 7570 6461 7465 5f79 5f7a 6f6f 6d28 7830  update_y_zoom(x0
-00019360: 2c20 7831 290d 0a20 2020 2020 2020 2074  , x1)..        t
-00019370: 6869 735f 746f 7020 3d20 6974 656d 2e61  his_top = item.a
-00019380: 782e 7662 2e74 6172 6765 7452 6563 7428  x.vb.targetRect(
-00019390: 292e 746f 7028 290d 0a20 2020 2020 2020  ).top()..       
-000193a0: 2069 6620 7468 6973 5f74 6f70 2061 6e64   if this_top and
-000193b0: 206e 6f74 2028 302e 3939 203c 2061 6273   not (0.99 < abs
-000193c0: 2870 7265 765f 746f 702f 7468 6973 5f74  (prev_top/this_t
-000193d0: 6f70 2920 3c20 312e 3031 293a 0d0a 2020  op) < 1.01):..  
-000193e0: 2020 2020 2020 2020 2020 7570 6461 7465            update
-000193f0: 5f73 6967 6469 6720 3d20 5472 7565 0d0a  _sigdig = True..
-00019400: 2020 2020 2020 2020 6966 2069 7465 6d2e          if item.
-00019410: 6178 2e61 7865 735b 2762 6f74 746f 6d27  ax.axes['bottom'
-00019420: 5d5b 2769 7465 6d27 5d2e 6973 5669 7369  ]['item'].isVisi
-00019430: 626c 6528 293a 2023 2075 7064 6174 6520  ble(): # update 
-00019440: 6178 6573 2069 6620 7669 7369 626c 650d  axes if visible.
-00019450: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-00019460: 6d2e 6178 2e61 7865 735b 2762 6f74 746f  m.ax.axes['botto
-00019470: 6d27 5d5b 2769 7465 6d27 5d2e 6869 6465  m']['item'].hide
-00019480: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00019490: 6974 656d 2e61 782e 6178 6573 5b27 626f  item.ax.axes['bo
-000194a0: 7474 6f6d 275d 5b27 6974 656d 275d 2e73  ttom']['item'].s
-000194b0: 686f 7728 290d 0a20 2020 205f 656e 645f  how()..    _end_
-000194c0: 7669 7375 616c 5f75 7064 6174 6528 6974  visual_update(it
-000194d0: 656d 290d 0a20 2020 2069 6620 7570 6461  em)..    if upda
-000194e0: 7465 5f73 6967 6469 673a 0d0a 2020 2020  te_sigdig:..    
-000194f0: 2020 2020 5f75 7064 6174 655f 7369 676e      _update_sign
-00019500: 6966 6963 616e 7473 2869 7465 6d2e 6178  ificants(item.ax
-00019510: 2c20 6974 656d 2e61 782e 7662 2e64 6174  , item.ax.vb.dat
-00019520: 6173 7263 2c20 666f 7263 653d 5472 7565  asrc, force=True
-00019530: 290d 0a0d 0a0d 0a64 6566 205f 7374 6172  )......def _star
-00019540: 745f 7669 7375 616c 5f75 7064 6174 6528  t_visual_update(
-00019550: 6974 656d 293a 0d0a 2020 2020 6966 2069  item):..    if i
-00019560: 7369 6e73 7461 6e63 6528 6974 656d 2c20  sinstance(item, 
-00019570: 4669 6e50 6c6f 7449 7465 6d29 3a0d 0a20  FinPlotItem):.. 
-00019580: 2020 2020 2020 2069 7465 6d2e 6178 2e72         item.ax.r
-00019590: 656d 6f76 6549 7465 6d28 6974 656d 290d  emoveItem(item).
-000195a0: 0a20 2020 2020 2020 2069 7465 6d2e 6469  .        item.di
-000195b0: 7274 7920 3d20 5472 7565 0d0a 2020 2020  rty = True..    
-000195c0: 656c 7365 3a0d 0a20 2020 2020 2020 2079  else:..        y
-000195d0: 203d 2069 7465 6d2e 6461 7461 7372 632e   = item.datasrc.
-000195e0: 7920 2f20 6974 656d 2e61 782e 7662 2e79  y / item.ax.vb.y
-000195f0: 7363 616c 652e 7363 616c 6566 0d0a 2020  scale.scalef..  
-00019600: 2020 2020 2020 6966 2069 7465 6d2e 6178        if item.ax
-00019610: 2e76 622e 7973 6361 6c65 2e73 6361 6c65  .vb.yscale.scale
-00019620: 7479 7065 203d 3d20 276c 6f67 273a 0d0a  type == 'log':..
-00019630: 2020 2020 2020 2020 2020 2020 7920 3d20              y = 
-00019640: 7920 2b20 6c6f 675f 706c 6f74 5f6f 6666  y + log_plot_off
-00019650: 7365 740d 0a20 2020 2020 2020 2078 203d  set..        x =
-00019660: 2069 7465 6d2e 6461 7461 7372 632e 696e   item.datasrc.in
-00019670: 6465 7820 6966 2069 7465 6d2e 6178 2e76  dex if item.ax.v
-00019680: 622e 785f 696e 6465 7865 6420 656c 7365  b.x_indexed else
-00019690: 2069 7465 6d2e 6461 7461 7372 632e 780d   item.datasrc.x.
-000196a0: 0a20 2020 2020 2020 2069 7465 6d2e 7365  .        item.se
-000196b0: 7444 6174 6128 782c 2079 290d 0a0d 0a0d  tData(x, y).....
-000196c0: 0a64 6566 205f 656e 645f 7669 7375 616c  .def _end_visual
-000196d0: 5f75 7064 6174 6528 6974 656d 293a 0d0a  _update(item):..
-000196e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000196f0: 6528 6974 656d 2c20 4669 6e50 6c6f 7449  e(item, FinPlotI
-00019700: 7465 6d29 3a0d 0a20 2020 2020 2020 2069  tem):..        i
-00019710: 7465 6d2e 6178 2e61 6464 4974 656d 2869  tem.ax.addItem(i
-00019720: 7465 6d29 0d0a 2020 2020 2020 2020 6974  tem)..        it
-00019730: 656d 2e72 6570 6169 6e74 2829 0d0a 0d0a  em.repaint()....
-00019740: 0d0a 6465 6620 5f73 6574 5f78 5f6c 696d  ..def _set_x_lim
-00019750: 6974 7328 6178 2c20 6461 7461 7372 6329  its(ax, datasrc)
-00019760: 3a0d 0a20 2020 2078 302c 7831 203d 205f  :..    x0,x1 = _
-00019770: 786d 696e 6d61 7828 6461 7461 7372 632c  xminmax(datasrc,
-00019780: 2078 5f69 6e64 6578 6564 3d61 782e 7662   x_indexed=ax.vb
-00019790: 2e78 5f69 6e64 6578 6564 290d 0a20 2020  .x_indexed)..   
-000197a0: 2061 782e 7365 744c 696d 6974 7328 784d   ax.setLimits(xM
-000197b0: 696e 3d78 302c 2078 4d61 783d 7831 290d  in=x0, xMax=x1).
-000197c0: 0a20 2020 2072 6574 7572 6e20 7830 2c78  .    return x0,x
-000197d0: 310d 0a0d 0a0d 0a64 6566 205f 786d 696e  1......def _xmin
-000197e0: 6d61 7828 6461 7461 7372 632c 2078 5f69  max(datasrc, x_i
-000197f0: 6e64 6578 6564 2c20 696e 6974 5f73 7465  ndexed, init_ste
-00019800: 7073 3d4e 6f6e 652c 2065 7874 7261 5f6d  ps=None, extra_m
-00019810: 6172 6769 6e3d 3029 3a0d 0a20 2020 2069  argin=0):..    i
-00019820: 6620 785f 696e 6465 7865 6420 616e 6420  f x_indexed and 
-00019830: 696e 6974 5f73 7465 7073 3a0d 0a20 2020  init_steps:..   
-00019840: 2020 2020 2023 2069 6e69 7469 616c 207a       # initial z
-00019850: 6f6f 6d0d 0a20 2020 2020 2020 2078 3020  oom..        x0 
-00019860: 3d20 6d61 7828 6461 7461 7372 632e 786c  = max(datasrc.xl
-00019870: 656e 2d69 6e69 745f 7374 6570 732c 2030  en-init_steps, 0
-00019880: 2920 2d20 7369 6465 5f6d 6172 6769 6e20  ) - side_margin 
-00019890: 2d20 6578 7472 615f 6d61 7267 696e 0d0a  - extra_margin..
-000198a0: 2020 2020 2020 2020 7831 203d 2064 6174          x1 = dat
-000198b0: 6173 7263 2e78 6c65 6e20 2b20 7269 6768  asrc.xlen + righ
-000198c0: 745f 6d61 7267 696e 5f63 616e 646c 6573  t_margin_candles
-000198d0: 202b 2073 6964 655f 6d61 7267 696e 202b   + side_margin +
-000198e0: 2065 7874 7261 5f6d 6172 6769 6e0d 0a20   extra_margin.. 
-000198f0: 2020 2065 6c69 6620 785f 696e 6465 7865     elif x_indexe
-00019900: 643a 0d0a 2020 2020 2020 2020 2320 746f  d:..        # to
-00019910: 7461 6c20 7820 7369 7a65 2066 6f72 2069  tal x size for i
-00019920: 6e64 6578 6564 2064 6174 610d 0a20 2020  ndexed data..   
-00019930: 2020 2020 2078 3020 3d20 2d73 6964 655f       x0 = -side_
-00019940: 6d61 7267 696e 202d 2065 7874 7261 5f6d  margin - extra_m
-00019950: 6172 6769 6e0d 0a20 2020 2020 2020 2078  argin..        x
-00019960: 3120 3d20 6461 7461 7372 632e 786c 656e  1 = datasrc.xlen
-00019970: 202b 2072 6967 6874 5f6d 6172 6769 6e5f   + right_margin_
-00019980: 6361 6e64 6c65 7320 2d20 3120 2b20 7369  candles - 1 + si
-00019990: 6465 5f6d 6172 6769 6e20 2b20 6578 7472  de_margin + extr
-000199a0: 615f 6d61 7267 696e 2023 2061 6464 2061  a_margin # add a
-000199b0: 6e6f 7468 6572 206d 6172 6769 6e20 746f  nother margin to
-000199c0: 2067 6574 2074 6865 2022 736e 6170 2062   get the "snap b
-000199d0: 6163 6b22 2073 656e 7361 7469 6f6e 0d0a  ack" sensation..
-000199e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000199f0: 2020 2023 2078 2073 697a 6520 666f 7220     # x size for 
-00019a00: 706c 6169 6e20 592d 6f76 6572 2d58 2064  plain Y-over-X d
-00019a10: 6174 6120 2869 2e65 2e20 6e6f 7420 696e  ata (i.e. not in
-00019a20: 6465 7865 6429 0d0a 2020 2020 2020 2020  dexed)..        
-00019a30: 7830 203d 2064 6174 6173 7263 2e78 2e6d  x0 = datasrc.x.m
-00019a40: 696e 2829 0d0a 2020 2020 2020 2020 7831  in()..        x1
-00019a50: 203d 2064 6174 6173 7263 2e78 2e6d 6178   = datasrc.x.max
-00019a60: 2829 0d0a 2020 2020 2020 2020 2320 6578  ()..        # ex
-00019a70: 7465 6e64 206d 6172 6769 6e20 6f6e 2064  tend margin on d
-00019a80: 6563 6f75 706c 6564 2070 6c6f 7473 0d0a  ecoupled plots..
-00019a90: 2020 2020 2020 2020 6420 3d20 2878 312d          d = (x1-
-00019aa0: 7830 2920 2a20 2830 2e32 2b65 7874 7261  x0) * (0.2+extra
-00019ab0: 5f6d 6172 6769 6e29 0d0a 2020 2020 2020  _margin)..      
-00019ac0: 2020 7830 202d 3d20 640d 0a20 2020 2020    x0 -= d..     
-00019ad0: 2020 2078 3120 2b3d 2064 0d0a 2020 2020     x1 += d..    
-00019ae0: 7265 7475 726e 2078 302c 7831 0d0a 0d0a  return x0,x1....
-00019af0: 0d0a 6465 6620 5f72 6570 6169 6e74 5f63  ..def _repaint_c
-00019b00: 616e 646c 6573 2829 3a0d 0a20 2020 2027  andles():..    '
-00019b10: 2727 4361 6e64 6c65 7320 6172 6520 6f6e  ''Candles are on
-00019b20: 6c79 2070 6172 7469 616c 6c79 2064 7261  ly partially dra
-00019b30: 776e 2c20 616e 6420 7468 6572 6566 6f72  wn, and therefor
-00019b40: 6520 6e65 6564 7320 6d61 6e75 616c 2064  e needs manual d
-00019b50: 6972 7479 2072 656d 696e 6465 7220 7768  irty reminder wh
-00019b60: 656e 6576 6572 2069 7420 676f 6573 206f  enever it goes o
-00019b70: 6666 2d73 6372 6565 6e2e 2727 270d 0a20  ff-screen.'''.. 
-00019b80: 2020 2061 7873 203d 205b 6178 2066 6f72     axs = [ax for
-00019b90: 2077 696e 2069 6e20 7769 6e64 6f77 7320   win in windows 
-00019ba0: 666f 7220 6178 2069 6e20 7769 6e2e 6178  for ax in win.ax
-00019bb0: 735d 202b 206f 7665 726c 6179 5f61 7873  s] + overlay_axs
-00019bc0: 0d0a 2020 2020 666f 7220 6178 2069 6e20  ..    for ax in 
-00019bd0: 6178 733a 0d0a 2020 2020 2020 2020 666f  axs:..        fo
-00019be0: 7220 6974 656d 2069 6e20 6c69 7374 2861  r item in list(a
-00019bf0: 782e 6974 656d 7329 3a0d 0a20 2020 2020  x.items):..     
-00019c00: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00019c10: 616e 6365 2869 7465 6d2c 2046 696e 506c  ance(item, FinPl
-00019c20: 6f74 4974 656d 293a 0d0a 2020 2020 2020  otItem):..      
-00019c30: 2020 2020 2020 2020 2020 5f73 7461 7274            _start
-00019c40: 5f76 6973 7561 6c5f 7570 6461 7465 2869  _visual_update(i
-00019c50: 7465 6d29 0d0a 2020 2020 2020 2020 2020  tem)..          
-00019c60: 2020 2020 2020 5f65 6e64 5f76 6973 7561        _end_visua
-00019c70: 6c5f 7570 6461 7465 2869 7465 6d29 0d0a  l_update(item)..
-00019c80: 0d0a 0d0a 6465 6620 5f70 6169 6e74 5f73  ....def _paint_s
-00019c90: 6361 7474 6572 2869 7465 6d2c 2070 2c20  catter(item, p, 
-00019ca0: 2a61 7267 7329 3a0d 0a20 2020 2077 6974  *args):..    wit
-00019cb0: 6820 6e70 2e65 7272 7374 6174 6528 696e  h np.errstate(in
-00019cc0: 7661 6c69 643d 2769 676e 6f72 6527 293a  valid='ignore'):
-00019cd0: 2023 206d 616b 6520 7067 2773 206d 6173   # make pg's mas
-00019ce0: 6b20 6372 6561 7469 6f6e 2063 616c 6c73  k creation calls
-00019cf0: 2074 6f20 6e75 6d70 7920 7368 7574 2075   to numpy shut u
-00019d00: 700d 0a20 2020 2020 2020 2069 7465 6d2e  p..        item.
-00019d10: 5f64 6f70 6169 6e74 2870 2c20 2a61 7267  _dopaint(p, *arg
-00019d20: 7329 0d0a 0d0a 0d0a 6465 6620 5f6b 6579  s)......def _key
-00019d30: 5f70 7265 7373 6564 2876 622c 2065 7629  _pressed(vb, ev)
-00019d40: 3a0d 0a20 2020 2069 6620 6576 2e74 6578  :..    if ev.tex
-00019d50: 7428 2920 3d3d 2027 6727 3a20 2320 6772  t() == 'g': # gr
-00019d60: 6964 0d0a 2020 2020 2020 2020 676c 6f62  id..        glob
-00019d70: 616c 2063 6c61 6d70 5f67 7269 640d 0a20  al clamp_grid.. 
-00019d80: 2020 2020 2020 2063 6c61 6d70 5f67 7269         clamp_gri
-00019d90: 6420 3d20 6e6f 7420 636c 616d 705f 6772  d = not clamp_gr
-00019da0: 6964 0d0a 2020 2020 2020 2020 666f 7220  id..        for 
-00019db0: 7769 6e20 696e 2077 696e 646f 7773 3a0d  win in windows:.
-00019dc0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00019dd0: 2061 7820 696e 2077 696e 2e61 7873 3a0d   ax in win.axs:.
-00019de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019df0: 2061 782e 6372 6f73 7368 6169 722e 7570   ax.crosshair.up
-00019e00: 6461 7465 2829 0d0a 2020 2020 656c 6966  date()..    elif
-00019e10: 2065 762e 7465 7874 2829 203d 3d20 2769   ev.text() == 'i
-00019e20: 273a 2023 2069 6e76 6572 7420 792d 6178  ': # invert y-ax
-00019e30: 6573 0d0a 2020 2020 2020 2020 666f 7220  es..        for 
-00019e40: 7769 6e20 696e 2077 696e 646f 7773 3a0d  win in windows:.
-00019e50: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00019e60: 2061 7820 696e 2077 696e 2e61 7873 3a0d   ax in win.axs:.
-00019e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019e80: 2061 782e 696e 7665 7274 5f79 2829 0d0a   ax.invert_y()..
-00019e90: 2020 2020 656c 6966 2065 762e 7465 7874      elif ev.text
-00019ea0: 2829 203d 3d20 2766 273a 2023 2066 6f63  () == 'f': # foc
-00019eb0: 7573 2f65 7870 616e 6420 6163 7469 7665  us/expand active
-00019ec0: 2061 7869 730d 0a20 2020 2020 2020 2076   axis..        v
-00019ed0: 622e 7061 7265 6e74 2829 2e65 7870 616e  b.parent().expan
-00019ee0: 6428 290d 0a20 2020 2065 6c69 6620 6576  d()..    elif ev
-00019ef0: 2e74 6578 7428 2920 696e 2028 275c 7227  .text() in ('\r'
-00019f00: 2c20 2720 2729 3a20 2320 656e 7465 722c  , ' '): # enter,
-00019f10: 2073 7061 6365 0d0a 2020 2020 2020 2020   space..        
-00019f20: 7662 2e73 6574 5f64 7261 775f 6c69 6e65  vb.set_draw_line
-00019f30: 5f63 6f6c 6f72 2864 7261 775f 646f 6e65  _color(draw_done
-00019f40: 5f63 6f6c 6f72 290d 0a20 2020 2020 2020  _color)..       
-00019f50: 2076 622e 6472 6177 5f6c 696e 6520 3d20   vb.draw_line = 
-00019f60: 4e6f 6e65 0d0a 2020 2020 656c 6966 2065  None..    elif e
-00019f70: 762e 7465 7874 2829 2069 6e20 2827 5c78  v.text() in ('\x
-00019f80: 3766 272c 2027 5c62 2729 3a20 2320 6465  7f', '\b'): # de
-00019f90: 6c2c 2062 6163 6b73 7061 6365 0d0a 2020  l, backspace..  
-00019fa0: 2020 2020 2020 6966 206e 6f74 2076 622e        if not vb.
-00019fb0: 7265 6d6f 7665 5f6c 6173 745f 726f 6928  remove_last_roi(
-00019fc0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00019fd0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-00019fe0: 2020 656c 6966 2065 762e 6b65 7928 2920    elif ev.key() 
-00019ff0: 3d3d 2051 7443 6f72 652e 5174 2e4b 6579  == QtCore.Qt.Key
-0001a000: 2e4b 6579 5f4c 6566 743a 0d0a 2020 2020  .Key_Left:..    
-0001a010: 2020 2020 7662 2e70 616e 5f78 2870 6572      vb.pan_x(per
-0001a020: 6365 6e74 3d2d 3135 290d 0a20 2020 2065  cent=-15)..    e
-0001a030: 6c69 6620 6576 2e6b 6579 2829 203d 3d20  lif ev.key() == 
-0001a040: 5174 436f 7265 2e51 742e 4b65 792e 4b65  QtCore.Qt.Key.Ke
-0001a050: 795f 5269 6768 743a 0d0a 2020 2020 2020  y_Right:..      
-0001a060: 2020 7662 2e70 616e 5f78 2870 6572 6365    vb.pan_x(perce
-0001a070: 6e74 3d2b 3135 290d 0a20 2020 2065 6c69  nt=+15)..    eli
-0001a080: 6620 6576 2e6b 6579 2829 203d 3d20 5174  f ev.key() == Qt
-0001a090: 436f 7265 2e51 742e 4b65 792e 4b65 795f  Core.Qt.Key.Key_
-0001a0a0: 486f 6d65 3a0d 0a20 2020 2020 2020 2076  Home:..        v
-0001a0b0: 622e 7061 6e5f 7828 7374 6570 733d 2d31  b.pan_x(steps=-1
-0001a0c0: 6531 3029 0d0a 2020 2020 2020 2020 5f72  e10)..        _r
-0001a0d0: 6570 6169 6e74 5f63 616e 646c 6573 2829  epaint_candles()
-0001a0e0: 0d0a 2020 2020 656c 6966 2065 762e 6b65  ..    elif ev.ke
-0001a0f0: 7928 2920 3d3d 2051 7443 6f72 652e 5174  y() == QtCore.Qt
-0001a100: 2e4b 6579 2e4b 6579 5f45 6e64 3a0d 0a20  .Key.Key_End:.. 
-0001a110: 2020 2020 2020 2076 622e 7061 6e5f 7828         vb.pan_x(
-0001a120: 7374 6570 733d 2b31 6531 3029 0d0a 2020  steps=+1e10)..  
-0001a130: 2020 2020 2020 5f72 6570 6169 6e74 5f63        _repaint_c
-0001a140: 616e 646c 6573 2829 0d0a 2020 2020 656c  andles()..    el
-0001a150: 6966 2065 762e 6b65 7928 2920 3d3d 2051  if ev.key() == Q
-0001a160: 7443 6f72 652e 5174 2e4b 6579 2e4b 6579  tCore.Qt.Key.Key
-0001a170: 5f45 7363 6170 6520 616e 6420 6b65 795f  _Escape and key_
-0001a180: 6573 635f 636c 6f73 653a 0d0a 2020 2020  esc_close:..    
-0001a190: 2020 2020 7662 2e77 696e 2e63 6c6f 7365      vb.win.close
-0001a1a0: 2829 0d0a 2020 2020 656c 7365 3a0d 0a20  ()..    else:.. 
-0001a1b0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0001a1c0: 6c73 650d 0a20 2020 2072 6574 7572 6e20  lse..    return 
-0001a1d0: 5472 7565 0d0a 0d0a 0d0a 6465 6620 5f6d  True......def _m
-0001a1e0: 6f75 7365 5f63 6c69 636b 6564 2876 622c  ouse_clicked(vb,
-0001a1f0: 2065 7629 3a0d 0a20 2020 2069 6620 6576   ev):..    if ev
-0001a200: 2e62 7574 746f 6e28 2920 3d3d 2038 3a20  .button() == 8: 
-0001a210: 2320 6261 636b 0d0a 2020 2020 2020 2020  # back..        
-0001a220: 7662 2e70 616e 5f78 2870 6572 6365 6e74  vb.pan_x(percent
-0001a230: 3d2d 3330 290d 0a20 2020 2065 6c69 6620  =-30)..    elif 
-0001a240: 6576 2e62 7574 746f 6e28 2920 3d3d 2031  ev.button() == 1
-0001a250: 363a 2023 2066 7764 0d0a 2020 2020 2020  6: # fwd..      
-0001a260: 2020 7662 2e70 616e 5f78 2870 6572 6365    vb.pan_x(perce
-0001a270: 6e74 3d2b 3330 290d 0a20 2020 2065 6c73  nt=+30)..    els
-0001a280: 653a 0d0a 2020 2020 2020 2020 7265 7475  e:..        retu
-0001a290: 726e 2046 616c 7365 0d0a 2020 2020 7265  rn False..    re
-0001a2a0: 7475 726e 2054 7275 650d 0a0d 0a0d 0a64  turn True......d
-0001a2b0: 6566 205f 6d6f 7573 655f 6d6f 7665 6428  ef _mouse_moved(
-0001a2c0: 6d61 7374 6572 2c20 7662 2c20 6576 7329  master, vb, evs)
-0001a2d0: 3a0d 0a20 2020 2069 6620 6861 7361 7474  :..    if hasatt
-0001a2e0: 7228 6d61 7374 6572 2c20 2763 6c6f 7369  r(master, 'closi
-0001a2f0: 6e67 2729 2061 6e64 206d 6173 7465 722e  ng') and master.
-0001a300: 636c 6f73 696e 673a 0d0a 2020 2020 2020  closing:..      
-0001a310: 2020 7265 7475 726e 0d0a 2020 2020 6d64    return..    md
-0001a320: 203d 206d 6173 7465 725f 6461 7461 5b6d   = master_data[m
-0001a330: 6173 7465 725d 2e67 6574 2876 6229 206f  aster].get(vb) o
-0001a340: 7220 6d61 7374 6572 5f64 6174 615b 6d61  r master_data[ma
-0001a350: 7374 6572 5d2e 6765 7428 2764 6566 6175  ster].get('defau
-0001a360: 6c74 2729 0d0a 2020 2020 6966 206d 6420  lt')..    if md 
-0001a370: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-0001a380: 2020 7265 7475 726e 0d0a 2020 2020 6966    return..    if
-0001a390: 206e 6f74 2065 7673 3a0d 0a20 2020 2020   not evs:..     
-0001a3a0: 2020 2065 7673 203d 206d 645b 276c 6173     evs = md['las
-0001a3b0: 745f 6d6f 7573 655f 6576 7327 5d0d 0a20  t_mouse_evs'].. 
-0001a3c0: 2020 2020 2020 2069 6620 6e6f 7420 6576         if not ev
-0001a3d0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0001a3e0: 7265 7475 726e 0d0a 2020 2020 6d64 5b27  return..    md['
-0001a3f0: 6c61 7374 5f6d 6f75 7365 5f65 7673 275d  last_mouse_evs']
-0001a400: 203d 2065 7673 0d0a 2020 2020 706f 7320   = evs..    pos 
-0001a410: 3d20 6576 735b 2d31 5d0d 0a20 2020 2023  = evs[-1]..    #
-0001a420: 2061 6c6c 6f77 2069 6e74 6572 2d70 6978   allow inter-pix
-0001a430: 656c 206d 6f76 6573 2069 6620 6d6f 7669  el moves if movi
-0001a440: 6e67 206d 6f75 7365 2073 6c6f 776c 790d  ng mouse slowly.
-0001a450: 0a20 2020 2079 203d 2070 6f73 2e79 2829  .    y = pos.y()
-0001a460: 0d0a 2020 2020 6479 203d 2079 202d 206d  ..    dy = y - m
-0001a470: 645b 276c 6173 745f 6d6f 7573 655f 7927  d['last_mouse_y'
-0001a480: 5d0d 0a20 2020 2069 6620 3020 3c20 6162  ]..    if 0 < ab
-0001a490: 7328 6479 2920 3c3d 2031 3a0d 0a20 2020  s(dy) <= 1:..   
-0001a4a0: 2020 2020 2070 6f73 2e73 6574 5928 706f       pos.setY(po
-0001a4b0: 732e 7928 2920 2d20 6479 2f32 290d 0a20  s.y() - dy/2).. 
-0001a4c0: 2020 206d 645b 276c 6173 745f 6d6f 7573     md['last_mous
-0001a4d0: 655f 7927 5d20 3d20 790d 0a20 2020 2023  e_y'] = y..    #
-0001a4e0: 2061 7070 6c79 2074 6f20 616c 6c20 6372   apply to all cr
-0001a4f0: 6f73 7368 6169 7273 0d0a 2020 2020 666f  osshairs..    fo
-0001a500: 7220 6178 2069 6e20 6d61 7374 6572 2e61  r ax in master.a
-0001a510: 7873 3a0d 0a20 2020 2020 2020 2069 6620  xs:..        if 
-0001a520: 6178 2e69 7356 6973 6962 6c65 2829 2061  ax.isVisible() a
-0001a530: 6e64 2061 782e 6372 6f73 7368 6169 723a  nd ax.crosshair:
-0001a540: 0d0a 2020 2020 2020 2020 2020 2020 706f  ..            po
-0001a550: 696e 7420 3d20 6178 2e76 622e 6d61 7053  int = ax.vb.mapS
-0001a560: 6365 6e65 546f 5669 6577 2870 6f73 290d  ceneToView(pos).
-0001a570: 0a20 2020 2020 2020 2020 2020 2061 782e  .            ax.
-0001a580: 6372 6f73 7368 6169 722e 7570 6461 7465  crosshair.update
-0001a590: 2870 6f69 6e74 290d 0a0d 0a0d 0a64 6566  (point)......def
-0001a5a0: 205f 7768 6565 6c5f 6576 656e 745f 7772   _wheel_event_wr
-0001a5b0: 6170 7065 7228 7365 6c66 2c20 6f72 6967  apper(self, orig
-0001a5c0: 5f66 756e 632c 2065 7629 3a0d 0a20 2020  _func, ev):..   
-0001a5d0: 2023 2073 6372 6f6c 6c69 6e67 206f 6e20   # scrolling on 
-0001a5e0: 7468 6520 626f 7264 6572 2069 7320 7369  the border is si
-0001a5f0: 6d70 6c79 2061 6e6e 6f79 696e 672c 2070  mply annoying, p
-0001a600: 6f70 2069 6e20 6120 636f 7570 6c65 206f  op in a couple o
-0001a610: 6620 7069 7865 6c73 2074 6f20 6d61 6b65  f pixels to make
-0001a620: 2073 7572 650d 0a20 2020 2064 203d 2051   sure..    d = Q
-0001a630: 7443 6f72 652e 5150 6f69 6e74 4628 2d32  tCore.QPointF(-2
-0001a640: 2c30 290d 0a20 2020 2065 7620 3d20 5174  ,0)..    ev = Qt
-0001a650: 4775 692e 5157 6865 656c 4576 656e 7428  Gui.QWheelEvent(
-0001a660: 6576 2e70 6f73 6974 696f 6e28 292b 642c  ev.position()+d,
-0001a670: 2065 762e 676c 6f62 616c 506f 7369 7469   ev.globalPositi
-0001a680: 6f6e 2829 2b64 2c20 6576 2e70 6978 656c  on()+d, ev.pixel
-0001a690: 4465 6c74 6128 292c 2065 762e 616e 676c  Delta(), ev.angl
-0001a6a0: 6544 656c 7461 2829 2c20 6576 2e62 7574  eDelta(), ev.but
-0001a6b0: 746f 6e73 2829 2c20 6576 2e6d 6f64 6966  tons(), ev.modif
-0001a6c0: 6965 7273 2829 2c20 6576 2e70 6861 7365  iers(), ev.phase
-0001a6d0: 2829 2c20 4661 6c73 6529 0d0a 2020 2020  (), False)..    
-0001a6e0: 6f72 6967 5f66 756e 6328 7365 6c66 2c20  orig_func(self, 
-0001a6f0: 6576 290d 0a0d 0a0d 0a64 6566 205f 6d63  ev)......def _mc
-0001a700: 616c 6c62 6163 6b5f 636c 6963 6b28 6178  allback_click(ax
-0001a710: 2c20 6361 6c6c 6261 636b 2c20 7768 656e  , callback, when
-0001a720: 2c20 6576 7329 3a0d 0a20 2020 2069 6620  , evs):..    if 
-0001a730: 6576 735b 2d31 5d2e 6163 6365 7074 6564  evs[-1].accepted
-0001a740: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0001a750: 6e0d 0a20 2020 2069 6620 7768 656e 203d  n..    if when =
-0001a760: 3d20 2764 636c 6963 6b27 2061 6e64 2065  = 'dclick' and e
-0001a770: 7673 5b2d 315d 2e64 6f75 626c 6528 293a  vs[-1].double():
-0001a780: 0d0a 2020 2020 2020 2020 7061 7373 0d0a  ..        pass..
-0001a790: 2020 2020 656c 6966 2077 6865 6e20 3d3d      elif when ==
-0001a7a0: 2027 6c63 6c69 636b 2720 616e 6420 6576   'lclick' and ev
-0001a7b0: 735b 2d31 5d2e 6275 7474 6f6e 2829 203d  s[-1].button() =
-0001a7c0: 3d20 5174 436f 7265 2e51 742e 4d6f 7573  = QtCore.Qt.Mous
-0001a7d0: 6542 7574 746f 6e2e 4c65 6674 4275 7474  eButton.LeftButt
-0001a7e0: 6f6e 3a0d 0a20 2020 2020 2020 2070 6173  on:..        pas
-0001a7f0: 730d 0a20 2020 2065 6c69 6620 7768 656e  s..    elif when
-0001a800: 203d 3d20 276d 636c 6963 6b27 2061 6e64   == 'mclick' and
-0001a810: 2065 7673 5b2d 315d 2e62 7574 746f 6e28   evs[-1].button(
-0001a820: 2920 3d3d 2051 7443 6f72 652e 5174 2e4d  ) == QtCore.Qt.M
-0001a830: 6f75 7365 4275 7474 6f6e 2e4d 6964 646c  ouseButton.Middl
-0001a840: 6542 7574 746f 6e3a 0d0a 2020 2020 2020  eButton:..      
-0001a850: 2020 7061 7373 0d0a 2020 2020 656c 6966    pass..    elif
-0001a860: 2077 6865 6e20 3d3d 2027 7263 6c69 636b   when == 'rclick
-0001a870: 2720 616e 6420 6576 735b 2d31 5d2e 6275  ' and evs[-1].bu
-0001a880: 7474 6f6e 2829 203d 3d20 5174 436f 7265  tton() == QtCore
-0001a890: 2e51 742e 4d6f 7573 6542 7574 746f 6e2e  .Qt.MouseButton.
-0001a8a0: 5269 6768 7442 7574 746f 6e3a 0d0a 2020  RightButton:..  
-0001a8b0: 2020 2020 2020 7061 7373 0d0a 2020 2020        pass..    
-0001a8c0: 656c 6966 2077 6865 6e20 3d3d 2027 616e  elif when == 'an
-0001a8d0: 7927 3a0d 0a20 2020 2020 2020 2070 6173  y':..        pas
-0001a8e0: 730d 0a20 2020 2065 6c73 653a 0d0a 2020  s..    else:..  
-0001a8f0: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
-0001a900: 2020 706f 7320 3d20 6576 735b 2d31 5d2e    pos = evs[-1].
-0001a910: 7363 656e 6550 6f73 2829 0d0a 2020 2020  scenePos()..    
-0001a920: 7265 7475 726e 205f 6d63 616c 6c62 6163  return _mcallbac
-0001a930: 6b5f 706f 7328 6178 2c20 6361 6c6c 6261  k_pos(ax, callba
-0001a940: 636b 2c20 2870 6f73 2c29 290d 0a0d 0a0d  ck, (pos,)).....
-0001a950: 0a64 6566 205f 6d63 616c 6c62 6163 6b5f  .def _mcallback_
-0001a960: 706f 7328 6178 2c20 6361 6c6c 6261 636b  pos(ax, callback
-0001a970: 2c20 706f 7373 293a 0d0a 2020 2020 6966  , poss):..    if
-0001a980: 206e 6f74 2061 782e 7662 2e64 6174 6173   not ax.vb.datas
-0001a990: 7263 3a0d 0a20 2020 2020 2020 2072 6574  rc:..        ret
-0001a9a0: 7572 6e0d 0a20 2020 2070 6f69 6e74 203d  urn..    point =
-0001a9b0: 2061 782e 7662 2e6d 6170 5363 656e 6554   ax.vb.mapSceneT
-0001a9c0: 6f56 6965 7728 706f 7373 5b2d 315d 290d  oView(poss[-1]).
-0001a9d0: 0a20 2020 2074 203d 2070 6f69 6e74 2e78  .    t = point.x
-0001a9e0: 2829 202b 2030 2e35 0d0a 2020 2020 7472  () + 0.5..    tr
-0001a9f0: 793a 0d0a 2020 2020 2020 2020 7420 3d20  y:..        t = 
-0001aa00: 6178 2e76 622e 6461 7461 7372 632e 636c  ax.vb.datasrc.cl
-0001aa10: 6f73 6573 745f 7469 6d65 2874 290d 0a20  osest_time(t).. 
-0001aa20: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
-0001aa30: 6f72 3a20 2320 7768 656e 2063 6c69 636b  or: # when click
-0001aa40: 696e 6720 6265 796f 6e64 2072 6967 6874  ing beyond right
-0001aa50: 5f6d 6172 6769 6e5f 6361 6e64 6c65 730d  _margin_candles.
-0001aa60: 0a20 2020 2020 2020 2069 6620 636c 616d  .        if clam
-0001aa70: 705f 6772 6964 3a0d 0a20 2020 2020 2020  p_grid:..       
-0001aa80: 2020 2020 2074 203d 2061 782e 7662 2e64       t = ax.vb.d
-0001aa90: 6174 6173 7263 2e78 2e69 6c6f 635b 2d31  atasrc.x.iloc[-1
-0001aaa0: 2069 6620 7420 3e20 3020 656c 7365 2030   if t > 0 else 0
-0001aab0: 5d0d 0a20 2020 2074 7279 3a0d 0a20 2020  ]..    try:..   
-0001aac0: 2020 2020 2063 616c 6c62 6163 6b28 742c       callback(t,
-0001aad0: 2070 6f69 6e74 2e79 2829 290d 0a20 2020   point.y())..   
-0001aae0: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
-0001aaf0: 6173 2065 3a0d 0a20 2020 2020 2020 2070  as e:..        p
-0001ab00: 6173 730d 0a20 2020 2065 7863 6570 7420  ass..    except 
-0001ab10: 4578 6365 7074 696f 6e20 6173 2065 3a0d  Exception as e:.
-0001ab20: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-0001ab30: 496e 7370 6563 7469 6f6e 2065 7272 6f72  Inspection error
-0001ab40: 3a27 2c20 7479 7065 2865 292c 2065 290d  :', type(e), e).
-0001ab50: 0a0d 0a0d 0a64 6566 2062 7269 6768 7465  .....def brighte
-0001ab60: 6e28 636f 6c6f 722c 2066 293a 0d0a 2020  n(color, f):..  
-0001ab70: 2020 6966 206e 6f74 2063 6f6c 6f72 3a0d    if not color:.
-0001ab80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001ab90: 636f 6c6f 720d 0a20 2020 2072 6574 7572  color..    retur
-0001aba0: 6e20 7067 2e6d 6b43 6f6c 6f72 2863 6f6c  n pg.mkColor(col
-0001abb0: 6f72 292e 6c69 6768 7465 7228 696e 7428  or).lighter(int(
-0001abc0: 662a 3130 3029 290d 0a0d 0a0d 0a64 6566  f*100))......def
-0001abd0: 205f 6765 745f 636f 6c6f 7228 6178 2c20   _get_color(ax, 
-0001abe0: 7374 796c 652c 2077 616e 7465 645f 636f  style, wanted_co
-0001abf0: 6c6f 7229 3a0d 0a20 2020 2069 6620 7479  lor):..    if ty
-0001ac00: 7065 2877 616e 7465 645f 636f 6c6f 7229  pe(wanted_color)
-0001ac10: 2069 6e20 2873 7472 2c20 5174 4775 692e   in (str, QtGui.
-0001ac20: 5143 6f6c 6f72 293a 0d0a 2020 2020 2020  QColor):..      
-0001ac30: 2020 7265 7475 726e 2077 616e 7465 645f    return wanted_
-0001ac40: 636f 6c6f 720d 0a20 2020 2069 6e64 6578  color..    index
-0001ac50: 203d 2077 616e 7465 645f 636f 6c6f 7220   = wanted_color 
-0001ac60: 6966 2074 7970 6528 7761 6e74 6564 5f63  if type(wanted_c
-0001ac70: 6f6c 6f72 2920 3d3d 2069 6e74 2065 6c73  olor) == int els
-0001ac80: 6520 4e6f 6e65 0d0a 2020 2020 6973 5f6c  e None..    is_l
-0001ac90: 696e 6520 3d20 6c61 6d62 6461 2073 7479  ine = lambda sty
-0001aca0: 6c65 3a20 7374 796c 6520 6973 204e 6f6e  le: style is Non
-0001acb0: 6520 6f72 2061 6e79 2863 6820 696e 2073  e or any(ch in s
-0001acc0: 7479 6c65 2066 6f72 2063 6820 696e 2027  tyle for ch in '
-0001acd0: 2d5f 2e27 290d 0a20 2020 2067 6574 5f68  -_.')..    get_h
-0001ace0: 616e 6465 645f 636f 6c6f 7220 3d20 6c61  anded_color = la
-0001acf0: 6d62 6461 2069 7465 6d3a 2069 7465 6d2e  mbda item: item.
-0001ad00: 6f70 7473 2e67 6574 2827 6861 6e64 6564  opts.get('handed
-0001ad10: 5f63 6f6c 6f72 2729 0d0a 2020 2020 7468  _color')..    th
-0001ad20: 6973 5f6c 696e 6520 3d20 6973 5f6c 696e  is_line = is_lin
-0001ad30: 6528 7374 796c 6529 0d0a 2020 2020 6966  e(style)..    if
-0001ad40: 2074 6869 735f 6c69 6e65 3a0d 0a20 2020   this_line:..   
-0001ad50: 2020 2020 2063 6f6c 6f72 7320 3d20 736f       colors = so
-0001ad60: 6674 5f63 6f6c 6f72 730d 0a20 2020 2065  ft_colors..    e
-0001ad70: 6c73 653a 0d0a 2020 2020 2020 2020 636f  lse:..        co
-0001ad80: 6c6f 7273 203d 2068 6172 645f 636f 6c6f  lors = hard_colo
-0001ad90: 7273 0d0a 2020 2020 6966 2069 6e64 6578  rs..    if index
-0001ada0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-0001adb0: 2020 2061 766f 6964 203d 2073 6574 2869     avoid = set(i
-0001adc0: 2e6f 7074 735b 2768 616e 6465 645f 636f  .opts['handed_co
-0001add0: 6c6f 7227 5d20 666f 7220 6920 696e 2061  lor'] for i in a
-0001ade0: 782e 6974 656d 7320 6966 2069 7369 6e73  x.items if isins
-0001adf0: 7461 6e63 6528 692c 7067 2e50 6c6f 7444  tance(i,pg.PlotD
-0001ae00: 6174 6149 7465 6d29 2061 6e64 2067 6574  ataItem) and get
-0001ae10: 5f68 616e 6465 645f 636f 6c6f 7228 6929  _handed_color(i)
-0001ae20: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0001ae30: 2074 6869 735f 6c69 6e65 3d3d 6973 5f6c   this_line==is_l
-0001ae40: 696e 6528 692e 6f70 7473 5b27 7379 6d62  ine(i.opts['symb
-0001ae50: 6f6c 275d 2929 0d0a 2020 2020 2020 2020  ol']))..        
-0001ae60: 696e 6465 7820 3d20 6c65 6e28 5b69 2066  index = len([i f
-0001ae70: 6f72 2069 2069 6e20 6178 2e69 7465 6d73  or i in ax.items
-0001ae80: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
-0001ae90: 2c70 672e 506c 6f74 4461 7461 4974 656d  ,pg.PlotDataItem
-0001aea0: 2920 616e 6420 6765 745f 6861 6e64 6564  ) and get_handed
-0001aeb0: 5f63 6f6c 6f72 2869 2920 6973 204e 6f6e  _color(i) is Non
-0001aec0: 6520 616e 6420 7468 6973 5f6c 696e 653d  e and this_line=
-0001aed0: 3d69 735f 6c69 6e65 2869 2e6f 7074 735b  =is_line(i.opts[
-0001aee0: 2773 796d 626f 6c27 5d29 5d29 0d0a 2020  'symbol'])])..  
-0001aef0: 2020 2020 2020 7768 696c 6520 696e 6465        while inde
-0001af00: 7820 696e 2061 766f 6964 3a0d 0a20 2020  x in avoid:..   
-0001af10: 2020 2020 2020 2020 2069 6e64 6578 202b           index +
-0001af20: 3d20 310d 0a20 2020 2072 6574 7572 6e20  = 1..    return 
-0001af30: 636f 6c6f 7273 5b69 6e64 6578 256c 656e  colors[index%len
-0001af40: 2863 6f6c 6f72 7329 5d0d 0a0d 0a0d 0a64  (colors)]......d
-0001af50: 6566 205f 7064 7469 6d65 3265 706f 6368  ef _pdtime2epoch
-0001af60: 2874 293a 0d0a 2020 2020 6966 2069 7369  (t):..    if isi
-0001af70: 6e73 7461 6e63 6528 742c 2070 642e 5365  nstance(t, pd.Se
-0001af80: 7269 6573 293a 0d0a 2020 2020 2020 2020  ries):..        
-0001af90: 6966 2069 7369 6e73 7461 6e63 6528 742e  if isinstance(t.
-0001afa0: 696c 6f63 5b30 5d2c 2070 642e 5469 6d65  iloc[0], pd.Time
-0001afb0: 7374 616d 7029 3a0d 0a20 2020 2020 2020  stamp):..       
-0001afc0: 2020 2020 2064 7479 7065 203d 2073 7472       dtype = str
-0001afd0: 2874 2e64 7479 7065 290d 0a20 2020 2020  (t.dtype)..     
-0001afe0: 2020 2020 2020 2069 6620 6474 7970 652e         if dtype.
-0001aff0: 656e 6473 7769 7468 2827 5b73 5d27 293a  endswith('[s]'):
-0001b000: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b010: 2020 7265 7475 726e 2074 2e76 6965 7728    return t.view(
-0001b020: 2769 6e74 3634 2729 202a 2069 6e74 2831  'int64') * int(1
-0001b030: 6539 290d 0a20 2020 2020 2020 2020 2020  e9)..           
-0001b040: 2065 6c69 6620 6474 7970 652e 656e 6473   elif dtype.ends
-0001b050: 7769 7468 2827 5b6d 735d 2729 3a0d 0a20  with('[ms]'):.. 
-0001b060: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001b070: 6574 7572 6e20 742e 7669 6577 2827 696e  eturn t.view('in
-0001b080: 7436 3427 2920 2a20 696e 7428 3165 3629  t64') * int(1e6)
-0001b090: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-0001b0a0: 6966 2064 7479 7065 2e65 6e64 7377 6974  if dtype.endswit
-0001b0b0: 6828 2775 7327 293a 0d0a 2020 2020 2020  h('us'):..      
-0001b0c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001b0d0: 2074 2e76 6965 7728 2769 6e74 3634 2729   t.view('int64')
-0001b0e0: 202a 2069 6e74 2831 6533 290d 0a20 2020   * int(1e3)..   
-0001b0f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001b100: 742e 7669 6577 2827 696e 7436 3427 290d  t.view('int64').
-0001b110: 0a20 2020 2020 2020 2068 203d 206e 702e  .        h = np.
-0001b120: 6e61 6e6d 6178 2874 2e76 616c 7565 7329  nanmax(t.values)
-0001b130: 0d0a 2020 2020 2020 2020 6966 2068 203c  ..        if h <
-0001b140: 2031 6531 303a 2023 2068 616e 646c 6520   1e10: # handle 
-0001b150: 7320 6570 6f63 6873 0d0a 2020 2020 2020  s epochs..      
-0001b160: 2020 2020 2020 7265 7475 726e 2028 742a        return (t*
-0001b170: 3165 3929 2e61 7374 7970 6528 2769 6e74  1e9).astype('int
-0001b180: 3634 2729 0d0a 2020 2020 2020 2020 6966  64')..        if
-0001b190: 2068 203c 2031 6531 333a 2023 2068 616e   h < 1e13: # han
-0001b1a0: 646c 6520 6d73 2065 706f 6368 730d 0a20  dle ms epochs.. 
-0001b1b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001b1c0: 6e20 2874 2a31 6536 292e 6173 7479 7065  n (t*1e6).astype
-0001b1d0: 2827 696e 7436 3427 290d 0a20 2020 2020  ('int64')..     
-0001b1e0: 2020 2069 6620 6820 3c20 3165 3136 3a20     if h < 1e16: 
-0001b1f0: 2320 6861 6e64 6c65 2075 7320 6570 6f63  # handle us epoc
-0001b200: 6873 0d0a 2020 2020 2020 2020 2020 2020  hs..            
-0001b210: 7265 7475 726e 2028 742a 3165 3329 2e61  return (t*1e3).a
-0001b220: 7374 7970 6528 2769 6e74 3634 2729 0d0a  stype('int64')..
-0001b230: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-0001b240: 2e61 7374 7970 6528 2769 6e74 3634 2729  .astype('int64')
-0001b250: 0d0a 2020 2020 7265 7475 726e 2074 0d0a  ..    return t..
-0001b260: 0d0a 0d0a 6465 6620 5f70 6474 696d 6532  ....def _pdtime2
-0001b270: 696e 6465 7828 6178 2c20 7473 2c20 616e  index(ax, ts, an
-0001b280: 795f 656e 643d 4661 6c73 652c 2072 6571  y_end=False, req
-0001b290: 7569 7265 5f74 696d 653d 4661 6c73 6529  uire_time=False)
-0001b2a0: 3a0d 0a20 2020 2069 6620 6973 696e 7374  :..    if isinst
-0001b2b0: 616e 6365 2874 732e 696c 6f63 5b30 5d2c  ance(ts.iloc[0],
-0001b2c0: 2070 642e 5469 6d65 7374 616d 7029 3a0d   pd.Timestamp):.
-0001b2d0: 0a20 2020 2020 2020 2074 7320 3d20 7473  .        ts = ts
-0001b2e0: 2e76 6965 7728 2769 6e74 3634 2729 0d0a  .view('int64')..
-0001b2f0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0001b300: 2020 2068 203d 206e 702e 6e61 6e6d 6178     h = np.nanmax
-0001b310: 2874 732e 7661 6c75 6573 290d 0a20 2020  (ts.values)..   
-0001b320: 2020 2020 2069 6620 6820 3c20 3165 373a       if h < 1e7:
-0001b330: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0001b340: 2072 6571 7569 7265 5f74 696d 653a 0d0a   require_time:..
-0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b360: 6173 7365 7274 2046 616c 7365 2c20 276e  assert False, 'n
-0001b370: 6f74 2061 2074 696d 6520 7365 7269 6573  ot a time series
-0001b380: 270d 0a20 2020 2020 2020 2020 2020 2072  '..            r
-0001b390: 6574 7572 6e20 7473 0d0a 2020 2020 2020  eturn ts..      
-0001b3a0: 2020 6966 2068 203c 2031 6531 303a 2023    if h < 1e10: #
-0001b3b0: 2068 616e 646c 6520 7320 6570 6f63 6873   handle s epochs
-0001b3c0: 0d0a 2020 2020 2020 2020 2020 2020 7473  ..            ts
-0001b3d0: 203d 2074 732e 6173 7479 7065 2827 666c   = ts.astype('fl
-0001b3e0: 6f61 7436 3427 2920 2a20 3165 390d 0a20  oat64') * 1e9.. 
-0001b3f0: 2020 2020 2020 2065 6c69 6620 6820 3c20         elif h < 
-0001b400: 3165 3133 3a20 2320 6861 6e64 6c65 206d  1e13: # handle m
-0001b410: 7320 6570 6f63 6873 0d0a 2020 2020 2020  s epochs..      
-0001b420: 2020 2020 2020 7473 203d 2074 732e 6173        ts = ts.as
-0001b430: 7479 7065 2827 666c 6f61 7436 3427 2920  type('float64') 
-0001b440: 2a20 3165 360d 0a20 2020 2020 2020 2065  * 1e6..        e
-0001b450: 6c69 6620 6820 3c20 3165 3136 3a20 2320  lif h < 1e16: # 
-0001b460: 6861 6e64 6c65 2075 7320 6570 6f63 6873  handle us epochs
-0001b470: 0d0a 2020 2020 2020 2020 2020 2020 7473  ..            ts
-0001b480: 203d 2074 732e 6173 7479 7065 2827 666c   = ts.astype('fl
-0001b490: 6f61 7436 3427 2920 2a20 3165 330d 0a20  oat64') * 1e3.. 
-0001b4a0: 2020 200d 0a20 2020 2064 6174 6173 7263     ..    datasrc
-0001b4b0: 203d 205f 6765 745f 6461 7461 7372 6328   = _get_datasrc(
-0001b4c0: 6178 290d 0a20 2020 2078 7320 3d20 6461  ax)..    xs = da
-0001b4d0: 7461 7372 632e 780d 0a0d 0a20 2020 2023  tasrc.x....    #
-0001b4e0: 2074 7279 2065 7861 6374 206d 6174 6368   try exact match
-0001b4f0: 2062 6566 6f72 6520 6170 7072 6f78 696d   before approxim
-0001b500: 6174 6520 6d61 7463 680d 0a20 2020 2069  ate match..    i
-0001b510: 6620 616c 6c28 7873 2e69 7369 6e28 7473  f all(xs.isin(ts
-0001b520: 2929 3a0d 0a20 2020 2020 2065 7861 6374  )):..      exact
-0001b530: 203d 2064 6174 6173 7263 2e69 6e64 6578   = datasrc.index
-0001b540: 5b74 735d 2e74 6f5f 6c69 7374 2829 0d0a  [ts].to_list()..
-0001b550: 2020 2020 2020 6966 206c 656e 2865 7861        if len(exa
-0001b560: 6374 2920 3d3d 206c 656e 2874 7329 3a0d  ct) == len(ts):.
-0001b570: 0a20 2020 2020 2020 2020 2072 6574 7572  .          retur
-0001b580: 6e20 6578 6163 740d 0a0d 0a20 2020 2072  n exact....    r
-0001b590: 203d 205b 5d0d 0a20 2020 2066 6f72 2069   = []..    for i
-0001b5a0: 2c74 2069 6e20 656e 756d 6572 6174 6528  ,t in enumerate(
-0001b5b0: 7473 293a 0d0a 2020 2020 2020 2020 7873  ts):..        xs
-0001b5c0: 7320 3d20 7873 2e6c 6f63 5b78 733e 745d  s = xs.loc[xs>t]
-0001b5d0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-0001b5e0: 2878 7373 2920 3d3d 2030 3a0d 0a20 2020  (xss) == 0:..   
-0001b5f0: 2020 2020 2020 2020 2074 3020 3d20 7873           t0 = xs
-0001b600: 2e69 6c6f 635b 2d31 5d0d 0a20 2020 2020  .iloc[-1]..     
-0001b610: 2020 2020 2020 2069 6620 616e 795f 656e         if any_en
-0001b620: 6420 6f72 2074 3020 3d3d 2074 3a0d 0a20  d or t0 == t:.. 
-0001b630: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001b640: 2e61 7070 656e 6428 6c65 6e28 7873 292d  .append(len(xs)-
-0001b650: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-0001b660: 2020 2020 636f 6e74 696e 7565 0d0a 2020      continue..  
-0001b670: 2020 2020 2020 2020 2020 6966 2069 203e            if i >
-0001b680: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-0001b690: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
-0001b6a0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-0001b6b0: 7420 7420 3c3d 2074 302c 2027 6d75 7374  t t <= t0, 'must
-0001b6c0: 2070 6c6f 7420 7468 6973 2070 7269 6d69   plot this primi
-0001b6d0: 7469 7665 2069 6e20 7072 696f 7220 7469  tive in prior ti
-0001b6e0: 6d65 2d72 616e 6765 270d 0a20 2020 2020  me-range'..     
-0001b6f0: 2020 2069 3120 3d20 7873 732e 696e 6465     i1 = xss.inde
-0001b700: 785b 305d 0d0a 2020 2020 2020 2020 6930  x[0]..        i0
-0001b710: 203d 2069 312d 310d 0a20 2020 2020 2020   = i1-1..       
-0001b720: 2069 6620 6930 203c 2030 3a0d 0a20 2020   if i0 < 0:..   
-0001b730: 2020 2020 2020 2020 2069 302c 6931 203d           i0,i1 =
-0001b740: 2030 2c31 0d0a 2020 2020 2020 2020 7430   0,1..        t0
-0001b750: 2c74 3120 3d20 7873 2e6c 6f63 5b69 305d  ,t1 = xs.loc[i0]
-0001b760: 2c20 7873 2e6c 6f63 5b69 315d 0d0a 2020  , xs.loc[i1]..  
-0001b770: 2020 2020 2020 6966 2074 3020 3d3d 2074        if t0 == t
-0001b780: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
-0001b790: 722e 6170 7065 6e64 2869 3029 0d0a 2020  r.append(i0)..  
-0001b7a0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0001b7b0: 2020 2020 2020 2020 2064 7420 3d20 2874           dt = (t
-0001b7c0: 2d74 3029 202f 2028 7431 2d74 3029 0d0a  -t0) / (t1-t0)..
-0001b7d0: 2020 2020 2020 2020 2020 2020 722e 6170              r.ap
-0001b7e0: 7065 6e64 286c 6572 7028 6474 2c20 6930  pend(lerp(dt, i0
-0001b7f0: 2c20 6931 2929 0d0a 2020 2020 7265 7475  , i1))..    retu
-0001b800: 726e 2072 0d0a 0d0a 0d0a 6465 6620 5f69  rn r......def _i
-0001b810: 735f 7374 725f 6d69 646e 6967 6874 2873  s_str_midnight(s
-0001b820: 293a 0d0a 2020 2020 7265 7475 726e 2073  ):..    return s
-0001b830: 2e65 6e64 7377 6974 6828 2720 3030 3a30  .endswith(' 00:0
-0001b840: 3027 2920 6f72 2073 2e65 6e64 7377 6974  0') or s.endswit
-0001b850: 6828 2720 3030 3a30 303a 3030 2729 0d0a  h(' 00:00:00')..
-0001b860: 0d0a 0d0a 6465 6620 5f67 6574 5f64 6174  ....def _get_dat
-0001b870: 6173 7263 2861 782c 2072 6571 7569 7265  asrc(ax, require
-0001b880: 3d54 7275 6529 3a0d 0a20 2020 2069 6620  =True):..    if 
-0001b890: 6178 2e76 622e 6461 7461 7372 6320 6973  ax.vb.datasrc is
-0001b8a0: 206e 6f74 204e 6f6e 6520 6f72 206e 6f74   not None or not
-0001b8b0: 2061 782e 7662 2e78 5f69 6e64 6578 6564   ax.vb.x_indexed
-0001b8c0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0001b8d0: 6e20 6178 2e76 622e 6461 7461 7372 630d  n ax.vb.datasrc.
-0001b8e0: 0a20 2020 2076 6273 203d 205b 6178 2e76  .    vbs = [ax.v
-0001b8f0: 6220 666f 7220 7769 6e20 696e 2077 696e  b for win in win
-0001b900: 646f 7773 2066 6f72 2061 7820 696e 2077  dows for ax in w
-0001b910: 696e 2e61 7873 5d0d 0a20 2020 2066 6f72  in.axs]..    for
-0001b920: 2076 6220 696e 2076 6273 3a0d 0a20 2020   vb in vbs:..   
-0001b930: 2020 2020 2069 6620 7662 2e64 6174 6173       if vb.datas
-0001b940: 7263 3a0d 0a20 2020 2020 2020 2020 2020  rc:..           
-0001b950: 2072 6574 7572 6e20 7662 2e64 6174 6173   return vb.datas
-0001b960: 7263 0d0a 2020 2020 6966 2072 6571 7569  rc..    if requi
-0001b970: 7265 3a0d 0a20 2020 2020 2020 2061 7373  re:..        ass
-0001b980: 6572 7420 6178 2e76 622e 6461 7461 7372  ert ax.vb.datasr
-0001b990: 632c 2027 6e6f 7420 706f 7373 6962 6c65  c, 'not possible
-0001b9a0: 2074 6f20 706c 6f74 2074 6869 7320 7072   to plot this pr
-0001b9b0: 696d 6974 6976 6520 7769 7468 6f75 7420  imitive without 
-0001b9c0: 6120 7072 696f 7220 7469 6d65 2d72 616e  a prior time-ran
-0001b9d0: 6765 2074 6f20 636f 6d70 6172 6520 746f  ge to compare to
-0001b9e0: 270d 0a0d 0a0d 0a64 6566 205f 6d69 6c6c  '......def _mill
-0001b9f0: 6973 6563 6f6e 645f 747a 5f77 7261 7028  isecond_tz_wrap(
-0001ba00: 7329 3a0d 0a20 2020 2069 6620 6c65 6e28  s):..    if len(
-0001ba10: 7329 203e 2036 2061 6e64 2073 5b2d 365d  s) > 6 and s[-6]
-0001ba20: 2069 6e20 272b 2d27 2061 6e64 2073 5b2d   in '+-' and s[-
-0001ba30: 335d 203d 3d20 273a 273a 2023 202b 3031  3] == ':': # +01
-0001ba40: 3a30 3020 666d 7420 7469 6d65 7a6f 6e65  :00 fmt timezone
-0001ba50: 2070 7265 7365 6e74 3f0d 0a20 2020 2020   present?..     
-0001ba60: 2020 2073 203d 2073 5b3a 2d36 5d0d 0a20     s = s[:-6].. 
-0001ba70: 2020 2072 6574 7572 6e20 2873 2b27 2e30     return (s+'.0
-0001ba80: 3030 3030 3027 2920 6966 2027 2e27 206e  00000') if '.' n
-0001ba90: 6f74 2069 6e20 7320 656c 7365 2073 0d0a  ot in s else s..
-0001baa0: 0d0a 0d0a 6465 6620 5f78 326c 6f63 616c  ....def _x2local
-0001bab0: 5f74 2864 6174 6173 7263 2c20 7829 3a0d  _t(datasrc, x):.
-0001bac0: 0a20 2020 2069 6620 6469 7370 6c61 795f  .    if display_
-0001bad0: 7469 6d65 7a6f 6e65 203d 3d20 4e6f 6e65  timezone == None
-0001bae0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0001baf0: 6e20 5f78 3275 7463 2864 6174 6173 7263  n _x2utc(datasrc
-0001bb00: 2c20 7829 0d0a 2020 2020 7265 7475 726e  , x)..    return
-0001bb10: 205f 7832 7428 6461 7461 7372 632c 2078   _x2t(datasrc, x
-0001bb20: 2c20 6c61 6d62 6461 2074 3a20 5f6d 696c  , lambda t: _mil
-0001bb30: 6c69 7365 636f 6e64 5f74 7a5f 7772 6170  lisecond_tz_wrap
-0001bb40: 2864 6174 6574 696d 652e 6672 6f6d 7469  (datetime.fromti
-0001bb50: 6d65 7374 616d 7028 742f 3165 392c 2074  mestamp(t/1e9, t
-0001bb60: 7a3d 6469 7370 6c61 795f 7469 6d65 7a6f  z=display_timezo
-0001bb70: 6e65 292e 7374 7266 7469 6d65 2874 696d  ne).strftime(tim
-0001bb80: 6573 7461 6d70 5f66 6f72 6d61 7429 2929  estamp_format)))
-0001bb90: 0d0a 0d0a 0d0a 6465 6620 5f78 3275 7463  ......def _x2utc
-0001bba0: 2864 6174 6173 7263 2c20 7829 3a0d 0a20  (datasrc, x):.. 
-0001bbb0: 2020 2023 2075 7369 6e67 2070 642e 746f     # using pd.to
-0001bbc0: 5f64 6174 6574 696d 6520 616c 6c6f 7720  _datetime allow 
-0001bbd0: 666f 7220 7072 652d 3139 3730 2064 6174  for pre-1970 dat
-0001bbe0: 6573 0d0a 2020 2020 7265 7475 726e 205f  es..    return _
-0001bbf0: 7832 7428 6461 7461 7372 632c 2078 2c20  x2t(datasrc, x, 
-0001bc00: 6c61 6d62 6461 2074 3a20 7064 2e74 6f5f  lambda t: pd.to_
-0001bc10: 6461 7465 7469 6d65 2874 2c20 756e 6974  datetime(t, unit
-0001bc20: 3d27 6e73 2729 2e73 7472 6674 696d 6528  ='ns').strftime(
-0001bc30: 7469 6d65 7374 616d 705f 666f 726d 6174  timestamp_format
-0001bc40: 2929 0d0a 0d0a 0d0a 6465 6620 5f78 3274  ))......def _x2t
-0001bc50: 2864 6174 6173 7263 2c20 782c 2074 7332  (datasrc, x, ts2
-0001bc60: 7374 7229 3a0d 0a20 2020 2069 6620 6e6f  str):..    if no
-0001bc70: 7420 6461 7461 7372 633a 0d0a 2020 2020  t datasrc:..    
-0001bc80: 2020 2020 7265 7475 726e 2027 272c 4661      return '',Fa
-0001bc90: 6c73 650d 0a20 2020 2074 7279 3a0d 0a20  lse..    try:.. 
-0001bca0: 2020 2020 2020 2078 202b 3d20 302e 350d         x += 0.5.
-0001bcb0: 0a20 2020 2020 2020 2074 2c5f 2c5f 2c5f  .        t,_,_,_
-0001bcc0: 2c63 6e74 203d 2064 6174 6173 7263 2e68  ,cnt = datasrc.h
-0001bcd0: 696c 6f28 782c 2078 290d 0a20 2020 2020  ilo(x, x)..     
-0001bce0: 2020 2069 6620 636e 743a 0d0a 2020 2020     if cnt:..    
-0001bcf0: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-0001bd00: 6174 6173 7263 2e74 696d 6562 6173 6564  atasrc.timebased
-0001bd10: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-0001bd20: 2020 2020 2072 6574 7572 6e20 2725 6727       return '%g'
-0001bd30: 2025 2074 2c20 4661 6c73 650d 0a20 2020   % t, False..   
-0001bd40: 2020 2020 2020 2020 2073 203d 2074 7332           s = ts2
-0001bd50: 7374 7228 7429 0d0a 2020 2020 2020 2020  str(t)..        
-0001bd60: 2020 2020 6966 2065 706f 6368 5f70 6572      if epoch_per
-0001bd70: 696f 6420 3e3d 2032 332a 3630 2a36 303a  iod >= 23*60*60:
-0001bd80: 2023 2064 6179 6c69 6768 7420 7361 7669   # daylight savi
-0001bd90: 6e67 732c 206c 6561 7020 7365 636f 6e64  ngs, leap second
-0001bda0: 732c 2065 7463 0d0a 2020 2020 2020 2020  s, etc..        
-0001bdb0: 2020 2020 2020 2020 6920 3d20 732e 696e          i = s.in
-0001bdc0: 6465 7828 2720 2729 0d0a 2020 2020 2020  dex(' ')..      
-0001bdd0: 2020 2020 2020 656c 6966 2065 706f 6368        elif epoch
-0001bde0: 5f70 6572 696f 6420 3e3d 2035 393a 2023  _period >= 59: #
-0001bdf0: 2063 6f6e 7369 6465 7220 6c65 6170 2073   consider leap s
-0001be00: 6563 6f6e 6473 0d0a 2020 2020 2020 2020  econds..        
-0001be10: 2020 2020 2020 2020 6920 3d20 732e 7269          i = s.ri
-0001be20: 6e64 6578 2827 3a27 290d 0a20 2020 2020  ndex(':')..     
-0001be30: 2020 2020 2020 2065 6c69 6620 6570 6f63         elif epoc
-0001be40: 685f 7065 7269 6f64 203e 3d20 313a 0d0a  h_period >= 1:..
-0001be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be60: 6920 3d20 732e 696e 6465 7828 272e 2729  i = s.index('.')
-0001be70: 2069 6620 272e 2720 696e 2073 2065 6c73   if '.' in s els
-0001be80: 6520 6c65 6e28 7329 0d0a 2020 2020 2020  e len(s)..      
-0001be90: 2020 2020 2020 656c 6966 2065 706f 6368        elif epoch
-0001bea0: 5f70 6572 696f 6420 3e3d 2030 2e30 3031  _period >= 0.001
-0001beb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001bec0: 2020 2069 203d 202d 330d 0a20 2020 2020     i = -3..     
-0001bed0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0001bee0: 2020 2020 2020 2020 2020 2020 2020 6920                i 
-0001bef0: 3d20 6c65 6e28 7329 0d0a 2020 2020 2020  = len(s)..      
-0001bf00: 2020 2020 2020 7265 7475 726e 2073 5b3a        return s[:
-0001bf10: 695d 2c54 7275 650d 0a20 2020 2065 7863  i],True..    exc
-0001bf20: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-0001bf30: 2065 3a0d 0a20 2020 2020 2020 2069 6d70   e:..        imp
-0001bf40: 6f72 7420 7472 6163 6562 6163 6b0d 0a20  ort traceback.. 
-0001bf50: 2020 2020 2020 2074 7261 6365 6261 636b         traceback
-0001bf60: 2e70 7269 6e74 5f65 7863 2829 0d0a 2020  .print_exc()..  
-0001bf70: 2020 7265 7475 726e 2027 272c 6461 7461    return '',data
-0001bf80: 7372 632e 7469 6d65 6261 7365 6428 290d  src.timebased().
-0001bf90: 0a0d 0a0d 0a64 6566 205f 7832 7965 6172  .....def _x2year
-0001bfa0: 2864 6174 6173 7263 2c20 7829 3a0d 0a20  (datasrc, x):.. 
-0001bfb0: 2020 2074 2c68 6173 6473 203d 205f 7832     t,hasds = _x2
-0001bfc0: 6c6f 6361 6c5f 7428 6461 7461 7372 632c  local_t(datasrc,
-0001bfd0: 2078 290d 0a20 2020 2072 6574 7572 6e20   x)..    return 
-0001bfe0: 745b 3a34 5d2c 6861 7364 730d 0a0d 0a0d  t[:4],hasds.....
-0001bff0: 0a64 6566 205f 726f 756e 645f 746f 5f73  .def _round_to_s
-0001c000: 6967 6e69 6669 6361 6e74 2872 6e67 2c20  ignificant(rng, 
-0001c010: 726e 676d 6178 2c20 782c 2073 6967 6e69  rngmax, x, signi
-0001c020: 6669 6361 6e74 5f64 6563 696d 616c 732c  ficant_decimals,
-0001c030: 2073 6967 6e69 6669 6361 6e74 5f65 7073   significant_eps
-0001c040: 293a 0d0a 2020 2020 6973 5f68 6967 6872  ):..    is_highr
-0001c050: 6573 203d 2028 726e 672f 7369 676e 6966  es = (rng/signif
-0001c060: 6963 616e 745f 6570 7320 3e20 3165 3220  icant_eps > 1e2 
-0001c070: 616e 6420 726e 676d 6178 3c31 652d 3229  and rngmax<1e-2)
-0001c080: 206f 7220 6162 7328 726e 676d 6178 2920   or abs(rngmax) 
-0001c090: 3e20 3165 3720 6f72 2072 6e67 203c 2031  > 1e7 or rng < 1
-0001c0a0: 652d 350d 0a20 2020 2073 6420 3d20 7369  e-5..    sd = si
-0001c0b0: 676e 6966 6963 616e 745f 6465 6369 6d61  gnificant_decima
-0001c0c0: 6c73 0d0a 2020 2020 6966 2069 735f 6869  ls..    if is_hi
-0001c0d0: 6768 7265 7320 616e 6420 6162 7328 7829  ghres and abs(x)
-0001c0e0: 3e30 3a0d 0a20 2020 2020 2020 2065 7870  >0:..        exp
-0001c0f0: 3130 203d 2066 6c6f 6f72 286e 702e 6c6f  10 = floor(np.lo
-0001c100: 6731 3028 6162 7328 7829 2929 0d0a 2020  g10(abs(x)))..  
-0001c110: 2020 2020 2020 7820 3d20 7820 2f20 2831        x = x / (1
-0001c120: 302a 2a65 7870 3130 290d 0a20 2020 2020  0**exp10)..     
-0001c130: 2020 2072 6d20 3d20 696e 7428 6162 7328     rm = int(abs(
-0001c140: 6e70 2e6c 6f67 3130 2872 6e67 6d61 7829  np.log10(rngmax)
-0001c150: 2929 2069 6620 726e 676d 6178 3e30 2065  )) if rngmax>0 e
-0001c160: 6c73 6520 300d 0a20 2020 2020 2020 2073  lse 0..        s
-0001c170: 6420 3d20 6d69 6e28 332c 2073 642b 726d  d = min(3, sd+rm
-0001c180: 290d 0a20 2020 2020 2020 2066 6d74 203d  )..        fmt =
-0001c190: 2027 2525 2569 2e25 6966 6525 2569 2720   '%%%i.%ife%%i' 
-0001c1a0: 2520 2873 642c 2073 6429 0d0a 2020 2020  % (sd, sd)..    
-0001c1b0: 2020 2020 7220 3d20 666d 7420 2520 2878      r = fmt % (x
-0001c1c0: 2c20 6578 7031 3029 0d0a 2020 2020 656c  , exp10)..    el
-0001c1d0: 7365 3a0d 0a20 2020 2020 2020 2065 7073  se:..        eps
-0001c1e0: 203d 2066 6d6f 6428 782c 2073 6967 6e69   = fmod(x, signi
-0001c1f0: 6669 6361 6e74 5f65 7073 290d 0a20 2020  ficant_eps)..   
-0001c200: 2020 2020 2069 6620 6162 7328 6570 7329       if abs(eps)
-0001c210: 203e 3d20 7369 676e 6966 6963 616e 745f   >= significant_
-0001c220: 6570 732f 323a 0d0a 2020 2020 2020 2020  eps/2:..        
-0001c230: 2020 2020 2320 726f 756e 6420 7570 0d0a      # round up..
-0001c240: 2020 2020 2020 2020 2020 2020 6570 7320              eps 
-0001c250: 2d3d 206e 702e 7369 676e 2865 7073 292a  -= np.sign(eps)*
-0001c260: 7369 676e 6966 6963 616e 745f 6570 730d  significant_eps.
-0001c270: 0a20 2020 2020 2020 2078 7820 3d20 7820  .        xx = x 
-0001c280: 2d20 6570 730d 0a20 2020 2020 2020 2066  - eps..        f
-0001c290: 6d74 203d 2027 2525 2569 2e25 6966 2720  mt = '%%%i.%if' 
-0001c2a0: 2520 2873 642c 2073 6429 0d0a 2020 2020  % (sd, sd)..    
-0001c2b0: 2020 2020 7220 3d20 666d 7420 2520 7878      r = fmt % xx
-0001c2c0: 0d0a 2020 2020 2020 2020 6966 2061 6273  ..        if abs
-0001c2d0: 2878 293e 3020 616e 6420 726e 673c 3165  (x)>0 and rng<1e
-0001c2e0: 3420 616e 6420 722e 7374 6172 7473 7769  4 and r.startswi
-0001c2f0: 7468 2827 302e 3027 2920 616e 6420 666c  th('0.0') and fl
-0001c300: 6f61 7428 725b 3a2d 315d 2920 3d3d 2030  oat(r[:-1]) == 0
-0001c310: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0001c320: 203d 2027 252e 3265 2720 2520 780d 0a20   = '%.2e' % x.. 
-0001c330: 2020 2072 6574 7572 6e20 720d 0a0d 0a0d     return r.....
-0001c340: 0a64 6566 205f 726f 6968 616e 646c 655f  .def _roihandle_
-0001c350: 6d6f 7665 5f73 6e61 7028 7662 2c20 6f72  move_snap(vb, or
-0001c360: 6967 5f66 756e 632c 2070 6f73 2c20 6d6f  ig_func, pos, mo
-0001c370: 6469 6669 6572 733d 5174 436f 7265 2e51  difiers=QtCore.Q
-0001c380: 742e 4b65 7962 6f61 7264 4d6f 6469 6669  t.KeyboardModifi
-0001c390: 6572 2c20 6669 6e69 7368 3d54 7275 6529  er, finish=True)
-0001c3a0: 3a0d 0a20 2020 2070 6f73 203d 2076 622e  :..    pos = vb.
-0001c3b0: 6d61 7044 6576 6963 6554 6f56 6965 7728  mapDeviceToView(
-0001c3c0: 706f 7329 0d0a 2020 2020 706f 7320 3d20  pos)..    pos = 
-0001c3d0: 5f63 6c61 6d70 5f70 6f69 6e74 2876 622e  _clamp_point(vb.
-0001c3e0: 7061 7265 6e74 2829 2c20 706f 7329 0d0a  parent(), pos)..
-0001c3f0: 2020 2020 706f 7320 3d20 7662 2e6d 6170      pos = vb.map
-0001c400: 5669 6577 546f 4465 7669 6365 2870 6f73  ViewToDevice(pos
-0001c410: 290d 0a20 2020 206f 7269 675f 6675 6e63  )..    orig_func
-0001c420: 2870 6f73 2c20 6d6f 6469 6669 6572 733d  (pos, modifiers=
-0001c430: 6d6f 6469 6669 6572 732c 2066 696e 6973  modifiers, finis
-0001c440: 683d 6669 6e69 7368 290d 0a0d 0a0d 0a64  h=finish)......d
-0001c450: 6566 205f 636c 616d 705f 7879 2861 782c  ef _clamp_xy(ax,
-0001c460: 2078 2c20 7929 3a0d 0a20 2020 2069 6620   x, y):..    if 
-0001c470: 6e6f 7420 636c 616d 705f 6772 6964 3a0d  not clamp_grid:.
-0001c480: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001c490: 782c 2079 0d0a 2020 2020 7920 3d20 6178  x, y..    y = ax
-0001c4a0: 2e76 622e 7973 6361 6c65 2e78 666f 726d  .vb.yscale.xform
-0001c4b0: 2879 290d 0a20 2020 2023 2073 6361 6c65  (y)..    # scale
-0001c4c0: 2078 0d0a 2020 2020 6966 2061 782e 7662   x..    if ax.vb
-0001c4d0: 2e78 5f69 6e64 6578 6564 3a0d 0a20 2020  .x_indexed:..   
-0001c4e0: 2020 2020 2064 7320 3d20 6178 2e76 622e       ds = ax.vb.
-0001c4f0: 6461 7461 7372 630d 0a20 2020 2020 2020  datasrc..       
-0001c500: 2069 6620 7820 3c20 3020 6f72 2028 6473   if x < 0 or (ds
-0001c510: 2061 6e64 2078 203e 206c 656e 2864 732e   and x > len(ds.
-0001c520: 6466 292d 3129 3a0d 0a20 2020 2020 2020  df)-1):..       
-0001c530: 2020 2020 2078 203d 2030 2069 6620 7820       x = 0 if x 
-0001c540: 3c20 3020 656c 7365 206c 656e 2864 732e  < 0 else len(ds.
-0001c550: 6466 292d 310d 0a20 2020 2020 2020 2078  df)-1..        x
-0001c560: 203d 205f 726f 756e 6428 7829 0d0a 2020   = _round(x)..  
-0001c570: 2020 2320 7363 616c 6520 790d 0a20 2020    # scale y..   
-0001c580: 2069 6620 7920 3c20 302e 3120 616e 6420   if y < 0.1 and 
-0001c590: 6178 2e76 622e 7973 6361 6c65 2e73 6361  ax.vb.yscale.sca
-0001c5a0: 6c65 7479 7065 203d 3d20 276c 6f67 273a  letype == 'log':
-0001c5b0: 0d0a 2020 2020 2020 2020 6d61 676e 6974  ..        magnit
-0001c5c0: 7564 6520 3d20 696e 7428 3320 2d20 6e70  ude = int(3 - np
-0001c5d0: 2e6c 6f67 3130 2879 2929 2023 2072 6f75  .log10(y)) # rou
-0001c5e0: 6e64 206c 6f67 2074 6f20 4e20 6465 6369  nd log to N deci
-0001c5f0: 6d61 6c73 0d0a 2020 2020 2020 2020 7920  mals..        y 
-0001c600: 3d20 726f 756e 6428 792c 206d 6167 6e69  = round(y, magni
-0001c610: 7475 6465 290d 0a20 2020 2065 6c73 653a  tude)..    else:
-0001c620: 2023 206c 696e 6561 720d 0a20 2020 2020   # linear..     
-0001c630: 2020 2065 7073 203d 2061 782e 7369 676e     eps = ax.sign
-0001c640: 6966 6963 616e 745f 6570 730d 0a20 2020  ificant_eps..   
-0001c650: 2020 2020 2069 6620 6570 7320 3e20 3165       if eps > 1e
-0001c660: 2d38 3a0d 0a20 2020 2020 2020 2020 2020  -8:..           
-0001c670: 2065 7073 3220 3d20 6e70 2e73 6967 6e28   eps2 = np.sign(
-0001c680: 7929 202a 2030 2e35 202a 2065 7073 0d0a  y) * 0.5 * eps..
-0001c690: 2020 2020 2020 2020 2020 2020 7920 2d3d              y -=
-0001c6a0: 2066 6d6f 6428 792b 6570 7332 2c20 6570   fmod(y+eps2, ep
-0001c6b0: 7329 202d 2065 7073 320d 0a20 2020 2079  s) - eps2..    y
-0001c6c0: 203d 2061 782e 7662 2e79 7363 616c 652e   = ax.vb.yscale.
-0001c6d0: 696e 7678 666f 726d 2879 2c20 7665 7269  invxform(y, veri
-0001c6e0: 6679 3d54 7275 6529 0d0a 2020 2020 7265  fy=True)..    re
-0001c6f0: 7475 726e 2078 2c20 790d 0a0d 0a0d 0a64  turn x, y......d
-0001c700: 6566 205f 636c 616d 705f 706f 696e 7428  ef _clamp_point(
-0001c710: 6178 2c20 7029 3a0d 0a20 2020 2069 6620  ax, p):..    if 
-0001c720: 636c 616d 705f 6772 6964 3a0d 0a20 2020  clamp_grid:..   
-0001c730: 2020 2020 2078 2c79 203d 205f 636c 616d       x,y = _clam
-0001c740: 705f 7879 2861 782c 2070 2e78 2829 2c20  p_xy(ax, p.x(), 
-0001c750: 702e 7928 2929 0d0a 2020 2020 2020 2020  p.y())..        
-0001c760: 7265 7475 726e 2070 672e 506f 696e 7428  return pg.Point(
-0001c770: 782c 2079 290d 0a20 2020 2072 6574 7572  x, y)..    retur
-0001c780: 6e20 700d 0a0d 0a0d 0a64 6566 205f 6472  n p......def _dr
-0001c790: 6177 5f6c 696e 655f 7365 676d 656e 745f  aw_line_segment_
-0001c7a0: 7465 7874 2870 6f6c 796c 696e 652c 2073  text(polyline, s
-0001c7b0: 6567 6d65 6e74 2c20 706f 7330 2c20 706f  egment, pos0, po
-0001c7c0: 7331 293a 0d0a 2020 2020 6673 6563 7320  s1):..    fsecs 
-0001c7d0: 3d20 4e6f 6e65 0d0a 2020 2020 6461 7461  = None..    data
-0001c7e0: 7372 6320 3d20 706f 6c79 6c69 6e65 2e76  src = polyline.v
-0001c7f0: 622e 6461 7461 7372 630d 0a20 2020 2069  b.datasrc..    i
-0001c800: 6620 6461 7461 7372 6320 616e 6420 636c  f datasrc and cl
-0001c810: 616d 705f 6772 6964 3a0d 0a20 2020 2020  amp_grid:..     
-0001c820: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-0001c830: 2020 2020 2078 302c 7831 203d 2070 6f73       x0,x1 = pos
-0001c840: 302e 7828 292b 302e 352c 2070 6f73 312e  0.x()+0.5, pos1.
-0001c850: 7828 292b 302e 350d 0a20 2020 2020 2020  x()+0.5..       
-0001c860: 2020 2020 2074 302c 5f2c 5f2c 5f2c 636e       t0,_,_,_,cn
-0001c870: 7430 203d 2064 6174 6173 7263 2e68 696c  t0 = datasrc.hil
-0001c880: 6f28 7830 2c20 7830 290d 0a20 2020 2020  o(x0, x0)..     
-0001c890: 2020 2020 2020 2074 312c 5f2c 5f2c 5f2c         t1,_,_,_,
-0001c8a0: 636e 7431 203d 2064 6174 6173 7263 2e68  cnt1 = datasrc.h
-0001c8b0: 696c 6f28 7831 2c20 7831 290d 0a20 2020  ilo(x1, x1)..   
-0001c8c0: 2020 2020 2020 2020 2069 6620 636e 7430           if cnt0
-0001c8d0: 2061 6e64 2063 6e74 313a 0d0a 2020 2020   and cnt1:..    
-0001c8e0: 2020 2020 2020 2020 2020 2020 6673 6563              fsec
-0001c8f0: 7320 3d20 6162 7328 7431 202d 2074 3029  s = abs(t1 - t0)
-0001c900: 202f 2031 6539 0d0a 2020 2020 2020 2020   / 1e9..        
-0001c910: 6578 6365 7074 3a0d 0a20 2020 2020 2020  except:..       
-0001c920: 2020 2020 2070 6173 730d 0a20 2020 2064       pass..    d
-0001c930: 6966 6620 3d20 706f 7331 202d 2070 6f73  iff = pos1 - pos
-0001c940: 300d 0a20 2020 2069 6620 6673 6563 7320  0..    if fsecs 
-0001c950: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-0001c960: 2020 6673 6563 7320 3d20 6162 7328 6469    fsecs = abs(di
-0001c970: 6666 2e78 2829 2a65 706f 6368 5f70 6572  ff.x()*epoch_per
-0001c980: 696f 6429 0d0a 2020 2020 7365 6373 203d  iod)..    secs =
-0001c990: 2069 6e74 2866 7365 6373 290d 0a20 2020   int(fsecs)..   
-0001c9a0: 206d 696e 7320 3d20 7365 6373 2f2f 3630   mins = secs//60
-0001c9b0: 0d0a 2020 2020 686f 7572 7320 3d20 6d69  ..    hours = mi
-0001c9c0: 6e73 2f2f 3630 0d0a 2020 2020 6d69 6e73  ns//60..    mins
-0001c9d0: 203d 206d 696e 7325 3630 0d0a 2020 2020   = mins%60..    
-0001c9e0: 7365 6373 203d 2073 6563 7325 3630 0d0a  secs = secs%60..
-0001c9f0: 2020 2020 6966 2068 6f75 7273 3d3d 3020      if hours==0 
-0001ca00: 616e 6420 6d69 6e73 3d3d 3020 616e 6420  and mins==0 and 
-0001ca10: 7365 6373 203c 2036 3020 616e 6420 6570  secs < 60 and ep
-0001ca20: 6f63 685f 7065 7269 6f64 203c 2031 3a0d  och_period < 1:.
-0001ca30: 0a20 2020 2020 2020 206d 7365 6373 203d  .        msecs =
-0001ca40: 2069 6e74 2828 6673 6563 732d 696e 7428   int((fsecs-int(
-0001ca50: 6673 6563 7329 292a 3130 3030 290d 0a20  fsecs))*1000).. 
-0001ca60: 2020 2020 2020 2074 7320 3d20 2725 302e         ts = '%0.
-0001ca70: 3269 3a25 302e 3269 2e25 302e 3369 2720  2i:%0.2i.%0.3i' 
-0001ca80: 2520 286d 696e 732c 2073 6563 732c 206d  % (mins, secs, m
-0001ca90: 7365 6373 290d 0a20 2020 2065 6c69 6620  secs)..    elif 
-0001caa0: 686f 7572 733d 3d30 2061 6e64 206d 696e  hours==0 and min
-0001cab0: 7320 3c20 3630 2061 6e64 2065 706f 6368  s < 60 and epoch
-0001cac0: 5f70 6572 696f 6420 3c20 3630 3a0d 0a20  _period < 60:.. 
-0001cad0: 2020 2020 2020 2074 7320 3d20 2725 302e         ts = '%0.
-0001cae0: 3269 3a25 302e 3269 3a25 302e 3269 2720  2i:%0.2i:%0.2i' 
-0001caf0: 2520 2868 6f75 7273 2c20 6d69 6e73 2c20  % (hours, mins, 
-0001cb00: 7365 6373 290d 0a20 2020 2065 6c69 6620  secs)..    elif 
-0001cb10: 686f 7572 7320 3c20 3234 3a0d 0a20 2020  hours < 24:..   
-0001cb20: 2020 2020 2074 7320 3d20 2725 302e 3269       ts = '%0.2i
-0001cb30: 3a25 302e 3269 2720 2520 2868 6f75 7273  :%0.2i' % (hours
-0001cb40: 2c20 6d69 6e73 290d 0a20 2020 2065 6c73  , mins)..    els
-0001cb50: 653a 0d0a 2020 2020 2020 2020 6461 7973  e:..        days
-0001cb60: 203d 2068 6f75 7273 202f 2f20 3234 0d0a   = hours // 24..
-0001cb70: 2020 2020 2020 2020 686f 7572 7320 253d          hours %=
-0001cb80: 2032 340d 0a20 2020 2020 2020 2074 7320   24..        ts 
-0001cb90: 3d20 2725 6964 2025 302e 3269 3a25 302e  = '%id %0.2i:%0.
-0001cba0: 3269 2720 2520 2864 6179 732c 2068 6f75  2i' % (days, hou
-0001cbb0: 7273 2c20 6d69 6e73 290d 0a20 2020 2020  rs, mins)..     
-0001cbc0: 2020 2069 6620 7473 2e65 6e64 7377 6974     if ts.endswit
-0001cbd0: 6828 2720 3030 3a30 3027 293a 0d0a 2020  h(' 00:00'):..  
-0001cbe0: 2020 2020 2020 2020 2020 7473 203d 2074            ts = t
-0001cbf0: 732e 7061 7274 6974 696f 6e28 2720 2729  s.partition(' ')
-0001cc00: 5b30 5d0d 0a20 2020 2079 7363 203d 2070  [0]..    ysc = p
-0001cc10: 6f6c 796c 696e 652e 7662 2e79 7363 616c  olyline.vb.yscal
-0001cc20: 650d 0a20 2020 2069 6620 706f 6c79 6c69  e..    if polyli
-0001cc30: 6e65 2e76 622e 795f 706f 7369 7469 7665  ne.vb.y_positive
-0001cc40: 3a0d 0a20 2020 2020 2020 2079 302c 7931  :..        y0,y1
-0001cc50: 203d 2079 7363 2e78 666f 726d 2870 6f73   = ysc.xform(pos
-0001cc60: 302e 7928 2929 2c20 7973 632e 7866 6f72  0.y()), ysc.xfor
-0001cc70: 6d28 706f 7331 2e79 2829 290d 0a20 2020  m(pos1.y())..   
-0001cc80: 2020 2020 2069 6620 7930 3a0d 0a20 2020       if y0:..   
-0001cc90: 2020 2020 2020 2020 2067 6169 6e20 3d20           gain = 
-0001cca0: 7931 202f 2079 3020 2d20 310d 0a20 2020  y1 / y0 - 1..   
-0001ccb0: 2020 2020 2020 2020 2069 6620 6761 696e           if gain
-0001ccc0: 203e 2031 303a 0d0a 2020 2020 2020 2020   > 10:..        
-0001ccd0: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
-0001cce0: 2778 2569 2720 2520 6761 696e 0d0a 2020  'x%i' % gain..  
-0001ccf0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0001cd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cd10: 2076 616c 7565 203d 2027 252b 2e32 6620   value = '%+.2f 
-0001cd20: 2525 2720 2520 2831 3030 202a 2067 6169  %%' % (100 * gai
-0001cd30: 6e29 0d0a 2020 2020 2020 2020 656c 6966  n)..        elif
-0001cd40: 206e 6f74 2079 313a 0d0a 2020 2020 2020   not y1:..      
-0001cd50: 2020 2020 2020 7661 6c75 6520 3d20 2730        value = '0
-0001cd60: 270d 0a20 2020 2020 2020 2065 6c73 653a  '..        else:
-0001cd70: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-0001cd80: 6c75 6520 3d20 272b e288 9e27 2069 6620  lue = '+...' if 
-0001cd90: 7931 3e30 2065 6c73 6520 272d e288 9e27  y1>0 else '-...'
-0001cda0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-0001cdb0: 2020 2020 2064 7920 3d20 7973 632e 7866       dy = ysc.xf
-0001cdc0: 6f72 6d28 6469 6666 2e79 2829 290d 0a20  orm(diff.y()).. 
-0001cdd0: 2020 2020 2020 2069 6620 6479 2061 6e64         if dy and
-0001cde0: 2028 6162 7328 6479 2920 3e3d 2031 6534   (abs(dy) >= 1e4
-0001cdf0: 206f 7220 6162 7328 6479 2920 3c3d 2031   or abs(dy) <= 1
-0001ce00: 652d 3229 3a0d 0a20 2020 2020 2020 2020  e-2):..         
-0001ce10: 2020 2076 616c 7565 203d 2027 252b 332e     value = '%+3.
-0001ce20: 3367 2720 2520 6479 0d0a 2020 2020 2020  3g' % dy..      
-0001ce30: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0001ce40: 2020 2020 2076 616c 7565 203d 2027 252b       value = '%+
-0001ce50: 322e 3266 2720 2520 6479 0d0a 2020 2020  2.2f' % dy..    
-0001ce60: 6578 7472 6120 3d20 5f64 7261 775f 6c69  extra = _draw_li
-0001ce70: 6e65 5f65 7874 7261 5f74 6578 7428 706f  ne_extra_text(po
-0001ce80: 6c79 6c69 6e65 2c20 7365 676d 656e 742c  lyline, segment,
-0001ce90: 2070 6f73 302c 2070 6f73 3129 0d0a 2020   pos0, pos1)..  
-0001cea0: 2020 7265 7475 726e 2027 2573 2025 7320    return '%s %s 
-0001ceb0: 2825 7329 2720 2520 2876 616c 7565 2c20  (%s)' % (value, 
-0001cec0: 6578 7472 612c 2074 7329 0d0a 0d0a 0d0a  extra, ts)......
-0001ced0: 6465 6620 5f64 7261 775f 6c69 6e65 5f65  def _draw_line_e
-0001cee0: 7874 7261 5f74 6578 7428 706f 6c79 6c69  xtra_text(polyli
-0001cef0: 6e65 2c20 7365 676d 656e 742c 2070 6f73  ne, segment, pos
-0001cf00: 302c 2070 6f73 3129 3a0d 0a20 2020 2027  0, pos1):..    '
-0001cf10: 2727 5368 6f77 7320 7468 6520 7072 6f70  ''Shows the prop
-0001cf20: 6f72 7469 6f6e 7320 6f66 2074 6869 7320  ortions of this 
-0001cf30: 6c69 6e65 2068 6569 6768 7420 636f 6d70  line height comp
-0001cf40: 6172 6564 2074 6f20 7468 6520 7072 6576  ared to the prev
-0001cf50: 696f 7573 2073 6567 6d65 6e74 2e27 2727  ious segment.'''
-0001cf60: 0d0a 2020 2020 7072 6576 5f74 6578 7420  ..    prev_text 
-0001cf70: 3d20 4e6f 6e65 0d0a 2020 2020 666f 7220  = None..    for 
-0001cf80: 7465 7874 2069 6e20 706f 6c79 6c69 6e65  text in polyline
-0001cf90: 2e74 6578 7473 3a0d 0a20 2020 2020 2020  .texts:..       
-0001cfa0: 2069 6620 7072 6576 5f74 6578 7420 6973   if prev_text is
-0001cfb0: 206e 6f74 204e 6f6e 6520 616e 6420 7465   not None and te
-0001cfc0: 7874 2e73 6567 6d65 6e74 203d 3d20 7365  xt.segment == se
-0001cfd0: 676d 656e 743a 0d0a 2020 2020 2020 2020  gment:..        
-0001cfe0: 2020 2020 6830 203d 2070 7265 765f 7465      h0 = prev_te
-0001cff0: 7874 2e73 6567 6d65 6e74 2e68 616e 646c  xt.segment.handl
-0001d000: 6573 5b30 5d5b 2769 7465 6d27 5d0d 0a20  es[0]['item'].. 
-0001d010: 2020 2020 2020 2020 2020 2068 3120 3d20             h1 = 
-0001d020: 7072 6576 5f74 6578 742e 7365 676d 656e  prev_text.segmen
-0001d030: 742e 6861 6e64 6c65 735b 315d 5b27 6974  t.handles[1]['it
-0001d040: 656d 275d 0d0a 2020 2020 2020 2020 2020  em']..          
-0001d050: 2020 7072 6576 5f63 6861 6e67 6520 3d20    prev_change = 
-0001d060: 6831 2e70 6f73 2829 2e79 2829 202d 2068  h1.pos().y() - h
-0001d070: 302e 706f 7328 292e 7928 290d 0a20 2020  0.pos().y()..   
-0001d080: 2020 2020 2020 2020 2074 6869 735f 6368           this_ch
-0001d090: 616e 6765 203d 2070 6f73 312e 7928 2920  ange = pos1.y() 
-0001d0a0: 2d20 706f 7330 2e79 2829 0d0a 2020 2020  - pos0.y()..    
-0001d0b0: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
-0001d0c0: 6273 2870 7265 765f 6368 616e 6765 2920  bs(prev_change) 
-0001d0d0: 3e20 3165 2d31 343a 0d0a 2020 2020 2020  > 1e-14:..      
-0001d0e0: 2020 2020 2020 2020 2020 6272 6561 6b0d            break.
-0001d0f0: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
-0001d100: 6e67 655f 7061 7274 203d 2061 6273 2874  nge_part = abs(t
-0001d110: 6869 735f 6368 616e 6765 202f 2070 7265  his_change / pre
-0001d120: 765f 6368 616e 6765 290d 0a20 2020 2020  v_change)..     
-0001d130: 2020 2020 2020 2072 6574 7572 6e20 2720         return ' 
-0001d140: 3d20 313a 252e 3266 2027 2025 2063 6861  = 1:%.2f ' % cha
-0001d150: 6e67 655f 7061 7274 0d0a 2020 2020 2020  nge_part..      
-0001d160: 2020 7072 6576 5f74 6578 7420 3d20 7465    prev_text = te
-0001d170: 7874 0d0a 2020 2020 7265 7475 726e 2027  xt..    return '
-0001d180: 270d 0a0d 0a0d 0a64 6566 205f 6d61 6b65  '......def _make
-0001d190: 7065 6e28 636f 6c6f 722c 2073 7479 6c65  pen(color, style
-0001d1a0: 3d4e 6f6e 652c 2077 6964 7468 3d31 293a  =None, width=1):
-0001d1b0: 0d0a 2020 2020 6966 2073 7479 6c65 2069  ..    if style i
-0001d1c0: 7320 4e6f 6e65 206f 7220 7374 796c 6520  s None or style 
-0001d1d0: 3d3d 2027 2d27 3a0d 0a20 2020 2020 2020  == '-':..       
-0001d1e0: 2072 6574 7572 6e20 7067 2e6d 6b50 656e   return pg.mkPen
-0001d1f0: 2863 6f6c 6f72 3d63 6f6c 6f72 2c20 7769  (color=color, wi
-0001d200: 6474 683d 7769 6474 6829 0d0a 2020 2020  dth=width)..    
-0001d210: 6461 7368 203d 205b 5d0d 0a20 2020 2066  dash = []..    f
-0001d220: 6f72 2063 6820 696e 2073 7479 6c65 3a0d  or ch in style:.
-0001d230: 0a20 2020 2020 2020 2069 6620 6368 203d  .        if ch =
-0001d240: 3d20 272d 273a 0d0a 2020 2020 2020 2020  = '-':..        
-0001d250: 2020 2020 6461 7368 202b 3d20 5b34 2c32      dash += [4,2
-0001d260: 5d0d 0a20 2020 2020 2020 2065 6c69 6620  ]..        elif 
-0001d270: 6368 203d 3d20 275f 273a 0d0a 2020 2020  ch == '_':..    
-0001d280: 2020 2020 2020 2020 6461 7368 202b 3d20          dash += 
-0001d290: 5b31 302c 325d 0d0a 2020 2020 2020 2020  [10,2]..        
-0001d2a0: 656c 6966 2063 6820 3d3d 2027 2e27 3a0d  elif ch == '.':.
-0001d2b0: 0a20 2020 2020 2020 2020 2020 2064 6173  .            das
-0001d2c0: 6820 2b3d 205b 312c 325d 0d0a 2020 2020  h += [1,2]..    
-0001d2d0: 2020 2020 656c 6966 2063 6820 3d3d 2027      elif ch == '
-0001d2e0: 2027 3a0d 0a20 2020 2020 2020 2020 2020   ':..           
-0001d2f0: 2069 6620 6461 7368 3a0d 0a20 2020 2020   if dash:..     
-0001d300: 2020 2020 2020 2020 2020 2064 6173 685b             dash[
-0001d310: 2d31 5d20 2b3d 2032 0d0a 2020 2020 7265  -1] += 2..    re
-0001d320: 7475 726e 2070 672e 6d6b 5065 6e28 636f  turn pg.mkPen(co
-0001d330: 6c6f 723d 636f 6c6f 722c 2073 7479 6c65  lor=color, style
-0001d340: 3d51 7443 6f72 652e 5174 2e50 656e 5374  =QtCore.Qt.PenSt
-0001d350: 796c 652e 4375 7374 6f6d 4461 7368 4c69  yle.CustomDashLi
-0001d360: 6e65 2c20 6461 7368 3d64 6173 682c 2077  ne, dash=dash, w
-0001d370: 6964 7468 3d77 6964 7468 290d 0a0d 0a0d  idth=width).....
-0001d380: 0a64 6566 205f 726f 756e 6428 7629 3a0d  .def _round(v):.
-0001d390: 0a20 2020 2072 6574 7572 6e20 666c 6f6f  .    return floo
-0001d3a0: 7228 762b 302e 3529 0d0a 0d0a 0d0a 7472  r(v+0.5)......tr
-0001d3b0: 793a 0d0a 2020 2020 7174 7665 7220 3d20  y:..    qtver = 
-0001d3c0: 2725 642e 2564 2720 2520 2851 7443 6f72  '%d.%d' % (QtCor
-0001d3d0: 652e 5154 5f56 4552 5349 4f4e 2f2f 3235  e.QT_VERSION//25
-0001d3e0: 362f 2f32 3536 2c20 5174 436f 7265 2e51  6//256, QtCore.Q
-0001d3f0: 545f 5645 5253 494f 4e2f 2f32 3536 2532  T_VERSION//256%2
-0001d400: 3536 290d 0a20 2020 2069 6620 7174 7665  56)..    if qtve
-0001d410: 7220 6e6f 7420 696e 2028 2735 2e39 272c  r not in ('5.9',
-0001d420: 2027 352e 3133 2729 2061 6e64 205b 696e   '5.13') and [in
-0001d430: 7428 6929 2066 6f72 2069 2069 6e20 7067  t(i) for i in pg
-0001d440: 2e5f 5f76 6572 7369 6f6e 5f5f 2e73 706c  .__version__.spl
-0001d450: 6974 2827 2e27 295d 203c 3d20 5b30 2c31  it('.')] <= [0,1
-0001d460: 312c 305d 3a0d 0a20 2020 2020 2020 2070  1,0]:..        p
-0001d470: 7269 6e74 2827 5741 524e 494e 473a 2079  rint('WARNING: y
-0001d480: 6f75 7220 7665 7273 696f 6e20 6f66 2051  our version of Q
-0001d490: 7420 6d61 7920 6e6f 7420 706c 6f74 2063  t may not plot c
-0001d4a0: 7572 7665 7320 636f 6e74 6169 6e69 6e67  urves containing
-0001d4b0: 204e 614e 7320 616e 6420 6973 206e 6f74   NaNs and is not
-0001d4c0: 2072 6563 6f6d 6d65 6e64 6564 2e27 290d   recommended.').
-0001d4d0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-0001d4e0: 5365 6520 6874 7470 733a 2f2f 6769 7468  See https://gith
-0001d4f0: 7562 2e63 6f6d 2f70 7971 7467 7261 7068  ub.com/pyqtgraph
-0001d500: 2f70 7971 7467 7261 7068 2f69 7373 7565  /pyqtgraph/issue
-0001d510: 732f 3130 3537 2729 0d0a 6578 6365 7074  s/1057')..except
-0001d520: 3a0d 0a20 2020 2070 6173 730d 0a0d 0a69  :..    pass....i
-0001d530: 6d70 6f72 7420 6c6f 6361 6c65 0d0a 636f  mport locale..co
-0001d540: 6465 2c5f 203d 206c 6f63 616c 652e 6765  de,_ = locale.ge
-0001d550: 7464 6566 6175 6c74 6c6f 6361 6c65 2829  tdefaultlocale()
-0001d560: 0d0a 6966 2063 6f64 6520 6973 206e 6f74  ..if code is not
-0001d570: 204e 6f6e 6520 616e 6420 5c0d 0a20 2020   None and \..   
-0001d580: 2028 616e 7928 7361 6e63 7469 6f6e 6564   (any(sanctioned
-0001d590: 2069 6e20 636f 6465 2e6c 6f77 6572 2829   in code.lower()
-0001d5a0: 2066 6f72 2073 616e 6374 696f 6e65 6420   for sanctioned 
-0001d5b0: 696e 2027 5f72 7520 5f62 7920 7275 5f20  in '_ru _by ru_ 
-0001d5c0: 6265 5f27 2e73 706c 6974 2829 2920 6f72  be_'.split()) or
-0001d5d0: 205c 0d0a 2020 2020 2061 6e79 2873 616e   \..     any(san
-0001d5e0: 6374 696f 6e65 6420 696e 2063 6f64 652e  ctioned in code.
-0001d5f0: 6c6f 7765 7228 2920 666f 7220 7361 6e63  lower() for sanc
-0001d600: 7469 6f6e 6564 2069 6e20 2772 7520 6265  tioned in 'ru be
-0001d610: 272e 7370 6c69 7428 2929 293a 0d0a 2020  '.split())):..  
-0001d620: 2020 696d 706f 7274 206f 730d 0a20 2020    import os..   
-0001d630: 206f 732e 5f65 7869 7428 3129 0d0a 2020   os._exit(1)..  
-0001d640: 2020 6173 7365 7274 2046 616c 7365 0d0a    assert False..
-0001d650: 0d0a 2320 6465 6661 756c 7420 746f 2062  ..# default to b
-0001d660: 6c61 636b 2d6f 6e2d 7768 6974 650d 0a70  lack-on-white..p
-0001d670: 672e 7769 6467 6574 732e 4772 6170 6869  g.widgets.Graphi
-0001d680: 6373 5669 6577 2e47 7261 7068 6963 7356  csView.GraphicsV
-0001d690: 6965 772e 7768 6565 6c45 7665 6e74 203d  iew.wheelEvent =
-0001d6a0: 2070 6172 7469 616c 6d65 7468 6f64 285f   partialmethod(_
-0001d6b0: 7768 6565 6c5f 6576 656e 745f 7772 6170  wheel_event_wrap
-0001d6c0: 7065 722c 2070 672e 7769 6467 6574 732e  per, pg.widgets.
-0001d6d0: 4772 6170 6869 6373 5669 6577 2e47 7261  GraphicsView.Gra
-0001d6e0: 7068 6963 7356 6965 772e 7768 6565 6c45  phicsView.wheelE
-0001d6f0: 7665 6e74 290d 0a23 2075 7365 2066 696e  vent)..# use fin
-0001d700: 706c 6f74 2069 6e73 7465 6164 206f 6620  plot instead of 
-0001d710: 6d61 7470 6c6f 746c 6962 0d0a 7064 2e73  matplotlib..pd.s
-0001d720: 6574 5f6f 7074 696f 6e28 2770 6c6f 7474  et_option('plott
-0001d730: 696e 672e 6261 636b 656e 6427 2c20 2766  ing.backend', 'f
-0001d740: 696e 706c 6f74 2e70 6470 6c6f 7427 290d  inplot.pdplot').
-0001d750: 0a23 2070 6963 6b20 7570 2077 696e 2072  .# pick up win r
-0001d760: 6573 6f6c 7574 696f 6e0d 0a74 7279 3a0d  esolution..try:.
-0001d770: 0a20 2020 2069 6d70 6f72 7420 6374 7970  .    import ctyp
-0001d780: 6573 0d0a 2020 2020 7573 6572 3332 203d  es..    user32 =
-0001d790: 2063 7479 7065 732e 7769 6e64 6c6c 2e75   ctypes.windll.u
-0001d7a0: 7365 7233 320d 0a20 2020 2075 7365 7233  ser32..    user3
-0001d7b0: 322e 5365 7450 726f 6365 7373 4450 4941  2.SetProcessDPIA
-0001d7c0: 7761 7265 2829 0d0a 2020 2020 6c6f 645f  ware()..    lod_
-0001d7d0: 6361 6e64 6c65 7320 3d20 696e 7428 7573  candles = int(us
-0001d7e0: 6572 3332 2e47 6574 5379 7374 656d 4d65  er32.GetSystemMe
-0001d7f0: 7472 6963 7328 3029 202a 2031 2e36 290d  trics(0) * 1.6).
-0001d800: 0a20 2020 2063 616e 646c 655f 7368 6164  .    candle_shad
-0001d810: 6f77 5f77 6964 7468 203d 2069 6e74 2875  ow_width = int(u
-0001d820: 7365 7233 322e 4765 7453 7973 7465 6d4d  ser32.GetSystemM
-0001d830: 6574 7269 6373 2830 2920 2f2f 2032 3130  etrics(0) // 210
-0001d840: 3020 2b20 3129 2023 2032 3536 3020 616e  0 + 1) # 2560 an
-0001d850: 6420 7265 736f 6c75 7469 6f6e 7320 6162  d resolutions ab
-0001d860: 6f76 6520 2d3e 2077 6964 6572 2073 6861  ove -> wider sha
-0001d870: 646f 7773 0d0a 6578 6365 7074 3a0d 0a20  dows..except:.. 
-0001d880: 2020 2070 6173 730d 0a                      pass..
+0000e2d0: 2e73 6574 506f 7328 782c 2079 290d 0a20  .setPos(x, y).. 
+0000e2e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000e2f0: 7465 6d2e 7365 7450 6172 656e 7449 7465  tem.setParentIte
+0000e300: 6d28 7365 6c66 290d 0a20 2020 2020 2020  m(self)..       
+0000e310: 2020 2020 2020 2020 2063 7265 6174 6564           created
+0000e320: 202b 3d20 310d 0a20 2020 2020 2020 2069   += 1..        i
+0000e330: 6620 6372 6561 7465 6420 3e20 3020 6f72  f created > 0 or
+0000e340: 2073 656c 662e 6469 7274 793a 2023 206f   self.dirty: # o
+0000e350: 6e6c 7920 7265 6475 6365 2063 6163 6865  nly reduce cache
+0000e360: 2069 6620 7765 2776 6520 6164 6465 6420   if we've added 
+0000e370: 736f 6d65 206e 6577 206f 7220 7570 6461  some new or upda
+0000e380: 7465 640d 0a20 2020 2020 2020 2020 2020  ted..           
+0000e390: 2073 656c 662e 636c 6561 725f 6974 656d   self.clear_item
+0000e3a0: 7328 6472 6f70 7329 0d0a 0d0a 2020 2020  s(drops)....    
+0000e3b0: 6465 6620 636c 6561 725f 6974 656d 7328  def clear_items(
+0000e3c0: 7365 6c66 2c20 6472 6f70 5f6b 6579 7329  self, drop_keys)
+0000e3d0: 3a0d 0a20 2020 2020 2020 2066 6f72 206b  :..        for k
+0000e3e0: 6579 2069 6e20 6472 6f70 5f6b 6579 733a  ey in drop_keys:
+0000e3f0: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
+0000e400: 656d 203d 2073 656c 662e 7465 7874 5f69  em = self.text_i
+0000e410: 7465 6d73 5b6b 6579 5d0d 0a20 2020 2020  tems[key]..     
+0000e420: 2020 2020 2020 2069 7465 6d2e 7363 656e         item.scen
+0000e430: 6528 292e 7265 6d6f 7665 4974 656d 2869  e().removeItem(i
+0000e440: 7465 6d29 0d0a 2020 2020 2020 2020 2020  tem)..          
+0000e450: 2020 6465 6c20 7365 6c66 2e74 6578 745f    del self.text_
+0000e460: 6974 656d 735b 6b65 795d 0d0a 0d0a 2020  items[key]....  
+0000e470: 2020 6465 6620 6765 7472 6f77 7328 7365    def getrows(se
+0000e480: 6c66 2c20 626f 756e 6469 6e67 5f72 6563  lf, bounding_rec
+0000e490: 7429 3a0d 0a20 2020 2020 2020 206c 6566  t):..        lef
+0000e4a0: 742c 7269 6768 7420 3d20 626f 756e 6469  t,right = boundi
+0000e4b0: 6e67 5f72 6563 742e 6c65 6674 2829 2c20  ng_rect.left(), 
+0000e4c0: 626f 756e 6469 6e67 5f72 6563 742e 7269  bounding_rect.ri
+0000e4d0: 6768 7428 290d 0a20 2020 2020 2020 2064  ght()..        d
+0000e4e0: 662c 5f20 3d20 7365 6c66 2e64 6174 6173  f,_ = self.datas
+0000e4f0: 7263 2e72 6f77 7328 332c 206c 6566 742c  rc.rows(3, left,
+0000e500: 2072 6967 6874 2c20 7973 6361 6c65 3d73   right, yscale=s
+0000e510: 656c 662e 6178 2e76 622e 7973 6361 6c65  elf.ax.vb.yscale
+0000e520: 2c20 6c6f 643d 4661 6c73 6529 0d0a 2020  , lod=False)..  
+0000e530: 2020 2020 2020 726f 7773 203d 2064 662e        rows = df.
+0000e540: 6472 6f70 6e61 2829 0d0a 2020 2020 2020  dropna()..      
+0000e550: 2020 6964 7873 203d 2072 6f77 732e 696e    idxs = rows.in
+0000e560: 6465 780d 0a20 2020 2020 2020 2072 6f77  dex..        row
+0000e570: 7320 3d20 726f 7773 2e76 616c 7565 730d  s = rows.values.
+0000e580: 0a20 2020 2020 2020 2072 6f77 7320 3d20  .        rows = 
+0000e590: 5b28 692c 742c 792c 7478 7429 2066 6f72  [(i,t,y,txt) for
+0000e5a0: 2069 2c28 742c 792c 7478 7429 2069 6e20   i,(t,y,txt) in 
+0000e5b0: 7a69 7028 6964 7873 2c20 726f 7773 2920  zip(idxs, rows) 
+0000e5c0: 6966 2074 7874 5d0d 0a20 2020 2020 2020  if txt]..       
+0000e5d0: 2072 6574 7572 6e20 726f 7773 0d0a 0d0a   return rows....
+0000e5e0: 2020 2020 6465 6620 626f 756e 6469 6e67      def bounding
+0000e5f0: 5265 6374 2873 656c 6629 3a0d 0a20 2020  Rect(self):..   
+0000e600: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000e610: 2e76 6965 7752 6563 7428 290d 0a0d 0a0d  .viewRect().....
+0000e620: 0a64 6566 2063 7265 6174 655f 706c 6f74  .def create_plot
+0000e630: 2874 6974 6c65 3d27 4669 6e61 6e63 6520  (title='Finance 
+0000e640: 506c 6f74 272c 2072 6f77 733d 312c 2069  Plot', rows=1, i
+0000e650: 6e69 745f 7a6f 6f6d 5f70 6572 696f 6473  nit_zoom_periods
+0000e660: 3d31 6531 302c 206d 6178 696d 697a 653d  =1e10, maximize=
+0000e670: 5472 7565 2c20 7973 6361 6c65 3d27 6c69  True, yscale='li
+0000e680: 6e65 6172 2729 3a0d 0a20 2020 2070 672e  near'):..    pg.
+0000e690: 7365 7443 6f6e 6669 674f 7074 696f 6e73  setConfigOptions
+0000e6a0: 2866 6f72 6567 726f 756e 643d 666f 7265  (foreground=fore
+0000e6b0: 6772 6f75 6e64 2c20 6261 636b 6772 6f75  ground, backgrou
+0000e6c0: 6e64 3d62 6163 6b67 726f 756e 6429 0d0a  nd=background)..
+0000e6d0: 2020 2020 7769 6e20 3d20 4669 6e57 696e      win = FinWin
+0000e6e0: 646f 7728 7469 746c 6529 0d0a 2020 2020  dow(title)..    
+0000e6f0: 7769 6e2e 7368 6f77 5f6d 6178 696d 697a  win.show_maximiz
+0000e700: 6564 203d 206d 6178 696d 697a 650d 0a20  ed = maximize.. 
+0000e710: 2020 2061 7830 203d 2061 7873 203d 2063     ax0 = axs = c
+0000e720: 7265 6174 655f 706c 6f74 5f77 6964 6765  reate_plot_widge
+0000e730: 7428 6d61 7374 6572 3d77 696e 2c20 726f  t(master=win, ro
+0000e740: 7773 3d72 6f77 732c 2069 6e69 745f 7a6f  ws=rows, init_zo
+0000e750: 6f6d 5f70 6572 696f 6473 3d69 6e69 745f  om_periods=init_
+0000e760: 7a6f 6f6d 5f70 6572 696f 6473 2c20 7973  zoom_periods, ys
+0000e770: 6361 6c65 3d79 7363 616c 6529 0d0a 2020  cale=yscale)..  
+0000e780: 2020 6178 7320 3d20 6178 7320 6966 2074    axs = axs if t
+0000e790: 7970 6528 6178 7329 2069 6e20 2874 7570  ype(axs) in (tup
+0000e7a0: 6c65 2c6c 6973 7429 2065 6c73 6520 5b61  le,list) else [a
+0000e7b0: 7873 5d0d 0a20 2020 2066 6f72 2061 7820  xs]..    for ax 
+0000e7c0: 696e 2061 7873 3a0d 0a20 2020 2020 2020  in axs:..       
+0000e7d0: 2077 696e 2e61 6464 4974 656d 2861 782c   win.addItem(ax,
+0000e7e0: 2063 6f6c 3d31 290d 0a20 2020 2020 2020   col=1)..       
+0000e7f0: 2077 696e 2e6e 6578 7452 6f77 2829 0d0a   win.nextRow()..
+0000e800: 2020 2020 7265 7475 726e 2061 7830 0d0a      return ax0..
+0000e810: 0d0a 0d0a 6465 6620 6372 6561 7465 5f70  ....def create_p
+0000e820: 6c6f 745f 7769 6467 6574 286d 6173 7465  lot_widget(maste
+0000e830: 722c 2072 6f77 733d 312c 2069 6e69 745f  r, rows=1, init_
+0000e840: 7a6f 6f6d 5f70 6572 696f 6473 3d31 6531  zoom_periods=1e1
+0000e850: 302c 2079 7363 616c 653d 276c 696e 6561  0, yscale='linea
+0000e860: 7227 293a 0d0a 2020 2020 7067 2e73 6574  r'):..    pg.set
+0000e870: 436f 6e66 6967 4f70 7469 6f6e 7328 666f  ConfigOptions(fo
+0000e880: 7265 6772 6f75 6e64 3d66 6f72 6567 726f  reground=foregro
+0000e890: 756e 642c 2062 6163 6b67 726f 756e 643d  und, background=
+0000e8a0: 6261 636b 6772 6f75 6e64 290d 0a20 2020  background)..   
+0000e8b0: 2067 6c6f 6261 6c20 6c61 7374 5f61 780d   global last_ax.
+0000e8c0: 0a20 2020 2069 6620 6d61 7374 6572 206e  .    if master n
+0000e8d0: 6f74 2069 6e20 7769 6e64 6f77 733a 0d0a  ot in windows:..
+0000e8e0: 2020 2020 2020 2020 7769 6e64 6f77 732e          windows.
+0000e8f0: 6170 7065 6e64 286d 6173 7465 7229 0d0a  append(master)..
+0000e900: 2020 2020 6178 7320 3d20 5b5d 0d0a 2020      axs = []..  
+0000e910: 2020 7072 6576 5f61 7820 3d20 4e6f 6e65    prev_ax = None
+0000e920: 0d0a 2020 2020 666f 7220 6e20 696e 2072  ..    for n in r
+0000e930: 616e 6765 2872 6f77 7329 3a0d 0a20 2020  ange(rows):..   
+0000e940: 2020 2020 2079 7363 203d 2079 7363 616c       ysc = yscal
+0000e950: 655b 6e5d 2069 6620 7479 7065 2879 7363  e[n] if type(ysc
+0000e960: 616c 6529 2069 6e20 286c 6973 742c 7475  ale) in (list,tu
+0000e970: 706c 6529 2065 6c73 6520 7973 6361 6c65  ple) else yscale
+0000e980: 0d0a 2020 2020 2020 2020 7973 6320 3d20  ..        ysc = 
+0000e990: 5953 6361 6c65 2879 7363 2c20 3129 2069  YScale(ysc, 1) i
+0000e9a0: 6620 7479 7065 2879 7363 2920 3d3d 2073  f type(ysc) == s
+0000e9b0: 7472 2065 6c73 6520 7973 630d 0a20 2020  tr else ysc..   
+0000e9c0: 2020 2020 2076 6965 7762 6f78 203d 2046       viewbox = F
+0000e9d0: 696e 5669 6577 426f 7828 6d61 7374 6572  inViewBox(master
+0000e9e0: 2c20 696e 6974 5f73 7465 7073 3d69 6e69  , init_steps=ini
+0000e9f0: 745f 7a6f 6f6d 5f70 6572 696f 6473 2c20  t_zoom_periods, 
+0000ea00: 7973 6361 6c65 3d79 7363 2c20 765f 7a6f  yscale=ysc, v_zo
+0000ea10: 6f6d 5f73 6361 6c65 3d31 2d79 5f70 6164  om_scale=1-y_pad
+0000ea20: 2c20 656e 6162 6c65 4d65 6e75 3d46 616c  , enableMenu=Fal
+0000ea30: 7365 290d 0a20 2020 2020 2020 2061 7820  se)..        ax 
+0000ea40: 3d20 7072 6576 5f61 7820 3d20 5f61 6464  = prev_ax = _add
+0000ea50: 5f74 696d 6573 7461 6d70 5f70 6c6f 7428  _timestamp_plot(
+0000ea60: 6d61 7374 6572 3d6d 6173 7465 722c 2070  master=master, p
+0000ea70: 7265 765f 6178 3d70 7265 765f 6178 2c20  rev_ax=prev_ax, 
+0000ea80: 7669 6577 626f 783d 7669 6577 626f 782c  viewbox=viewbox,
+0000ea90: 2069 6e64 6578 3d6e 2c20 7973 6361 6c65   index=n, yscale
+0000eaa0: 3d79 7363 290d 0a20 2020 2020 2020 2069  =ysc)..        i
+0000eab0: 6620 6178 733a 0d0a 2020 2020 2020 2020  f axs:..        
+0000eac0: 2020 2020 6178 2e73 6574 584c 696e 6b28      ax.setXLink(
+0000ead0: 6178 735b 305d 2e76 6229 0d0a 2020 2020  axs[0].vb)..    
+0000eae0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000eaf0: 2020 2020 2020 2076 6965 7762 6f78 2e73         viewbox.s
+0000eb00: 6574 466f 6375 7328 290d 0a20 2020 2020  etFocus()..     
+0000eb10: 2020 2061 7873 202b 3d20 5b61 785d 0d0a     axs += [ax]..
+0000eb20: 2020 2020 6966 206d 6173 7465 7220 6e6f      if master no
+0000eb30: 7420 696e 206d 6173 7465 725f 6461 7461  t in master_data
+0000eb40: 3a0d 0a20 2020 2020 2020 206d 6173 7465  :..        maste
+0000eb50: 725f 6461 7461 5b6d 6173 7465 725d 203d  r_data[master] =
+0000eb60: 207b 7d0d 0a20 2020 2069 6620 6973 696e   {}..    if isin
+0000eb70: 7374 616e 6365 286d 6173 7465 722c 2070  stance(master, p
+0000eb80: 672e 4772 6170 6869 6373 4c61 796f 7574  g.GraphicsLayout
+0000eb90: 5769 6467 6574 293a 0d0a 2020 2020 2020  Widget):..      
+0000eba0: 2020 7072 6f78 7920 3d20 7067 2e53 6967    proxy = pg.Sig
+0000ebb0: 6e61 6c50 726f 7879 286d 6173 7465 722e  nalProxy(master.
+0000ebc0: 7363 656e 6528 292e 7369 674d 6f75 7365  scene().sigMouse
+0000ebd0: 4d6f 7665 642c 2072 6174 654c 696d 6974  Moved, rateLimit
+0000ebe0: 3d31 3434 2c20 736c 6f74 3d70 6172 7469  =144, slot=parti
+0000ebf0: 616c 285f 6d6f 7573 655f 6d6f 7665 642c  al(_mouse_moved,
+0000ec00: 206d 6173 7465 722c 2061 7873 5b30 5d2e   master, axs[0].
+0000ec10: 7662 2929 0d0a 2020 2020 2020 2020 6d61  vb))..        ma
+0000ec20: 7374 6572 5f64 6174 615b 6d61 7374 6572  ster_data[master
+0000ec30: 5d5b 6178 735b 305d 2e76 625d 203d 2064  ][axs[0].vb] = d
+0000ec40: 6963 7428 7072 6f78 796d 6d3d 7072 6f78  ict(proxymm=prox
+0000ec50: 792c 206c 6173 745f 6d6f 7573 655f 6576  y, last_mouse_ev
+0000ec60: 733d 4e6f 6e65 2c20 6c61 7374 5f6d 6f75  s=None, last_mou
+0000ec70: 7365 5f79 3d30 290d 0a20 2020 2020 2020  se_y=0)..       
+0000ec80: 2069 6620 2764 6566 6175 6c74 2720 6e6f   if 'default' no
+0000ec90: 7420 696e 206d 6173 7465 725f 6461 7461  t in master_data
+0000eca0: 5b6d 6173 7465 725d 3a0d 0a20 2020 2020  [master]:..     
+0000ecb0: 2020 2020 2020 206d 6173 7465 725f 6461         master_da
+0000ecc0: 7461 5b6d 6173 7465 725d 5b27 6465 6661  ta[master]['defa
+0000ecd0: 756c 7427 5d20 3d20 6d61 7374 6572 5f64  ult'] = master_d
+0000ece0: 6174 615b 6d61 7374 6572 5d5b 6178 735b  ata[master][axs[
+0000ecf0: 305d 2e76 625d 0d0a 2020 2020 656c 7365  0].vb]..    else
+0000ed00: 3a0d 0a20 2020 2020 2020 2066 6f72 2061  :..        for a
+0000ed10: 7820 696e 2061 7873 3a0d 0a20 2020 2020  x in axs:..     
+0000ed20: 2020 2020 2020 2070 726f 7879 203d 2070         proxy = p
+0000ed30: 672e 5369 676e 616c 5072 6f78 7928 6178  g.SignalProxy(ax
+0000ed40: 2e61 785f 7769 6467 6574 2e73 6365 6e65  .ax_widget.scene
+0000ed50: 2829 2e73 6967 4d6f 7573 654d 6f76 6564  ().sigMouseMoved
+0000ed60: 2c20 7261 7465 4c69 6d69 743d 3134 342c  , rateLimit=144,
+0000ed70: 2073 6c6f 743d 7061 7274 6961 6c28 5f6d   slot=partial(_m
+0000ed80: 6f75 7365 5f6d 6f76 6564 2c20 6d61 7374  ouse_moved, mast
+0000ed90: 6572 2c20 6178 2e76 6229 290d 0a20 2020  er, ax.vb))..   
+0000eda0: 2020 2020 2020 2020 206d 6173 7465 725f           master_
+0000edb0: 6461 7461 5b6d 6173 7465 725d 5b61 782e  data[master][ax.
+0000edc0: 7662 5d20 3d20 6469 6374 2870 726f 7879  vb] = dict(proxy
+0000edd0: 6d6d 3d70 726f 7879 2c20 6c61 7374 5f6d  mm=proxy, last_m
+0000ede0: 6f75 7365 5f65 7673 3d4e 6f6e 652c 206c  ouse_evs=None, l
+0000edf0: 6173 745f 6d6f 7573 655f 793d 3029 0d0a  ast_mouse_y=0)..
+0000ee00: 2020 2020 6c61 7374 5f61 7820 3d20 6178      last_ax = ax
+0000ee10: 735b 305d 0d0a 2020 2020 7265 7475 726e  s[0]..    return
+0000ee20: 2061 7873 5b30 5d20 6966 206c 656e 2861   axs[0] if len(a
+0000ee30: 7873 2920 3d3d 2031 2065 6c73 6520 6178  xs) == 1 else ax
+0000ee40: 730d 0a0d 0a0d 0a64 6566 2063 6c6f 7365  s......def close
+0000ee50: 2829 3a0d 0a20 2020 2066 6f72 2077 696e  ():..    for win
+0000ee60: 2069 6e20 7769 6e64 6f77 733a 0d0a 2020   in windows:..  
+0000ee70: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0000ee80: 2020 2020 2020 2020 7769 6e2e 636c 6f73          win.clos
+0000ee90: 6528 290d 0a20 2020 2020 2020 2065 7863  e()..        exc
+0000eea0: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+0000eeb0: 2065 3a0d 0a20 2020 2020 2020 2020 2020   e:..           
+0000eec0: 2070 7269 6e74 2827 5769 6e64 6f77 2063   print('Window c
+0000eed0: 6c6f 7369 6e67 2065 7272 6f72 3a27 2c20  losing error:', 
+0000eee0: 7479 7065 2865 292c 2065 290d 0a20 2020  type(e), e)..   
+0000eef0: 2067 6c6f 6261 6c20 6c61 7374 5f61 780d   global last_ax.
+0000ef00: 0a20 2020 2077 696e 646f 7773 2e63 6c65  .    windows.cle
+0000ef10: 6172 2829 0d0a 2020 2020 6f76 6572 6c61  ar()..    overla
+0000ef20: 795f 6178 732e 636c 6561 7228 290d 0a20  y_axs.clear().. 
+0000ef30: 2020 205f 636c 6561 725f 7469 6d65 7273     _clear_timers
+0000ef40: 2829 0d0a 2020 2020 736f 756e 6473 2e63  ()..    sounds.c
+0000ef50: 6c65 6172 2829 0d0a 2020 2020 6d61 7374  lear()..    mast
+0000ef60: 6572 5f64 6174 612e 636c 6561 7228 290d  er_data.clear().
+0000ef70: 0a20 2020 206c 6173 745f 6178 203d 204e  .    last_ax = N
+0000ef80: 6f6e 650d 0a0d 0a0d 0a64 6566 2070 7269  one......def pri
+0000ef90: 6365 5f63 6f6c 6f72 6669 6c74 6572 2869  ce_colorfilter(i
+0000efa0: 7465 6d2c 2064 6174 6173 7263 2c20 6466  tem, datasrc, df
+0000efb0: 293a 0d0a 2020 2020 6f70 656e 636f 6c20  ):..    opencol 
+0000efc0: 3d20 6466 2e63 6f6c 756d 6e73 5b31 5d0d  = df.columns[1].
+0000efd0: 0a20 2020 2063 6c6f 7365 636f 6c20 3d20  .    closecol = 
+0000efe0: 6466 2e63 6f6c 756d 6e73 5b32 5d0d 0a20  df.columns[2].. 
+0000eff0: 2020 2069 735f 7570 203d 2064 665b 6f70     is_up = df[op
+0000f000: 656e 636f 6c5d 203c 3d20 6466 5b63 6c6f  encol] <= df[clo
+0000f010: 7365 636f 6c5d 2023 206f 7065 6e20 6c6f  secol] # open lo
+0000f020: 7765 7220 7468 616e 2063 6c6f 7365 203d  wer than close =
+0000f030: 2067 6f65 7320 7570 0d0a 2020 2020 7969   goes up..    yi
+0000f040: 656c 6420 6974 656d 2e72 6f77 636f 6c6f  eld item.rowcolo
+0000f050: 7273 2827 6275 6c6c 2729 202b 205b 6466  rs('bull') + [df
+0000f060: 2e6c 6f63 5b69 735f 7570 2c20 3a5d 5d0d  .loc[is_up, :]].
+0000f070: 0a20 2020 2079 6965 6c64 2069 7465 6d2e  .    yield item.
+0000f080: 726f 7763 6f6c 6f72 7328 2762 6561 7227  rowcolors('bear'
+0000f090: 2920 2b20 5b64 662e 6c6f 635b 7e69 735f  ) + [df.loc[~is_
+0000f0a0: 7570 2c20 3a5d 5d0d 0a0d 0a0d 0a64 6566  up, :]]......def
+0000f0b0: 2076 6f6c 756d 655f 636f 6c6f 7266 696c   volume_colorfil
+0000f0c0: 7465 7228 6974 656d 2c20 6461 7461 7372  ter(item, datasr
+0000f0d0: 632c 2064 6629 3a0d 0a20 2020 206f 7065  c, df):..    ope
+0000f0e0: 6e63 6f6c 203d 2064 662e 636f 6c75 6d6e  ncol = df.column
+0000f0f0: 735b 335d 0d0a 2020 2020 636c 6f73 6563  s[3]..    closec
+0000f100: 6f6c 203d 2064 662e 636f 6c75 6d6e 735b  ol = df.columns[
+0000f110: 345d 0d0a 2020 2020 6973 5f75 7020 3d20  4]..    is_up = 
+0000f120: 6466 5b6f 7065 6e63 6f6c 5d20 3c3d 2064  df[opencol] <= d
+0000f130: 665b 636c 6f73 6563 6f6c 5d20 2320 6f70  f[closecol] # op
+0000f140: 656e 206c 6f77 6572 2074 6861 6e20 636c  en lower than cl
+0000f150: 6f73 6520 3d20 676f 6573 2075 700d 0a20  ose = goes up.. 
+0000f160: 2020 2079 6965 6c64 2069 7465 6d2e 726f     yield item.ro
+0000f170: 7763 6f6c 6f72 7328 2762 756c 6c27 2920  wcolors('bull') 
+0000f180: 2b20 5b64 662e 6c6f 635b 6973 5f75 702c  + [df.loc[is_up,
+0000f190: 203a 5d5d 0d0a 2020 2020 7969 656c 6420   :]]..    yield 
+0000f1a0: 6974 656d 2e72 6f77 636f 6c6f 7273 2827  item.rowcolors('
+0000f1b0: 6265 6172 2729 202b 205b 6466 2e6c 6f63  bear') + [df.loc
+0000f1c0: 5b7e 6973 5f75 702c 203a 5d5d 0d0a 0d0a  [~is_up, :]]....
+0000f1d0: 0d0a 6465 6620 7374 7265 6e67 7468 5f63  ..def strength_c
+0000f1e0: 6f6c 6f72 6669 6c74 6572 2869 7465 6d2c  olorfilter(item,
+0000f1f0: 2064 6174 6173 7263 2c20 6466 293a 0d0a   datasrc, df):..
+0000f200: 2020 2020 6f70 656e 636f 6c20 3d20 6466      opencol = df
+0000f210: 2e63 6f6c 756d 6e73 5b31 5d0d 0a20 2020  .columns[1]..   
+0000f220: 2063 6c6f 7365 636f 6c20 3d20 6466 2e63   closecol = df.c
+0000f230: 6f6c 756d 6e73 5b32 5d0d 0a20 2020 2073  olumns[2]..    s
+0000f240: 7461 7274 636f 6c20 3d20 6466 2e63 6f6c  tartcol = df.col
+0000f250: 756d 6e73 5b33 5d0d 0a20 2020 2065 6e64  umns[3]..    end
+0000f260: 636f 6c20 3d20 6466 2e63 6f6c 756d 6e73  col = df.columns
+0000f270: 5b34 5d0d 0a20 2020 2069 735f 7570 203d  [4]..    is_up =
+0000f280: 2064 665b 6f70 656e 636f 6c5d 203c 3d20   df[opencol] <= 
+0000f290: 6466 5b63 6c6f 7365 636f 6c5d 2023 206f  df[closecol] # o
+0000f2a0: 7065 6e20 6c6f 7765 7220 7468 616e 2063  pen lower than c
+0000f2b0: 6c6f 7365 203d 2067 6f65 7320 7570 0d0a  lose = goes up..
+0000f2c0: 2020 2020 6973 5f73 7472 6f6e 6720 3d20      is_strong = 
+0000f2d0: 6466 5b73 7461 7274 636f 6c5d 203c 3d20  df[startcol] <= 
+0000f2e0: 6466 5b65 6e64 636f 6c5d 0d0a 2020 2020  df[endcol]..    
+0000f2f0: 7969 656c 6420 6974 656d 2e72 6f77 636f  yield item.rowco
+0000f300: 6c6f 7273 2827 6275 6c6c 2729 202b 205b  lors('bull') + [
+0000f310: 6466 2e6c 6f63 5b69 735f 7570 2669 735f  df.loc[is_up&is_
+0000f320: 7374 726f 6e67 2c20 3a5d 5d0d 0a20 2020  strong, :]]..   
+0000f330: 2079 6965 6c64 2069 7465 6d2e 726f 7763   yield item.rowc
+0000f340: 6f6c 6f72 7328 2777 6561 6b5f 6275 6c6c  olors('weak_bull
+0000f350: 2729 202b 205b 6466 2e6c 6f63 5b69 735f  ') + [df.loc[is_
+0000f360: 7570 2628 7e69 735f 7374 726f 6e67 292c  up&(~is_strong),
+0000f370: 203a 5d5d 0d0a 2020 2020 7969 656c 6420   :]]..    yield 
+0000f380: 6974 656d 2e72 6f77 636f 6c6f 7273 2827  item.rowcolors('
+0000f390: 7765 616b 5f62 6561 7227 2920 2b20 5b64  weak_bear') + [d
+0000f3a0: 662e 6c6f 635b 287e 6973 5f75 7029 2669  f.loc[(~is_up)&i
+0000f3b0: 735f 7374 726f 6e67 2c20 3a5d 5d0d 0a20  s_strong, :]].. 
+0000f3c0: 2020 2079 6965 6c64 2069 7465 6d2e 726f     yield item.ro
+0000f3d0: 7763 6f6c 6f72 7328 2762 6561 7227 2920  wcolors('bear') 
+0000f3e0: 2b20 5b64 662e 6c6f 635b 287e 6973 5f75  + [df.loc[(~is_u
+0000f3f0: 7029 2628 7e69 735f 7374 726f 6e67 292c  p)&(~is_strong),
+0000f400: 203a 5d5d 0d0a 0d0a 0d0a 6465 6620 766f   :]]......def vo
+0000f410: 6c75 6d65 5f63 6f6c 6f72 6669 6c74 6572  lume_colorfilter
+0000f420: 5f73 6563 7469 6f6e 2873 6563 7469 6f6e  _section(section
+0000f430: 733d 5b5d 293a 0d0a 2020 2020 2727 2754  s=[]):..    '''T
+0000f440: 6865 2073 6563 7469 6f6e 7320 6172 6775  he sections argu
+0000f450: 6d65 6e74 2069 7320 6120 2873 7461 7274  ment is a (start
+0000f460: 696e 675f 696e 6465 782c 2063 6f6c 6f72  ing_index, color
+0000f470: 5f6e 616d 6529 2061 7272 6179 2e27 2727  _name) array.'''
+0000f480: 0d0a 2020 2020 6465 6620 5f63 6f6c 6f72  ..    def _color
+0000f490: 6669 6c74 6572 2873 6563 7469 6f6e 732c  filter(sections,
+0000f4a0: 2069 7465 6d2c 2064 6174 6173 7263 2c20   item, datasrc, 
+0000f4b0: 6466 293a 0d0a 2020 2020 2020 2020 6966  df):..        if
+0000f4c0: 206e 6f74 2073 6563 7469 6f6e 733a 0d0a   not sections:..
+0000f4d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000f4e0: 726e 2076 6f6c 756d 655f 636f 6c6f 7266  rn volume_colorf
+0000f4f0: 696c 7465 7228 6974 656d 2c20 6461 7461  ilter(item, data
+0000f500: 7372 632c 2064 6629 0d0a 2020 2020 2020  src, df)..      
+0000f510: 2020 666f 7220 2869 302c 636f 6c6e 616d    for (i0,colnam
+0000f520: 6529 2c28 6931 2c5f 2920 696e 207a 6970  e),(i1,_) in zip
+0000f530: 2873 6563 7469 6f6e 732c 2073 6563 7469  (sections, secti
+0000f540: 6f6e 735b 313a 5d2b 5b28 4e6f 6e65 2c27  ons[1:]+[(None,'
+0000f550: 6e65 7574 7261 6c27 295d 293a 0d0a 2020  neutral')]):..  
+0000f560: 2020 2020 2020 2020 2020 726f 7773 203d            rows =
+0000f570: 2064 662e 696c 6f63 5b69 303a 6931 2c20   df.iloc[i0:i1, 
+0000f580: 3a5d 0d0a 2020 2020 2020 2020 2020 2020  :]..            
+0000f590: 7969 656c 6420 6974 656d 2e72 6f77 636f  yield item.rowco
+0000f5a0: 6c6f 7273 2863 6f6c 6e61 6d65 2920 2b20  lors(colname) + 
+0000f5b0: 5b72 6f77 735d 0d0a 2020 2020 7265 7475  [rows]..    retu
+0000f5c0: 726e 2070 6172 7469 616c 285f 636f 6c6f  rn partial(_colo
+0000f5d0: 7266 696c 7465 722c 2073 6563 7469 6f6e  rfilter, section
+0000f5e0: 7329 0d0a 0d0a 0d0a 6465 6620 686f 7269  s)......def hori
+0000f5f0: 7a76 6f6c 5f63 6f6c 6f72 6669 6c74 6572  zvol_colorfilter
+0000f600: 2873 6563 7469 6f6e 733d 5b5d 293a 0d0a  (sections=[]):..
+0000f610: 2020 2020 2727 2754 6865 2073 6563 7469      '''The secti
+0000f620: 6f6e 7320 6172 6775 6d65 6e74 2069 7320  ons argument is 
+0000f630: 6120 2873 7461 7274 696e 675f 696e 6465  a (starting_inde
+0000f640: 782c 2063 6f6c 6f72 5f6e 616d 6529 2061  x, color_name) a
+0000f650: 7272 6179 2e27 2727 0d0a 2020 2020 6465  rray.'''..    de
+0000f660: 6620 5f63 6f6c 6f72 6669 6c74 6572 2873  f _colorfilter(s
+0000f670: 6563 7469 6f6e 732c 2069 7465 6d2c 2064  ections, item, d
+0000f680: 6174 6173 7263 2c20 6461 7461 293a 0d0a  atasrc, data):..
+0000f690: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0000f6a0: 6563 7469 6f6e 733a 0d0a 2020 2020 2020  ections:..      
+0000f6b0: 2020 2020 2020 7969 656c 6420 6974 656d        yield item
+0000f6c0: 2e72 6f77 636f 6c6f 7273 2827 6e65 7574  .rowcolors('neut
+0000f6d0: 7261 6c27 2920 2b20 5b64 6174 615d 0d0a  ral') + [data]..
+0000f6e0: 2020 2020 2020 2020 666f 7220 2869 302c          for (i0,
+0000f6f0: 636f 6c6e 616d 6529 2c28 6931 2c5f 2920  colname),(i1,_) 
+0000f700: 696e 207a 6970 2873 6563 7469 6f6e 732c  in zip(sections,
+0000f710: 2073 6563 7469 6f6e 735b 313a 5d2b 5b28   sections[1:]+[(
+0000f720: 4e6f 6e65 2c27 6e65 7574 7261 6c27 295d  None,'neutral')]
+0000f730: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000f740: 726f 7773 203d 2064 6174 615b 3a2c 2069  rows = data[:, i
+0000f750: 303a 6931 5d0d 0a20 2020 2020 2020 2020  0:i1]..         
+0000f760: 2020 2079 6965 6c64 2069 7465 6d2e 726f     yield item.ro
+0000f770: 7763 6f6c 6f72 7328 636f 6c6e 616d 6529  wcolors(colname)
+0000f780: 202b 205b 726f 7773 5d0d 0a20 2020 2072   + [rows]..    r
+0000f790: 6574 7572 6e20 7061 7274 6961 6c28 5f63  eturn partial(_c
+0000f7a0: 6f6c 6f72 6669 6c74 6572 2c20 7365 6374  olorfilter, sect
+0000f7b0: 696f 6e73 290d 0a0d 0a0d 0a64 6566 2063  ions)......def c
+0000f7c0: 616e 646c 6573 7469 636b 5f6f 6368 6c28  andlestick_ochl(
+0000f7d0: 6461 7461 7372 632c 2064 7261 775f 626f  datasrc, draw_bo
+0000f7e0: 6479 3d54 7275 652c 2064 7261 775f 7368  dy=True, draw_sh
+0000f7f0: 6164 6f77 3d54 7275 652c 2063 616e 646c  adow=True, candl
+0000f800: 655f 7769 6474 683d 302e 362c 2061 783d  e_width=0.6, ax=
+0000f810: 4e6f 6e65 2c20 636f 6c6f 7266 756e 633d  None, colorfunc=
+0000f820: 7072 6963 655f 636f 6c6f 7266 696c 7465  price_colorfilte
+0000f830: 7229 3a0d 0a20 2020 2061 7820 3d20 5f63  r):..    ax = _c
+0000f840: 7265 6174 655f 706c 6f74 2861 783d 6178  reate_plot(ax=ax
+0000f850: 2c20 6d61 7869 6d69 7a65 3d46 616c 7365  , maximize=False
+0000f860: 290d 0a20 2020 2064 6174 6173 7263 203d  )..    datasrc =
+0000f870: 205f 6372 6561 7465 5f64 6174 6173 7263   _create_datasrc
+0000f880: 2861 782c 2064 6174 6173 7263 2c20 6e63  (ax, datasrc, nc
+0000f890: 6f6c 733d 3529 0d0a 2020 2020 6461 7461  ols=5)..    data
+0000f8a0: 7372 632e 7363 616c 655f 636f 6c73 203d  src.scale_cols =
+0000f8b0: 205b 332c 345d 2023 206f 6e6c 7920 6869   [3,4] # only hi
+0000f8c0: 2b6c 6f20 7363 616c 6573 0d0a 2020 2020  +lo scales..    
+0000f8d0: 5f73 6574 5f64 6174 6173 7263 2861 782c  _set_datasrc(ax,
+0000f8e0: 2064 6174 6173 7263 290d 0a20 2020 2069   datasrc)..    i
+0000f8f0: 7465 6d20 3d20 4361 6e64 6c65 7374 6963  tem = Candlestic
+0000f900: 6b49 7465 6d28 6178 3d61 782c 2064 6174  kItem(ax=ax, dat
+0000f910: 6173 7263 3d64 6174 6173 7263 2c20 6472  asrc=datasrc, dr
+0000f920: 6177 5f62 6f64 793d 6472 6177 5f62 6f64  aw_body=draw_bod
+0000f930: 792c 2064 7261 775f 7368 6164 6f77 3d64  y, draw_shadow=d
+0000f940: 7261 775f 7368 6164 6f77 2c20 6361 6e64  raw_shadow, cand
+0000f950: 6c65 5f77 6964 7468 3d63 616e 646c 655f  le_width=candle_
+0000f960: 7769 6474 682c 2063 6f6c 6f72 6675 6e63  width, colorfunc
+0000f970: 3d63 6f6c 6f72 6675 6e63 2c20 7265 7361  =colorfunc, resa
+0000f980: 6d70 3d27 6869 6c6f 2729 0d0a 2020 2020  mp='hilo')..    
+0000f990: 5f75 7064 6174 655f 7369 676e 6966 6963  _update_signific
+0000f9a0: 616e 7473 2861 782c 2064 6174 6173 7263  ants(ax, datasrc
+0000f9b0: 2c20 666f 7263 653d 5472 7565 290d 0a20  , force=True).. 
+0000f9c0: 2020 2069 7465 6d2e 7570 6461 7465 5f64     item.update_d
+0000f9d0: 6174 6120 3d20 7061 7274 6961 6c28 5f75  ata = partial(_u
+0000f9e0: 7064 6174 655f 6461 7461 2c20 4e6f 6e65  pdate_data, None
+0000f9f0: 2c20 4e6f 6e65 2c20 6974 656d 290d 0a20  , None, item).. 
+0000fa00: 2020 2069 7465 6d2e 7570 6461 7465 5f67     item.update_g
+0000fa10: 6678 203d 2070 6172 7469 616c 285f 7570  fx = partial(_up
+0000fa20: 6461 7465 5f67 6678 2c20 6974 656d 290d  date_gfx, item).
+0000fa30: 0a20 2020 2061 782e 6164 6449 7465 6d28  .    ax.addItem(
+0000fa40: 6974 656d 290d 0a20 2020 2072 6574 7572  item)..    retur
+0000fa50: 6e20 6974 656d 0d0a 0d0a 0d0a 6465 6620  n item......def 
+0000fa60: 7265 6e6b 6f28 782c 2079 3d4e 6f6e 652c  renko(x, y=None,
+0000fa70: 2062 696e 733d 4e6f 6e65 2c20 7374 6570   bins=None, step
+0000fa80: 3d4e 6f6e 652c 2061 783d 4e6f 6e65 2c20  =None, ax=None, 
+0000fa90: 636f 6c6f 7266 756e 633d 7072 6963 655f  colorfunc=price_
+0000faa0: 636f 6c6f 7266 696c 7465 7229 3a0d 0a20  colorfilter):.. 
+0000fab0: 2020 2061 7820 3d20 5f63 7265 6174 655f     ax = _create_
+0000fac0: 706c 6f74 2861 783d 6178 2c20 6d61 7869  plot(ax=ax, maxi
+0000fad0: 6d69 7a65 3d46 616c 7365 290d 0a20 2020  mize=False)..   
+0000fae0: 2064 6174 6173 7263 203d 205f 6372 6561   datasrc = _crea
+0000faf0: 7465 5f64 6174 6173 7263 2861 782c 2078  te_datasrc(ax, x
+0000fb00: 2c20 792c 206e 636f 6c73 3d33 290d 0a20  , y, ncols=3).. 
+0000fb10: 2020 206f 7269 6764 6620 3d20 6461 7461     origdf = data
+0000fb20: 7372 632e 6466 0d0a 2020 2020 6164 6a20  src.df..    adj 
+0000fb30: 3d20 5f61 646a 7573 745f 7265 6e6b 6f5f  = _adjust_renko_
+0000fb40: 6c6f 675f 6461 7461 7372 6320 6966 2061  log_datasrc if a
+0000fb50: 782e 7662 2e79 7363 616c 652e 7363 616c  x.vb.yscale.scal
+0000fb60: 6574 7970 6520 3d3d 2027 6c6f 6727 2065  etype == 'log' e
+0000fb70: 6c73 6520 5f61 646a 7573 745f 7265 6e6b  lse _adjust_renk
+0000fb80: 6f5f 6461 7461 7372 630d 0a20 2020 2073  o_datasrc..    s
+0000fb90: 7465 705f 6164 6a75 7374 5f72 656e 6b6f  tep_adjust_renko
+0000fba0: 5f64 6174 6173 7263 203d 2070 6172 7469  _datasrc = parti
+0000fbb0: 616c 2861 646a 2c20 6269 6e73 2c20 7374  al(adj, bins, st
+0000fbc0: 6570 290d 0a20 2020 2073 7465 705f 6164  ep)..    step_ad
+0000fbd0: 6a75 7374 5f72 656e 6b6f 5f64 6174 6173  just_renko_datas
+0000fbe0: 7263 2864 6174 6173 7263 290d 0a20 2020  rc(datasrc)..   
+0000fbf0: 2061 782e 6465 636f 7570 6c65 2829 0d0a   ax.decouple()..
+0000fc00: 2020 2020 6974 656d 203d 2063 616e 646c      item = candl
+0000fc10: 6573 7469 636b 5f6f 6368 6c28 6461 7461  estick_ochl(data
+0000fc20: 7372 632c 2064 7261 775f 7368 6164 6f77  src, draw_shadow
+0000fc30: 3d46 616c 7365 2c20 6361 6e64 6c65 5f77  =False, candle_w
+0000fc40: 6964 7468 3d31 2c20 6178 3d61 782c 2063  idth=1, ax=ax, c
+0000fc50: 6f6c 6f72 6675 6e63 3d63 6f6c 6f72 6675  olorfunc=colorfu
+0000fc60: 6e63 290d 0a20 2020 2069 7465 6d2e 636f  nc)..    item.co
+0000fc70: 6c6f 7273 5b27 6275 6c6c 5f62 6f64 7927  lors['bull_body'
+0000fc80: 5d20 3d20 6974 656d 2e63 6f6c 6f72 735b  ] = item.colors[
+0000fc90: 2762 756c 6c5f 6672 616d 6527 5d0d 0a20  'bull_frame'].. 
+0000fca0: 2020 2069 7465 6d2e 7570 6461 7465 5f64     item.update_d
+0000fcb0: 6174 6120 3d20 7061 7274 6961 6c28 5f75  ata = partial(_u
+0000fcc0: 7064 6174 655f 6461 7461 2c20 4e6f 6e65  pdate_data, None
+0000fcd0: 2c20 7374 6570 5f61 646a 7573 745f 7265  , step_adjust_re
+0000fce0: 6e6b 6f5f 6461 7461 7372 632c 2069 7465  nko_datasrc, ite
+0000fcf0: 6d29 0d0a 2020 2020 6974 656d 2e75 7064  m)..    item.upd
+0000fd00: 6174 655f 6766 7820 3d20 7061 7274 6961  ate_gfx = partia
+0000fd10: 6c28 5f75 7064 6174 655f 6766 782c 2069  l(_update_gfx, i
+0000fd20: 7465 6d29 0d0a 2020 2020 676c 6f62 616c  tem)..    global
+0000fd30: 2065 706f 6368 5f70 6572 696f 640d 0a20   epoch_period.. 
+0000fd40: 2020 2065 706f 6368 5f70 6572 696f 6420     epoch_period 
+0000fd50: 3d20 286f 7269 6764 662e 696c 6f63 5b31  = (origdf.iloc[1
+0000fd60: 2c30 5d20 2d20 6f72 6967 6466 2e69 6c6f  ,0] - origdf.ilo
+0000fd70: 635b 302c 305d 2920 2f2f 2069 6e74 2831  c[0,0]) // int(1
+0000fd80: 6539 290d 0a20 2020 2072 6574 7572 6e20  e9)..    return 
+0000fd90: 6974 656d 0d0a 0d0a 0d0a 6465 6620 766f  item......def vo
+0000fda0: 6c75 6d65 5f6f 6376 2864 6174 6173 7263  lume_ocv(datasrc
+0000fdb0: 2c20 6361 6e64 6c65 5f77 6964 7468 3d30  , candle_width=0
+0000fdc0: 2e38 2c20 6178 3d4e 6f6e 652c 2063 6f6c  .8, ax=None, col
+0000fdd0: 6f72 6675 6e63 3d76 6f6c 756d 655f 636f  orfunc=volume_co
+0000fde0: 6c6f 7266 696c 7465 7229 3a0d 0a20 2020  lorfilter):..   
+0000fdf0: 2061 7820 3d20 5f63 7265 6174 655f 706c   ax = _create_pl
+0000fe00: 6f74 2861 783d 6178 2c20 6d61 7869 6d69  ot(ax=ax, maximi
+0000fe10: 7a65 3d46 616c 7365 290d 0a20 2020 2064  ze=False)..    d
+0000fe20: 6174 6173 7263 203d 205f 6372 6561 7465  atasrc = _create
+0000fe30: 5f64 6174 6173 7263 2861 782c 2064 6174  _datasrc(ax, dat
+0000fe40: 6173 7263 2c20 6e63 6f6c 733d 3429 0d0a  asrc, ncols=4)..
+0000fe50: 2020 2020 5f61 646a 7573 745f 766f 6c75      _adjust_volu
+0000fe60: 6d65 5f64 6174 6173 7263 2864 6174 6173  me_datasrc(datas
+0000fe70: 7263 290d 0a20 2020 205f 7365 745f 6461  rc)..    _set_da
+0000fe80: 7461 7372 6328 6178 2c20 6461 7461 7372  tasrc(ax, datasr
+0000fe90: 6329 0d0a 2020 2020 6974 656d 203d 2043  c)..    item = C
+0000fea0: 616e 646c 6573 7469 636b 4974 656d 2861  andlestickItem(a
+0000feb0: 783d 6178 2c20 6461 7461 7372 633d 6461  x=ax, datasrc=da
+0000fec0: 7461 7372 632c 2064 7261 775f 626f 6479  tasrc, draw_body
+0000fed0: 3d54 7275 652c 2064 7261 775f 7368 6164  =True, draw_shad
+0000fee0: 6f77 3d46 616c 7365 2c20 6361 6e64 6c65  ow=False, candle
+0000fef0: 5f77 6964 7468 3d63 616e 646c 655f 7769  _width=candle_wi
+0000ff00: 6474 682c 2063 6f6c 6f72 6675 6e63 3d63  dth, colorfunc=c
+0000ff10: 6f6c 6f72 6675 6e63 2c20 7265 7361 6d70  olorfunc, resamp
+0000ff20: 3d27 7375 6d27 290d 0a20 2020 205f 7570  ='sum')..    _up
+0000ff30: 6461 7465 5f73 6967 6e69 6669 6361 6e74  date_significant
+0000ff40: 7328 6178 2c20 6461 7461 7372 632c 2066  s(ax, datasrc, f
+0000ff50: 6f72 6365 3d54 7275 6529 0d0a 2020 2020  orce=True)..    
+0000ff60: 6974 656d 2e63 6f6c 6f72 735b 2762 756c  item.colors['bul
+0000ff70: 6c5f 626f 6479 275d 203d 2069 7465 6d2e  l_body'] = item.
+0000ff80: 636f 6c6f 7273 5b27 6275 6c6c 5f66 7261  colors['bull_fra
+0000ff90: 6d65 275d 0d0a 2020 2020 6966 2063 6f6c  me']..    if col
+0000ffa0: 6f72 6675 6e63 203d 3d20 766f 6c75 6d65  orfunc == volume
+0000ffb0: 5f63 6f6c 6f72 6669 6c74 6572 3a20 2320  _colorfilter: # 
+0000ffc0: 6173 7375 6d65 206e 6f72 6d61 6c20 766f  assume normal vo
+0000ffd0: 6c75 6d65 2070 6c6f 740d 0a20 2020 2020  lume plot..     
+0000ffe0: 2020 2069 7465 6d2e 636f 6c6f 7273 5b27     item.colors['
+0000fff0: 6275 6c6c 5f66 7261 6d65 275d 203d 2076  bull_frame'] = v
+00010000: 6f6c 756d 655f 6275 6c6c 5f63 6f6c 6f72  olume_bull_color
+00010010: 0d0a 2020 2020 2020 2020 6974 656d 2e63  ..        item.c
+00010020: 6f6c 6f72 735b 2762 756c 6c5f 626f 6479  olors['bull_body
+00010030: 275d 2020 3d20 766f 6c75 6d65 5f62 756c  ']  = volume_bul
+00010040: 6c5f 626f 6479 5f63 6f6c 6f72 0d0a 2020  l_body_color..  
+00010050: 2020 2020 2020 6974 656d 2e63 6f6c 6f72        item.color
+00010060: 735b 2762 6561 725f 6672 616d 6527 5d20  s['bear_frame'] 
+00010070: 3d20 766f 6c75 6d65 5f62 6561 725f 636f  = volume_bear_co
+00010080: 6c6f 720d 0a20 2020 2020 2020 2069 7465  lor..        ite
+00010090: 6d2e 636f 6c6f 7273 5b27 6265 6172 5f62  m.colors['bear_b
+000100a0: 6f64 7927 5d20 203d 2076 6f6c 756d 655f  ody']  = volume_
+000100b0: 6265 6172 5f63 6f6c 6f72 0d0a 2020 2020  bear_color..    
+000100c0: 2020 2020 6178 2e76 622e 765f 7a6f 6f6d      ax.vb.v_zoom
+000100d0: 5f62 6173 656c 696e 6520 3d20 300d 0a20  _baseline = 0.. 
+000100e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000100f0: 2020 6974 656d 2e63 6f6c 6f72 735b 2777    item.colors['w
+00010100: 6561 6b5f 6275 6c6c 5f66 7261 6d65 275d  eak_bull_frame']
+00010110: 203d 2062 7269 6768 7465 6e28 766f 6c75   = brighten(volu
+00010120: 6d65 5f62 756c 6c5f 636f 6c6f 722c 2031  me_bull_color, 1
+00010130: 2e32 290d 0a20 2020 2020 2020 2069 7465  .2)..        ite
+00010140: 6d2e 636f 6c6f 7273 5b27 7765 616b 5f62  m.colors['weak_b
+00010150: 756c 6c5f 626f 6479 275d 2020 3d20 6272  ull_body']  = br
+00010160: 6967 6874 656e 2876 6f6c 756d 655f 6275  ighten(volume_bu
+00010170: 6c6c 5f63 6f6c 6f72 2c20 312e 3229 0d0a  ll_color, 1.2)..
+00010180: 2020 2020 6974 656d 2e75 7064 6174 655f      item.update_
+00010190: 6461 7461 203d 2070 6172 7469 616c 285f  data = partial(_
+000101a0: 7570 6461 7465 5f64 6174 612c 204e 6f6e  update_data, Non
+000101b0: 652c 205f 6164 6a75 7374 5f76 6f6c 756d  e, _adjust_volum
+000101c0: 655f 6461 7461 7372 632c 2069 7465 6d29  e_datasrc, item)
+000101d0: 0d0a 2020 2020 6974 656d 2e75 7064 6174  ..    item.updat
+000101e0: 655f 6766 7820 3d20 7061 7274 6961 6c28  e_gfx = partial(
+000101f0: 5f75 7064 6174 655f 6766 782c 2069 7465  _update_gfx, ite
+00010200: 6d29 0d0a 2020 2020 6178 2e61 6464 4974  m)..    ax.addIt
+00010210: 656d 2869 7465 6d29 0d0a 2020 2020 6974  em(item)..    it
+00010220: 656d 2e73 6574 5a56 616c 7565 282d 3230  em.setZValue(-20
+00010230: 290d 0a20 2020 2072 6574 7572 6e20 6974  )..    return it
+00010240: 656d 0d0a 0d0a 0d0a 6465 6620 686f 7269  em......def hori
+00010250: 7a5f 7469 6d65 5f76 6f6c 756d 6528 6461  z_time_volume(da
+00010260: 7461 7372 632c 2061 783d 4e6f 6e65 2c20  tasrc, ax=None, 
+00010270: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00010280: 2727 2744 7261 7773 206d 756c 7469 706c  '''Draws multipl
+00010290: 6520 6669 7865 6420 686f 7269 7a6f 6e74  e fixed horizont
+000102a0: 616c 2076 6f6c 756d 6573 2e20 5468 6520  al volumes. The 
+000102b0: 696e 7075 7420 666f 726d 6174 2069 733a  input format is:
+000102c0: 0d0a 2020 2020 2020 205b 5b74 696d 6530  ..       [[time0
+000102d0: 2c20 5b28 7072 6963 6530 2c76 6f6c 756d  , [(price0,volum
+000102e0: 6530 292c 2870 7269 6365 312c 766f 6c75  e0),(price1,volu
+000102f0: 6d65 3129 2c2e 2e2e 5d5d 2c20 2e2e 2e5d  me1),...]], ...]
+00010300: 0d0a 0d0a 2020 2020 2020 2054 6869 7320  ....       This 
+00010310: 6368 6172 7420 6e65 6564 7320 746f 2062  chart needs to b
+00010320: 6520 706c 6f74 206c 6173 742c 2073 6f20  e plot last, so 
+00010330: 6974 206b 6e6f 7773 2069 6620 6974 2063  it knows if it c
+00010340: 6f6e 7472 6f6c 730d 0a20 2020 2020 2020  ontrols..       
+00010350: 7768 6174 2074 696d 6520 7065 7269 6f64  what time period
+00010360: 7320 6172 6520 7368 6f77 6e2c 206f 7220  s are shown, or 
+00010370: 6966 2069 7473 2075 7369 6e67 2074 696d  if its using tim
+00010380: 6520 616c 7265 6164 7920 696e 0d0a 2020  e already in..  
+00010390: 2020 2020 2070 6c61 6365 2062 7920 616e       place by an
+000103a0: 6f74 6865 7220 706c 6f74 2e27 2727 0d0a  other plot.'''..
+000103b0: 2020 2020 2320 7570 6461 7465 2068 616e      # update han
+000103c0: 646c 696e 6720 6465 6661 756c 7420 6966  dling default if
+000103d0: 206e 6563 6573 7361 7279 0d0a 2020 2020   necessary..    
+000103e0: 676c 6f62 616c 206d 6178 5f7a 6f6f 6d5f  global max_zoom_
+000103f0: 706f 696e 7473 2c20 7269 6768 745f 6d61  points, right_ma
+00010400: 7267 696e 5f63 616e 646c 6573 0d0a 2020  rgin_candles..  
+00010410: 2020 6966 206d 6178 5f7a 6f6f 6d5f 706f    if max_zoom_po
+00010420: 696e 7473 203e 2031 353a 0d0a 2020 2020  ints > 15:..    
+00010430: 2020 2020 6d61 785f 7a6f 6f6d 5f70 6f69      max_zoom_poi
+00010440: 6e74 7320 3d20 340d 0a20 2020 2069 6620  nts = 4..    if 
+00010450: 7269 6768 745f 6d61 7267 696e 5f63 616e  right_margin_can
+00010460: 646c 6573 203e 2033 3a0d 0a20 2020 2020  dles > 3:..     
+00010470: 2020 2072 6967 6874 5f6d 6172 6769 6e5f     right_margin_
+00010480: 6361 6e64 6c65 7320 3d20 310d 0a0d 0a20  candles = 1.... 
+00010490: 2020 2061 7820 3d20 5f63 7265 6174 655f     ax = _create_
+000104a0: 706c 6f74 2861 783d 6178 2c20 6d61 7869  plot(ax=ax, maxi
+000104b0: 6d69 7a65 3d46 616c 7365 290d 0a20 2020  mize=False)..   
+000104c0: 2064 6174 6173 7263 203d 205f 7072 6561   datasrc = _prea
+000104d0: 646a 7573 745f 686f 7269 7a5f 6461 7461  djust_horiz_data
+000104e0: 7372 6328 6461 7461 7372 6329 0d0a 2020  src(datasrc)..  
+000104f0: 2020 6461 7461 7372 6320 3d20 5f63 7265    datasrc = _cre
+00010500: 6174 655f 6461 7461 7372 6328 6178 2c20  ate_datasrc(ax, 
+00010510: 6461 7461 7372 632c 2061 6c6c 6f77 5f73  datasrc, allow_s
+00010520: 6361 6c69 6e67 3d46 616c 7365 290d 0a20  caling=False).. 
+00010530: 2020 205f 6164 6a75 7374 5f68 6f72 697a     _adjust_horiz
+00010540: 5f64 6174 6173 7263 2864 6174 6173 7263  _datasrc(datasrc
+00010550: 290d 0a20 2020 2069 6620 6178 2e76 622e  )..    if ax.vb.
+00010560: 6461 7461 7372 6320 6973 206e 6f74 204e  datasrc is not N
+00010570: 6f6e 653a 0d0a 2020 2020 2020 2020 6461  one:..        da
+00010580: 7461 7372 632e 7374 616e 6461 6c6f 6e65  tasrc.standalone
+00010590: 203d 2054 7275 6520 2320 6f6e 6c79 2066   = True # only f
+000105a0: 6f72 6365 2073 7461 6e64 616c 6f6e 6520  orce standalone 
+000105b0: 6966 2074 6865 7265 2069 7320 736f 6d65  if there is some
+000105c0: 7468 696e 6720 6f6e 206f 7572 2063 6861  thing on our cha
+000105d0: 7274 7320 616c 7265 6164 790d 0a20 2020  rts already..   
+000105e0: 2064 6174 6173 7263 2e73 6361 6c65 5f63   datasrc.scale_c
+000105f0: 6f6c 7320 3d20 5b64 6174 6173 7263 2e63  ols = [datasrc.c
+00010600: 6f6c 5f64 6174 615f 6f66 6673 6574 2c20  ol_data_offset, 
+00010610: 6c65 6e28 6461 7461 7372 632e 6466 2e63  len(datasrc.df.c
+00010620: 6f6c 756d 6e73 292d 325d 2023 2066 6972  olumns)-2] # fir
+00010630: 7374 2061 6e64 206c 6173 7420 7072 6963  st and last pric
+00010640: 6520 636f 6c75 6d6e 730d 0a20 2020 2064  e columns..    d
+00010650: 6174 6173 7263 2e70 7265 5f75 7064 6174  atasrc.pre_updat
+00010660: 6520 3d20 6c61 6d62 6461 2064 663a 2064  e = lambda df: d
+00010670: 662e 6c6f 635b 3a2c 203a 6466 2e63 6f6c  f.loc[:, :df.col
+00010680: 756d 6e73 5b30 5d5d 2023 2074 6872 6f77  umns[0]] # throw
+00010690: 2061 7761 7920 7072 6576 696f 7573 2064   away previous d
+000106a0: 6174 610d 0a20 2020 2064 6174 6173 7263  ata..    datasrc
+000106b0: 2e70 6f73 745f 7570 6461 7465 203d 206c  .post_update = l
+000106c0: 616d 6264 6120 6466 3a20 6466 2e64 726f  ambda df: df.dro
+000106d0: 706e 6128 686f 773d 2761 6c6c 2729 2023  pna(how='all') #
+000106e0: 206b 696c 6c20 616c 6c2d 4e61 4e73 0d0a   kill all-NaNs..
+000106f0: 2020 2020 5f73 6574 5f64 6174 6173 7263      _set_datasrc
+00010700: 2861 782c 2064 6174 6173 7263 290d 0a20  (ax, datasrc).. 
+00010710: 2020 2069 7465 6d20 3d20 486f 7269 7a6f     item = Horizo
+00010720: 6e74 616c 5469 6d65 566f 6c75 6d65 4974  ntalTimeVolumeIt
+00010730: 656d 2861 783d 6178 2c20 6461 7461 7372  em(ax=ax, datasr
+00010740: 633d 6461 7461 7372 632c 202a 2a6b 7761  c=datasrc, **kwa
+00010750: 7267 7329 0d0a 2020 2020 6974 656d 2e75  rgs)..    item.u
+00010760: 7064 6174 655f 6461 7461 203d 2070 6172  pdate_data = par
+00010770: 7469 616c 285f 7570 6461 7465 5f64 6174  tial(_update_dat
+00010780: 612c 205f 7072 6561 646a 7573 745f 686f  a, _preadjust_ho
+00010790: 7269 7a5f 6461 7461 7372 632c 205f 6164  riz_datasrc, _ad
+000107a0: 6a75 7374 5f68 6f72 697a 5f64 6174 6173  just_horiz_datas
+000107b0: 7263 2c20 6974 656d 290d 0a20 2020 2069  rc, item)..    i
+000107c0: 7465 6d2e 7570 6461 7465 5f67 6678 203d  tem.update_gfx =
+000107d0: 2070 6172 7469 616c 285f 7570 6461 7465   partial(_update
+000107e0: 5f67 6678 2c20 6974 656d 290d 0a20 2020  _gfx, item)..   
+000107f0: 2069 7465 6d2e 7365 745a 5661 6c75 6528   item.setZValue(
+00010800: 2d31 3029 0d0a 2020 2020 6178 2e61 6464  -10)..    ax.add
+00010810: 4974 656d 2869 7465 6d29 0d0a 2020 2020  Item(item)..    
+00010820: 7265 7475 726e 2069 7465 6d0d 0a0d 0a0d  return item.....
+00010830: 0a64 6566 2068 6561 746d 6170 2864 6174  .def heatmap(dat
+00010840: 6173 7263 2c20 6178 3d4e 6f6e 652c 202a  asrc, ax=None, *
+00010850: 2a6b 7761 7267 7329 3a0d 0a20 2020 2027  *kwargs):..    '
+00010860: 2727 4578 7065 6e73 6976 6520 6675 6e63  ''Expensive func
+00010870: 7469 6f6e 2e20 4f6e 6c79 2075 7365 206f  tion. Only use o
+00010880: 6e20 736d 616c 6c20 6461 7461 2073 6574  n small data set
+00010890: 732e 2053 6565 2048 6561 746d 6170 4974  s. See HeatmapIt
+000108a0: 656d 2066 6f72 206b 7761 7267 732e 2049  em for kwargs. I
+000108b0: 6e70 7574 2064 6174 6173 7263 0d0a 2020  nput datasrc..  
+000108c0: 2020 2020 2068 6173 2078 2028 7469 6d65       has x (time
+000108d0: 2920 696e 2069 6e64 6578 206f 7220 6669  ) in index or fi
+000108e0: 7273 7420 636f 6c75 6d6e 2c20 7920 2870  rst column, y (p
+000108f0: 7269 6365 2920 6173 2063 6f6c 756d 6e20  rice) as column 
+00010900: 6e61 6d65 732c 2061 6e64 2069 6e74 656e  names, and inten
+00010910: 7369 7479 2028 636f 6c6f 7229 2061 730d  sity (color) as.
+00010920: 0a20 2020 2020 2020 6365 6c6c 2076 616c  .       cell val
+00010930: 7565 732e 2727 270d 0a20 2020 2061 7820  ues.'''..    ax 
+00010940: 3d20 5f63 7265 6174 655f 706c 6f74 2861  = _create_plot(a
+00010950: 783d 6178 2c20 6d61 7869 6d69 7a65 3d46  x=ax, maximize=F
+00010960: 616c 7365 290d 0a20 2020 2069 6620 6178  alse)..    if ax
+00010970: 2e76 622e 765f 7a6f 6f6d 5f73 6361 6c65  .vb.v_zoom_scale
+00010980: 203e 3d20 302e 393a 0d0a 2020 2020 2020   >= 0.9:..      
+00010990: 2020 6178 2e76 622e 765f 7a6f 6f6d 5f73    ax.vb.v_zoom_s
+000109a0: 6361 6c65 203d 2030 2e36 0d0a 2020 2020  cale = 0.6..    
+000109b0: 6461 7461 7372 6320 3d20 5f63 7265 6174  datasrc = _creat
+000109c0: 655f 6461 7461 7372 6328 6178 2c20 6461  e_datasrc(ax, da
+000109d0: 7461 7372 6329 0d0a 2020 2020 6461 7461  tasrc)..    data
+000109e0: 7372 632e 7363 616c 655f 636f 6c73 203d  src.scale_cols =
+000109f0: 205b 5d20 2320 646f 6573 6e27 7420 7363   [] # doesn't sc
+00010a00: 616c 650d 0a20 2020 205f 7365 745f 6461  ale..    _set_da
+00010a10: 7461 7372 6328 6178 2c20 6461 7461 7372  tasrc(ax, datasr
+00010a20: 6329 0d0a 2020 2020 6974 656d 203d 2048  c)..    item = H
+00010a30: 6561 746d 6170 4974 656d 2861 783d 6178  eatmapItem(ax=ax
+00010a40: 2c20 6461 7461 7372 633d 6461 7461 7372  , datasrc=datasr
+00010a50: 632c 202a 2a6b 7761 7267 7329 0d0a 2020  c, **kwargs)..  
+00010a60: 2020 6974 656d 2e75 7064 6174 655f 6461    item.update_da
+00010a70: 7461 203d 2070 6172 7469 616c 285f 7570  ta = partial(_up
+00010a80: 6461 7465 5f64 6174 612c 204e 6f6e 652c  date_data, None,
+00010a90: 204e 6f6e 652c 2069 7465 6d29 0d0a 2020   None, item)..  
+00010aa0: 2020 6974 656d 2e75 7064 6174 655f 6766    item.update_gf
+00010ab0: 7820 3d20 7061 7274 6961 6c28 5f75 7064  x = partial(_upd
+00010ac0: 6174 655f 6766 782c 2069 7465 6d29 0d0a  ate_gfx, item)..
+00010ad0: 2020 2020 6974 656d 2e73 6574 5a56 616c      item.setZVal
+00010ae0: 7565 282d 3330 290d 0a20 2020 2061 782e  ue(-30)..    ax.
+00010af0: 6164 6449 7465 6d28 6974 656d 290d 0a20  addItem(item).. 
+00010b00: 2020 2069 6620 6178 2e76 622e 6461 7461     if ax.vb.data
+00010b10: 7372 6320 6973 206e 6f74 204e 6f6e 6520  src is not None 
+00010b20: 616e 6420 6e6f 7420 6178 2e76 622e 6461  and not ax.vb.da
+00010b30: 7461 7372 632e 7469 6d65 6261 7365 6428  tasrc.timebased(
+00010b40: 293a 2023 206d 616e 7561 6c20 7a6f 6f6d  ): # manual zoom
+00010b50: 2075 7064 6174 650d 0a20 2020 2020 2020   update..       
+00010b60: 2061 782e 7365 7458 4c69 6e6b 284e 6f6e   ax.setXLink(Non
+00010b70: 6529 0d0a 2020 2020 2020 2020 6966 2061  e)..        if a
+00010b80: 782e 7072 6576 5f61 783a 0d0a 2020 2020  x.prev_ax:..    
+00010b90: 2020 2020 2020 2020 6178 2e70 7265 765f          ax.prev_
+00010ba0: 6178 2e73 6574 5f76 6973 6962 6c65 2878  ax.set_visible(x
+00010bb0: 6178 6973 3d54 7275 6529 0d0a 2020 2020  axis=True)..    
+00010bc0: 2020 2020 6466 203d 2061 782e 7662 2e64      df = ax.vb.d
+00010bd0: 6174 6173 7263 2e64 660d 0a20 2020 2020  atasrc.df..     
+00010be0: 2020 2070 7269 6365 7320 3d20 6466 2e63     prices = df.c
+00010bf0: 6f6c 756d 6e73 5b61 782e 7662 2e64 6174  olumns[ax.vb.dat
+00010c00: 6173 7263 2e63 6f6c 5f64 6174 615f 6f66  asrc.col_data_of
+00010c10: 6673 6574 3a69 7465 6d2e 636f 6c5f 6461  fset:item.col_da
+00010c20: 7461 5f65 6e64 5d0d 0a20 2020 2020 2020  ta_end]..       
+00010c30: 2064 656c 7461 5f70 7269 6365 203d 2061   delta_price = a
+00010c40: 6273 2870 7269 6365 735b 305d 202d 2070  bs(prices[0] - p
+00010c50: 7269 6365 735b 315d 290d 0a20 2020 2020  rices[1])..     
+00010c60: 2020 2061 782e 7662 2e73 6574 5f72 616e     ax.vb.set_ran
+00010c70: 6765 2830 2c20 6d69 6e28 6466 2e63 6f6c  ge(0, min(df.col
+00010c80: 756d 6e73 5b31 3a5d 292c 206c 656e 2864  umns[1:]), len(d
+00010c90: 6629 2c20 6d61 7828 6466 2e63 6f6c 756d  f), max(df.colum
+00010ca0: 6e73 5b31 3a5d 292b 6465 6c74 615f 7072  ns[1:])+delta_pr
+00010cb0: 6963 6529 0d0a 2020 2020 7265 7475 726e  ice)..    return
+00010cc0: 2069 7465 6d0d 0a0d 0a0d 0a64 6566 2062   item......def b
+00010cd0: 6172 2878 2c20 793d 4e6f 6e65 2c20 7769  ar(x, y=None, wi
+00010ce0: 6474 683d 302e 382c 2061 783d 4e6f 6e65  dth=0.8, ax=None
+00010cf0: 2c20 636f 6c6f 7266 756e 633d 7374 7265  , colorfunc=stre
+00010d00: 6e67 7468 5f63 6f6c 6f72 6669 6c74 6572  ngth_colorfilter
+00010d10: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00010d20: 2020 2727 2742 6172 2070 6c6f 7473 2061    '''Bar plots a
+00010d30: 7265 2064 6563 6f75 706c 6564 2e20 5573  re decoupled. Us
+00010d40: 6520 766f 6c75 6d65 5f6f 6376 2829 2069  e volume_ocv() i
+00010d50: 6620 796f 7520 7761 6e74 2061 2062 6172  f you want a bar
+00010d60: 2070 6c6f 7420 7768 6963 6820 7265 6c61   plot which rela
+00010d70: 7465 7320 746f 206f 7468 6572 2074 696d  tes to other tim
+00010d80: 6520 706c 6f74 732e 2727 270d 0a20 2020  e plots.'''..   
+00010d90: 2067 6c6f 6261 6c20 7269 6768 745f 6d61   global right_ma
+00010da0: 7267 696e 5f63 616e 646c 6573 2c20 6d61  rgin_candles, ma
+00010db0: 785f 7a6f 6f6d 5f70 6f69 6e74 730d 0a20  x_zoom_points.. 
+00010dc0: 2020 2072 6967 6874 5f6d 6172 6769 6e5f     right_margin_
+00010dd0: 6361 6e64 6c65 7320 3d20 300d 0a20 2020  candles = 0..   
+00010de0: 206d 6178 5f7a 6f6f 6d5f 706f 696e 7473   max_zoom_points
+00010df0: 203d 206d 696e 286d 6178 5f7a 6f6f 6d5f   = min(max_zoom_
+00010e00: 706f 696e 7473 2c20 3829 0d0a 2020 2020  points, 8)..    
+00010e10: 6178 203d 205f 6372 6561 7465 5f70 6c6f  ax = _create_plo
+00010e20: 7428 6178 3d61 782c 206d 6178 696d 697a  t(ax=ax, maximiz
+00010e30: 653d 4661 6c73 6529 0d0a 2020 2020 6178  e=False)..    ax
+00010e40: 2e64 6563 6f75 706c 6528 290d 0a20 2020  .decouple()..   
+00010e50: 2064 6174 6173 7263 203d 205f 6372 6561   datasrc = _crea
+00010e60: 7465 5f64 6174 6173 7263 2861 782c 2078  te_datasrc(ax, x
+00010e70: 2c20 792c 206e 636f 6c73 3d31 290d 0a20  , y, ncols=1).. 
+00010e80: 2020 205f 6164 6a75 7374 5f62 6172 5f64     _adjust_bar_d
+00010e90: 6174 6173 7263 2864 6174 6173 7263 2c20  atasrc(datasrc, 
+00010ea0: 6f72 6465 725f 636f 6c73 3d46 616c 7365  order_cols=False
+00010eb0: 2920 2320 646f 6e27 7420 7265 6172 7261  ) # don't rearra
+00010ec0: 6e67 6520 636f 6c75 6d6e 732c 2064 6f6e  nge columns, don
+00010ed0: 6520 666f 7220 7573 2069 6e20 766f 6c75  e for us in volu
+00010ee0: 6d65 5f6f 6376 2829 0d0a 2020 2020 6974  me_ocv()..    it
+00010ef0: 656d 203d 2076 6f6c 756d 655f 6f63 7628  em = volume_ocv(
+00010f00: 6461 7461 7372 632c 2063 616e 646c 655f  datasrc, candle_
+00010f10: 7769 6474 683d 7769 6474 682c 2061 783d  width=width, ax=
+00010f20: 6178 2c20 636f 6c6f 7266 756e 633d 636f  ax, colorfunc=co
+00010f30: 6c6f 7266 756e 6329 0d0a 2020 2020 6974  lorfunc)..    it
+00010f40: 656d 2e75 7064 6174 655f 6461 7461 203d  em.update_data =
+00010f50: 2070 6172 7469 616c 285f 7570 6461 7465   partial(_update
+00010f60: 5f64 6174 612c 204e 6f6e 652c 205f 6164  _data, None, _ad
+00010f70: 6a75 7374 5f62 6172 5f64 6174 6173 7263  just_bar_datasrc
+00010f80: 2c20 6974 656d 290d 0a20 2020 2069 7465  , item)..    ite
+00010f90: 6d2e 7570 6461 7465 5f67 6678 203d 2070  m.update_gfx = p
+00010fa0: 6172 7469 616c 285f 7570 6461 7465 5f67  artial(_update_g
+00010fb0: 6678 2c20 6974 656d 290d 0a20 2020 2061  fx, item)..    a
+00010fc0: 782e 7662 2e70 7265 5f70 726f 6365 7373  x.vb.pre_process
+00010fd0: 5f64 6174 6128 290d 0a20 2020 2069 6620  _data()..    if 
+00010fe0: 6178 2e76 622e 795f 6d69 6e20 3e3d 2030  ax.vb.y_min >= 0
+00010ff0: 3a0d 0a20 2020 2020 2020 2061 782e 7662  :..        ax.vb
+00011000: 2e76 5f7a 6f6f 6d5f 6261 7365 6c69 6e65  .v_zoom_baseline
+00011010: 203d 2030 0d0a 2020 2020 7265 7475 726e   = 0..    return
+00011020: 2069 7465 6d0d 0a0d 0a0d 0a64 6566 2068   item......def h
+00011030: 6973 7428 782c 2062 696e 732c 2061 783d  ist(x, bins, ax=
+00011040: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
+00011050: 0d0a 2020 2020 6869 7374 5f64 6174 6120  ..    hist_data 
+00011060: 3d20 7064 2e63 7574 2878 2c20 6269 6e73  = pd.cut(x, bins
+00011070: 3d62 696e 7329 2e76 616c 7565 5f63 6f75  =bins).value_cou
+00011080: 6e74 7328 290d 0a20 2020 2064 6174 6120  nts()..    data 
+00011090: 3d20 5b28 692e 6d69 642c 302c 6869 7374  = [(i.mid,0,hist
+000110a0: 5f64 6174 612e 6c6f 635b 695d 2c68 6973  _data.loc[i],his
+000110b0: 745f 6461 7461 2e6c 6f63 5b69 5d29 2066  t_data.loc[i]) f
+000110c0: 6f72 2069 2069 6e20 736f 7274 6564 2868  or i in sorted(h
+000110d0: 6973 745f 6461 7461 2e69 6e64 6578 295d  ist_data.index)]
+000110e0: 0d0a 2020 2020 6466 203d 2070 642e 4461  ..    df = pd.Da
+000110f0: 7461 4672 616d 6528 6461 7461 2c20 636f  taFrame(data, co
+00011100: 6c75 6d6e 733d 5b27 7827 2c27 5f6f 705f  lumns=['x','_op_
+00011110: 272c 275f 636c 5f27 2c27 6269 6e27 5d29  ','_cl_','bin'])
+00011120: 0d0a 2020 2020 6466 2e73 6574 5f69 6e64  ..    df.set_ind
+00011130: 6578 2827 7827 2c20 696e 706c 6163 653d  ex('x', inplace=
+00011140: 5472 7565 290d 0a20 2020 2069 7465 6d20  True)..    item 
+00011150: 3d20 6261 7228 6466 2c20 6178 3d61 7829  = bar(df, ax=ax)
+00011160: 0d0a 2020 2020 6465 6c20 6974 656d 2e75  ..    del item.u
+00011170: 7064 6174 655f 6461 7461 0d0a 2020 2020  pdate_data..    
+00011180: 7265 7475 726e 2069 7465 6d0d 0a0d 0a0d  return item.....
+00011190: 0a64 6566 2070 6c6f 7428 782c 2079 3d4e  .def plot(x, y=N
+000111a0: 6f6e 652c 2063 6f6c 6f72 3d4e 6f6e 652c  one, color=None,
+000111b0: 2077 6964 7468 3d31 2c20 6178 3d4e 6f6e   width=1, ax=Non
+000111c0: 652c 2073 7479 6c65 3d4e 6f6e 652c 206c  e, style=None, l
+000111d0: 6567 656e 643d 4e6f 6e65 2c20 7a6f 6f6d  egend=None, zoom
+000111e0: 7363 616c 653d 5472 7565 2c20 2a2a 6b77  scale=True, **kw
+000111f0: 6172 6773 293a 0d0a 2020 2020 6178 203d  args):..    ax =
+00011200: 205f 6372 6561 7465 5f70 6c6f 7428 6178   _create_plot(ax
+00011210: 3d61 782c 206d 6178 696d 697a 653d 4661  =ax, maximize=Fa
+00011220: 6c73 6529 0d0a 2020 2020 7573 6564 5f63  lse)..    used_c
+00011230: 6f6c 6f72 203d 205f 6765 745f 636f 6c6f  olor = _get_colo
+00011240: 7228 6178 2c20 7374 796c 652c 2063 6f6c  r(ax, style, col
+00011250: 6f72 290d 0a20 2020 2064 6174 6173 7263  or)..    datasrc
+00011260: 203d 205f 6372 6561 7465 5f64 6174 6173   = _create_datas
+00011270: 7263 2861 782c 2078 2c20 792c 206e 636f  rc(ax, x, y, nco
+00011280: 6c73 3d31 290d 0a20 2020 2069 6620 6e6f  ls=1)..    if no
+00011290: 7420 7a6f 6f6d 7363 616c 653a 0d0a 2020  t zoomscale:..  
+000112a0: 2020 2020 2020 6461 7461 7372 632e 7363        datasrc.sc
+000112b0: 616c 655f 636f 6c73 203d 205b 5d0d 0a20  ale_cols = [].. 
+000112c0: 2020 205f 7365 745f 6461 7461 7372 6328     _set_datasrc(
+000112d0: 6178 2c20 6461 7461 7372 6329 0d0a 2020  ax, datasrc)..  
+000112e0: 2020 6966 206c 6567 656e 6420 6973 206e    if legend is n
+000112f0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00011300: 2020 5f63 7265 6174 655f 6c65 6765 6e64    _create_legend
+00011310: 2861 7829 0d0a 2020 2020 7820 3d20 6461  (ax)..    x = da
+00011320: 7461 7372 632e 7820 6966 206e 6f74 2061  tasrc.x if not a
+00011330: 782e 7662 2e78 5f69 6e64 6578 6564 2065  x.vb.x_indexed e
+00011340: 6c73 6520 6461 7461 7372 632e 696e 6465  lse datasrc.inde
+00011350: 780d 0a20 2020 2079 203d 2064 6174 6173  x..    y = datas
+00011360: 7263 2e79 202f 2061 782e 7662 2e79 7363  rc.y / ax.vb.ysc
+00011370: 616c 652e 7363 616c 6566 0d0a 2020 2020  ale.scalef..    
+00011380: 6966 2061 782e 7662 2e79 7363 616c 652e  if ax.vb.yscale.
+00011390: 7363 616c 6574 7970 6520 3d3d 2027 6c6f  scaletype == 'lo
+000113a0: 6727 3a0d 0a20 2020 2020 2020 2079 203d  g':..        y =
+000113b0: 2079 202b 206c 6f67 5f70 6c6f 745f 6f66   y + log_plot_of
+000113c0: 6673 6574 0d0a 2020 2020 6966 2073 7479  fset..    if sty
+000113d0: 6c65 2069 7320 4e6f 6e65 206f 7220 616e  le is None or an
+000113e0: 7928 6368 2069 6e20 7374 796c 6520 666f  y(ch in style fo
+000113f0: 7220 6368 2069 6e20 272d 5f2e 2729 3a0d  r ch in '-_.'):.
+00011400: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
+00011410: 5f64 6f74 7320 3d20 2766 696e 6974 6527  _dots = 'finite'
+00011420: 2023 2073 616d 6520 6173 206d 6174 706c   # same as matpl
+00011430: 6f74 6c69 623b 2075 7365 2064 6174 6173  otlib; use datas
+00011440: 7263 2e73 7461 6e64 616c 6f6e 653d 5472  rc.standalone=Tr
+00011450: 7565 2069 6620 796f 7520 7761 6e74 2074  ue if you want t
+00011460: 6f20 6b65 6570 2073 6570 6172 6174 6520  o keep separate 
+00011470: 696e 7465 7276 616c 7320 6f6e 2061 2070  intervals on a p
+00011480: 6c6f 740d 0a20 2020 2020 2020 2069 7465  lot..        ite
+00011490: 6d20 3d20 6178 2e70 6c6f 7428 782c 2079  m = ax.plot(x, y
+000114a0: 2c20 7065 6e3d 5f6d 616b 6570 656e 2863  , pen=_makepen(c
+000114b0: 6f6c 6f72 3d75 7365 645f 636f 6c6f 722c  olor=used_color,
+000114c0: 2073 7479 6c65 3d73 7479 6c65 2c20 7769   style=style, wi
+000114d0: 6474 683d 7769 6474 6829 2c20 6e61 6d65  dth=width), name
+000114e0: 3d6c 6567 656e 642c 2063 6f6e 6e65 6374  =legend, connect
+000114f0: 3d63 6f6e 6e65 6374 5f64 6f74 7329 0d0a  =connect_dots)..
+00011500: 2020 2020 2020 2020 6974 656d 2e73 6574          item.set
+00011510: 5a56 616c 7565 2835 290d 0a20 2020 2065  ZValue(5)..    e
+00011520: 6c73 653a 0d0a 2020 2020 2020 2020 7379  lse:..        sy
+00011530: 6d62 6f6c 203d 207b 2776 273a 2774 272c  mbol = {'v':'t',
+00011540: 2027 5e27 3a27 7431 272c 2027 3e27 3a27   '^':'t1', '>':'
+00011550: 7432 272c 2027 3c27 3a27 7433 277d 2e67  t2', '<':'t3'}.g
+00011560: 6574 2873 7479 6c65 2c20 7374 796c 6529  et(style, style)
+00011570: 2023 2074 7261 6e73 6c61 7465 2073 6f6d   # translate som
+00011580: 6520 7369 6d69 6c61 7220 7374 796c 6573  e similar styles
+00011590: 0d0a 2020 2020 2020 2020 7966 696c 7465  ..        yfilte
+000115a0: 7220 3d20 792e 6e6f 746e 756c 6c28 290d  r = y.notnull().
+000115b0: 0a20 2020 2020 2020 2073 6572 203d 2079  .        ser = y
+000115c0: 2e6c 6f63 5b79 6669 6c74 6572 5d0d 0a20  .loc[yfilter].. 
+000115d0: 2020 2020 2020 2078 203d 2078 2e6c 6f63         x = x.loc
+000115e0: 5b79 6669 6c74 6572 5d2e 7661 6c75 6573  [yfilter].values
+000115f0: 2069 6620 6861 7361 7474 7228 782c 2027   if hasattr(x, '
+00011600: 6c6f 6327 2920 656c 7365 2078 5b79 6669  loc') else x[yfi
+00011610: 6c74 6572 5d0d 0a20 2020 2020 2020 2069  lter]..        i
+00011620: 7465 6d20 3d20 6178 2e70 6c6f 7428 782c  tem = ax.plot(x,
+00011630: 2073 6572 2e76 616c 7565 732c 2070 656e   ser.values, pen
+00011640: 3d4e 6f6e 652c 2073 796d 626f 6c3d 7379  =None, symbol=sy
+00011650: 6d62 6f6c 2c20 7379 6d62 6f6c 5065 6e3d  mbol, symbolPen=
+00011660: 4e6f 6e65 2c20 7379 6d62 6f6c 5369 7a65  None, symbolSize
+00011670: 3d37 2a77 6964 7468 2c20 7379 6d62 6f6c  =7*width, symbol
+00011680: 4272 7573 683d 7067 2e6d 6b42 7275 7368  Brush=pg.mkBrush
+00011690: 2875 7365 645f 636f 6c6f 7229 2c20 6e61  (used_color), na
+000116a0: 6d65 3d6c 6567 656e 6429 0d0a 2020 2020  me=legend)..    
+000116b0: 2020 2020 6966 2077 6964 7468 203c 2031      if width < 1
+000116c0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+000116d0: 7465 6d2e 6f70 7473 5b27 616e 7469 616c  tem.opts['antial
+000116e0: 6961 7327 5d20 3d20 5472 7565 0d0a 2020  ias'] = True..  
+000116f0: 2020 2020 2020 6974 656d 2e73 6361 7474        item.scatt
+00011700: 6572 2e5f 646f 7061 696e 7420 3d20 6974  er._dopaint = it
+00011710: 656d 2e73 6361 7474 6572 2e70 6169 6e74  em.scatter.paint
+00011720: 0d0a 2020 2020 2020 2020 6974 656d 2e73  ..        item.s
+00011730: 6361 7474 6572 2e70 6169 6e74 203d 2070  catter.paint = p
+00011740: 6172 7469 616c 285f 7061 696e 745f 7363  artial(_paint_sc
+00011750: 6174 7465 722c 2069 7465 6d2e 7363 6174  atter, item.scat
+00011760: 7465 7229 0d0a 2020 2020 2020 2020 2320  ter)..        # 
+00011770: 6f70 7469 6d69 7a65 2028 7768 656e 2068  optimize (when h
+00011780: 6176 696e 6720 6c61 7267 6520 6e75 6d62  aving large numb
+00011790: 6572 206f 6620 706f 696e 7473 2920 6279  er of points) by
+000117a0: 2069 676e 6f72 696e 6720 7363 6174 7465   ignoring scatte
+000117b0: 7220 636c 6963 6b20 6465 7465 6374 696f  r click detectio
+000117c0: 6e0d 0a20 2020 2020 2020 205f 6475 6d6d  n..        _dumm
+000117d0: 795f 6d6f 7573 655f 636c 6963 6b20 3d20  y_mouse_click = 
+000117e0: 6c61 6d62 6461 2065 763a 2030 0d0a 2020  lambda ev: 0..  
+000117f0: 2020 2020 2020 6974 656d 2e73 6361 7474        item.scatt
+00011800: 6572 2e6d 6f75 7365 436c 6963 6b45 7665  er.mouseClickEve
+00011810: 6e74 203d 205f 6475 6d6d 795f 6d6f 7573  nt = _dummy_mous
+00011820: 655f 636c 6963 6b0d 0a20 2020 2020 2020  e_click..       
+00011830: 2069 7465 6d2e 7365 745a 5661 6c75 6528   item.setZValue(
+00011840: 3130 290d 0a20 2020 2069 7465 6d2e 6f70  10)..    item.op
+00011850: 7473 5b27 6861 6e64 6564 5f63 6f6c 6f72  ts['handed_color
+00011860: 275d 203d 2063 6f6c 6f72 0d0a 2020 2020  '] = color..    
+00011870: 6974 656d 2e61 7820 3d20 6178 0d0a 2020  item.ax = ax..  
+00011880: 2020 6974 656d 2e64 6174 6173 7263 203d    item.datasrc =
+00011890: 2064 6174 6173 7263 0d0a 2020 2020 5f75   datasrc..    _u
+000118a0: 7064 6174 655f 7369 676e 6966 6963 616e  pdate_significan
+000118b0: 7473 2861 782c 2064 6174 6173 7263 2c20  ts(ax, datasrc, 
+000118c0: 666f 7263 653d 4661 6c73 6529 0d0a 2020  force=False)..  
+000118d0: 2020 6974 656d 2e75 7064 6174 655f 6461    item.update_da
+000118e0: 7461 203d 2070 6172 7469 616c 285f 7570  ta = partial(_up
+000118f0: 6461 7465 5f64 6174 612c 204e 6f6e 652c  date_data, None,
+00011900: 204e 6f6e 652c 2069 7465 6d29 0d0a 2020   None, item)..  
+00011910: 2020 6974 656d 2e75 7064 6174 655f 6766    item.update_gf
+00011920: 7820 3d20 7061 7274 6961 6c28 5f75 7064  x = partial(_upd
+00011930: 6174 655f 6766 782c 2069 7465 6d29 0d0a  ate_gfx, item)..
+00011940: 2020 2020 2320 6164 6420 6c65 6765 6e64      # add legend
+00011950: 2074 6f20 6d61 696e 2061 782c 206e 6f74   to main ax, not
+00011960: 2074 6f20 6f76 6572 6c61 790d 0a20 2020   to overlay..   
+00011970: 2061 786d 203d 2061 782e 7662 2e6d 6173   axm = ax.vb.mas
+00011980: 7465 725f 7669 6577 626f 782e 7061 7265  ter_viewbox.pare
+00011990: 6e74 2829 2069 6620 6178 2e76 622e 6d61  nt() if ax.vb.ma
+000119a0: 7374 6572 5f76 6965 7762 6f78 2065 6c73  ster_viewbox els
+000119b0: 6520 6178 0d0a 2020 2020 6966 2061 786d  e ax..    if axm
+000119c0: 2e6c 6567 656e 6420 6973 206e 6f74 204e  .legend is not N
+000119d0: 6f6e 653a 0d0a 2020 2020 2020 2020 6966  one:..        if
+000119e0: 206c 6567 656e 6420 616e 6420 6178 6d20   legend and axm 
+000119f0: 213d 2061 783a 0d0a 2020 2020 2020 2020  != ax:..        
+00011a00: 2020 2020 6178 6d2e 6c65 6765 6e64 2e61      axm.legend.a
+00011a10: 6464 4974 656d 2869 7465 6d2c 206e 616d  ddItem(item, nam
+00011a20: 653d 6c65 6765 6e64 290d 0a20 2020 2020  e=legend)..     
+00011a30: 2020 2066 6f72 205f 2c6c 6162 656c 2069     for _,label i
+00011a40: 6e20 6178 6d2e 6c65 6765 6e64 2e69 7465  n axm.legend.ite
+00011a50: 6d73 3a0d 0a20 2020 2020 2020 2020 2020  ms:..           
+00011a60: 2069 6620 6c61 6265 6c2e 7465 7874 203d   if label.text =
+00011a70: 3d20 6c65 6765 6e64 3a0d 0a20 2020 2020  = legend:..     
+00011a80: 2020 2020 2020 2020 2020 206c 6162 656c             label
+00011a90: 2e73 6574 4174 7472 2827 6a75 7374 6966  .setAttr('justif
+00011aa0: 7927 2c20 276c 6566 7427 290d 0a20 2020  y', 'left')..   
+00011ab0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
+00011ac0: 656c 2e73 6574 5465 7874 286c 6162 656c  el.setText(label
+00011ad0: 2e74 6578 742c 2063 6f6c 6f72 3d6c 6567  .text, color=leg
+00011ae0: 656e 645f 7465 7874 5f63 6f6c 6f72 290d  end_text_color).
+00011af0: 0a20 2020 2072 6574 7572 6e20 6974 656d  .    return item
+00011b00: 0d0a 0d0a 0d0a 6465 6620 6c61 6265 6c73  ......def labels
+00011b10: 2878 2c20 793d 4e6f 6e65 2c20 6c61 6265  (x, y=None, labe
+00011b20: 6c73 3d4e 6f6e 652c 2063 6f6c 6f72 3d4e  ls=None, color=N
+00011b30: 6f6e 652c 2061 783d 4e6f 6e65 2c20 616e  one, ax=None, an
+00011b40: 6368 6f72 3d28 302e 352c 3129 293a 0d0a  chor=(0.5,1)):..
+00011b50: 2020 2020 6178 203d 205f 6372 6561 7465      ax = _create
+00011b60: 5f70 6c6f 7428 6178 3d61 782c 206d 6178  _plot(ax=ax, max
+00011b70: 696d 697a 653d 4661 6c73 6529 0d0a 2020  imize=False)..  
+00011b80: 2020 7573 6564 5f63 6f6c 6f72 203d 205f    used_color = _
+00011b90: 6765 745f 636f 6c6f 7228 6178 2c20 273f  get_color(ax, '?
+00011ba0: 272c 2063 6f6c 6f72 290d 0a20 2020 2064  ', color)..    d
+00011bb0: 6174 6173 7263 203d 205f 6372 6561 7465  atasrc = _create
+00011bc0: 5f64 6174 6173 7263 2861 782c 2078 2c20  _datasrc(ax, x, 
+00011bd0: 792c 206c 6162 656c 732c 206e 636f 6c73  y, labels, ncols
+00011be0: 3d33 290d 0a20 2020 2064 6174 6173 7263  =3)..    datasrc
+00011bf0: 2e73 6361 6c65 5f63 6f6c 7320 3d20 5b5d  .scale_cols = []
+00011c00: 2023 2064 6f6e 2774 2075 7365 2074 6869   # don't use thi
+00011c10: 7320 666f 7220 7363 616c 696e 670d 0a20  s for scaling.. 
+00011c20: 2020 205f 7365 745f 6461 7461 7372 6328     _set_datasrc(
+00011c30: 6178 2c20 6461 7461 7372 6329 0d0a 2020  ax, datasrc)..  
+00011c40: 2020 6974 656d 203d 2053 6361 7474 6572    item = Scatter
+00011c50: 4c61 6265 6c49 7465 6d28 6178 3d61 782c  LabelItem(ax=ax,
+00011c60: 2064 6174 6173 7263 3d64 6174 6173 7263   datasrc=datasrc
+00011c70: 2c20 636f 6c6f 723d 7573 6564 5f63 6f6c  , color=used_col
+00011c80: 6f72 2c20 616e 6368 6f72 3d61 6e63 686f  or, anchor=ancho
+00011c90: 7229 0d0a 2020 2020 5f75 7064 6174 655f  r)..    _update_
+00011ca0: 7369 676e 6966 6963 616e 7473 2861 782c  significants(ax,
+00011cb0: 2064 6174 6173 7263 2c20 666f 7263 653d   datasrc, force=
+00011cc0: 4661 6c73 6529 0d0a 2020 2020 6974 656d  False)..    item
+00011cd0: 2e75 7064 6174 655f 6461 7461 203d 2070  .update_data = p
+00011ce0: 6172 7469 616c 285f 7570 6461 7465 5f64  artial(_update_d
+00011cf0: 6174 612c 204e 6f6e 652c 204e 6f6e 652c  ata, None, None,
+00011d00: 2069 7465 6d29 0d0a 2020 2020 6974 656d   item)..    item
+00011d10: 2e75 7064 6174 655f 6766 7820 3d20 7061  .update_gfx = pa
+00011d20: 7274 6961 6c28 5f75 7064 6174 655f 6766  rtial(_update_gf
+00011d30: 782c 2069 7465 6d29 0d0a 2020 2020 6178  x, item)..    ax
+00011d40: 2e61 6464 4974 656d 2869 7465 6d29 0d0a  .addItem(item)..
+00011d50: 2020 2020 6966 2061 782e 7662 2e76 5f7a      if ax.vb.v_z
+00011d60: 6f6f 6d5f 7363 616c 6520 3e20 302e 393a  oom_scale > 0.9:
+00011d70: 2023 2061 646a 7573 7420 746f 206d 616b   # adjust to mak
+00011d80: 6520 6869 2f6c 6f20 7465 7874 2066 6974  e hi/lo text fit
+00011d90: 0d0a 2020 2020 2020 2020 6178 2e76 622e  ..        ax.vb.
+00011da0: 765f 7a6f 6f6d 5f73 6361 6c65 203d 2030  v_zoom_scale = 0
+00011db0: 2e39 0d0a 2020 2020 7265 7475 726e 2069  .9..    return i
+00011dc0: 7465 6d0d 0a0d 0a0d 0a64 6566 206c 6976  tem......def liv
+00011dd0: 6528 706c 6f74 733d 3129 3a0d 0a20 2020  e(plots=1):..   
+00011de0: 2069 6620 706c 6f74 7320 3d3d 2031 3a0d   if plots == 1:.
+00011df0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011e00: 4c69 7665 2829 0d0a 2020 2020 7265 7475  Live()..    retu
+00011e10: 726e 205b 4c69 7665 2829 2066 6f72 205f  rn [Live() for _
+00011e20: 2069 6e20 7261 6e67 6528 706c 6f74 7329   in range(plots)
+00011e30: 5d0d 0a0d 0a0d 0a64 6566 2061 6464 5f6c  ]......def add_l
+00011e40: 6567 656e 6428 7465 7874 2c20 6178 3d4e  egend(text, ax=N
+00011e50: 6f6e 6529 3a0d 0a20 2020 2061 7820 3d20  one):..    ax = 
+00011e60: 5f63 7265 6174 655f 706c 6f74 2861 783d  _create_plot(ax=
+00011e70: 6178 2c20 6d61 7869 6d69 7a65 3d46 616c  ax, maximize=Fal
+00011e80: 7365 290d 0a20 2020 205f 6372 6561 7465  se)..    _create
+00011e90: 5f6c 6567 656e 6428 6178 290d 0a20 2020  _legend(ax)..   
+00011ea0: 2072 6f77 203d 2061 782e 6c65 6765 6e64   row = ax.legend
+00011eb0: 2e6c 6179 6f75 742e 726f 7743 6f75 6e74  .layout.rowCount
+00011ec0: 2829 0d0a 2020 2020 6c61 6265 6c20 3d20  ()..    label = 
+00011ed0: 7067 2e4c 6162 656c 4974 656d 2874 6578  pg.LabelItem(tex
+00011ee0: 742c 2063 6f6c 6f72 3d6c 6567 656e 645f  t, color=legend_
+00011ef0: 7465 7874 5f63 6f6c 6f72 2c20 6a75 7374  text_color, just
+00011f00: 6966 793d 276c 6566 7427 290d 0a20 2020  ify='left')..   
+00011f10: 2061 782e 6c65 6765 6e64 2e6c 6179 6f75   ax.legend.layou
+00011f20: 742e 6164 6449 7465 6d28 6c61 6265 6c2c  t.addItem(label,
+00011f30: 2072 6f77 2c20 302c 2031 2c20 3229 0d0a   row, 0, 1, 2)..
+00011f40: 2020 2020 7265 7475 726e 206c 6162 656c      return label
+00011f50: 0d0a 0d0a 0d0a 6465 6620 6669 6c6c 5f62  ......def fill_b
+00011f60: 6574 7765 656e 2870 6c6f 7430 2c20 706c  etween(plot0, pl
+00011f70: 6f74 312c 2063 6f6c 6f72 3d4e 6f6e 6529  ot1, color=None)
+00011f80: 3a0d 0a20 2020 2075 7365 645f 636f 6c6f  :..    used_colo
+00011f90: 7220 3d20 6272 6967 6874 656e 285f 6765  r = brighten(_ge
+00011fa0: 745f 636f 6c6f 7228 706c 6f74 302e 6178  t_color(plot0.ax
+00011fb0: 2c20 4e6f 6e65 2c20 636f 6c6f 7229 2c20  , None, color), 
+00011fc0: 312e 3329 0d0a 2020 2020 6974 656d 203d  1.3)..    item =
+00011fd0: 2070 672e 4669 6c6c 4265 7477 6565 6e49   pg.FillBetweenI
+00011fe0: 7465 6d28 706c 6f74 302c 2070 6c6f 7431  tem(plot0, plot1
+00011ff0: 2c20 6272 7573 683d 7067 2e6d 6b42 7275  , brush=pg.mkBru
+00012000: 7368 2875 7365 645f 636f 6c6f 7229 290d  sh(used_color)).
+00012010: 0a20 2020 2069 7465 6d2e 6178 203d 2070  .    item.ax = p
+00012020: 6c6f 7430 2e61 780d 0a20 2020 2069 7465  lot0.ax..    ite
+00012030: 6d2e 7365 745a 5661 6c75 6528 2d34 3029  m.setZValue(-40)
+00012040: 0d0a 2020 2020 6974 656d 2e61 782e 6164  ..    item.ax.ad
+00012050: 6449 7465 6d28 6974 656d 290d 0a20 2020  dItem(item)..   
+00012060: 2023 2055 676c 7920 6275 6720 6669 7820   # Ugly bug fix 
+00012070: 666f 7220 5079 5174 4772 6170 6820 6275  for PyQtGraph bu
+00012080: 6720 7768 6572 6520 646f 776e 7361 6d70  g where downsamp
+00012090: 6c65 642f 636c 6970 7065 6420 706c 6f74  led/clipped plot
+000120a0: 7320 6172 6520 7573 6564 2069 6e20 636f  s are used in co
+000120b0: 6e6a 756e 6374 696f 6e0d 0a20 2020 2023  njunction..    #
+000120c0: 2077 6974 6820 6669 6c6c 2062 6574 7765   with fill betwe
+000120d0: 656e 2e20 5468 6520 7265 6173 6f6e 2069  en. The reason i
+000120e0: 7320 7468 6174 2074 6865 2063 7572 7665  s that the curve
+000120f0: 7320 6f66 2074 6865 2064 6f77 6e73 616d  s of the downsam
+00012100: 706c 6564 2070 6c6f 7473 2061 7265 206f  pled plots are o
+00012110: 6e6c 790d 0a20 2020 2023 2063 616c 6375  nly..    # calcu
+00012120: 6c61 7465 6420 7768 656e 2073 686f 776e  lated when shown
+00012130: 2c20 6275 7420 6e6f 7420 7768 656e 2061  , but not when a
+00012140: 6464 6564 2074 6f20 7468 6520 6178 6973  dded to the axis
+00012150: 2e20 5765 2066 6978 2062 7920 7361 7969  . We fix by sayi
+00012160: 6e67 2074 6865 2070 6c6f 7420 6973 0d0a  ng the plot is..
+00012170: 2020 2020 2320 6368 616e 6765 6420 6576      # changed ev
+00012180: 6572 7920 7469 6d65 2074 6865 207a 6f6f  ery time the zoo
+00012190: 6d20 6973 2063 6861 6e67 6564 202d 2069  m is changed - i
+000121a0: 6e63 6c75 6469 6e67 2069 6e69 7469 616c  ncluding initial
+000121b0: 206c 6f61 642e 0d0a 2020 2020 6465 6620   load...    def 
+000121c0: 7570 6461 7465 5f66 696c 6c28 7662 293a  update_fill(vb):
+000121d0: 0d0a 2020 2020 2020 2020 706c 6f74 302e  ..        plot0.
+000121e0: 7369 6750 6c6f 7443 6861 6e67 6564 2e65  sigPlotChanged.e
+000121f0: 6d69 7428 706c 6f74 3029 0d0a 2020 2020  mit(plot0)..    
+00012200: 706c 6f74 302e 6178 2e76 622e 7a6f 6f6d  plot0.ax.vb.zoom
+00012210: 5f6c 6973 7465 6e65 7273 2e61 6464 2875  _listeners.add(u
+00012220: 7064 6174 655f 6669 6c6c 290d 0a20 2020  pdate_fill)..   
+00012230: 2072 6574 7572 6e20 6974 656d 0d0a 0d0a   return item....
+00012240: 0d0a 6465 6620 7365 745f 785f 706f 7328  ..def set_x_pos(
+00012250: 786d 696e 2c20 786d 6178 2c20 6178 3d4e  xmin, xmax, ax=N
+00012260: 6f6e 6529 3a0d 0a20 2020 2061 7820 3d20  one):..    ax = 
+00012270: 5f63 7265 6174 655f 706c 6f74 2861 783d  _create_plot(ax=
+00012280: 6178 2c20 6d61 7869 6d69 7a65 3d46 616c  ax, maximize=Fal
+00012290: 7365 290d 0a20 2020 2078 6964 7830 2c78  se)..    xidx0,x
+000122a0: 6964 7831 203d 205f 7064 7469 6d65 3269  idx1 = _pdtime2i
+000122b0: 6e64 6578 2861 782c 2070 642e 5365 7269  ndex(ax, pd.Seri
+000122c0: 6573 285b 786d 696e 2c20 786d 6178 5d29  es([xmin, xmax])
+000122d0: 290d 0a20 2020 2061 782e 7662 2e75 7064  )..    ax.vb.upd
+000122e0: 6174 655f 795f 7a6f 6f6d 2878 6964 7830  ate_y_zoom(xidx0
+000122f0: 2c20 7869 6478 3129 0d0a 2020 2020 5f72  , xidx1)..    _r
+00012300: 6570 6169 6e74 5f63 616e 646c 6573 2829  epaint_candles()
+00012310: 0d0a 0d0a 0d0a 6465 6620 7365 745f 795f  ......def set_y_
+00012320: 7261 6e67 6528 796d 696e 2c20 796d 6178  range(ymin, ymax
+00012330: 2c20 6178 3d4e 6f6e 6529 3a0d 0a20 2020  , ax=None):..   
+00012340: 2061 7820 3d20 5f63 7265 6174 655f 706c   ax = _create_pl
+00012350: 6f74 2861 783d 6178 2c20 6d61 7869 6d69  ot(ax=ax, maximi
+00012360: 7a65 3d46 616c 7365 290d 0a20 2020 2061  ze=False)..    a
+00012370: 782e 7365 744c 696d 6974 7328 794d 696e  x.setLimits(yMin
+00012380: 3d79 6d69 6e2c 2079 4d61 783d 796d 6178  =ymin, yMax=ymax
+00012390: 290d 0a20 2020 2061 782e 7662 2e76 5f61  )..    ax.vb.v_a
+000123a0: 7574 6f7a 6f6f 6d20 3d20 4661 6c73 650d  utozoom = False.
+000123b0: 0a20 2020 2061 782e 7662 2e73 6574 5f72  .    ax.vb.set_r
+000123c0: 616e 6765 284e 6f6e 652c 2079 6d69 6e2c  ange(None, ymin,
+000123d0: 204e 6f6e 652c 2079 6d61 7829 0d0a 0d0a   None, ymax)....
+000123e0: 0d0a 6465 6620 7365 745f 795f 7363 616c  ..def set_y_scal
+000123f0: 6528 7973 6361 6c65 3d27 6c69 6e65 6172  e(yscale='linear
+00012400: 272c 2061 783d 4e6f 6e65 293a 0d0a 2020  ', ax=None):..  
+00012410: 2020 6178 203d 205f 6372 6561 7465 5f70    ax = _create_p
+00012420: 6c6f 7428 6178 3d61 782c 206d 6178 696d  lot(ax=ax, maxim
+00012430: 697a 653d 4661 6c73 6529 0d0a 2020 2020  ize=False)..    
+00012440: 6178 2e73 6574 4c6f 674d 6f64 6528 793d  ax.setLogMode(y=
+00012450: 2879 7363 616c 653d 3d27 6c6f 6727 2929  (yscale=='log'))
+00012460: 0d0a 2020 2020 6178 2e76 622e 7973 6361  ..    ax.vb.ysca
+00012470: 6c65 203d 2059 5363 616c 6528 7973 6361  le = YScale(ysca
+00012480: 6c65 2c20 6178 2e76 622e 7973 6361 6c65  le, ax.vb.yscale
+00012490: 2e73 6361 6c65 6629 0d0a 0d0a 0d0a 6465  .scalef)......de
+000124a0: 6620 6164 645f 6261 6e64 2879 302c 2079  f add_band(y0, y
+000124b0: 312c 2063 6f6c 6f72 3d62 616e 645f 636f  1, color=band_co
+000124c0: 6c6f 722c 2061 783d 4e6f 6e65 293a 0d0a  lor, ax=None):..
+000124d0: 2020 2020 7072 696e 7428 2761 6464 5f62      print('add_b
+000124e0: 616e 6428 2920 6973 2064 6570 7265 6361  and() is depreca
+000124f0: 7465 642c 2075 7365 2061 6464 5f68 6f72  ted, use add_hor
+00012500: 697a 6f6e 7461 6c5f 6261 6e64 2829 2069  izontal_band() i
+00012510: 6e73 7465 6164 2e27 290d 0a20 2020 2072  nstead.')..    r
+00012520: 6574 7572 6e20 6164 645f 686f 7269 7a6f  eturn add_horizo
+00012530: 6e74 616c 5f62 616e 6428 7930 2c20 7931  ntal_band(y0, y1
+00012540: 2c20 636f 6c6f 722c 2061 7829 0d0a 0d0a  , color, ax)....
+00012550: 0d0a 6465 6620 6164 645f 686f 7269 7a6f  ..def add_horizo
+00012560: 6e74 616c 5f62 616e 6428 7930 2c20 7931  ntal_band(y0, y1
+00012570: 2c20 636f 6c6f 723d 6261 6e64 5f63 6f6c  , color=band_col
+00012580: 6f72 2c20 6178 3d4e 6f6e 6529 3a0d 0a20  or, ax=None):.. 
+00012590: 2020 2061 7820 3d20 5f63 7265 6174 655f     ax = _create_
+000125a0: 706c 6f74 2861 783d 6178 2c20 6d61 7869  plot(ax=ax, maxi
+000125b0: 6d69 7a65 3d46 616c 7365 290d 0a20 2020  mize=False)..   
+000125c0: 2063 6f6c 6f72 203d 205f 6765 745f 636f   color = _get_co
+000125d0: 6c6f 7228 6178 2c20 4e6f 6e65 2c20 636f  lor(ax, None, co
+000125e0: 6c6f 7229 0d0a 2020 2020 6978 203d 2061  lor)..    ix = a
+000125f0: 782e 7662 2e79 7363 616c 652e 696e 7678  x.vb.yscale.invx
+00012600: 666f 726d 0d0a 2020 2020 6c72 203d 2070  form..    lr = p
+00012610: 672e 4c69 6e65 6172 5265 6769 6f6e 4974  g.LinearRegionIt
+00012620: 656d 285b 6978 2879 3029 2c69 7828 7931  em([ix(y0),ix(y1
+00012630: 295d 2c20 6f72 6965 6e74 6174 696f 6e3d  )], orientation=
+00012640: 7067 2e4c 696e 6561 7252 6567 696f 6e49  pg.LinearRegionI
+00012650: 7465 6d2e 486f 7269 7a6f 6e74 616c 2c20  tem.Horizontal, 
+00012660: 6272 7573 683d 7067 2e6d 6b42 7275 7368  brush=pg.mkBrush
+00012670: 2863 6f6c 6f72 292c 206d 6f76 6162 6c65  (color), movable
+00012680: 3d46 616c 7365 290d 0a20 2020 206c 722e  =False)..    lr.
+00012690: 6c69 6e65 735b 305d 2e73 6574 5065 6e28  lines[0].setPen(
+000126a0: 7067 2e6d 6b50 656e 284e 6f6e 6529 290d  pg.mkPen(None)).
+000126b0: 0a20 2020 206c 722e 6c69 6e65 735b 315d  .    lr.lines[1]
+000126c0: 2e73 6574 5065 6e28 7067 2e6d 6b50 656e  .setPen(pg.mkPen
+000126d0: 284e 6f6e 6529 290d 0a20 2020 206c 722e  (None))..    lr.
+000126e0: 7365 745a 5661 6c75 6528 2d35 3029 0d0a  setZValue(-50)..
+000126f0: 2020 2020 6c72 2e61 7820 3d20 6178 0d0a      lr.ax = ax..
+00012700: 2020 2020 6178 2e61 6464 4974 656d 286c      ax.addItem(l
+00012710: 7229 0d0a 2020 2020 7265 7475 726e 206c  r)..    return l
+00012720: 720d 0a0d 0a0d 0a64 6566 2061 6464 5f76  r......def add_v
+00012730: 6572 7469 6361 6c5f 6261 6e64 2878 302c  ertical_band(x0,
+00012740: 2078 312c 2063 6f6c 6f72 3d62 616e 645f   x1, color=band_
+00012750: 636f 6c6f 722c 2061 783d 4e6f 6e65 293a  color, ax=None):
+00012760: 0d0a 2020 2020 6178 203d 205f 6372 6561  ..    ax = _crea
+00012770: 7465 5f70 6c6f 7428 6178 3d61 782c 206d  te_plot(ax=ax, m
+00012780: 6178 696d 697a 653d 4661 6c73 6529 0d0a  aximize=False)..
+00012790: 2020 2020 785f 7074 7320 3d20 5f70 6474      x_pts = _pdt
+000127a0: 696d 6532 696e 6465 7828 6178 2c20 7064  ime2index(ax, pd
+000127b0: 2e53 6572 6965 7328 5b78 302c 2078 315d  .Series([x0, x1]
+000127c0: 2929 0d0a 2020 2020 636f 6c6f 7220 3d20  ))..    color = 
+000127d0: 5f67 6574 5f63 6f6c 6f72 2861 782c 204e  _get_color(ax, N
+000127e0: 6f6e 652c 2063 6f6c 6f72 290d 0a20 2020  one, color)..   
+000127f0: 206c 7220 3d20 7067 2e4c 696e 6561 7252   lr = pg.LinearR
+00012800: 6567 696f 6e49 7465 6d28 5b78 5f70 7473  egionItem([x_pts
+00012810: 5b30 5d2c 785f 7074 735b 315d 5d2c 206f  [0],x_pts[1]], o
+00012820: 7269 656e 7461 7469 6f6e 3d70 672e 4c69  rientation=pg.Li
+00012830: 6e65 6172 5265 6769 6f6e 4974 656d 2e56  nearRegionItem.V
+00012840: 6572 7469 6361 6c2c 2062 7275 7368 3d70  ertical, brush=p
+00012850: 672e 6d6b 4272 7573 6828 636f 6c6f 7229  g.mkBrush(color)
+00012860: 2c20 6d6f 7661 626c 653d 4661 6c73 6529  , movable=False)
+00012870: 0d0a 2020 2020 6c72 2e6c 696e 6573 5b30  ..    lr.lines[0
+00012880: 5d2e 7365 7450 656e 2870 672e 6d6b 5065  ].setPen(pg.mkPe
+00012890: 6e28 4e6f 6e65 2929 0d0a 2020 2020 6c72  n(None))..    lr
+000128a0: 2e6c 696e 6573 5b31 5d2e 7365 7450 656e  .lines[1].setPen
+000128b0: 2870 672e 6d6b 5065 6e28 4e6f 6e65 2929  (pg.mkPen(None))
+000128c0: 0d0a 2020 2020 6c72 2e73 6574 5a56 616c  ..    lr.setZVal
+000128d0: 7565 282d 3530 290d 0a20 2020 206c 722e  ue(-50)..    lr.
+000128e0: 6178 203d 2061 780d 0a20 2020 2061 782e  ax = ax..    ax.
+000128f0: 6164 6449 7465 6d28 6c72 290d 0a20 2020  addItem(lr)..   
+00012900: 2072 6574 7572 6e20 6c72 0d0a 0d0a 0d0a   return lr......
+00012910: 6465 6620 6164 645f 7265 6374 2870 302c  def add_rect(p0,
+00012920: 2070 312c 2063 6f6c 6f72 3d62 616e 645f   p1, color=band_
+00012930: 636f 6c6f 722c 2069 6e74 6572 6163 7469  color, interacti
+00012940: 7665 3d46 616c 7365 2c20 6178 3d4e 6f6e  ve=False, ax=Non
+00012950: 6529 3a0d 0a20 2020 2061 7820 3d20 5f63  e):..    ax = _c
+00012960: 7265 6174 655f 706c 6f74 2861 783d 6178  reate_plot(ax=ax
+00012970: 2c20 6d61 7869 6d69 7a65 3d46 616c 7365  , maximize=False
+00012980: 290d 0a20 2020 2078 5f70 7473 203d 205f  )..    x_pts = _
+00012990: 7064 7469 6d65 3269 6e64 6578 2861 782c  pdtime2index(ax,
+000129a0: 2070 642e 5365 7269 6573 285b 7030 5b30   pd.Series([p0[0
+000129b0: 5d2c 2070 315b 305d 5d29 290d 0a20 2020  ], p1[0]]))..   
+000129c0: 2069 7820 3d20 6178 2e76 622e 7973 6361   ix = ax.vb.ysca
+000129d0: 6c65 2e69 6e76 7866 6f72 6d0d 0a20 2020  le.invxform..   
+000129e0: 2079 302c 7931 203d 2073 6f72 7465 6428   y0,y1 = sorted(
+000129f0: 5b70 305b 315d 2c20 7031 5b31 5d5d 290d  [p0[1], p1[1]]).
+00012a00: 0a20 2020 2070 6f73 2020 3d20 2878 5f70  .    pos  = (x_p
+00012a10: 7473 5b30 5d2c 2069 7828 7930 2929 0d0a  ts[0], ix(y0))..
+00012a20: 2020 2020 7369 7a65 203d 2028 785f 7074      size = (x_pt
+00012a30: 735b 315d 2d70 6f73 5b30 5d2c 2069 7828  s[1]-pos[0], ix(
+00012a40: 7931 292d 6978 2879 3029 290d 0a20 2020  y1)-ix(y0))..   
+00012a50: 2072 6563 7420 3d20 4669 6e52 6563 7428   rect = FinRect(
+00012a60: 6178 3d61 782c 2062 7275 7368 3d70 672e  ax=ax, brush=pg.
+00012a70: 6d6b 4272 7573 6828 636f 6c6f 7229 2c20  mkBrush(color), 
+00012a80: 706f 733d 706f 732c 2073 697a 653d 7369  pos=pos, size=si
+00012a90: 7a65 2c20 6d6f 7661 626c 653d 696e 7465  ze, movable=inte
+00012aa0: 7261 6374 6976 652c 2072 6573 697a 6162  ractive, resizab
+00012ab0: 6c65 3d69 6e74 6572 6163 7469 7665 2c20  le=interactive, 
+00012ac0: 726f 7461 7461 626c 653d 4661 6c73 6529  rotatable=False)
+00012ad0: 0d0a 2020 2020 7265 6374 2e73 6574 5a56  ..    rect.setZV
+00012ae0: 616c 7565 282d 3430 290d 0a20 2020 2069  alue(-40)..    i
+00012af0: 6620 696e 7465 7261 6374 6976 653a 0d0a  f interactive:..
+00012b00: 2020 2020 2020 2020 6178 2e76 622e 726f          ax.vb.ro
+00012b10: 6973 2e61 7070 656e 6428 7265 6374 290d  is.append(rect).
+00012b20: 0a20 2020 2072 6563 742e 6178 203d 2061  .    rect.ax = a
+00012b30: 780d 0a20 2020 2061 782e 6164 6449 7465  x..    ax.addIte
+00012b40: 6d28 7265 6374 290d 0a20 2020 2072 6574  m(rect)..    ret
+00012b50: 7572 6e20 7265 6374 0d0a 0d0a 0d0a 6465  urn rect......de
+00012b60: 6620 6164 645f 6c69 6e65 2870 302c 2070  f add_line(p0, p
+00012b70: 312c 2063 6f6c 6f72 3d64 7261 775f 6c69  1, color=draw_li
+00012b80: 6e65 5f63 6f6c 6f72 2c20 7769 6474 683d  ne_color, width=
+00012b90: 312c 2073 7479 6c65 3d4e 6f6e 652c 2069  1, style=None, i
+00012ba0: 6e74 6572 6163 7469 7665 3d46 616c 7365  nteractive=False
+00012bb0: 2c20 6178 3d4e 6f6e 6529 3a0d 0a20 2020  , ax=None):..   
+00012bc0: 2061 7820 3d20 5f63 7265 6174 655f 706c   ax = _create_pl
+00012bd0: 6f74 2861 783d 6178 2c20 6d61 7869 6d69  ot(ax=ax, maximi
+00012be0: 7a65 3d46 616c 7365 290d 0a20 2020 2075  ze=False)..    u
+00012bf0: 7365 645f 636f 6c6f 7220 3d20 5f67 6574  sed_color = _get
+00012c00: 5f63 6f6c 6f72 2861 782c 2073 7479 6c65  _color(ax, style
+00012c10: 2c20 636f 6c6f 7229 0d0a 2020 2020 7065  , color)..    pe
+00012c20: 6e20 3d20 5f6d 616b 6570 656e 2863 6f6c  n = _makepen(col
+00012c30: 6f72 3d75 7365 645f 636f 6c6f 722c 2073  or=used_color, s
+00012c40: 7479 6c65 3d73 7479 6c65 2c20 7769 6474  tyle=style, widt
+00012c50: 683d 7769 6474 6829 0d0a 2020 2020 785f  h=width)..    x_
+00012c60: 7074 7320 3d20 5f70 6474 696d 6532 696e  pts = _pdtime2in
+00012c70: 6465 7828 6178 2c20 7064 2e53 6572 6965  dex(ax, pd.Serie
+00012c80: 7328 5b70 305b 305d 2c20 7031 5b30 5d5d  s([p0[0], p1[0]]
+00012c90: 2929 0d0a 2020 2020 6978 203d 2061 782e  ))..    ix = ax.
+00012ca0: 7662 2e79 7363 616c 652e 696e 7678 666f  vb.yscale.invxfo
+00012cb0: 726d 0d0a 2020 2020 7074 7320 3d20 5b28  rm..    pts = [(
+00012cc0: 785f 7074 735b 305d 2c20 6978 2870 305b  x_pts[0], ix(p0[
+00012cd0: 315d 2929 2c20 2878 5f70 7473 5b31 5d2c  1])), (x_pts[1],
+00012ce0: 2069 7828 7031 5b31 5d29 295d 0d0a 2020   ix(p1[1]))]..  
+00012cf0: 2020 6966 2069 6e74 6572 6163 7469 7665    if interactive
+00012d00: 3a0d 0a20 2020 2020 2020 206c 696e 6520  :..        line 
+00012d10: 3d20 5f63 7265 6174 655f 706f 6c79 5f6c  = _create_poly_l
+00012d20: 696e 6528 6178 2e76 622c 2070 7473 2c20  ine(ax.vb, pts, 
+00012d30: 636c 6f73 6564 3d46 616c 7365 2c20 7065  closed=False, pe
+00012d40: 6e3d 7065 6e2c 206d 6f76 6162 6c65 3d46  n=pen, movable=F
+00012d50: 616c 7365 290d 0a20 2020 2020 2020 2061  alse)..        a
+00012d60: 782e 7662 2e72 6f69 732e 6170 7065 6e64  x.vb.rois.append
+00012d70: 286c 696e 6529 0d0a 2020 2020 656c 7365  (line)..    else
+00012d80: 3a0d 0a20 2020 2020 2020 206c 696e 6520  :..        line 
+00012d90: 3d20 4669 6e4c 696e 6528 7074 732c 2070  = FinLine(pts, p
+00012da0: 656e 3d70 656e 290d 0a20 2020 206c 696e  en=pen)..    lin
+00012db0: 652e 6178 203d 2061 780d 0a20 2020 2061  e.ax = ax..    a
+00012dc0: 782e 6164 6449 7465 6d28 6c69 6e65 290d  x.addItem(line).
+00012dd0: 0a20 2020 2072 6574 7572 6e20 6c69 6e65  .    return line
+00012de0: 0d0a 0d0a 0d0a 6465 6620 6164 645f 7465  ......def add_te
+00012df0: 7874 2870 6f73 2c20 732c 2063 6f6c 6f72  xt(pos, s, color
+00012e00: 3d64 7261 775f 6c69 6e65 5f63 6f6c 6f72  =draw_line_color
+00012e10: 2c20 616e 6368 6f72 3d28 302c 3029 2c20  , anchor=(0,0), 
+00012e20: 6178 3d4e 6f6e 6529 3a0d 0a20 2020 2061  ax=None):..    a
+00012e30: 7820 3d20 5f63 7265 6174 655f 706c 6f74  x = _create_plot
+00012e40: 2861 783d 6178 2c20 6d61 7869 6d69 7a65  (ax=ax, maximize
+00012e50: 3d46 616c 7365 290d 0a20 2020 2063 6f6c  =False)..    col
+00012e60: 6f72 203d 205f 6765 745f 636f 6c6f 7228  or = _get_color(
+00012e70: 6178 2c20 4e6f 6e65 2c20 636f 6c6f 7229  ax, None, color)
+00012e80: 0d0a 2020 2020 7465 7874 203d 2070 672e  ..    text = pg.
+00012e90: 5465 7874 4974 656d 2873 2c20 636f 6c6f  TextItem(s, colo
+00012ea0: 723d 636f 6c6f 722c 2061 6e63 686f 723d  r=color, anchor=
+00012eb0: 616e 6368 6f72 290d 0a20 2020 2078 203d  anchor)..    x =
+00012ec0: 2070 6f73 5b30 5d0d 0a20 2020 2069 6620   pos[0]..    if 
+00012ed0: 6178 2e76 622e 6461 7461 7372 6320 6973  ax.vb.datasrc is
+00012ee0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00012ef0: 2020 2020 7820 3d20 5f70 6474 696d 6532      x = _pdtime2
+00012f00: 696e 6465 7828 6178 2c20 7064 2e53 6572  index(ax, pd.Ser
+00012f10: 6965 7328 5b70 6f73 5b30 5d5d 2929 5b30  ies([pos[0]]))[0
+00012f20: 5d0d 0a20 2020 2079 203d 2061 782e 7662  ]..    y = ax.vb
+00012f30: 2e79 7363 616c 652e 696e 7678 666f 726d  .yscale.invxform
+00012f40: 2870 6f73 5b31 5d29 0d0a 2020 2020 7465  (pos[1])..    te
+00012f50: 7874 2e73 6574 506f 7328 782c 2079 290d  xt.setPos(x, y).
+00012f60: 0a20 2020 2074 6578 742e 7365 745a 5661  .    text.setZVa
+00012f70: 6c75 6528 3530 290d 0a20 2020 2074 6578  lue(50)..    tex
+00012f80: 742e 6178 203d 2061 780d 0a20 2020 2061  t.ax = ax..    a
+00012f90: 782e 6164 6449 7465 6d28 7465 7874 2c20  x.addItem(text, 
+00012fa0: 6967 6e6f 7265 426f 756e 6473 3d54 7275  ignoreBounds=Tru
+00012fb0: 6529 0d0a 2020 2020 7265 7475 726e 2074  e)..    return t
+00012fc0: 6578 740d 0a0d 0a0d 0a64 6566 2072 656d  ext......def rem
+00012fd0: 6f76 655f 6c69 6e65 286c 696e 6529 3a0d  ove_line(line):.
+00012fe0: 0a20 2020 2070 7269 6e74 2827 7265 6d6f  .    print('remo
+00012ff0: 7665 5f6c 696e 6528 2920 6973 2064 6570  ve_line() is dep
+00013000: 7265 6361 7465 642c 2075 7365 2072 656d  recated, use rem
+00013010: 6f76 655f 7072 696d 6974 6976 6528 2920  ove_primitive() 
+00013020: 696e 7374 6561 6427 290d 0a20 2020 2072  instead')..    r
+00013030: 656d 6f76 655f 7072 696d 6974 6976 6528  emove_primitive(
+00013040: 6c69 6e65 290d 0a0d 0a0d 0a64 6566 2072  line)......def r
+00013050: 656d 6f76 655f 7465 7874 2874 6578 7429  emove_text(text)
+00013060: 3a0d 0a20 2020 2070 7269 6e74 2827 7265  :..    print('re
+00013070: 6d6f 7665 5f74 6578 7428 2920 6973 2064  move_text() is d
+00013080: 6570 7265 6361 7465 642c 2075 7365 2072  eprecated, use r
+00013090: 656d 6f76 655f 7072 696d 6974 6976 6528  emove_primitive(
+000130a0: 2920 696e 7374 6561 6427 290d 0a20 2020  ) instead')..   
+000130b0: 2072 656d 6f76 655f 7072 696d 6974 6976   remove_primitiv
+000130c0: 6528 7465 7874 290d 0a0d 0a0d 0a64 6566  e(text)......def
+000130d0: 2072 656d 6f76 655f 7072 696d 6974 6976   remove_primitiv
+000130e0: 6528 7072 696d 6974 6976 6529 3a0d 0a20  e(primitive):.. 
+000130f0: 2020 2061 7820 3d20 7072 696d 6974 6976     ax = primitiv
+00013100: 652e 6178 0d0a 2020 2020 6178 2e72 656d  e.ax..    ax.rem
+00013110: 6f76 6549 7465 6d28 7072 696d 6974 6976  oveItem(primitiv
+00013120: 6529 0d0a 2020 2020 6966 2070 7269 6d69  e)..    if primi
+00013130: 7469 7665 2069 6e20 6178 2e76 622e 726f  tive in ax.vb.ro
+00013140: 6973 3a0d 0a20 2020 2020 2020 2061 782e  is:..        ax.
+00013150: 7662 2e72 6f69 732e 7265 6d6f 7665 2870  vb.rois.remove(p
+00013160: 7269 6d69 7469 7665 290d 0a20 2020 2069  rimitive)..    i
+00013170: 6620 6861 7361 7474 7228 7072 696d 6974  f hasattr(primit
+00013180: 6976 652c 2027 7465 7874 7327 293a 0d0a  ive, 'texts'):..
+00013190: 2020 2020 2020 2020 666f 7220 7478 7420          for txt 
+000131a0: 696e 2070 7269 6d69 7469 7665 2e74 6578  in primitive.tex
+000131b0: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
+000131c0: 2061 782e 7662 2e72 656d 6f76 6549 7465   ax.vb.removeIte
+000131d0: 6d28 7478 7429 0d0a 0d0a 0d0a 6465 6620  m(txt)......def 
+000131e0: 7365 745f 6d6f 7573 655f 6361 6c6c 6261  set_mouse_callba
+000131f0: 636b 2863 616c 6c62 6163 6b2c 2061 783d  ck(callback, ax=
+00013200: 4e6f 6e65 2c20 7768 656e 3d27 636c 6963  None, when='clic
+00013210: 6b27 293a 0d0a 2020 2020 2727 2743 616c  k'):..    '''Cal
+00013220: 6c62 6163 6b20 7768 656e 2063 6c69 636b  lback when click
+00013230: 6564 206c 696b 6520 736f 3a20 6361 6c6c  ed like so: call
+00013240: 6261 636b 2878 2c20 7929 2e27 2727 0d0a  back(x, y).'''..
+00013250: 2020 2020 6178 203d 2061 7820 6966 2061      ax = ax if a
+00013260: 7820 656c 7365 206c 6173 745f 6178 0d0a  x else last_ax..
+00013270: 2020 2020 6d61 7374 6572 203d 2061 782e      master = ax.
+00013280: 6178 5f77 6964 6765 7420 6966 2068 6173  ax_widget if has
+00013290: 6174 7472 2861 782c 2027 6178 5f77 6964  attr(ax, 'ax_wid
+000132a0: 6765 7427 2920 656c 7365 2061 782e 7662  get') else ax.vb
+000132b0: 2e77 696e 0d0a 2020 2020 6966 2077 6865  .win..    if whe
+000132c0: 6e20 3d3d 2027 686f 7665 7227 3a0d 0a20  n == 'hover':.. 
+000132d0: 2020 2020 2020 206d 6173 7465 722e 7072         master.pr
+000132e0: 6f78 795f 686f 7665 7220 3d20 7067 2e53  oxy_hover = pg.S
+000132f0: 6967 6e61 6c50 726f 7879 286d 6173 7465  ignalProxy(maste
+00013300: 722e 7363 656e 6528 292e 7369 674d 6f75  r.scene().sigMou
+00013310: 7365 4d6f 7665 642c 2072 6174 654c 696d  seMoved, rateLim
+00013320: 6974 3d31 352c 2073 6c6f 743d 7061 7274  it=15, slot=part
+00013330: 6961 6c28 5f6d 6361 6c6c 6261 636b 5f70  ial(_mcallback_p
+00013340: 6f73 2c20 6178 2c20 6361 6c6c 6261 636b  os, ax, callback
+00013350: 2929 0d0a 2020 2020 656c 6966 2077 6865  ))..    elif whe
+00013360: 6e20 696e 2028 2764 636c 6963 6b27 2c20  n in ('dclick', 
+00013370: 2764 6f75 626c 652d 636c 6963 6b27 293a  'double-click'):
+00013380: 0d0a 2020 2020 2020 2020 6d61 7374 6572  ..        master
+00013390: 2e70 726f 7879 5f64 636c 6963 6b20 3d20  .proxy_dclick = 
+000133a0: 7067 2e53 6967 6e61 6c50 726f 7879 286d  pg.SignalProxy(m
+000133b0: 6173 7465 722e 7363 656e 6528 292e 7369  aster.scene().si
+000133c0: 674d 6f75 7365 436c 6963 6b65 642c 2073  gMouseClicked, s
+000133d0: 6c6f 743d 7061 7274 6961 6c28 5f6d 6361  lot=partial(_mca
+000133e0: 6c6c 6261 636b 5f63 6c69 636b 2c20 6178  llback_click, ax
+000133f0: 2c20 6361 6c6c 6261 636b 2c20 2764 636c  , callback, 'dcl
+00013400: 6963 6b27 2929 0d0a 2020 2020 656c 6966  ick'))..    elif
+00013410: 2077 6865 6e20 696e 2028 2763 6c69 636b   when in ('click
+00013420: 272c 2027 6c63 6c69 636b 2729 3a0d 0a20  ', 'lclick'):.. 
+00013430: 2020 2020 2020 206d 6173 7465 722e 7072         master.pr
+00013440: 6f78 795f 636c 6963 6b20 3d20 7067 2e53  oxy_click = pg.S
+00013450: 6967 6e61 6c50 726f 7879 286d 6173 7465  ignalProxy(maste
+00013460: 722e 7363 656e 6528 292e 7369 674d 6f75  r.scene().sigMou
+00013470: 7365 436c 6963 6b65 642c 2073 6c6f 743d  seClicked, slot=
+00013480: 7061 7274 6961 6c28 5f6d 6361 6c6c 6261  partial(_mcallba
+00013490: 636b 5f63 6c69 636b 2c20 6178 2c20 6361  ck_click, ax, ca
+000134a0: 6c6c 6261 636b 2c20 276c 636c 6963 6b27  llback, 'lclick'
+000134b0: 2929 0d0a 2020 2020 656c 6966 2077 6865  ))..    elif whe
+000134c0: 6e20 696e 2028 276d 636c 6963 6b27 2c29  n in ('mclick',)
+000134d0: 3a0d 0a20 2020 2020 2020 206d 6173 7465  :..        maste
+000134e0: 722e 7072 6f78 795f 636c 6963 6b20 3d20  r.proxy_click = 
+000134f0: 7067 2e53 6967 6e61 6c50 726f 7879 286d  pg.SignalProxy(m
+00013500: 6173 7465 722e 7363 656e 6528 292e 7369  aster.scene().si
+00013510: 674d 6f75 7365 436c 6963 6b65 642c 2073  gMouseClicked, s
+00013520: 6c6f 743d 7061 7274 6961 6c28 5f6d 6361  lot=partial(_mca
+00013530: 6c6c 6261 636b 5f63 6c69 636b 2c20 6178  llback_click, ax
+00013540: 2c20 6361 6c6c 6261 636b 2c20 276d 636c  , callback, 'mcl
+00013550: 6963 6b27 2929 0d0a 2020 2020 656c 6966  ick'))..    elif
+00013560: 2077 6865 6e20 696e 2028 2772 636c 6963   when in ('rclic
+00013570: 6b27 2c29 3a0d 0a20 2020 2020 2020 206d  k',):..        m
+00013580: 6173 7465 722e 7072 6f78 795f 636c 6963  aster.proxy_clic
+00013590: 6b20 3d20 7067 2e53 6967 6e61 6c50 726f  k = pg.SignalPro
+000135a0: 7879 286d 6173 7465 722e 7363 656e 6528  xy(master.scene(
+000135b0: 292e 7369 674d 6f75 7365 436c 6963 6b65  ).sigMouseClicke
+000135c0: 642c 2073 6c6f 743d 7061 7274 6961 6c28  d, slot=partial(
+000135d0: 5f6d 6361 6c6c 6261 636b 5f63 6c69 636b  _mcallback_click
+000135e0: 2c20 6178 2c20 6361 6c6c 6261 636b 2c20  , ax, callback, 
+000135f0: 2772 636c 6963 6b27 2929 0d0a 2020 2020  'rclick'))..    
+00013600: 656c 6966 2077 6865 6e20 696e 2028 2761  elif when in ('a
+00013610: 6e79 272c 293a 0d0a 2020 2020 2020 2020  ny',):..        
+00013620: 6d61 7374 6572 2e70 726f 7879 5f63 6c69  master.proxy_cli
+00013630: 636b 203d 2070 672e 5369 676e 616c 5072  ck = pg.SignalPr
+00013640: 6f78 7928 6d61 7374 6572 2e73 6365 6e65  oxy(master.scene
+00013650: 2829 2e73 6967 4d6f 7573 6543 6c69 636b  ().sigMouseClick
+00013660: 6564 2c20 736c 6f74 3d70 6172 7469 616c  ed, slot=partial
+00013670: 285f 6d63 616c 6c62 6163 6b5f 636c 6963  (_mcallback_clic
+00013680: 6b2c 2061 782c 2063 616c 6c62 6163 6b2c  k, ax, callback,
+00013690: 2027 616e 7927 2929 0d0a 2020 2020 656c   'any'))..    el
+000136a0: 7365 3a0d 0a20 2020 2020 2020 2070 7269  se:..        pri
+000136b0: 6e74 2866 2757 6172 6e69 6e67 3a20 756e  nt(f'Warning: un
+000136c0: 6b6e 6f77 6e20 636c 6963 6b20 227b 7768  known click "{wh
+000136d0: 656e 7d22 2073 656e 7420 746f 2073 6574  en}" sent to set
+000136e0: 5f6d 6f75 7365 5f63 616c 6c62 6163 6b28  _mouse_callback(
+000136f0: 2927 290d 0a0d 0a0d 0a64 6566 2073 6574  )')......def set
+00013700: 5f74 696d 655f 696e 7370 6563 746f 7228  _time_inspector(
+00013710: 6361 6c6c 6261 636b 2c20 6178 3d4e 6f6e  callback, ax=Non
+00013720: 652c 2077 6865 6e3d 2763 6c69 636b 2729  e, when='click')
+00013730: 3a0d 0a20 2020 2070 7269 6e74 2827 5761  :..    print('Wa
+00013740: 726e 696e 673a 2073 6574 5f74 696d 655f  rning: set_time_
+00013750: 696e 7370 6563 746f 7228 2920 6973 2061  inspector() is a
+00013760: 206d 6973 6e6f 6d65 7220 6672 6f6d 206f   misnomer from o
+00013770: 6c64 656e 2064 6179 732e 2050 6c65 6173  lden days. Pleas
+00013780: 6520 7573 6520 7365 745f 6d6f 7573 655f  e use set_mouse_
+00013790: 6361 6c6c 6261 636b 2829 2069 6e73 7465  callback() inste
+000137a0: 6164 2e27 290d 0a20 2020 2073 6574 5f6d  ad.')..    set_m
+000137b0: 6f75 7365 5f63 616c 6c62 6163 6b28 6361  ouse_callback(ca
+000137c0: 6c6c 6261 636b 2c20 6178 2c20 7768 656e  llback, ax, when
+000137d0: 290d 0a0d 0a0d 0a64 6566 2061 6464 5f63  )......def add_c
+000137e0: 726f 7373 6861 6972 5f69 6e66 6f28 696e  rosshair_info(in
+000137f0: 666f 6675 6e63 2c20 6178 3d4e 6f6e 6529  fofunc, ax=None)
+00013800: 3a0d 0a20 2020 2027 2727 4361 6c6c 6261  :..    '''Callba
+00013810: 636b 2077 6865 6e20 6372 6f73 7368 6169  ck when crosshai
+00013820: 7220 7570 6461 7465 6420 6c69 6b65 2073  r updated like s
+00013830: 6f3a 2069 6e66 6f28 6178 2c78 2c79 2c78  o: info(ax,x,y,x
+00013840: 7465 7874 2c79 7465 7874 293b 2074 6865  text,ytext); the
+00013850: 2069 6e66 6f28 290d 0a20 2020 2020 2020   info()..       
+00013860: 6361 6c6c 6261 636b 206d 7573 7420 7265  callback must re
+00013870: 7475 726e 2074 776f 2076 616c 7565 733a  turn two values:
+00013880: 2078 7465 7874 2061 6e64 2079 7465 7874   xtext and ytext
+00013890: 2e27 2727 0d0a 2020 2020 6178 203d 205f  .'''..    ax = _
+000138a0: 6372 6561 7465 5f70 6c6f 7428 6178 3d61  create_plot(ax=a
+000138b0: 782c 206d 6178 696d 697a 653d 4661 6c73  x, maximize=Fals
+000138c0: 6529 0d0a 2020 2020 6178 2e63 726f 7373  e)..    ax.cross
+000138d0: 6861 6972 2e69 6e66 6f73 2e61 7070 656e  hair.infos.appen
+000138e0: 6428 696e 666f 6675 6e63 290d 0a0d 0a0d  d(infofunc).....
+000138f0: 0a64 6566 2074 696d 6572 5f63 616c 6c62  .def timer_callb
+00013900: 6163 6b28 7570 6461 7465 5f66 756e 632c  ack(update_func,
+00013910: 2073 6563 6f6e 6473 2c20 7369 6e67 6c65   seconds, single
+00013920: 5f73 686f 743d 4661 6c73 6529 3a0d 0a20  _shot=False):.. 
+00013930: 2020 2067 6c6f 6261 6c20 7469 6d65 7273     global timers
+00013940: 0d0a 2020 2020 7469 6d65 7220 3d20 5174  ..    timer = Qt
+00013950: 436f 7265 2e51 5469 6d65 7228 290d 0a20  Core.QTimer().. 
+00013960: 2020 2074 696d 6572 2e74 696d 656f 7574     timer.timeout
+00013970: 2e63 6f6e 6e65 6374 2875 7064 6174 655f  .connect(update_
+00013980: 6675 6e63 290d 0a20 2020 2069 6620 7369  func)..    if si
+00013990: 6e67 6c65 5f73 686f 743a 0d0a 2020 2020  ngle_shot:..    
+000139a0: 2020 2020 7469 6d65 722e 7365 7453 696e      timer.setSin
+000139b0: 676c 6553 686f 7428 5472 7565 290d 0a20  gleShot(True).. 
+000139c0: 2020 2074 696d 6572 2e73 7461 7274 2869     timer.start(i
+000139d0: 6e74 2873 6563 6f6e 6473 2a31 3030 3029  nt(seconds*1000)
+000139e0: 290d 0a20 2020 2074 696d 6572 732e 6170  )..    timers.ap
+000139f0: 7065 6e64 2874 696d 6572 290d 0a20 2020  pend(timer)..   
+00013a00: 2072 6574 7572 6e20 7469 6d65 720d 0a0d   return timer...
+00013a10: 0a0d 0a64 6566 2061 7574 6f76 6965 7772  ...def autoviewr
+00013a20: 6573 746f 7265 2865 6e61 626c 653d 5472  estore(enable=Tr
+00013a30: 7565 293a 0d0a 2020 2020 2727 2752 6573  ue):..    '''Res
+00013a40: 746f 7220 6675 6e63 7469 6f6e 616c 6974  tor functionalit
+00013a50: 7920 7361 7665 7320 7669 6577 207a 6f6f  y saves view zoo
+00013a60: 6d20 636f 6f72 6469 6e61 7465 7320 7768  m coordinates wh
+00013a70: 656e 2063 6c6f 7369 6e67 2061 2077 696e  en closing a win
+00013a80: 646f 772c 2061 6e64 0d0a 2020 2020 2020  dow, and..      
+00013a90: 206c 6f61 6420 7468 656d 2077 6865 6e20   load them when 
+00013aa0: 6372 6561 7469 6e67 2074 6865 2070 6c6f  creating the plo
+00013ab0: 7420 2877 6974 6820 7468 6520 7361 6d65  t (with the same
+00013ac0: 206e 616d 6529 2061 6761 696e 2e27 2727   name) again.'''
+00013ad0: 0d0a 2020 2020 676c 6f62 616c 2076 6965  ..    global vie
+00013ae0: 7772 6573 746f 7265 0d0a 2020 2020 7669  wrestore..    vi
+00013af0: 6577 7265 7374 6f72 6520 3d20 656e 6162  ewrestore = enab
+00013b00: 6c65 0d0a 0d0a 0d0a 6465 6620 7265 6672  le......def refr
+00013b10: 6573 6828 293a 0d0a 2020 2020 666f 7220  esh():..    for 
+00013b20: 7769 6e20 696e 2077 696e 646f 7773 3a0d  win in windows:.
+00013b30: 0a20 2020 2020 2020 2061 7873 203d 2077  .        axs = w
+00013b40: 696e 2e61 7873 202b 205b 6178 2066 6f72  in.axs + [ax for
+00013b50: 2061 7820 696e 206f 7665 726c 6179 5f61   ax in overlay_a
+00013b60: 7873 2069 6620 6178 2e76 622e 7769 6e3d  xs if ax.vb.win=
+00013b70: 3d77 696e 5d0d 0a20 2020 2020 2020 2066  =win]..        f
+00013b80: 6f72 2061 7820 696e 2061 7873 3a0d 0a20  or ax in axs:.. 
+00013b90: 2020 2020 2020 2020 2020 205f 696d 7072             _impr
+00013ba0: 6f76 655f 7369 676e 6966 6963 616e 7473  ove_significants
+00013bb0: 2861 7829 0d0a 2020 2020 2020 2020 7662  (ax)..        vb
+00013bc0: 7320 3d20 5b61 782e 7662 2066 6f72 2061  s = [ax.vb for a
+00013bd0: 7820 696e 2061 7873 5d0d 0a20 2020 2020  x in axs]..     
+00013be0: 2020 2066 6f72 2076 6220 696e 2076 6273     for vb in vbs
+00013bf0: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
+00013c00: 622e 7072 655f 7072 6f63 6573 735f 6461  b.pre_process_da
+00013c10: 7461 2829 0d0a 2020 2020 2020 2020 6966  ta()..        if
+00013c20: 2076 6965 7772 6573 746f 7265 3a0d 0a20   viewrestore:.. 
+00013c30: 2020 2020 2020 2020 2020 2069 6620 5f6c             if _l
+00013c40: 6f61 6477 696e 6461 7461 2877 696e 293a  oadwindata(win):
+00013c50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013c60: 2020 636f 6e74 696e 7565 0d0a 2020 2020    continue..    
+00013c70: 2020 2020 5f73 6574 5f6d 6178 5f7a 6f6f      _set_max_zoo
+00013c80: 6d28 7662 7329 0d0a 2020 2020 2020 2020  m(vbs)..        
+00013c90: 666f 7220 7662 2069 6e20 7662 733a 0d0a  for vb in vbs:..
+00013ca0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00013cb0: 7372 6320 3d20 7662 2e64 6174 6173 7263  src = vb.datasrc
+00013cc0: 5f6f 725f 7374 616e 6461 6c6f 6e65 0d0a  _or_standalone..
+00013cd0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00013ce0: 6174 6173 7263 2061 6e64 2028 7662 2e6c  atasrc and (vb.l
+00013cf0: 696e 6b65 6456 6965 7728 3029 2069 7320  inkedView(0) is 
+00013d00: 4e6f 6e65 206f 7220 7662 2e6c 696e 6b65  None or vb.linke
+00013d10: 6456 6965 7728 3029 2e64 6174 6173 7263  dView(0).datasrc
+00013d20: 2069 7320 4e6f 6e65 206f 7220 7662 2e6d   is None or vb.m
+00013d30: 6173 7465 725f 7669 6577 626f 7829 3a0d  aster_viewbox):.
+00013d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013d50: 2076 622e 7570 6461 7465 5f79 5f7a 6f6f   vb.update_y_zoo
+00013d60: 6d28 6461 7461 7372 632e 696e 6974 5f78  m(datasrc.init_x
+00013d70: 302c 2064 6174 6173 7263 2e69 6e69 745f  0, datasrc.init_
+00013d80: 7831 290d 0a20 2020 205f 7265 7061 696e  x1)..    _repain
+00013d90: 745f 6361 6e64 6c65 7328 290d 0a20 2020  t_candles()..   
+00013da0: 2066 6f72 206d 6420 696e 206d 6173 7465   for md in maste
+00013db0: 725f 6461 7461 2e76 616c 7565 7328 293a  r_data.values():
+00013dc0: 0d0a 2020 2020 2020 2020 666f 7220 7662  ..        for vb
+00013dd0: 2069 6e20 6d64 3a0d 0a20 2020 2020 2020   in md:..       
+00013de0: 2020 2020 2069 6620 7479 7065 2876 6229       if type(vb)
+00013df0: 2021 3d20 7374 723a 2023 2069 676e 6f72   != str: # ignor
+00013e00: 6520 2764 6566 6175 6c74 270d 0a20 2020  e 'default'..   
+00013e10: 2020 2020 2020 2020 2020 2020 205f 6d6f               _mo
+00013e20: 7573 655f 6d6f 7665 6428 7769 6e2c 2076  use_moved(win, v
+00013e30: 622c 204e 6f6e 6529 0d0a 0d0a 0d0a 6465  b, None)......de
+00013e40: 6620 7368 6f77 2871 745f 6578 6563 3d54  f show(qt_exec=T
+00013e50: 7275 6529 3a0d 0a20 2020 2072 6566 7265  rue):..    refre
+00013e60: 7368 2829 0d0a 2020 2020 666f 7220 7769  sh()..    for wi
+00013e70: 6e20 696e 2077 696e 646f 7773 3a0d 0a20  n in windows:.. 
+00013e80: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00013e90: 616e 6365 2877 696e 2c20 4669 6e57 696e  ance(win, FinWin
+00013ea0: 646f 7729 206f 7220 7174 5f65 7865 633a  dow) or qt_exec:
+00013eb0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00013ec0: 2077 696e 2e73 686f 775f 6d61 7869 6d69   win.show_maximi
+00013ed0: 7a65 643a 0d0a 2020 2020 2020 2020 2020  zed:..          
+00013ee0: 2020 2020 2020 7769 6e2e 7368 6f77 4d61        win.showMa
+00013ef0: 7869 6d69 7a65 6428 290d 0a20 2020 2020  ximized()..     
+00013f00: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00013f10: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+00013f20: 6e2e 7368 6f77 2829 0d0a 2020 2020 6966  n.show()..    if
+00013f30: 2077 696e 646f 7773 2061 6e64 2071 745f   windows and qt_
+00013f40: 6578 6563 3a0d 0a20 2020 2020 2020 2067  exec:..        g
+00013f50: 6c6f 6261 6c20 6c61 7374 5f61 782c 2061  lobal last_ax, a
+00013f60: 7070 0d0a 2020 2020 2020 2020 6170 7020  pp..        app 
+00013f70: 3d20 5174 4775 692e 5147 7569 4170 706c  = QtGui.QGuiAppl
+00013f80: 6963 6174 696f 6e2e 696e 7374 616e 6365  ication.instance
+00013f90: 2829 0d0a 2020 2020 2020 2020 6170 702e  ()..        app.
+00013fa0: 6578 6563 2829 0d0a 2020 2020 2020 2020  exec()..        
+00013fb0: 7769 6e64 6f77 732e 636c 6561 7228 290d  windows.clear().
+00013fc0: 0a20 2020 2020 2020 206f 7665 726c 6179  .        overlay
+00013fd0: 5f61 7873 2e63 6c65 6172 2829 0d0a 2020  _axs.clear()..  
+00013fe0: 2020 2020 2020 5f63 6c65 6172 5f74 696d        _clear_tim
+00013ff0: 6572 7328 290d 0a20 2020 2020 2020 2073  ers()..        s
+00014000: 6f75 6e64 732e 636c 6561 7228 290d 0a20  ounds.clear().. 
+00014010: 2020 2020 2020 206d 6173 7465 725f 6461         master_da
+00014020: 7461 2e63 6c65 6172 2829 0d0a 2020 2020  ta.clear()..    
+00014030: 2020 2020 6c61 7374 5f61 7820 3d20 4e6f      last_ax = No
+00014040: 6e65 0d0a 0d0a 0d0a 6465 6620 706c 6179  ne......def play
+00014050: 5f73 6f75 6e64 2866 696c 656e 616d 6529  _sound(filename)
+00014060: 3a0d 0a20 2020 2069 6620 6669 6c65 6e61  :..    if filena
+00014070: 6d65 206e 6f74 2069 6e20 736f 756e 6473  me not in sounds
+00014080: 3a0d 0a20 2020 2020 2020 2066 726f 6d20  :..        from 
+00014090: 5079 5174 362e 5174 4d75 6c74 696d 6564  PyQt6.QtMultimed
+000140a0: 6961 2069 6d70 6f72 7420 5153 6f75 6e64  ia import QSound
+000140b0: 4566 6665 6374 0d0a 2020 2020 2020 2020  Effect..        
+000140c0: 7320 3d20 736f 756e 6473 5b66 696c 656e  s = sounds[filen
+000140d0: 616d 655d 203d 2051 536f 756e 6445 6666  ame] = QSoundEff
+000140e0: 6563 7428 2920 2320 6469 7361 6c6c 6f77  ect() # disallow
+000140f0: 2067 630d 0a20 2020 2020 2020 2073 2e73   gc..        s.s
+00014100: 6574 536f 7572 6365 2851 7443 6f72 652e  etSource(QtCore.
+00014110: 5155 726c 2e66 726f 6d4c 6f63 616c 4669  QUrl.fromLocalFi
+00014120: 6c65 2866 696c 656e 616d 6529 290d 0a20  le(filename)).. 
+00014130: 2020 2073 203d 2073 6f75 6e64 735b 6669     s = sounds[fi
+00014140: 6c65 6e61 6d65 5d0d 0a20 2020 2073 2e70  lename]..    s.p
+00014150: 6c61 7928 290d 0a0d 0a0d 0a64 6566 2073  lay()......def s
+00014160: 6372 6565 6e73 686f 7428 6669 6c65 2c20  creenshot(file, 
+00014170: 666d 743d 2770 6e67 2729 3a0d 0a20 2020  fmt='png'):..   
+00014180: 2069 6620 5f69 6e74 6572 6e61 6c5f 7769   if _internal_wi
+00014190: 6e64 6f77 735f 6f6e 6c79 2829 2061 6e64  ndows_only() and
+000141a0: 206e 6f74 2061 7070 3a0d 0a20 2020 2020   not app:..     
+000141b0: 2020 2070 7269 6e74 2827 4552 524f 523a     print('ERROR:
+000141c0: 2073 6372 6565 6e73 686f 7420 6d75 7374   screenshot must
+000141d0: 2062 6520 6361 6c6c 6261 636b 6564 2066   be callbacked f
+000141e0: 726f 6d20 652e 672e 2074 696d 6572 5f63  rom e.g. timer_c
+000141f0: 616c 6c62 6163 6b28 2927 290d 0a20 2020  allback()')..   
+00014200: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00014210: 650d 0a20 2020 2074 7279 3a0d 0a20 2020  e..    try:..   
+00014220: 2020 2020 2062 7566 6665 7220 3d20 5174       buffer = Qt
+00014230: 436f 7265 2e51 4275 6666 6572 2829 0d0a  Core.QBuffer()..
+00014240: 2020 2020 2020 2020 6170 702e 7072 696d          app.prim
+00014250: 6172 7953 6372 6565 6e28 292e 6772 6162  aryScreen().grab
+00014260: 5769 6e64 6f77 2877 696e 646f 7773 5b30  Window(windows[0
+00014270: 5d2e 7769 6e49 6428 2929 2e73 6176 6528  ].winId()).save(
+00014280: 6275 6666 6572 2c20 666d 7429 0d0a 2020  buffer, fmt)..  
+00014290: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
+000142a0: 2862 7566 6665 722e 6461 7461 2829 290d  (buffer.data()).
+000142b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000142c0: 5472 7565 0d0a 2020 2020 6578 6365 7074  True..    except
+000142d0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+000142e0: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+000142f0: 2753 6372 6565 6e73 686f 7420 6572 726f  'Screenshot erro
+00014300: 723a 272c 2074 7970 6528 6529 2c20 6529  r:', type(e), e)
+00014310: 0d0a 2020 2020 7265 7475 726e 2046 616c  ..    return Fal
+00014320: 7365 0d0a 0d0a 0d0a 6465 6620 6578 7065  se......def expe
+00014330: 7269 6d65 6e74 282a 6172 6773 2c20 2a2a  riment(*args, **
+00014340: 6b77 6172 6773 293a 0d0a 2020 2020 6966  kwargs):..    if
+00014350: 2027 6f70 656e 676c 2720 696e 2061 7267   'opengl' in arg
+00014360: 7320 6f72 206b 7761 7267 732e 6765 7428  s or kwargs.get(
+00014370: 276f 7065 6e67 6c27 293a 0d0a 2020 2020  'opengl'):..    
+00014380: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+00014390: 2020 2020 2020 2320 7069 7020 696e 7374        # pip inst
+000143a0: 616c 6c20 5079 4f70 656e 474c 2050 794f  all PyOpenGL PyO
+000143b0: 7065 6e47 4c2d 6163 6365 6c65 7261 7465  penGL-accelerate
+000143c0: 2074 6f20 6765 7420 7468 6973 2067 6f69   to get this goi
+000143d0: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
+000143e0: 696d 706f 7274 204f 7065 6e47 4c0d 0a20  import OpenGL.. 
+000143f0: 2020 2020 2020 2020 2020 2070 672e 7365             pg.se
+00014400: 7443 6f6e 6669 674f 7074 696f 6e73 2875  tConfigOptions(u
+00014410: 7365 4f70 656e 474c 3d54 7275 652c 2065  seOpenGL=True, e
+00014420: 6e61 626c 6545 7870 6572 696d 656e 7461  nableExperimenta
+00014430: 6c3d 5472 7565 290d 0a20 2020 2020 2020  l=True)..       
+00014440: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00014450: 6e20 6173 2065 3a0d 0a20 2020 2020 2020  n as e:..       
+00014460: 2020 2020 2070 7269 6e74 2827 5741 524e       print('WARN
+00014470: 494e 473a 204f 7065 6e47 4c20 696e 6974  ING: OpenGL init
+00014480: 2065 7272 6f72 2e27 2c20 7479 7065 2865   error.', type(e
+00014490: 292c 2065 290d 0a0d 0a0d 0a23 2323 2323  ), e)......#####
+000144a0: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+000144b0: 494e 5445 524e 414c 5320 2323 2323 2323  INTERNALS ######
+000144c0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+000144d0: 0d0a 0d0a 6465 6620 5f6f 7065 6e66 696c  ....def _openfil
+000144e0: 6528 2a61 7267 7329 3a0d 0a20 2020 2072  e(*args):..    r
+000144f0: 6574 7572 6e20 6f70 656e 282a 6172 6773  eturn open(*args
+00014500: 290d 0a0d 0a0d 0a64 6566 205f 6c6f 6164  )......def _load
+00014510: 7769 6e64 6174 6128 7769 6e29 3a0d 0a20  windata(win):.. 
+00014520: 2020 2074 7279 3a20 6f73 2e6d 6b64 6972     try: os.mkdir
+00014530: 286f 732e 7061 7468 2e65 7870 616e 6475  (os.path.expandu
+00014540: 7365 7228 277e 2f2e 6669 6e70 6c6f 7427  ser('~/.finplot'
+00014550: 2929 0d0a 2020 2020 6578 6365 7074 3a20  ))..    except: 
+00014560: 7061 7373 0d0a 2020 2020 7472 793a 0d0a  pass..    try:..
+00014570: 2020 2020 2020 2020 6620 3d20 6f73 2e70          f = os.p
+00014580: 6174 682e 6578 7061 6e64 7573 6572 2827  ath.expanduser('
+00014590: 7e2f 2e66 696e 706c 6f74 2f27 2b77 696e  ~/.finplot/'+win
+000145a0: 2e74 6974 6c65 2e72 6570 6c61 6365 2827  .title.replace('
+000145b0: 2f27 2c27 2d27 292b 272e 696e 6927 290d  /','-')+'.ini').
+000145c0: 0a20 2020 2020 2020 2073 6574 7469 6e67  .        setting
+000145d0: 7320 3d20 5b28 6b2e 7374 7269 7028 292c  s = [(k.strip(),
+000145e0: 6c69 7465 7261 6c5f 6576 616c 2876 2e73  literal_eval(v.s
+000145f0: 7472 6970 2829 2929 2066 6f72 206c 696e  trip())) for lin
+00014600: 6520 696e 205f 6f70 656e 6669 6c65 2866  e in _openfile(f
+00014610: 2920 666f 7220 6b2c 642c 7620 696e 205b  ) for k,d,v in [
+00014620: 6c69 6e65 2e70 6172 7469 7469 6f6e 2827  line.partition('
+00014630: 3d27 295d 2069 6620 765d 0d0a 2020 2020  =')] if v]..    
+00014640: 2020 2020 6966 206e 6f74 2073 6574 7469      if not setti
+00014650: 6e67 733a 0d0a 2020 2020 2020 2020 2020  ngs:..          
+00014660: 2020 7265 7475 726e 0d0a 2020 2020 6578    return..    ex
+00014670: 6365 7074 3a0d 0a20 2020 2020 2020 2072  cept:..        r
+00014680: 6574 7572 6e0d 0a20 2020 206b 7673 203d  eturn..    kvs =
+00014690: 207b 6b3a 7620 666f 7220 6b2c 7620 696e   {k:v for k,v in
+000146a0: 2073 6574 7469 6e67 737d 0d0a 2020 2020   settings}..    
+000146b0: 7662 7320 3d20 7365 7428 6178 2e76 6220  vbs = set(ax.vb 
+000146c0: 666f 7220 6178 2069 6e20 7769 6e2e 6178  for ax in win.ax
+000146d0: 7329 0d0a 2020 2020 7a6f 6f6d 5f73 6574  s)..    zoom_set
+000146e0: 203d 2046 616c 7365 0d0a 2020 2020 666f   = False..    fo
+000146f0: 7220 7662 2069 6e20 7662 733a 0d0a 2020  r vb in vbs:..  
+00014700: 2020 2020 2020 6473 203d 2076 622e 6461        ds = vb.da
+00014710: 7461 7372 630d 0a20 2020 2020 2020 2069  tasrc..        i
+00014720: 6620 6473 2061 6e64 2028 7662 2e6c 696e  f ds and (vb.lin
+00014730: 6b65 6456 6965 7728 3029 2069 7320 4e6f  kedView(0) is No
+00014740: 6e65 206f 7220 7662 2e6c 696e 6b65 6456  ne or vb.linkedV
+00014750: 6965 7728 3029 2e64 6174 6173 7263 2069  iew(0).datasrc i
+00014760: 7320 4e6f 6e65 206f 7220 7662 2e6d 6173  s None or vb.mas
+00014770: 7465 725f 7669 6577 626f 7829 3a0d 0a20  ter_viewbox):.. 
+00014780: 2020 2020 2020 2020 2020 2070 6572 696f             perio
+00014790: 645f 6e73 203d 2064 732e 7065 7269 6f64  d_ns = ds.period
+000147a0: 5f6e 730d 0a20 2020 2020 2020 2020 2020  _ns..           
+000147b0: 2069 6620 6b76 735b 276d 696e 5f78 275d   if kvs['min_x']
+000147c0: 203e 3d20 6473 2e78 2e69 6c6f 635b 305d   >= ds.x.iloc[0]
+000147d0: 2d70 6572 696f 645f 6e73 2061 6e64 206b  -period_ns and k
+000147e0: 7673 5b27 6d61 785f 7827 5d20 3c3d 2064  vs['max_x'] <= d
+000147f0: 732e 782e 696c 6f63 5b2d 315d 2b70 6572  s.x.iloc[-1]+per
+00014800: 696f 645f 6e73 3a0d 0a20 2020 2020 2020  iod_ns:..       
+00014810: 2020 2020 2020 2020 2078 302c 7831 203d           x0,x1 =
+00014820: 2064 732e 782e 6c6f 635b 6473 2e78 3e3d   ds.x.loc[ds.x>=
+00014830: 6b76 735b 276d 696e 5f78 275d 5d2e 696e  kvs['min_x']].in
+00014840: 6465 785b 305d 2c20 6473 2e78 2e6c 6f63  dex[0], ds.x.loc
+00014850: 5b64 732e 783c 3d6b 7673 5b27 6d61 785f  [ds.x<=kvs['max_
+00014860: 7827 5d5d 2e69 6e64 6578 5b2d 315d 0d0a  x']].index[-1]..
+00014870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014880: 6966 2078 3120 3d3d 206c 656e 2864 732e  if x1 == len(ds.
+00014890: 7829 2d31 3a0d 0a20 2020 2020 2020 2020  x)-1:..         
+000148a0: 2020 2020 2020 2020 2020 2078 3120 2b3d             x1 +=
+000148b0: 2072 6967 6874 5f6d 6172 6769 6e5f 6361   right_margin_ca
+000148c0: 6e64 6c65 730d 0a20 2020 2020 2020 2020  ndles..         
+000148d0: 2020 2020 2020 2078 3120 2b3d 2030 2e35         x1 += 0.5
+000148e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000148f0: 2020 7a6f 6f6d 5f73 6574 203d 2076 622e    zoom_set = vb.
+00014900: 7570 6461 7465 5f79 5f7a 6f6f 6d28 7830  update_y_zoom(x0
+00014910: 2c20 7831 290d 0a20 2020 2072 6574 7572  , x1)..    retur
+00014920: 6e20 7a6f 6f6d 5f73 6574 0d0a 0d0a 0d0a  n zoom_set......
+00014930: 6465 6620 5f73 6176 6577 696e 6461 7461  def _savewindata
+00014940: 2877 696e 293a 0d0a 2020 2020 6966 206e  (win):..    if n
+00014950: 6f74 2076 6965 7772 6573 746f 7265 3a0d  ot viewrestore:.
+00014960: 0a20 2020 2020 2020 2072 6574 7572 6e0d  .        return.
+00014970: 0a20 2020 2074 7279 3a0d 0a20 2020 2020  .    try:..     
+00014980: 2020 206d 696e 5f78 203d 2069 6e74 2831     min_x = int(1
+00014990: 6531 3030 290d 0a20 2020 2020 2020 206d  e100)..        m
+000149a0: 6178 5f78 203d 2069 6e74 282d 3165 3130  ax_x = int(-1e10
+000149b0: 3029 0d0a 2020 2020 2020 2020 666f 7220  0)..        for 
+000149c0: 6178 2069 6e20 7769 6e2e 6178 733a 0d0a  ax in win.axs:..
+000149d0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+000149e0: 782e 7662 2e74 6172 6765 7452 6563 7428  x.vb.targetRect(
+000149f0: 292e 7269 6768 7428 2920 3c20 343a 2023  ).right() < 4: #
+00014a00: 2069 676e 6f72 6520 656d 7074 7920 706c   ignore empty pl
+00014a10: 6f74 730d 0a20 2020 2020 2020 2020 2020  ots..           
+00014a20: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
+00014a30: 2020 2020 2020 2020 2020 2069 6620 6178             if ax
+00014a40: 2e76 622e 6461 7461 7372 6320 6973 204e  .vb.datasrc is N
+00014a50: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00014a60: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
+00014a70: 2020 2020 2020 2020 2020 2020 7430 2c74              t0,t
+00014a80: 312c 5f2c 5f2c 5f20 3d20 6178 2e76 622e  1,_,_,_ = ax.vb.
+00014a90: 6461 7461 7372 632e 6869 6c6f 2861 782e  datasrc.hilo(ax.
+00014aa0: 7662 2e74 6172 6765 7452 6563 7428 292e  vb.targetRect().
+00014ab0: 6c65 6674 2829 2c20 6178 2e76 622e 7461  left(), ax.vb.ta
+00014ac0: 7267 6574 5265 6374 2829 2e72 6967 6874  rgetRect().right
+00014ad0: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
+00014ae0: 206d 696e 5f78 203d 206e 702e 6e61 6e6d   min_x = np.nanm
+00014af0: 696e 285b 6d69 6e5f 782c 2074 305d 290d  in([min_x, t0]).
+00014b00: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
+00014b10: 5f78 203d 206e 702e 6e61 6e6d 6178 285b  _x = np.nanmax([
+00014b20: 6d61 785f 782c 2074 315d 290d 0a20 2020  max_x, t1])..   
+00014b30: 2020 2020 2069 6620 6e70 2e6d 6178 286e       if np.max(n
+00014b40: 702e 6162 7328 5b6d 696e 5f78 2c20 6d61  p.abs([min_x, ma
+00014b50: 785f 785d 2929 203c 2031 6539 393a 0d0a  x_x])) < 1e99:..
+00014b60: 2020 2020 2020 2020 2020 2020 7320 3d20              s = 
+00014b70: 276d 696e 5f78 203d 2025 735c 6e6d 6178  'min_x = %s\nmax
+00014b80: 5f78 203d 2025 735c 6e27 2025 2028 6d69  _x = %s\n' % (mi
+00014b90: 6e5f 782c 206d 6178 5f78 290d 0a20 2020  n_x, max_x)..   
+00014ba0: 2020 2020 2020 2020 2066 203d 206f 732e           f = os.
+00014bb0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
+00014bc0: 277e 2f2e 6669 6e70 6c6f 742f 272b 7769  '~/.finplot/'+wi
+00014bd0: 6e2e 7469 746c 652e 7265 706c 6163 6528  n.title.replace(
+00014be0: 272f 272c 272d 2729 2b27 2e69 6e69 2729  '/','-')+'.ini')
+00014bf0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+00014c00: 793a 2063 6861 6e67 6564 203d 205f 6f70  y: changed = _op
+00014c10: 656e 6669 6c65 2866 292e 7265 6164 2829  enfile(f).read()
+00014c20: 2021 3d20 730d 0a20 2020 2020 2020 2020   != s..         
+00014c30: 2020 2065 7863 6570 743a 2063 6861 6e67     except: chang
+00014c40: 6564 203d 2054 7275 650d 0a20 2020 2020  ed = True..     
+00014c50: 2020 2020 2020 2069 6620 6368 616e 6765         if change
+00014c60: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00014c70: 2020 2020 5f6f 7065 6e66 696c 6528 662c      _openfile(f,
+00014c80: 2027 7774 2729 2e77 7269 7465 2873 290d   'wt').write(s).
+00014c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014ca0: 2023 2320 7072 696e 7428 2725 7320 7361   ## print('%s sa
+00014cb0: 7665 6427 2025 2077 696e 2e74 6974 6c65  ved' % win.title
+00014cc0: 290d 0a20 2020 2065 7863 6570 7420 4578  )..    except Ex
+00014cd0: 6365 7074 696f 6e20 6173 2065 3a0d 0a20  ception as e:.. 
+00014ce0: 2020 2020 2020 2070 7269 6e74 2827 4572         print('Er
+00014cf0: 726f 7220 7361 7669 6e67 2070 6c6f 743a  ror saving plot:
+00014d00: 272c 2065 290d 0a0d 0a0d 0a64 6566 205f  ', e)......def _
+00014d10: 696e 7465 726e 616c 5f77 696e 646f 7773  internal_windows
+00014d20: 5f6f 6e6c 7928 293a 0d0a 2020 2020 2072  _only():..     r
+00014d30: 6574 7572 6e20 616c 6c28 6973 696e 7374  eturn all(isinst
+00014d40: 616e 6365 2877 696e 2c46 696e 5769 6e64  ance(win,FinWind
+00014d50: 6f77 2920 666f 7220 7769 6e20 696e 2077  ow) for win in w
+00014d60: 696e 646f 7773 290d 0a0d 0a0d 0a64 6566  indows)......def
+00014d70: 205f 6372 6561 7465 5f70 6c6f 7428 6178   _create_plot(ax
+00014d80: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
+00014d90: 3a0d 0a20 2020 2069 6620 6178 3a0d 0a20  :..    if ax:.. 
+00014da0: 2020 2020 2020 2072 6574 7572 6e20 6178         return ax
+00014db0: 0d0a 2020 2020 6966 206c 6173 745f 6178  ..    if last_ax
+00014dc0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+00014dd0: 6e20 6c61 7374 5f61 780d 0a20 2020 2072  n last_ax..    r
+00014de0: 6574 7572 6e20 6372 6561 7465 5f70 6c6f  eturn create_plo
+00014df0: 7428 2a2a 6b77 6172 6773 290d 0a0d 0a0d  t(**kwargs).....
+00014e00: 0a64 6566 205f 6372 6561 7465 5f61 7869  .def _create_axi
+00014e10: 7328 706f 732c 202a 2a6b 7761 7267 7329  s(pos, **kwargs)
+00014e20: 3a0d 0a20 2020 2069 6620 706f 7320 3d3d  :..    if pos ==
+00014e30: 2027 7827 3a0d 0a20 2020 2020 2020 2072   'x':..        r
+00014e40: 6574 7572 6e20 4570 6f63 6841 7869 7349  eturn EpochAxisI
+00014e50: 7465 6d28 2a2a 6b77 6172 6773 290d 0a20  tem(**kwargs).. 
+00014e60: 2020 2065 6c69 6620 706f 7320 3d3d 2027     elif pos == '
+00014e70: 7927 3a0d 0a20 2020 2020 2020 2072 6574  y':..        ret
+00014e80: 7572 6e20 5941 7869 7349 7465 6d28 2a2a  urn YAxisItem(**
+00014e90: 6b77 6172 6773 290d 0a0d 0a0d 0a64 6566  kwargs)......def
+00014ea0: 205f 636c 6561 725f 7469 6d65 7273 2829   _clear_timers()
+00014eb0: 3a0d 0a20 2020 2066 6f72 2074 696d 6572  :..    for timer
+00014ec0: 2069 6e20 7469 6d65 7273 3a0d 0a20 2020   in timers:..   
+00014ed0: 2020 2020 2074 696d 6572 2e74 696d 656f       timer.timeo
+00014ee0: 7574 2e64 6973 636f 6e6e 6563 7428 290d  ut.disconnect().
+00014ef0: 0a20 2020 2074 696d 6572 732e 636c 6561  .    timers.clea
+00014f00: 7228 290d 0a0d 0a0d 0a64 6566 205f 6164  r()......def _ad
+00014f10: 645f 7469 6d65 7374 616d 705f 706c 6f74  d_timestamp_plot
+00014f20: 286d 6173 7465 722c 2070 7265 765f 6178  (master, prev_ax
+00014f30: 2c20 7669 6577 626f 782c 2069 6e64 6578  , viewbox, index
+00014f40: 2c20 7973 6361 6c65 293a 0d0a 2020 2020  , yscale):..    
+00014f50: 6e61 7469 7665 5f77 696e 203d 2069 7369  native_win = isi
+00014f60: 6e73 7461 6e63 6528 6d61 7374 6572 2c20  nstance(master, 
+00014f70: 7067 2e47 7261 7068 6963 734c 6179 6f75  pg.GraphicsLayou
+00014f80: 7457 6964 6765 7429 0d0a 2020 2020 6966  tWidget)..    if
+00014f90: 206e 6174 6976 655f 7769 6e20 616e 6420   native_win and 
+00014fa0: 7072 6576 5f61 7820 6973 206e 6f74 204e  prev_ax is not N
+00014fb0: 6f6e 653a 0d0a 2020 2020 2020 2020 7072  one:..        pr
+00014fc0: 6576 5f61 782e 7365 745f 7669 7369 626c  ev_ax.set_visibl
+00014fd0: 6528 7861 7869 733d 4661 6c73 6529 2023  e(xaxis=False) #
+00014fe0: 2068 6964 6520 7468 6520 7768 6f6c 6520   hide the whole 
+00014ff0: 7072 6576 696f 7573 2061 7869 730d 0a20  previous axis.. 
+00015000: 2020 2061 7865 7320 3d20 7b27 626f 7474     axes = {'bott
+00015010: 6f6d 273a 205f 6372 6561 7465 5f61 7869  om': _create_axi
+00015020: 7328 706f 733d 2778 272c 2076 623d 7669  s(pos='x', vb=vi
+00015030: 6577 626f 782c 206f 7269 656e 7461 7469  ewbox, orientati
+00015040: 6f6e 3d27 626f 7474 6f6d 2729 2c0d 0a20  on='bottom'),.. 
+00015050: 2020 2020 2020 2020 2020 2027 7269 6768             'righ
+00015060: 7427 3a20 205f 6372 6561 7465 5f61 7869  t':  _create_axi
+00015070: 7328 706f 733d 2779 272c 2076 623d 7669  s(pos='y', vb=vi
+00015080: 6577 626f 782c 206f 7269 656e 7461 7469  ewbox, orientati
+00015090: 6f6e 3d27 7269 6768 7427 297d 0d0a 2020  on='right')}..  
+000150a0: 2020 6966 206e 6174 6976 655f 7769 6e3a    if native_win:
+000150b0: 0d0a 2020 2020 2020 2020 6178 203d 2070  ..        ax = p
+000150c0: 672e 506c 6f74 4974 656d 2876 6965 7742  g.PlotItem(viewB
+000150d0: 6f78 3d76 6965 7762 6f78 2c20 6178 6973  ox=viewbox, axis
+000150e0: 4974 656d 733d 6178 6573 2c20 6e61 6d65  Items=axes, name
+000150f0: 3d27 706c 6f74 2d25 6927 2569 6e64 6578  ='plot-%i'%index
+00015100: 2c20 656e 6162 6c65 4d65 6e75 3d46 616c  , enableMenu=Fal
+00015110: 7365 290d 0a20 2020 2065 6c73 653a 0d0a  se)..    else:..
+00015120: 2020 2020 2020 2020 6178 7720 3d20 7067          axw = pg
+00015130: 2e50 6c6f 7457 6964 6765 7428 7669 6577  .PlotWidget(view
+00015140: 426f 783d 7669 6577 626f 782c 2061 7869  Box=viewbox, axi
+00015150: 7349 7465 6d73 3d61 7865 732c 206e 616d  sItems=axes, nam
+00015160: 653d 2770 6c6f 742d 2569 2725 696e 6465  e='plot-%i'%inde
+00015170: 782c 2065 6e61 626c 654d 656e 753d 4661  x, enableMenu=Fa
+00015180: 6c73 6529 0d0a 2020 2020 2020 2020 6178  lse)..        ax
+00015190: 203d 2061 7877 2e70 6c6f 7449 7465 6d0d   = axw.plotItem.
+000151a0: 0a20 2020 2020 2020 2061 782e 6178 5f77  .        ax.ax_w
+000151b0: 6964 6765 7420 3d20 6178 770d 0a20 2020  idget = axw..   
+000151c0: 2061 782e 7365 7443 6c69 7054 6f56 6965   ax.setClipToVie
+000151d0: 7728 5472 7565 290d 0a20 2020 2061 782e  w(True)..    ax.
+000151e0: 7365 7444 6f77 6e73 616d 706c 696e 6728  setDownsampling(
+000151f0: 6175 746f 3d54 7275 652c 206d 6f64 653d  auto=True, mode=
+00015200: 2773 7562 7361 6d70 6c65 2729 0d0a 2020  'subsample')..  
+00015210: 2020 6178 2e68 6964 6541 7869 7328 276c    ax.hideAxis('l
+00015220: 6566 7427 290d 0a20 2020 2069 6620 795f  eft')..    if y_
+00015230: 6c61 6265 6c5f 7769 6474 683a 0d0a 2020  label_width:..  
+00015240: 2020 2020 2020 6178 2e61 7865 735b 2772        ax.axes['r
+00015250: 6967 6874 275d 5b27 6974 656d 275d 2e73  ight']['item'].s
+00015260: 6574 5769 6474 6828 795f 6c61 6265 6c5f  etWidth(y_label_
+00015270: 7769 6474 6829 2023 2074 6869 7320 6973  width) # this is
+00015280: 2074 6f20 7075 7420 616c 6c20 6772 6170   to put all grap
+00015290: 6873 206f 6e20 6571 7561 6c20 666f 6f74  hs on equal foot
+000152a0: 696e 6720 7768 656e 2074 6578 7473 2076  ing when texts v
+000152b0: 6172 7920 6672 6f6d 2030 2e34 2074 6f20  ary from 0.4 to 
+000152c0: 3230 3030 3030 300d 0a20 2020 2061 782e  2000000..    ax.
+000152d0: 6178 6573 5b27 7269 6768 7427 5d5b 2769  axes['right']['i
+000152e0: 7465 6d27 5d2e 7365 7453 7479 6c65 2874  tem'].setStyle(t
+000152f0: 6963 6b4c 656e 6774 683d 2d35 2920 2320  ickLength=-5) # 
+00015300: 736f 6d65 2062 7567 2c20 746f 7461 6c6c  some bug, totall
+00015310: 7920 756e 6578 706c 6963 6162 6c65 2028  y unexplicable (
+00015320: 7768 7920 7365 7474 696e 6720 7468 6520  why setting the 
+00015330: 6465 6661 756c 7420 7661 6c75 6520 6167  default value ag
+00015340: 6169 6e20 776f 756c 6420 6669 7820 7265  ain would fix re
+00015350: 7061 696e 7420 7769 6474 6820 6173 2061  paint width as a
+00015360: 7869 7320 7363 616c 6520 646f 776e 290d  xis scale down).
+00015370: 0a20 2020 2061 782e 6178 6573 5b27 7269  .    ax.axes['ri
+00015380: 6768 7427 5d5b 2769 7465 6d27 5d2e 7365  ght']['item'].se
+00015390: 745a 5661 6c75 6528 3330 2920 2320 7075  tZValue(30) # pu
+000153a0: 7420 6178 6973 2069 6e20 6672 6f6e 7420  t axis in front 
+000153b0: 696e 7374 6561 6420 6f66 2062 6568 696e  instead of behin
+000153c0: 6420 6461 7461 0d0a 2020 2020 6178 2e61  d data..    ax.a
+000153d0: 7865 735b 2762 6f74 746f 6d27 5d5b 2769  xes['bottom']['i
+000153e0: 7465 6d27 5d2e 7365 745a 5661 6c75 6528  tem'].setZValue(
+000153f0: 3330 290d 0a20 2020 2061 782e 7365 744c  30)..    ax.setL
+00015400: 6f67 4d6f 6465 2879 3d28 7973 6361 6c65  ogMode(y=(yscale
+00015410: 2e73 6361 6c65 7479 7065 3d3d 276c 6f67  .scaletype=='log
+00015420: 2729 290d 0a20 2020 2061 782e 7369 676e  '))..    ax.sign
+00015430: 6966 6963 616e 745f 666f 7263 6564 203d  ificant_forced =
+00015440: 2046 616c 7365 0d0a 2020 2020 6178 2e73   False..    ax.s
+00015450: 6967 6e69 6669 6361 6e74 5f64 6563 696d  ignificant_decim
+00015460: 616c 7320 3d20 7369 676e 6966 6963 616e  als = significan
+00015470: 745f 6465 6369 6d61 6c73 0d0a 2020 2020  t_decimals..    
+00015480: 6178 2e73 6967 6e69 6669 6361 6e74 5f65  ax.significant_e
+00015490: 7073 203d 2073 6967 6e69 6669 6361 6e74  ps = significant
+000154a0: 5f65 7073 0d0a 2020 2020 6178 2e69 6e76  _eps..    ax.inv
+000154b0: 6572 7465 6420 3d20 4661 6c73 650d 0a20  erted = False.. 
+000154c0: 2020 2061 782e 6178 6f73 203d 205b 5d0d     ax.axos = [].
+000154d0: 0a20 2020 2061 782e 6372 6f73 7368 6169  .    ax.crosshai
+000154e0: 7220 3d20 4669 6e43 726f 7373 4861 6972  r = FinCrossHair
+000154f0: 2861 782c 2063 6f6c 6f72 3d63 726f 7373  (ax, color=cross
+00015500: 5f68 6169 725f 636f 6c6f 7229 0d0a 2020  _hair_color)..  
+00015510: 2020 6178 2e68 6964 6542 7574 746f 6e73    ax.hideButtons
+00015520: 2829 0d0a 2020 2020 6178 2e6f 7665 726c  ()..    ax.overl
+00015530: 6179 203d 2070 6172 7469 616c 285f 6178  ay = partial(_ax
+00015540: 5f6f 7665 726c 6179 2c20 6178 290d 0a20  _overlay, ax).. 
+00015550: 2020 2061 782e 7365 745f 7669 7369 626c     ax.set_visibl
+00015560: 6520 3d20 7061 7274 6961 6c28 5f61 785f  e = partial(_ax_
+00015570: 7365 745f 7669 7369 626c 652c 2061 7829  set_visible, ax)
+00015580: 0d0a 2020 2020 6178 2e64 6563 6f75 706c  ..    ax.decoupl
+00015590: 6520 3d20 7061 7274 6961 6c28 5f61 785f  e = partial(_ax_
+000155a0: 6465 636f 7570 6c65 2c20 6178 290d 0a20  decouple, ax).. 
+000155b0: 2020 2061 782e 6469 7361 626c 655f 785f     ax.disable_x_
+000155c0: 696e 6465 7820 3d20 7061 7274 6961 6c28  index = partial(
+000155d0: 5f61 785f 6469 7361 626c 655f 785f 696e  _ax_disable_x_in
+000155e0: 6465 782c 2061 7829 0d0a 2020 2020 6178  dex, ax)..    ax
+000155f0: 2e72 6573 6574 203d 2070 6172 7469 616c  .reset = partial
+00015600: 285f 6178 5f72 6573 6574 2c20 6178 290d  (_ax_reset, ax).
+00015610: 0a20 2020 2061 782e 696e 7665 7274 5f79  .    ax.invert_y
+00015620: 203d 2070 6172 7469 616c 285f 6178 5f69   = partial(_ax_i
+00015630: 6e76 6572 745f 792c 2061 7829 0d0a 2020  nvert_y, ax)..  
+00015640: 2020 6178 2e65 7870 616e 6420 3d20 7061    ax.expand = pa
+00015650: 7274 6961 6c28 5f61 785f 6578 7061 6e64  rtial(_ax_expand
+00015660: 2c20 6178 290d 0a20 2020 2061 782e 7072  , ax)..    ax.pr
+00015670: 6576 5f61 7820 3d20 7072 6576 5f61 780d  ev_ax = prev_ax.
+00015680: 0a20 2020 2061 782e 7769 6e5f 696e 6465  .    ax.win_inde
+00015690: 7820 3d20 696e 6465 780d 0a20 2020 2069  x = index..    i
+000156a0: 6620 696e 6465 7825 323a 0d0a 2020 2020  f index%2:..    
+000156b0: 2020 2020 7669 6577 626f 782e 7365 7442      viewbox.setB
+000156c0: 6163 6b67 726f 756e 6443 6f6c 6f72 286f  ackgroundColor(o
+000156d0: 6464 5f70 6c6f 745f 6261 636b 6772 6f75  dd_plot_backgrou
+000156e0: 6e64 290d 0a20 2020 2076 6965 7762 6f78  nd)..    viewbox
+000156f0: 2e73 6574 5061 7265 6e74 2861 7829 0d0a  .setParent(ax)..
+00015700: 2020 2020 7265 7475 726e 2061 780d 0a0d      return ax...
+00015710: 0a0d 0a64 6566 205f 6178 5f6f 7665 726c  ...def _ax_overl
+00015720: 6179 2861 782c 2073 6361 6c65 3d30 2e32  ay(ax, scale=0.2
+00015730: 352c 2079 6178 6973 3d46 616c 7365 293a  5, yaxis=False):
+00015740: 0d0a 2020 2020 2727 2754 6865 2073 6361  ..    '''The sca
+00015750: 6c65 2070 6172 616d 6574 6572 2064 6566  le parameter def
+00015760: 696e 6573 2068 6f77 2022 6869 6768 2075  ines how "high u
+00015770: 7022 206f 6e20 7468 6520 696e 6974 6961  p" on the initia
+00015780: 6c20 706c 6f74 2074 6869 7320 6f76 6572  l plot this over
+00015790: 6c61 7920 7769 6c6c 2073 686f 772e 0d0a  lay will show...
+000157a0: 2020 2020 2020 2054 6865 2079 6178 6973         The yaxis
+000157b0: 2070 6172 616d 6574 6572 2063 616e 2062   parameter can b
+000157c0: 6520 6f6e 6520 6f66 205b 4661 6c73 652c  e one of [False,
+000157d0: 2027 6c69 6e65 6172 272c 2027 6c6f 6727   'linear', 'log'
+000157e0: 5d2e 2727 270d 0a20 2020 2079 7363 616c  ].'''..    yscal
+000157f0: 6520 3d20 7961 7869 7320 6966 2079 6178  e = yaxis if yax
+00015800: 6973 2065 6c73 6520 276c 696e 6561 7227  is else 'linear'
+00015810: 0d0a 2020 2020 7669 6577 626f 7820 3d20  ..    viewbox = 
+00015820: 4669 6e56 6965 7742 6f78 2861 782e 7662  FinViewBox(ax.vb
+00015830: 2e77 696e 2c20 696e 6974 5f73 7465 7073  .win, init_steps
+00015840: 3d61 782e 7662 2e69 6e69 745f 7374 6570  =ax.vb.init_step
+00015850: 732c 2079 7363 616c 653d 5953 6361 6c65  s, yscale=YScale
+00015860: 2879 7363 616c 652c 2031 292c 2065 6e61  (yscale, 1), ena
+00015870: 626c 654d 656e 753d 4661 6c73 6529 0d0a  bleMenu=False)..
+00015880: 2020 2020 7669 6577 626f 782e 6d61 7374      viewbox.mast
+00015890: 6572 5f76 6965 7762 6f78 203d 2061 782e  er_viewbox = ax.
+000158a0: 7662 0d0a 2020 2020 7669 6577 626f 782e  vb..    viewbox.
+000158b0: 7365 745a 5661 6c75 6528 2d35 290d 0a20  setZValue(-5).. 
+000158c0: 2020 2076 6965 7762 6f78 2e73 6574 4261     viewbox.setBa
+000158d0: 636b 6772 6f75 6e64 436f 6c6f 7228 6178  ckgroundColor(ax
+000158e0: 2e76 622e 7374 6174 655b 2762 6163 6b67  .vb.state['backg
+000158f0: 726f 756e 6427 5d29 0d0a 2020 2020 6178  round'])..    ax
+00015900: 2e76 622e 7365 7442 6163 6b67 726f 756e  .vb.setBackgroun
+00015910: 6443 6f6c 6f72 284e 6f6e 6529 0d0a 2020  dColor(None)..  
+00015920: 2020 7669 6577 626f 782e 765f 7a6f 6f6d    viewbox.v_zoom
+00015930: 5f73 6361 6c65 203d 2073 6361 6c65 0d0a  _scale = scale..
+00015940: 2020 2020 6966 2068 6173 6174 7472 2861      if hasattr(a
+00015950: 782c 2027 6178 5f77 6964 6765 7427 293a  x, 'ax_widget'):
+00015960: 0d0a 2020 2020 2020 2020 6178 2e61 785f  ..        ax.ax_
+00015970: 7769 6467 6574 2e73 6365 6e65 2829 2e61  widget.scene().a
+00015980: 6464 4974 656d 2876 6965 7762 6f78 290d  ddItem(viewbox).
+00015990: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
+000159a0: 2020 2020 6178 2e76 622e 7769 6e2e 6365      ax.vb.win.ce
+000159b0: 6e74 7261 6c57 6964 6765 742e 7363 656e  ntralWidget.scen
+000159c0: 6528 292e 6164 6449 7465 6d28 7669 6577  e().addItem(view
+000159d0: 626f 7829 0d0a 2020 2020 7669 6577 626f  box)..    viewbo
+000159e0: 782e 7365 7458 4c69 6e6b 2861 782e 7662  x.setXLink(ax.vb
+000159f0: 290d 0a20 2020 2064 6566 2075 7064 6174  )..    def updat
+00015a00: 6556 6965 7728 293a 0d0a 2020 2020 2020  eView():..      
+00015a10: 2020 7669 6577 626f 782e 7365 7447 656f    viewbox.setGeo
+00015a20: 6d65 7472 7928 6178 2e76 622e 7363 656e  metry(ax.vb.scen
+00015a30: 6542 6f75 6e64 696e 6752 6563 7428 2929  eBoundingRect())
+00015a40: 0d0a 2020 2020 6178 6f20 3d20 7067 2e50  ..    axo = pg.P
+00015a50: 6c6f 7449 7465 6d28 656e 6162 6c65 4d65  lotItem(enableMe
+00015a60: 6e75 3d46 616c 7365 290d 0a20 2020 2061  nu=False)..    a
+00015a70: 786f 2e73 6967 6e69 6669 6361 6e74 5f66  xo.significant_f
+00015a80: 6f72 6365 6420 3d20 4661 6c73 650d 0a20  orced = False.. 
+00015a90: 2020 2061 786f 2e73 6967 6e69 6669 6361     axo.significa
+00015aa0: 6e74 5f64 6563 696d 616c 7320 3d20 7369  nt_decimals = si
+00015ab0: 676e 6966 6963 616e 745f 6465 6369 6d61  gnificant_decima
+00015ac0: 6c73 0d0a 2020 2020 6178 6f2e 7369 676e  ls..    axo.sign
+00015ad0: 6966 6963 616e 745f 6570 7320 3d20 7369  ificant_eps = si
+00015ae0: 676e 6966 6963 616e 745f 6570 730d 0a20  gnificant_eps.. 
+00015af0: 2020 2061 786f 2e70 7265 765f 6178 203d     axo.prev_ax =
+00015b00: 204e 6f6e 650d 0a20 2020 2061 786f 2e63   None..    axo.c
+00015b10: 726f 7373 6861 6972 203d 204e 6f6e 650d  rosshair = None.
+00015b20: 0a20 2020 2061 786f 2e64 6563 6f75 706c  .    axo.decoupl
+00015b30: 6520 3d20 7061 7274 6961 6c28 5f61 785f  e = partial(_ax_
+00015b40: 6465 636f 7570 6c65 2c20 6178 6f29 0d0a  decouple, axo)..
+00015b50: 2020 2020 6178 6f2e 6469 7361 626c 655f      axo.disable_
+00015b60: 785f 696e 6465 7820 3d20 7061 7274 6961  x_index = partia
+00015b70: 6c28 5f61 785f 6469 7361 626c 655f 785f  l(_ax_disable_x_
+00015b80: 696e 6465 782c 2061 786f 290d 0a20 2020  index, axo)..   
+00015b90: 2061 786f 2e72 6573 6574 203d 2070 6172   axo.reset = par
+00015ba0: 7469 616c 285f 6178 5f72 6573 6574 2c20  tial(_ax_reset, 
+00015bb0: 6178 6f29 0d0a 2020 2020 6178 6f2e 6869  axo)..    axo.hi
+00015bc0: 6465 4178 6973 2827 6c65 6674 2729 0d0a  deAxis('left')..
+00015bd0: 2020 2020 6178 6f2e 6869 6465 4178 6973      axo.hideAxis
+00015be0: 2827 7269 6768 7427 290d 0a20 2020 2061  ('right')..    a
+00015bf0: 786f 2e68 6964 6541 7869 7328 2762 6f74  xo.hideAxis('bot
+00015c00: 746f 6d27 290d 0a20 2020 2061 786f 2e68  tom')..    axo.h
+00015c10: 6964 6542 7574 746f 6e73 2829 0d0a 2020  ideButtons()..  
+00015c20: 2020 7669 6577 626f 782e 6164 6449 7465    viewbox.addIte
+00015c30: 6d28 6178 6f29 0d0a 2020 2020 6178 6f2e  m(axo)..    axo.
+00015c40: 7662 203d 2076 6965 7762 6f78 0d0a 2020  vb = viewbox..  
+00015c50: 2020 6966 2079 6178 6973 2061 6e64 2069    if yaxis and i
+00015c60: 7369 6e73 7461 6e63 6528 6178 6f2e 7662  sinstance(axo.vb
+00015c70: 2e77 696e 2c20 7067 2e47 7261 7068 6963  .win, pg.Graphic
+00015c80: 734c 6179 6f75 7457 6964 6765 7429 3a0d  sLayoutWidget):.
+00015c90: 0a20 2020 2020 2020 2061 7869 203d 205f  .        axi = _
+00015ca0: 6372 6561 7465 5f61 7869 7328 706f 733d  create_axis(pos=
+00015cb0: 2779 272c 2076 623d 6178 6f2e 7662 2c20  'y', vb=axo.vb, 
+00015cc0: 6f72 6965 6e74 6174 696f 6e3d 276c 6566  orientation='lef
+00015cd0: 7427 290d 0a20 2020 2020 2020 2061 786f  t')..        axo
+00015ce0: 2e73 6574 4178 6973 4974 656d 7328 7b27  .setAxisItems({'
+00015cf0: 6c65 6674 273a 2061 7869 7d29 0d0a 2020  left': axi})..  
+00015d00: 2020 2020 2020 6178 6f2e 7662 2e77 696e        axo.vb.win
+00015d10: 2e61 6464 4974 656d 2861 7869 2c20 726f  .addItem(axi, ro
+00015d20: 773d 302c 2063 6f6c 3d30 290d 0a20 2020  w=0, col=0)..   
+00015d30: 2061 782e 7662 2e73 6967 5265 7369 7a65   ax.vb.sigResize
+00015d40: 642e 636f 6e6e 6563 7428 7570 6461 7465  d.connect(update
+00015d50: 5669 6577 290d 0a20 2020 206f 7665 726c  View)..    overl
+00015d60: 6179 5f61 7873 2e61 7070 656e 6428 6178  ay_axs.append(ax
+00015d70: 6f29 0d0a 2020 2020 6178 2e61 786f 732e  o)..    ax.axos.
+00015d80: 6170 7065 6e64 2861 786f 290d 0a20 2020  append(axo)..   
+00015d90: 2075 7064 6174 6556 6965 7728 290d 0a20   updateView().. 
+00015da0: 2020 2072 6574 7572 6e20 6178 6f0d 0a0d     return axo...
+00015db0: 0a0d 0a64 6566 205f 6178 5f73 6574 5f76  ...def _ax_set_v
+00015dc0: 6973 6962 6c65 2861 782c 2063 726f 7373  isible(ax, cross
+00015dd0: 6861 6972 3d4e 6f6e 652c 2078 6178 6973  hair=None, xaxis
+00015de0: 3d4e 6f6e 652c 2079 6178 6973 3d4e 6f6e  =None, yaxis=Non
+00015df0: 652c 2078 6772 6964 3d4e 6f6e 652c 2079  e, xgrid=None, y
+00015e00: 6772 6964 3d4e 6f6e 6529 3a0d 0a20 2020  grid=None):..   
+00015e10: 2069 6620 6372 6f73 7368 6169 7220 3d3d   if crosshair ==
+00015e20: 2046 616c 7365 3a0d 0a20 2020 2020 2020   False:..       
+00015e30: 2061 782e 6372 6f73 7368 6169 722e 6869   ax.crosshair.hi
+00015e40: 6465 2829 0d0a 2020 2020 6966 2078 6178  de()..    if xax
+00015e50: 6973 2069 7320 6e6f 7420 4e6f 6e65 3a0d  is is not None:.
+00015e60: 0a20 2020 2020 2020 2061 782e 6765 7441  .        ax.getA
+00015e70: 7869 7328 2762 6f74 746f 6d27 292e 7365  xis('bottom').se
+00015e80: 7453 7479 6c65 2873 686f 7756 616c 7565  tStyle(showValue
+00015e90: 733d 7861 7869 7329 0d0a 2020 2020 6966  s=xaxis)..    if
+00015ea0: 2079 6178 6973 2069 7320 6e6f 7420 4e6f   yaxis is not No
+00015eb0: 6e65 3a0d 0a20 2020 2020 2020 2061 782e  ne:..        ax.
+00015ec0: 6765 7441 7869 7328 2772 6967 6874 2729  getAxis('right')
+00015ed0: 2e73 6574 5374 796c 6528 7368 6f77 5661  .setStyle(showVa
+00015ee0: 6c75 6573 3d79 6178 6973 290d 0a20 2020  lues=yaxis)..   
+00015ef0: 2069 6620 7867 7269 6420 6973 206e 6f74   if xgrid is not
+00015f00: 204e 6f6e 6520 6f72 2079 6772 6964 2069   None or ygrid i
+00015f10: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00015f20: 2020 2020 2061 782e 7368 6f77 4772 6964       ax.showGrid
+00015f30: 2878 3d78 6772 6964 2c20 793d 7967 7269  (x=xgrid, y=ygri
+00015f40: 642c 2061 6c70 6861 3d67 7269 645f 616c  d, alpha=grid_al
+00015f50: 7068 6129 0d0a 2020 2020 2020 2020 6966  pha)..        if
+00015f60: 2061 782e 6765 7441 7869 7328 2772 6967   ax.getAxis('rig
+00015f70: 6874 2729 3a0d 0a20 2020 2020 2020 2020  ht'):..         
+00015f80: 2020 2061 782e 6765 7441 7869 7328 2772     ax.getAxis('r
+00015f90: 6967 6874 2729 2e73 6574 456e 6162 6c65  ight').setEnable
+00015fa0: 6428 4661 6c73 6529 0d0a 2020 2020 2020  d(False)..      
+00015fb0: 2020 6966 2061 782e 6765 7441 7869 7328    if ax.getAxis(
+00015fc0: 2762 6f74 746f 6d27 293a 0d0a 2020 2020  'bottom'):..    
+00015fd0: 2020 2020 2020 2020 6178 2e67 6574 4178          ax.getAx
+00015fe0: 6973 2827 626f 7474 6f6d 2729 2e73 6574  is('bottom').set
+00015ff0: 456e 6162 6c65 6428 4661 6c73 6529 0d0a  Enabled(False)..
+00016000: 0d0a 0d0a 6465 6620 5f61 785f 6465 636f  ....def _ax_deco
+00016010: 7570 6c65 2861 7829 3a0d 0a20 2020 2061  uple(ax):..    a
+00016020: 782e 7365 7458 4c69 6e6b 284e 6f6e 6529  x.setXLink(None)
+00016030: 0d0a 2020 2020 6966 2061 782e 7072 6576  ..    if ax.prev
+00016040: 5f61 783a 0d0a 2020 2020 2020 2020 6178  _ax:..        ax
+00016050: 2e70 7265 765f 6178 2e73 6574 5f76 6973  .prev_ax.set_vis
+00016060: 6962 6c65 2878 6178 6973 3d54 7275 6529  ible(xaxis=True)
+00016070: 0d0a 0d0a 0d0a 6465 6620 5f61 785f 6469  ......def _ax_di
+00016080: 7361 626c 655f 785f 696e 6465 7828 6178  sable_x_index(ax
+00016090: 2c20 6465 636f 7570 6c65 3d54 7275 6529  , decouple=True)
+000160a0: 3a0d 0a20 2020 2061 782e 7662 2e78 5f69  :..    ax.vb.x_i
+000160b0: 6e64 6578 6564 203d 2046 616c 7365 0d0a  ndexed = False..
+000160c0: 2020 2020 6966 2064 6563 6f75 706c 653a      if decouple:
+000160d0: 0d0a 2020 2020 2020 2020 5f61 785f 6465  ..        _ax_de
+000160e0: 636f 7570 6c65 2861 7829 0d0a 0d0a 0d0a  couple(ax)......
+000160f0: 6465 6620 5f61 785f 7265 7365 7428 6178  def _ax_reset(ax
+00016100: 293a 0d0a 2020 2020 6966 2061 782e 6372  ):..    if ax.cr
+00016110: 6f73 7368 6169 7220 6973 206e 6f74 204e  osshair is not N
+00016120: 6f6e 653a 0d0a 2020 2020 2020 2020 6178  one:..        ax
+00016130: 2e63 726f 7373 6861 6972 2e68 6964 6528  .crosshair.hide(
+00016140: 290d 0a20 2020 2066 6f72 2069 7465 6d20  )..    for item 
+00016150: 696e 206c 6973 7428 6178 2e69 7465 6d73  in list(ax.items
+00016160: 293a 0d0a 2020 2020 2020 2020 6966 2061  ):..        if a
+00016170: 6e79 2869 7369 6e73 7461 6e63 6528 6974  ny(isinstance(it
+00016180: 656d 2c20 6329 2066 6f72 2063 2069 6e20  em, c) for c in 
+00016190: 5b46 696e 4c69 6e65 2c20 4669 6e50 6f6c  [FinLine, FinPol
+000161a0: 794c 696e 652c 2070 672e 5465 7874 4974  yLine, pg.TextIt
+000161b0: 656d 5d29 3a0d 0a20 2020 2020 2020 2020  em]):..         
+000161c0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+000161d0: 2020 2020 2020 2020 2072 656d 6f76 655f           remove_
+000161e0: 7072 696d 6974 6976 6528 6974 656d 290d  primitive(item).
+000161f0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00016200: 6570 743a 0d0a 2020 2020 2020 2020 2020  ept:..          
+00016210: 2020 2020 2020 7061 7373 0d0a 2020 2020        pass..    
+00016220: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00016230: 2020 2020 2020 2061 782e 7265 6d6f 7665         ax.remove
+00016240: 4974 656d 2869 7465 6d29 0d0a 2020 2020  Item(item)..    
+00016250: 2020 2020 6966 2061 782e 7662 2e6d 6173      if ax.vb.mas
+00016260: 7465 725f 7669 6577 626f 7820 616e 6420  ter_viewbox and 
+00016270: 6861 7361 7474 7228 6974 656d 2c20 276e  hasattr(item, 'n
+00016280: 616d 6527 2920 616e 6420 6974 656d 2e6e  ame') and item.n
+00016290: 616d 6528 293a 0d0a 2020 2020 2020 2020  ame():..        
+000162a0: 2020 2020 6c65 6765 6e64 203d 2061 782e      legend = ax.
+000162b0: 7662 2e6d 6173 7465 725f 7669 6577 626f  vb.master_viewbo
+000162c0: 782e 7061 7265 6e74 2829 2e6c 6567 656e  x.parent().legen
+000162d0: 640d 0a20 2020 2020 2020 2020 2020 2069  d..            i
+000162e0: 6620 6c65 6765 6e64 3a0d 0a20 2020 2020  f legend:..     
+000162f0: 2020 2020 2020 2020 2020 206c 6567 656e             legen
+00016300: 642e 7265 6d6f 7665 4974 656d 2869 7465  d.removeItem(ite
+00016310: 6d29 0d0a 2020 2020 6966 2061 782e 6c65  m)..    if ax.le
+00016320: 6765 6e64 3a0d 0a20 2020 2020 2020 2061  gend:..        a
+00016330: 782e 6c65 6765 6e64 2e6f 7074 735b 276f  x.legend.opts['o
+00016340: 6666 7365 7427 5d20 3d20 4e6f 6e65 0d0a  ffset'] = None..
+00016350: 2020 2020 2020 2020 6178 2e6c 6567 656e          ax.legen
+00016360: 642e 7365 7450 6172 656e 7449 7465 6d28  d.setParentItem(
+00016370: 4e6f 6e65 290d 0a20 2020 2020 2020 2061  None)..        a
+00016380: 782e 6c65 6765 6e64 203d 204e 6f6e 650d  x.legend = None.
+00016390: 0a20 2020 2061 782e 7662 2e72 6573 6574  .    ax.vb.reset
+000163a0: 2829 0d0a 2020 2020 6178 2e76 622e 7365  ()..    ax.vb.se
+000163b0: 745f 6461 7461 7372 6328 4e6f 6e65 290d  t_datasrc(None).
+000163c0: 0a20 2020 2069 6620 6178 2e63 726f 7373  .    if ax.cross
+000163d0: 6861 6972 2069 7320 6e6f 7420 4e6f 6e65  hair is not None
+000163e0: 3a0d 0a20 2020 2020 2020 2061 782e 6372  :..        ax.cr
+000163f0: 6f73 7368 6169 722e 7368 6f77 2829 0d0a  osshair.show()..
+00016400: 2020 2020 6178 2e73 6967 6e69 6669 6361      ax.significa
+00016410: 6e74 5f66 6f72 6365 6420 3d20 4661 6c73  nt_forced = Fals
+00016420: 650d 0a0d 0a0d 0a64 6566 205f 6178 5f69  e......def _ax_i
+00016430: 6e76 6572 745f 7928 6178 293a 0d0a 2020  nvert_y(ax):..  
+00016440: 2020 6178 2e69 6e76 6572 7465 6420 3d20    ax.inverted = 
+00016450: 6e6f 7420 6178 2e69 6e76 6572 7465 640d  not ax.inverted.
+00016460: 0a20 2020 2061 782e 7365 7454 7261 6e73  .    ax.setTrans
+00016470: 666f 726d 2861 782e 7472 616e 7366 6f72  form(ax.transfor
+00016480: 6d28 292e 7363 616c 6528 312c 2d31 292e  m().scale(1,-1).
+00016490: 7472 616e 736c 6174 6528 302c 2d61 782e  translate(0,-ax.
+000164a0: 6865 6967 6874 2829 2929 0d0a 0d0a 0d0a  height()))......
+000164b0: 6465 6620 5f61 785f 6578 7061 6e64 2861  def _ax_expand(a
+000164c0: 7829 3a0d 0a20 2020 2076 6220 3d20 6178  x):..    vb = ax
+000164d0: 2e76 620d 0a20 2020 2061 7873 203d 2076  .vb..    axs = v
+000164e0: 622e 7769 6e2e 6178 730d 0a20 2020 2066  b.win.axs..    f
+000164f0: 6f72 2061 7878 2069 6e20 6178 733a 0d0a  or axx in axs:..
+00016500: 2020 2020 2020 2020 6966 2061 7878 2e69          if axx.i
+00016510: 6e76 6572 7465 643a 2023 2072 6f6c 6c20  nverted: # roll 
+00016520: 6261 636b 2069 6e76 6572 7369 6f6e 2069  back inversion i
+00016530: 6620 6368 616e 6769 6e67 2065 7870 616e  f changing expan
+00016540: 7369 6f6e 0d0a 2020 2020 2020 2020 2020  sion..          
+00016550: 2020 6178 782e 696e 7665 7274 5f79 2829    axx.invert_y()
+00016560: 0d0a 2020 2020 7368 6f77 5f61 6c6c 203d  ..    show_all =
+00016570: 2061 6e79 286e 6f74 2061 782e 6973 5669   any(not ax.isVi
+00016580: 7369 626c 6528 2920 666f 7220 6178 2069  sible() for ax i
+00016590: 6e20 6178 7329 0d0a 2020 2020 666f 7220  n axs)..    for 
+000165a0: 726f 7769 2c61 7878 2069 6e20 656e 756d  rowi,axx in enum
+000165b0: 6572 6174 6528 6178 7329 3a0d 0a20 2020  erate(axs):..   
+000165c0: 2020 2020 2069 6620 6178 7820 213d 2061       if axx != a
+000165d0: 783a 0d0a 2020 2020 2020 2020 2020 2020  x:..            
+000165e0: 6178 782e 7365 7456 6973 6962 6c65 2873  axx.setVisible(s
+000165f0: 686f 775f 616c 6c29 0d0a 2020 2020 2020  how_all)..      
+00016600: 2020 2020 2020 666f 7220 6178 6f20 696e        for axo in
+00016610: 2061 7878 2e61 786f 733a 0d0a 2020 2020   axx.axos:..    
+00016620: 2020 2020 2020 2020 2020 2020 6178 6f2e              axo.
+00016630: 7662 2e73 6574 5669 7369 626c 6528 7368  vb.setVisible(sh
+00016640: 6f77 5f61 6c6c 290d 0a20 2020 2061 782e  ow_all)..    ax.
+00016650: 7365 745f 7669 7369 626c 6528 7861 7869  set_visible(xaxi
+00016660: 733d 6e6f 7420 7368 6f77 5f61 6c6c 290d  s=not show_all).
+00016670: 0a20 2020 2061 7873 5b2d 315d 2e73 6574  .    axs[-1].set
+00016680: 5f76 6973 6962 6c65 2878 6178 6973 3d54  _visible(xaxis=T
+00016690: 7275 6529 0d0a 0d0a 0d0a 6465 6620 5f63  rue)......def _c
+000166a0: 7265 6174 655f 6c65 6765 6e64 2861 7829  reate_legend(ax)
+000166b0: 3a0d 0a20 2020 2069 6620 6178 2e76 622e  :..    if ax.vb.
+000166c0: 6d61 7374 6572 5f76 6965 7762 6f78 3a0d  master_viewbox:.
+000166d0: 0a20 2020 2020 2020 2061 7820 3d20 6178  .        ax = ax
+000166e0: 2e76 622e 6d61 7374 6572 5f76 6965 7762  .vb.master_viewb
+000166f0: 6f78 2e70 6172 656e 7428 290d 0a20 2020  ox.parent()..   
+00016700: 2069 6620 6178 2e6c 6567 656e 6420 6973   if ax.legend is
+00016710: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00016720: 6178 2e6c 6567 656e 6420 3d20 4669 6e4c  ax.legend = FinL
+00016730: 6567 656e 6449 7465 6d28 626f 7264 6572  egendItem(border
+00016740: 5f63 6f6c 6f72 3d6c 6567 656e 645f 626f  _color=legend_bo
+00016750: 7264 6572 5f63 6f6c 6f72 2c20 6669 6c6c  rder_color, fill
+00016760: 5f63 6f6c 6f72 3d6c 6567 656e 645f 6669  _color=legend_fi
+00016770: 6c6c 5f63 6f6c 6f72 2c20 7369 7a65 3d4e  ll_color, size=N
+00016780: 6f6e 652c 206f 6666 7365 743d 2833 2c32  one, offset=(3,2
+00016790: 2929 0d0a 2020 2020 2020 2020 6178 2e6c  ))..        ax.l
+000167a0: 6567 656e 642e 7365 7450 6172 656e 7449  egend.setParentI
+000167b0: 7465 6d28 6178 2e76 6229 0d0a 0d0a 0d0a  tem(ax.vb)......
+000167c0: 6465 6620 5f75 7064 6174 655f 7369 676e  def _update_sign
+000167d0: 6966 6963 616e 7473 2861 782c 2064 6174  ificants(ax, dat
+000167e0: 6173 7263 2c20 666f 7263 6529 3a0d 0a20  asrc, force):.. 
+000167f0: 2020 2023 2063 6865 636b 2069 6620 6e6f     # check if no
+00016800: 2065 7073 696c 6f6e 2073 6574 2079 6574   epsilon set yet
+00016810: 0d0a 2020 2020 6465 6661 756c 745f 6465  ..    default_de
+00016820: 6320 3d20 302e 3939 203c 2061 782e 7369  c = 0.99 < ax.si
+00016830: 676e 6966 6963 616e 745f 6465 6369 6d61  gnificant_decima
+00016840: 6c73 2f73 6967 6e69 6669 6361 6e74 5f64  ls/significant_d
+00016850: 6563 696d 616c 7320 3c20 312e 3031 0d0a  ecimals < 1.01..
+00016860: 2020 2020 6465 6661 756c 745f 6570 7320      default_eps 
+00016870: 3d20 302e 3939 203c 2061 782e 7369 676e  = 0.99 < ax.sign
+00016880: 6966 6963 616e 745f 6570 732f 7369 676e  ificant_eps/sign
+00016890: 6966 6963 616e 745f 6570 7320 3c20 312e  ificant_eps < 1.
+000168a0: 3031 0d0a 2020 2020 6966 2066 6f72 6365  01..    if force
+000168b0: 206f 7220 2864 6566 6175 6c74 5f64 6563   or (default_dec
+000168c0: 2061 6e64 2064 6566 6175 6c74 5f65 7073   and default_eps
+000168d0: 293a 0d0a 2020 2020 2020 2020 7472 793a  ):..        try:
+000168e0: 0d0a 2020 2020 2020 2020 2020 2020 7364  ..            sd
+000168f0: 2c73 6520 3d20 6461 7461 7372 632e 6361  ,se = datasrc.ca
+00016900: 6c63 5f73 6967 6e69 6669 6361 6e74 5f64  lc_significant_d
+00016910: 6563 696d 616c 7328 6675 6c6c 3d66 6f72  ecimals(full=for
+00016920: 6365 290d 0a20 2020 2020 2020 2020 2020  ce)..           
+00016930: 2069 6620 7364 206f 7220 7365 2021 3d20   if sd or se != 
+00016940: 7369 676e 6966 6963 616e 745f 6570 733a  significant_eps:
+00016950: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016960: 2020 6966 2028 666f 7263 6520 616e 6420    if (force and 
+00016970: 6e6f 7420 6178 2e73 6967 6e69 6669 6361  not ax.significa
+00016980: 6e74 5f66 6f72 6365 6429 206f 7220 6465  nt_forced) or de
+00016990: 6661 756c 745f 6465 6320 6f72 2073 6420  fault_dec or sd 
+000169a0: 3e20 6178 2e73 6967 6e69 6669 6361 6e74  > ax.significant
+000169b0: 5f64 6563 696d 616c 733a 0d0a 2020 2020  _decimals:..    
+000169c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169d0: 6178 2e73 6967 6e69 6669 6361 6e74 5f64  ax.significant_d
+000169e0: 6563 696d 616c 7320 3d20 7364 0d0a 2020  ecimals = sd..  
+000169f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a00: 2020 6178 2e73 6967 6e69 6669 6361 6e74    ax.significant
+00016a10: 5f66 6f72 6365 6420 7c3d 2066 6f72 6365  _forced |= force
+00016a20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016a30: 2020 6966 2028 666f 7263 6520 616e 6420    if (force and 
+00016a40: 6e6f 7420 6178 2e73 6967 6e69 6669 6361  not ax.significa
+00016a50: 6e74 5f66 6f72 6365 6429 206f 7220 6465  nt_forced) or de
+00016a60: 6661 756c 745f 6570 7320 6f72 2073 6520  fault_eps or se 
+00016a70: 3c20 6178 2e73 6967 6e69 6669 6361 6e74  < ax.significant
+00016a80: 5f65 7073 3a0d 0a20 2020 2020 2020 2020  _eps:..         
+00016a90: 2020 2020 2020 2020 2020 2061 782e 7369             ax.si
+00016aa0: 676e 6966 6963 616e 745f 6570 7320 3d20  gnificant_eps = 
+00016ab0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00016ac0: 2020 2020 2020 2020 6178 2e73 6967 6e69          ax.signi
+00016ad0: 6669 6361 6e74 5f66 6f72 6365 6420 7c3d  ficant_forced |=
+00016ae0: 2066 6f72 6365 0d0a 2020 2020 2020 2020   force..        
+00016af0: 6578 6365 7074 3a0d 0a20 2020 2020 2020  except:..       
+00016b00: 2020 2020 2070 6173 7320 2320 6461 7461       pass # data
+00016b10: 7372 6320 7072 6f62 6162 6c79 2066 756c  src probably ful
+00016b20: 6c20 6176 204e 614e 730d 0a0d 0a0d 0a64  l av NaNs......d
+00016b30: 6566 205f 696d 7072 6f76 655f 7369 676e  ef _improve_sign
+00016b40: 6966 6963 616e 7473 2861 7829 3a0d 0a20  ificants(ax):.. 
+00016b50: 2020 2027 2727 466f 7263 6520 7570 6461     '''Force upda
+00016b60: 7465 206f 6620 7468 6520 4550 5320 6966  te of the EPS if
+00016b70: 2077 6520 626f 7468 2068 6176 6520 6e6f   we both have no
+00016b80: 2062 6172 732f 6361 6e64 6c65 7320 414e   bars/candles AN
+00016b90: 4420 6120 6c6f 6720 7363 616c 652e 0d0a  D a log scale...
+00016ba0: 2020 2020 2020 2054 6869 7320 6973 2069         This is i
+00016bb0: 6e74 656e 6465 6420 746f 2066 6978 2074  ntended to fix t
+00016bc0: 6865 206c 6f77 6572 2070 6172 7420 6f66  he lower part of
+00016bd0: 2074 6865 2067 7269 6420 6f6e 206c 696e   the grid on lin
+00016be0: 6520 706c 6f74 7320 6f6e 2061 206c 6f67  e plots on a log
+00016bf0: 2073 6361 6c65 2e27 2727 0d0a 2020 2020   scale.'''..    
+00016c00: 6966 2061 782e 7662 2e79 7363 616c 652e  if ax.vb.yscale.
+00016c10: 7363 616c 6574 7970 6520 3d3d 2027 6c6f  scaletype == 'lo
+00016c20: 6727 3a0d 0a20 2020 2020 2020 2069 6620  g':..        if 
+00016c30: 6e6f 7420 616e 7928 6973 696e 7374 616e  not any(isinstan
+00016c40: 6365 2869 7465 6d2c 2043 616e 646c 6573  ce(item, Candles
+00016c50: 7469 636b 4974 656d 2920 666f 7220 6974  tickItem) for it
+00016c60: 656d 2069 6e20 6178 2e69 7465 6d73 293a  em in ax.items):
+00016c70: 0d0a 2020 2020 2020 2020 2020 2020 5f75  ..            _u
+00016c80: 7064 6174 655f 7369 676e 6966 6963 616e  pdate_significan
+00016c90: 7473 2861 782c 2061 782e 7662 2e64 6174  ts(ax, ax.vb.dat
+00016ca0: 6173 7263 2c20 666f 7263 653d 5472 7565  asrc, force=True
+00016cb0: 290d 0a0d 0a0d 0a64 6566 205f 6973 5f73  )......def _is_s
+00016cc0: 7461 6e64 616c 6f6e 6528 7469 6d65 7365  tandalone(timese
+00016cd0: 7229 3a0d 0a20 2020 2023 206d 6f72 6520  r):..    # more 
+00016ce0: 7468 616e 204e 2070 6572 6365 6e74 2067  than N percent g
+00016cf0: 6170 7320 6f72 2074 696d 6520 7265 7665  aps or time reve
+00016d00: 7273 616c 7320 7072 6f62 6162 6c79 206d  rsals probably m
+00016d10: 6561 6e73 2074 6869 7320 6973 2061 2073  eans this is a s
+00016d20: 7461 6e64 616c 6f6e 6520 706c 6f74 0d0a  tandalone plot..
+00016d30: 2020 2020 7265 7475 726e 2074 696d 6573      return times
+00016d40: 6572 2e69 736e 756c 6c28 292e 7375 6d28  er.isnull().sum(
+00016d50: 2920 2b20 2874 696d 6573 6572 2e64 6966  ) + (timeser.dif
+00016d60: 6628 293c 3d30 292e 7375 6d28 2920 3e20  f()<=0).sum() > 
+00016d70: 6c65 6e28 7469 6d65 7365 7229 2a30 2e31  len(timeser)*0.1
+00016d80: 0d0a 0d0a 0d0a 6465 6620 5f63 7265 6174  ......def _creat
+00016d90: 655f 706f 6c79 5f6c 696e 6528 2a61 7267  e_poly_line(*arg
+00016da0: 732c 202a 2a6b 7761 7267 7329 3a0d 0a20  s, **kwargs):.. 
+00016db0: 2020 2072 6574 7572 6e20 4669 6e50 6f6c     return FinPol
+00016dc0: 794c 696e 6528 2a61 7267 732c 202a 2a6b  yLine(*args, **k
+00016dd0: 7761 7267 7329 0d0a 0d0a 0d0a 6465 6620  wargs)......def 
+00016de0: 5f63 7265 6174 655f 7365 7269 6573 2861  _create_series(a
+00016df0: 293a 0d0a 2020 2020 7265 7475 726e 2061  ):..    return a
+00016e00: 2069 6620 6973 696e 7374 616e 6365 2861   if isinstance(a
+00016e10: 2c20 7064 2e53 6572 6965 7329 2065 6c73  , pd.Series) els
+00016e20: 6520 7064 2e53 6572 6965 7328 6129 0d0a  e pd.Series(a)..
+00016e30: 0d0a 0d0a 6465 6620 5f63 7265 6174 655f  ....def _create_
+00016e40: 6461 7461 7372 6328 6178 2c20 2a61 7267  datasrc(ax, *arg
+00016e50: 732c 206e 636f 6c73 3d2d 312c 2061 6c6c  s, ncols=-1, all
+00016e60: 6f77 5f73 6361 6c69 6e67 3d54 7275 6529  ow_scaling=True)
+00016e70: 3a0d 0a20 2020 2064 6566 2064 6f5f 6372  :..    def do_cr
+00016e80: 6561 7465 2861 7267 7329 3a0d 0a20 2020  eate(args):..   
+00016e90: 2020 2020 2069 6620 6c65 6e28 6172 6773       if len(args
+00016ea0: 2920 3d3d 2031 2061 6e64 2074 7970 6528  ) == 1 and type(
+00016eb0: 6172 6773 5b30 5d29 203d 3d20 5061 6e64  args[0]) == Pand
+00016ec0: 6173 4461 7461 536f 7572 6365 3a0d 0a20  asDataSource:.. 
+00016ed0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00016ee0: 6e20 6172 6773 5b30 5d0d 0a20 2020 2020  n args[0]..     
+00016ef0: 2020 2069 6620 6c65 6e28 6172 6773 2920     if len(args) 
+00016f00: 3d3d 2031 2061 6e64 2074 7970 6528 6172  == 1 and type(ar
+00016f10: 6773 5b30 5d29 2069 6e20 286c 6973 742c  gs[0]) in (list,
+00016f20: 2074 7570 6c65 293a 0d0a 2020 2020 2020   tuple):..      
+00016f30: 2020 2020 2020 6172 6773 203d 205b 6e70        args = [np
+00016f40: 2e61 7272 6179 2861 7267 735b 305d 295d  .array(args[0])]
+00016f50: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00016f60: 2861 7267 7329 203d 3d20 3120 616e 6420  (args) == 1 and 
+00016f70: 7479 7065 2861 7267 735b 305d 2920 3d3d  type(args[0]) ==
+00016f80: 206e 702e 6e64 6172 7261 793a 0d0a 2020   np.ndarray:..  
+00016f90: 2020 2020 2020 2020 2020 6172 6773 203d            args =
+00016fa0: 205b 7064 2e44 6174 6146 7261 6d65 2861   [pd.DataFrame(a
+00016fb0: 7267 735b 305d 2e54 295d 0d0a 2020 2020  rgs[0].T)]..    
+00016fc0: 2020 2020 6966 206c 656e 2861 7267 7329      if len(args)
+00016fd0: 203d 3d20 3120 616e 6420 7479 7065 2861   == 1 and type(a
+00016fe0: 7267 735b 305d 2920 3d3d 2070 642e 4461  rgs[0]) == pd.Da
+00016ff0: 7461 4672 616d 653a 0d0a 2020 2020 2020  taFrame:..      
+00017000: 2020 2020 2020 7265 7475 726e 2050 616e        return Pan
+00017010: 6461 7344 6174 6153 6f75 7263 6528 6172  dasDataSource(ar
+00017020: 6773 5b30 5d29 0d0a 2020 2020 2020 2020  gs[0])..        
+00017030: 6172 6773 203d 205b 5f63 7265 6174 655f  args = [_create_
+00017040: 7365 7269 6573 2861 2920 666f 7220 6120  series(a) for a 
+00017050: 696e 2061 7267 735d 0d0a 2020 2020 2020  in args]..      
+00017060: 2020 7265 7475 726e 2050 616e 6461 7344    return PandasD
+00017070: 6174 6153 6f75 7263 6528 7064 2e63 6f6e  ataSource(pd.con
+00017080: 6361 7428 6172 6773 2c20 6178 6973 3d31  cat(args, axis=1
+00017090: 2929 0d0a 2020 2020 6961 7267 7320 3d20  ))..    iargs = 
+000170a0: 5b61 2066 6f72 2061 2069 6e20 6172 6773  [a for a in args
+000170b0: 2069 6620 6120 6973 206e 6f74 204e 6f6e   if a is not Non
+000170c0: 655d 0d0a 2020 2020 6461 7461 7372 6320  e]..    datasrc 
+000170d0: 3d20 646f 5f63 7265 6174 6528 6961 7267  = do_create(iarg
+000170e0: 7329 0d0a 2020 2020 2320 6368 6563 6b20  s)..    # check 
+000170f0: 6966 2074 696d 6520 636f 6c75 6d6e 206d  if time column m
+00017100: 6973 7369 6e67 0d0a 2020 2020 6966 206c  issing..    if l
+00017110: 656e 2864 6174 6173 7263 2e64 662e 636f  en(datasrc.df.co
+00017120: 6c75 6d6e 7329 2069 6e20 2831 2c20 6e63  lumns) in (1, nc
+00017130: 6f6c 732d 3129 3a0d 0a20 2020 2020 2020  ols-1):..       
+00017140: 2023 2061 7373 756d 6520 7469 6d65 2064   # assume time d
+00017150: 6174 6120 6861 7320 616c 7265 6164 7920  ata has already 
+00017160: 6265 656e 2061 6464 6564 2062 6566 6f72  been added befor
+00017170: 650d 0a20 2020 2020 2020 2066 6f72 2061  e..        for a
+00017180: 2069 6e20 6178 2e76 622e 7769 6e2e 6178   in ax.vb.win.ax
+00017190: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+000171a0: 6966 2061 2e76 622e 6461 7461 7372 6320  if a.vb.datasrc 
+000171b0: 616e 6420 6c65 6e28 612e 7662 2e64 6174  and len(a.vb.dat
+000171c0: 6173 7263 2e64 662e 636f 6c75 6d6e 7329  asrc.df.columns)
+000171d0: 203e 3d20 323a 0d0a 2020 2020 2020 2020   >= 2:..        
+000171e0: 2020 2020 2020 2020 636f 6c20 3d20 612e          col = a.
+000171f0: 7662 2e64 6174 6173 7263 2e64 662e 636f  vb.datasrc.df.co
+00017200: 6c75 6d6e 735b 305d 0d0a 2020 2020 2020  lumns[0]..      
+00017210: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
+00017220: 2069 6e20 6461 7461 7372 632e 6466 2e63   in datasrc.df.c
+00017230: 6f6c 756d 6e73 3a0d 0a20 2020 2020 2020  olumns:..       
+00017240: 2020 2020 2020 2020 2020 2020 2023 2065               # e
+00017250: 6e73 7572 6520 636f 6c75 6d6e 206e 616d  nsure column nam
+00017260: 6573 2061 7265 2075 6e69 7175 650d 0a20  es are unique.. 
+00017270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017280: 2020 2064 6174 6173 7263 2e64 662e 636f     datasrc.df.co
+00017290: 6c75 6d6e 7320 3d20 612e 7662 2e64 6174  lumns = a.vb.dat
+000172a0: 6173 7263 2e64 662e 636f 6c75 6d6e 735b  asrc.df.columns[
+000172b0: 313a 6c65 6e28 6461 7461 7372 632e 6466  1:len(datasrc.df
+000172c0: 2e63 6f6c 756d 6e73 292b 315d 0d0a 2020  .columns)+1]..  
+000172d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000172e0: 6c20 3d20 612e 7662 2e64 6174 6173 7263  l = a.vb.datasrc
+000172f0: 2e64 662e 636f 6c75 6d6e 735b 305d 0d0a  .df.columns[0]..
+00017300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017310: 6461 7461 7372 632e 6466 2e69 6e73 6572  datasrc.df.inser
+00017320: 7428 302c 2063 6f6c 2c20 612e 7662 2e64  t(0, col, a.vb.d
+00017330: 6174 6173 7263 2e64 665b 636f 6c5d 290d  atasrc.df[col]).
+00017340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017350: 2064 6174 6173 7263 203d 2050 616e 6461   datasrc = Panda
+00017360: 7344 6174 6153 6f75 7263 6528 6461 7461  sDataSource(data
+00017370: 7372 632e 6466 290d 0a20 2020 2020 2020  src.df)..       
+00017380: 2020 2020 2020 2020 2062 7265 616b 0d0a           break..
+00017390: 2020 2020 2020 2020 6966 206c 656e 2864          if len(d
+000173a0: 6174 6173 7263 2e64 662e 636f 6c75 6d6e  atasrc.df.column
+000173b0: 7329 2069 6e20 2831 2c20 6e63 6f6c 732d  s) in (1, ncols-
+000173c0: 3129 3a0d 0a20 2020 2020 2020 2020 2020  1):..           
+000173d0: 2069 6620 6e63 6f6c 7320 3e20 313a 0d0a   if ncols > 1:..
+000173e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173f0: 7072 696e 7428 6622 5741 524e 494e 473a  print(f"WARNING:
+00017400: 2074 6869 7320 7479 7065 206f 6620 706c   this type of pl
+00017410: 6f74 2077 616e 7473 2025 6920 636f 6c75  ot wants %i colu
+00017420: 6d6e 732f 6172 6773 2c20 6275 7420 796f  mns/args, but yo
+00017430: 7527 7665 206f 6e6c 7920 7375 7070 6c69  u've only suppli
+00017440: 6564 2025 6922 2025 2028 6e63 6f6c 732c  ed %i" % (ncols,
+00017450: 206c 656e 2864 6174 6173 7263 2e64 662e   len(datasrc.df.
+00017460: 636f 6c75 6d6e 7329 2929 0d0a 2020 2020  columns)))..    
+00017470: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00017480: 7428 2720 2d20 4173 7375 6d69 6e67 2074  t(' - Assuming t
+00017490: 696d 6520 636f 6c75 6d6e 2069 7320 6d69  ime column is mi
+000174a0: 7373 696e 6720 616e 6420 7573 696e 6720  ssing and using 
+000174b0: 696e 6465 7820 696e 7374 6561 642e 2729  index instead.')
+000174c0: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+000174d0: 7461 7372 6320 3d20 5061 6e64 6173 4461  tasrc = PandasDa
+000174e0: 7461 536f 7572 6365 2864 6174 6173 7263  taSource(datasrc
+000174f0: 2e64 662e 7265 7365 745f 696e 6465 7828  .df.reset_index(
+00017500: 2929 0d0a 2020 2020 656c 6966 206c 656e  ))..    elif len
+00017510: 2869 6172 6773 2920 3e3d 2032 2061 6e64  (iargs) >= 2 and
+00017520: 206c 656e 2864 6174 6173 7263 2e64 662e   len(datasrc.df.
+00017530: 636f 6c75 6d6e 7329 203d 3d20 6c65 6e28  columns) == len(
+00017540: 6961 7267 7329 2b31 2061 6e64 206c 656e  iargs)+1 and len
+00017550: 2869 6172 6773 2920 3d3d 206c 656e 2861  (iargs) == len(a
+00017560: 7267 7329 3a0d 0a20 2020 2020 2020 2074  rgs):..        t
+00017570: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00017580: 2069 6620 272e 496e 7427 2069 6e20 7374   if '.Int' in st
+00017590: 7228 7479 7065 2869 6172 6773 5b30 5d2e  r(type(iargs[0].
+000175a0: 696e 6465 7829 293a 0d0a 2020 2020 2020  index)):..      
+000175b0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000175c0: 2757 4152 4e49 4e47 3a20 7065 7266 6f72  'WARNING: perfor
+000175d0: 6d61 6e63 6520 7065 6e61 6c74 7920 616e  mance penalty an
+000175e0: 6420 6372 6173 6820 6d61 7920 6f63 6375  d crash may occu
+000175f0: 7220 7768 656e 2075 7369 6e67 2069 6e74  r when using int
+00017600: 3634 2069 6e73 7465 6164 206f 6620 7261  64 instead of ra
+00017610: 6e67 6520 696e 6469 6365 732e 2729 0d0a  nge indices.')..
+00017620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017630: 6966 2028 6961 7267 735b 305d 2e69 6e64  if (iargs[0].ind
+00017640: 6578 203d 3d20 7261 6e67 6528 6c65 6e28  ex == range(len(
+00017650: 6961 7267 735b 305d 2929 292e 616c 6c28  iargs[0]))).all(
+00017660: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00017670: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+00017680: 2d20 4669 7820 6279 202e 7265 7365 745f  - Fix by .reset_
+00017690: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
+000176a0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+000176b0: 2020 2020 2020 2020 7265 7475 726e 205f          return _
+000176c0: 6372 6561 7465 5f64 6174 6173 7263 2861  create_datasrc(a
+000176d0: 782c 2064 6174 6173 7263 2e64 665b 6461  x, datasrc.df[da
+000176e0: 7461 7372 632e 6466 2e63 6f6c 756d 6e73  tasrc.df.columns
+000176f0: 5b31 3a5d 5d2c 206e 636f 6c73 3d6e 636f  [1:]], ncols=nco
+00017700: 6c73 290d 0a20 2020 2020 2020 2065 7863  ls)..        exc
+00017710: 6570 743a 0d0a 2020 2020 2020 2020 2020  ept:..          
+00017720: 2020 7072 696e 7428 2757 4152 4e49 4e47    print('WARNING
+00017730: 3a20 696e 7075 7420 6461 7461 2073 6f75  : input data sou
+00017740: 7263 6520 6d61 7920 6361 7573 6520 7065  rce may cause pe
+00017750: 7266 6f72 6d61 6e63 6520 7065 6e61 6c74  rformance penalt
+00017760: 7920 616e 6420 6372 6173 682e 2729 0d0a  y and crash.')..
+00017770: 0d0a 2020 2020 6173 7365 7274 206c 656e  ..    assert len
+00017780: 2864 6174 6173 7263 2e64 662e 636f 6c75  (datasrc.df.colu
+00017790: 6d6e 7329 203e 3d20 6e63 6f6c 732c 2027  mns) >= ncols, '
+000177a0: 4552 524f 523a 2074 6f6f 2066 6577 2063  ERROR: too few c
+000177b0: 6f6c 756d 6e73 2f61 7267 7320 7375 7070  olumns/args supp
+000177c0: 6c69 6564 2066 6f72 2074 6869 7320 706c  lied for this pl
+000177d0: 6f74 270d 0a0d 0a20 2020 2069 6620 6461  ot'....    if da
+000177e0: 7461 7372 632e 7065 7269 6f64 5f6e 7320  tasrc.period_ns 
+000177f0: 3c20 303a 0d0a 2020 2020 2020 2020 7072  < 0:..        pr
+00017800: 696e 7428 2757 4152 4e49 4e47 3a20 696e  int('WARNING: in
+00017810: 7075 7420 6461 7461 2073 6f75 7263 6520  put data source 
+00017820: 6861 7320 7469 6d65 2069 6e20 6465 7363  has time in desc
+00017830: 656e 6469 6e67 206f 7264 6572 2e20 5472  ending order. Tr
+00017840: 7920 736f 7274 5f76 616c 7565 7328 2920  y sort_values() 
+00017850: 6265 666f 7265 2063 616c 6c69 6e67 2e27  before calling.'
+00017860: 290d 0a0d 0a20 2020 2023 2046 4958 3a20  )....    # FIX: 
+00017870: 7374 7570 6964 2051 5420 6275 6720 6361  stupid QT bug ca
+00017880: 7573 6573 2072 6563 7461 6e67 6c65 7320  uses rectangles 
+00017890: 6c61 7267 6572 2074 6861 6e20 3247 2074  larger than 2G t
+000178a0: 6f20 666c 6963 6b65 722c 2073 6f20 7363  o flicker, so sc
+000178b0: 616c 6520 7265 6e64 6572 696e 6720 646f  ale rendering do
+000178c0: 776e 2073 6f6d 650d 0a20 2020 2023 2046  wn some..    # F
+000178d0: 4958 3a20 5079 5174 2035 2e31 352e 3220  IX: PyQt 5.15.2 
+000178e0: 6c69 6e65 7320 3e31 6536 2061 7265 2062  lines >1e6 are b
+000178f0: 6569 6e67 2063 6c69 7070 6564 2074 6f20  eing clipped to 
+00017900: 3165 3620 6475 7269 6e67 2074 6865 2066  1e6 during the f
+00017910: 6972 7374 2072 656e 6465 7220 7061 7373  irst render pass
+00017920: 2c20 736f 2073 6361 6c65 2064 6f77 6e20  , so scale down 
+00017930: 6966 203e 3165 360d 0a20 2020 2069 6620  if >1e6..    if 
+00017940: 6178 2e76 622e 7973 6361 6c65 2e73 6361  ax.vb.yscale.sca
+00017950: 6c65 6620 3d3d 2031 2061 6e64 2061 6c6c  lef == 1 and all
+00017960: 6f77 5f73 6361 6c69 6e67 2061 6e64 2064  ow_scaling and d
+00017970: 6174 6173 7263 2e64 662e 696c 6f63 5b3a  atasrc.df.iloc[:
+00017980: 2c20 313a 5d2e 6d61 7828 6e75 6d65 7269  , 1:].max(numeri
+00017990: 635f 6f6e 6c79 3d54 7275 6529 2e6d 6178  c_only=True).max
+000179a0: 2829 203e 2031 6536 3a0d 0a20 2020 2020  () > 1e6:..     
+000179b0: 2020 2061 782e 7662 2e79 7363 616c 652e     ax.vb.yscale.
+000179c0: 7365 745f 7363 616c 6528 696e 7428 3165  set_scale(int(1e
+000179d0: 3629 290d 0a20 2020 2072 6574 7572 6e20  6))..    return 
+000179e0: 6461 7461 7372 630d 0a0d 0a0d 0a64 6566  datasrc......def
+000179f0: 205f 7365 745f 6461 7461 7372 6328 6178   _set_datasrc(ax
+00017a00: 2c20 6461 7461 7372 632c 2061 6464 636f  , datasrc, addco
+00017a10: 6c73 3d54 7275 6529 3a0d 0a20 2020 2076  ls=True):..    v
+00017a20: 6965 7762 6f78 203d 2061 782e 7662 0d0a  iewbox = ax.vb..
+00017a30: 2020 2020 6966 206e 6f74 2064 6174 6173      if not datas
+00017a40: 7263 2e73 7461 6e64 616c 6f6e 653a 0d0a  rc.standalone:..
+00017a50: 2020 2020 2020 2020 6966 2076 6965 7762          if viewb
+00017a60: 6f78 2e64 6174 6173 7263 2069 7320 4e6f  ox.datasrc is No
+00017a70: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00017a80: 2076 6965 7762 6f78 2e73 6574 5f64 6174   viewbox.set_dat
+00017a90: 6173 7263 2864 6174 6173 7263 2920 2320  asrc(datasrc) # 
+00017aa0: 666f 7220 6d77 6865 656c 207a 6f6f 6d2d  for mwheel zoom-
+00017ab0: 7363 616c 696e 670d 0a20 2020 2020 2020  scaling..       
+00017ac0: 2020 2020 205f 7365 745f 785f 6c69 6d69       _set_x_limi
+00017ad0: 7473 2861 782c 2064 6174 6173 7263 290d  ts(ax, datasrc).
+00017ae0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00017af0: 2020 2020 2020 2020 2020 2020 7430 203d              t0 =
+00017b00: 2076 6965 7762 6f78 2e64 6174 6173 7263   viewbox.datasrc
+00017b10: 2e78 2e6c 6f63 5b30 5d0d 0a20 2020 2020  .x.loc[0]..     
+00017b20: 2020 2020 2020 2069 6620 6164 6463 6f6c         if addcol
+00017b30: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00017b40: 2020 2020 7669 6577 626f 782e 6461 7461      viewbox.data
+00017b50: 7372 632e 6164 6463 6f6c 7328 6461 7461  src.addcols(data
+00017b60: 7372 6329 0d0a 2020 2020 2020 2020 2020  src)..          
+00017b70: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00017b80: 2020 2020 2020 2020 2076 6965 7762 6f78           viewbox
+00017b90: 2e64 6174 6173 7263 2e64 6620 3d20 6461  .datasrc.df = da
+00017ba0: 7461 7372 632e 6466 0d0a 2020 2020 2020  tasrc.df..      
+00017bb0: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
+00017bc0: 2077 6520 6e65 6564 2074 6f20 7265 2d72   we need to re-r
+00017bd0: 656e 6465 7220 7072 6576 696f 7573 2070  ender previous p
+00017be0: 6c6f 7473 2064 7565 2074 6f20 6368 616e  lots due to chan
+00017bf0: 6765 6420 696e 6469 6365 730d 0a20 2020  ged indices..   
+00017c00: 2020 2020 2020 2020 2069 6e64 6963 6573           indices
+00017c10: 5f75 7064 6174 6564 203d 2076 6965 7762  _updated = viewb
+00017c20: 6f78 2e64 6174 6173 7263 2e74 696d 6562  ox.datasrc.timeb
+00017c30: 6173 6564 2829 2061 6e64 2074 3020 213d  ased() and t0 !=
+00017c40: 2076 6965 7762 6f78 2e64 6174 6173 7263   viewbox.datasrc
+00017c50: 2e78 2e6c 6f63 5b30 5d0d 0a20 2020 2020  .x.loc[0]..     
+00017c60: 2020 2020 2020 2066 6f72 2069 7465 6d20         for item 
+00017c70: 696e 2061 782e 6974 656d 733a 0d0a 2020  in ax.items:..  
+00017c80: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00017c90: 2068 6173 6174 7472 2869 7465 6d2c 2027   hasattr(item, '
+00017ca0: 6461 7461 7372 6327 2920 616e 6420 6e6f  datasrc') and no
+00017cb0: 7420 6974 656d 2e64 6174 6173 7263 2e73  t item.datasrc.s
+00017cc0: 7461 6e64 616c 6f6e 653a 0d0a 2020 2020  tandalone:..    
+00017cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ce0: 6974 656d 2e64 6174 6173 7263 2e73 6574  item.datasrc.set
+00017cf0: 5f64 6628 7669 6577 626f 782e 6461 7461  _df(viewbox.data
+00017d00: 7372 632e 6466 2920 2320 6576 6572 7920  src.df) # every 
+00017d10: 706c 6f74 2068 6572 6520 6e6f 7720 6861  plot here now ha
+00017d20: 7320 7468 6520 7361 6d65 2074 696d 652d  s the same time-
+00017d30: 6672 616d 650d 0a20 2020 2020 2020 2020  frame..         
+00017d40: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+00017d50: 6469 6365 735f 7570 6461 7465 643a 0d0a  dices_updated:..
+00017d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d70: 2020 2020 2020 2020 5f73 7461 7274 5f76          _start_v
+00017d80: 6973 7561 6c5f 7570 6461 7465 2869 7465  isual_update(ite
+00017d90: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
+00017da0: 2020 2020 2020 2020 2020 2020 5f65 6e64              _end
+00017db0: 5f76 6973 7561 6c5f 7570 6461 7465 2869  _visual_update(i
+00017dc0: 7465 6d29 0d0a 2020 2020 2020 2020 2020  tem)..          
+00017dd0: 2020 5f73 6574 5f78 5f6c 696d 6974 7328    _set_x_limits(
+00017de0: 6178 2c20 6461 7461 7372 6329 0d0a 2020  ax, datasrc)..  
+00017df0: 2020 2020 2020 2020 2020 7669 6577 626f            viewbo
+00017e00: 782e 7365 745f 6461 7461 7372 6328 7669  x.set_datasrc(vi
+00017e10: 6577 626f 782e 6461 7461 7372 6329 2023  ewbox.datasrc) #
+00017e20: 2075 7064 6174 6520 7a6f 6f6d 0d0a 2020   update zoom..  
+00017e30: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00017e40: 2076 6965 7762 6f78 2e73 7461 6e64 616c   viewbox.standal
+00017e50: 6f6e 6573 2e61 6464 2864 6174 6173 7263  ones.add(datasrc
+00017e60: 290d 0a20 2020 2020 2020 2064 6174 6173  )..        datas
+00017e70: 7263 2e75 7064 6174 655f 696e 6974 5f78  rc.update_init_x
+00017e80: 2876 6965 7762 6f78 2e69 6e69 745f 7374  (viewbox.init_st
+00017e90: 6570 7329 0d0a 2020 2020 2020 2020 6966  eps)..        if
+00017ea0: 2064 6174 6173 7263 2e74 696d 6562 6173   datasrc.timebas
+00017eb0: 6564 2829 2061 6e64 2076 6965 7762 6f78  ed() and viewbox
+00017ec0: 2e64 6174 6173 7263 2069 7320 6e6f 7420  .datasrc is not 
+00017ed0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00017ee0: 2020 2023 2320 7072 696e 7428 2757 4152     ## print('WAR
+00017ef0: 4e49 4e47 3a20 7265 2d69 6e64 6578 696e  NING: re-indexin
+00017f00: 6720 7374 616e 6461 6c6f 6e65 2c20 7469  g standalone, ti
+00017f10: 6d65 2d62 6173 6564 2070 6c6f 7427 290d  me-based plot').
+00017f20: 0a20 2020 2020 2020 2020 2020 2076 6466  .            vdf
+00017f30: 203d 2076 6965 7762 6f78 2e64 6174 6173   = viewbox.datas
+00017f40: 7263 2e64 660d 0a20 2020 2020 2020 2020  rc.df..         
+00017f50: 2020 2064 203d 207b 763a 6b20 666f 7220     d = {v:k for 
+00017f60: 6b2c 7620 696e 2065 6e75 6d65 7261 7465  k,v in enumerate
+00017f70: 2876 6466 5b76 6466 2e63 6f6c 756d 6e73  (vdf[vdf.columns
+00017f80: 5b30 5d5d 297d 0d0a 2020 2020 2020 2020  [0]])}..        
+00017f90: 2020 2020 6461 7461 7372 632e 6466 2e69      datasrc.df.i
+00017fa0: 6e64 6578 203d 205b 645b 695d 2066 6f72  ndex = [d[i] for
+00017fb0: 2069 2069 6e20 6461 7461 7372 632e 6466   i in datasrc.df
+00017fc0: 5b64 6174 6173 7263 2e64 662e 636f 6c75  [datasrc.df.colu
+00017fd0: 6d6e 735b 305d 5d5d 0d0a 2020 2020 2020  mns[0]]]..      
+00017fe0: 2020 2323 2069 6620 6e6f 7420 7669 6577    ## if not view
+00017ff0: 626f 782e 785f 696e 6465 7865 643a 0d0a  box.x_indexed:..
+00018000: 2020 2020 2020 2020 2020 2020 2323 205f              ## _
+00018010: 7365 745f 785f 6c69 6d69 7473 2861 782c  set_x_limits(ax,
+00018020: 2064 6174 6173 7263 290d 0a20 2020 2023   datasrc)..    #
+00018030: 2075 7064 6174 6520 7065 7269 6f64 2069   update period i
+00018040: 6620 7468 6973 2064 6174 6173 7263 2068  f this datasrc h
+00018050: 6173 2068 6967 6865 7220 7469 6d65 2072  as higher time r
+00018060: 6573 6f6c 7574 696f 6e0d 0a20 2020 2067  esolution..    g
+00018070: 6c6f 6261 6c20 6570 6f63 685f 7065 7269  lobal epoch_peri
+00018080: 6f64 0d0a 2020 2020 6966 2064 6174 6173  od..    if datas
+00018090: 7263 2e74 696d 6562 6173 6564 2829 2061  rc.timebased() a
+000180a0: 6e64 2028 6570 6f63 685f 7065 7269 6f64  nd (epoch_period
+000180b0: 203e 2031 6537 206f 7220 6e6f 7420 6461   > 1e7 or not da
+000180c0: 7461 7372 632e 7374 616e 6461 6c6f 6e65  tasrc.standalone
+000180d0: 293a 0d0a 2020 2020 2020 2020 6570 5f73  ):..        ep_s
+000180e0: 6563 7320 3d20 6461 7461 7372 632e 7065  ecs = datasrc.pe
+000180f0: 7269 6f64 5f6e 7320 2f20 3165 390d 0a20  riod_ns / 1e9.. 
+00018100: 2020 2020 2020 2065 706f 6368 5f70 6572         epoch_per
+00018110: 696f 6420 3d20 6570 5f73 6563 7320 6966  iod = ep_secs if
+00018120: 2065 705f 7365 6373 203c 2065 706f 6368   ep_secs < epoch
+00018130: 5f70 6572 696f 6420 656c 7365 2065 706f  _period else epo
+00018140: 6368 5f70 6572 696f 640d 0a0d 0a0d 0a64  ch_period......d
+00018150: 6566 205f 6861 735f 7469 6d65 636f 6c28  ef _has_timecol(
+00018160: 6466 293a 0d0a 2020 2020 7265 7475 726e  df):..    return
+00018170: 206c 656e 2864 662e 636f 6c75 6d6e 7329   len(df.columns)
+00018180: 203e 3d20 320d 0a0d 0a0d 0a64 6566 205f   >= 2......def _
+00018190: 7365 745f 6d61 785f 7a6f 6f6d 2876 6273  set_max_zoom(vbs
+000181a0: 293a 0d0a 2020 2020 2727 2753 6574 2074  ):..    '''Set t
+000181b0: 6865 2072 656c 6174 6976 6520 616c 6c6f  he relative allo
+000181c0: 7765 6420 7a6f 6f6d 206c 6576 656c 2062  wed zoom level b
+000181d0: 6574 7765 656e 2061 7865 7320 6772 6f75  etween axes grou
+000181e0: 7073 2c20 7768 6572 6520 7468 6520 6c6f  ps, where the lo
+000181f0: 7765 7374 2d72 6573 6f6c 7574 696f 6e0d  west-resolution.
+00018200: 0a20 2020 2020 2020 706c 6f74 2069 6e20  .       plot in 
+00018210: 6561 6368 2067 726f 7570 2075 7365 7320  each group uses 
+00018220: 6d61 785f 7a6f 6f6d 5f70 6f69 6e74 732c  max_zoom_points,
+00018230: 2077 6869 6c65 2074 6865 206f 7468 6572   while the other
+00018240: 7320 6765 7420 6120 7363 616c 6520 3e3d  s get a scale >=
+00018250: 3120 6f66 2074 6865 6972 0d0a 2020 2020  1 of their..    
+00018260: 2020 2072 6573 7065 6374 6976 6520 6869     respective hi
+00018270: 6768 6573 7420 7a6f 6f6d 206c 6576 656c  ghest zoom level
+00018280: 2e27 2727 0d0a 2020 2020 6772 6f75 7073  .'''..    groups
+00018290: 203d 2064 6566 6175 6c74 6469 6374 2873   = defaultdict(s
+000182a0: 6574 290d 0a20 2020 2066 6f72 2076 6220  et)..    for vb 
+000182b0: 696e 2076 6273 3a0d 0a20 2020 2020 2020  in vbs:..       
+000182c0: 206d 6173 7465 725f 7662 203d 2076 622e   master_vb = vb.
+000182d0: 6c69 6e6b 6564 5669 6577 2830 290d 0a20  linkedView(0).. 
+000182e0: 2020 2020 2020 2069 6620 7662 2e64 6174         if vb.dat
+000182f0: 6173 7263 2061 6e64 206d 6173 7465 725f  asrc and master_
+00018300: 7662 2061 6e64 206d 6173 7465 725f 7662  vb and master_vb
+00018310: 2e64 6174 6173 7263 3a0d 0a20 2020 2020  .datasrc:..     
+00018320: 2020 2020 2020 2067 726f 7570 735b 6d61         groups[ma
+00018330: 7374 6572 5f76 625d 2e61 6464 2876 6229  ster_vb].add(vb)
+00018340: 0d0a 2020 2020 2020 2020 2020 2020 6772  ..            gr
+00018350: 6f75 7073 5b6d 6173 7465 725f 7662 5d2e  oups[master_vb].
+00018360: 6164 6428 6d61 7374 6572 5f76 6229 0d0a  add(master_vb)..
+00018370: 2020 2020 666f 7220 6772 6f75 7020 696e      for group in
+00018380: 2067 726f 7570 732e 7661 6c75 6573 2829   groups.values()
+00018390: 3a0d 0a20 2020 2020 2020 206d 696e 6c65  :..        minle
+000183a0: 6e20 3d20 6d69 6e28 6c65 6e28 7662 2e64  n = min(len(vb.d
+000183b0: 6174 6173 7263 2e64 6629 2066 6f72 2076  atasrc.df) for v
+000183c0: 6220 696e 2067 726f 7570 290d 0a20 2020  b in group)..   
+000183d0: 2020 2020 2066 6f72 2076 6220 696e 2067       for vb in g
+000183e0: 726f 7570 3a0d 0a20 2020 2020 2020 2020  roup:..         
+000183f0: 2020 2076 622e 6d61 785f 7a6f 6f6d 5f70     vb.max_zoom_p
+00018400: 6f69 6e74 735f 6620 3d20 6c65 6e28 7662  oints_f = len(vb
+00018410: 2e64 6174 6173 7263 2e64 6629 202f 206d  .datasrc.df) / m
+00018420: 696e 6c65 6e0d 0a0d 0a0d 0a64 6566 205f  inlen......def _
+00018430: 6164 6a75 7374 5f72 656e 6b6f 5f64 6174  adjust_renko_dat
+00018440: 6173 7263 2862 696e 732c 2073 7465 702c  asrc(bins, step,
+00018450: 2064 6174 6173 7263 293a 0d0a 2020 2020   datasrc):..    
+00018460: 6966 206e 6f74 2062 696e 7320 616e 6420  if not bins and 
+00018470: 6e6f 7420 7374 6570 3a0d 0a20 2020 2020  not step:..     
+00018480: 2020 2062 696e 7320 3d20 3530 0d0a 2020     bins = 50..  
+00018490: 2020 6966 206e 6f74 2073 7465 703a 0d0a    if not step:..
+000184a0: 2020 2020 2020 2020 7374 6570 203d 2028          step = (
+000184b0: 6461 7461 7372 632e 792e 6d61 7828 292d  datasrc.y.max()-
+000184c0: 6461 7461 7372 632e 792e 6d69 6e28 2929  datasrc.y.min())
+000184d0: 202f 2062 696e 730d 0a20 2020 2062 7269   / bins..    bri
+000184e0: 636b 7320 3d20 6461 7461 7372 632e 792e  cks = datasrc.y.
+000184f0: 6469 6666 2829 202f 2073 7465 700d 0a20  diff() / step.. 
+00018500: 2020 2062 7269 636b 7320 3d20 2864 6174     bricks = (dat
+00018510: 6173 7263 2e79 5b62 7269 636b 732e 6973  asrc.y[bricks.is
+00018520: 6e75 6c6c 2829 207c 2028 6272 6963 6b73  null() | (bricks
+00018530: 2e61 6273 2829 3e3d 302e 3529 5d20 2f20  .abs()>=0.5)] / 
+00018540: 7374 6570 292e 726f 756e 6428 292e 6173  step).round().as
+00018550: 7479 7065 2869 6e74 290d 0a20 2020 2065  type(int)..    e
+00018560: 7874 7261 7320 3d20 6461 7461 7372 632e  xtras = datasrc.
+00018570: 6466 2e69 6c6f 635b 3a2c 2064 6174 6173  df.iloc[:, datas
+00018580: 7263 2e63 6f6c 5f64 6174 615f 6f66 6673  rc.col_data_offs
+00018590: 6574 2b31 3a5d 0d0a 2020 2020 7473 203d  et+1:]..    ts =
+000185a0: 2064 6174 6173 7263 2e78 5b62 7269 636b   datasrc.x[brick
+000185b0: 732e 696e 6465 785d 0d0a 2020 2020 7570  s.index]..    up
+000185c0: 203d 2062 7269 636b 732e 696c 6f63 5b30   = bricks.iloc[0
+000185d0: 5d20 2b20 310d 0a20 2020 2064 6e20 3d20  ] + 1..    dn = 
+000185e0: 7570 202d 2032 0d0a 2020 2020 6461 7461  up - 2..    data
+000185f0: 203d 205b 5d0d 0a20 2020 2066 6f72 2074   = []..    for t
+00018600: 2c69 2c62 7269 636b 2069 6e20 7a69 7028  ,i,brick in zip(
+00018610: 7473 2c20 6272 6963 6b73 2e69 6e64 6578  ts, bricks.index
+00018620: 2c20 6272 6963 6b73 293a 0d0a 2020 2020  , bricks):..    
+00018630: 2020 2020 7320 3d20 300d 0a20 2020 2020      s = 0..     
+00018640: 2020 2069 6620 6272 6963 6b20 3e3d 2075     if brick >= u
+00018650: 703a 0d0a 2020 2020 2020 2020 2020 2020  p:..            
+00018660: 7830 2c78 312c 7320 3d20 7570 2d31 2c62  x0,x1,s = up-1,b
+00018670: 7269 636b 2c2b 310d 0a20 2020 2020 2020  rick,+1..       
+00018680: 2020 2020 2075 7020 3d20 6272 6963 6b2b       up = brick+
+00018690: 310d 0a20 2020 2020 2020 2020 2020 2064  1..            d
+000186a0: 6e20 3d20 6272 6963 6b2d 320d 0a20 2020  n = brick-2..   
+000186b0: 2020 2020 2065 6c69 6620 6272 6963 6b20       elif brick 
+000186c0: 3c3d 2064 6e3a 0d0a 2020 2020 2020 2020  <= dn:..        
+000186d0: 2020 2020 7830 2c78 312c 7320 3d20 646e      x0,x1,s = dn
+000186e0: 2c62 7269 636b 2d31 2c2d 310d 0a20 2020  ,brick-1,-1..   
+000186f0: 2020 2020 2020 2020 2075 7020 3d20 6272           up = br
+00018700: 6963 6b2b 320d 0a20 2020 2020 2020 2020  ick+2..         
+00018710: 2020 2064 6e20 3d20 6272 6963 6b2d 310d     dn = brick-1.
+00018720: 0a20 2020 2020 2020 2069 6620 733a 0d0a  .        if s:..
+00018730: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00018740: 7820 696e 2072 616e 6765 2878 302c 2078  x in range(x0, x
+00018750: 312c 2073 293a 0d0a 2020 2020 2020 2020  1, s):..        
+00018760: 2020 2020 2020 2020 7464 203d 2061 6273          td = abs
+00018770: 2878 312d 7829 2d31 0d0a 2020 2020 2020  (x1-x)-1..      
+00018780: 2020 2020 2020 2020 2020 6473 203d 2030            ds = 0
+00018790: 2069 6620 733e 3020 656c 7365 2073 7465   if s>0 else ste
+000187a0: 700d 0a20 2020 2020 2020 2020 2020 2020  p..             
+000187b0: 2020 2079 203d 2078 2a73 7465 700d 0a20     y = x*step.. 
+000187c0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+000187d0: 203d 206c 6973 7428 6578 7472 6173 2e6c   = list(extras.l
+000187e0: 6f63 5b69 5d29 0d0a 2020 2020 2020 2020  oc[i])..        
+000187f0: 2020 2020 2020 2020 6461 7461 2e61 7070          data.app
+00018800: 656e 6428 5b74 2d74 642c 2079 2b64 732c  end([t-td, y+ds,
+00018810: 2079 2b73 7465 702d 6473 2c20 792b 7374   y+step-ds, y+st
+00018820: 6570 2c20 795d 202b 207a 290d 0a20 2020  ep, y] + z)..   
+00018830: 2064 6174 6173 7263 2e73 6574 5f64 6628   datasrc.set_df(
+00018840: 7064 2e44 6174 6146 7261 6d65 2864 6174  pd.DataFrame(dat
+00018850: 612c 2063 6f6c 756d 6e73 3d27 7469 6d65  a, columns='time
+00018860: 206f 7065 6e20 636c 6f73 6520 6869 6768   open close high
+00018870: 206c 6f77 272e 7370 6c69 7428 292b 6c69   low'.split()+li
+00018880: 7374 2865 7874 7261 732e 636f 6c75 6d6e  st(extras.column
+00018890: 7329 2929 0d0a 0d0a 0d0a 6465 6620 5f61  s)))......def _a
+000188a0: 646a 7573 745f 7265 6e6b 6f5f 6c6f 675f  djust_renko_log_
+000188b0: 6461 7461 7372 6328 6269 6e73 2c20 7374  datasrc(bins, st
+000188c0: 6570 2c20 6461 7461 7372 6329 3a0d 0a20  ep, datasrc):.. 
+000188d0: 2020 2064 6174 6173 7263 2e64 662e 6c6f     datasrc.df.lo
+000188e0: 635b 3a2c 6461 7461 7372 632e 6466 2e63  c[:,datasrc.df.c
+000188f0: 6f6c 756d 6e73 5b31 5d5d 203d 206e 702e  olumns[1]] = np.
+00018900: 6c6f 6731 3028 6461 7461 7372 632e 6466  log10(datasrc.df
+00018910: 2e69 6c6f 635b 3a2c 315d 290d 0a20 2020  .iloc[:,1])..   
+00018920: 205f 6164 6a75 7374 5f72 656e 6b6f 5f64   _adjust_renko_d
+00018930: 6174 6173 7263 2862 696e 732c 2073 7465  atasrc(bins, ste
+00018940: 702c 2064 6174 6173 7263 290d 0a20 2020  p, datasrc)..   
+00018950: 2064 6174 6173 7263 2e64 662e 6c6f 635b   datasrc.df.loc[
+00018960: 3a2c 6461 7461 7372 632e 6466 2e63 6f6c  :,datasrc.df.col
+00018970: 756d 6e73 5b31 3a35 5d5d 203d 2031 302a  umns[1:5]] = 10*
+00018980: 2a64 6174 6173 7263 2e64 662e 696c 6f63  *datasrc.df.iloc
+00018990: 5b3a 2c31 3a35 5d0d 0a0d 0a0d 0a64 6566  [:,1:5]......def
+000189a0: 205f 6164 6a75 7374 5f76 6f6c 756d 655f   _adjust_volume_
+000189b0: 6461 7461 7372 6328 6461 7461 7372 6329  datasrc(datasrc)
+000189c0: 3a0d 0a20 2020 2069 6620 6c65 6e28 6461  :..    if len(da
+000189d0: 7461 7372 632e 6466 2e63 6f6c 756d 6e73  tasrc.df.columns
+000189e0: 2920 3c3d 2034 3a0d 0a20 2020 2020 2020  ) <= 4:..       
+000189f0: 205f 696e 7365 7274 5f63 6f6c 2864 6174   _insert_col(dat
+00018a00: 6173 7263 2c20 332c 2027 5f7a 6572 6f5f  asrc, 3, '_zero_
+00018a10: 272c 205b 305d 2a6c 656e 2864 6174 6173  ', [0]*len(datas
+00018a20: 7263 2e64 6629 2920 2320 6261 7365 206f  rc.df)) # base o
+00018a30: 6620 6361 6e64 6c65 7320 6973 2061 6c77  f candles is alw
+00018a40: 6179 7320 7a65 726f 0d0a 2020 2020 6461  ays zero..    da
+00018a50: 7461 7372 632e 7365 745f 6466 2864 6174  tasrc.set_df(dat
+00018a60: 6173 7263 2e64 662e 696c 6f63 5b3a 2c5b  asrc.df.iloc[:,[
+00018a70: 302c 332c 342c 312c 325d 5d29 2023 2072  0,3,4,1,2]]) # r
+00018a80: 652d 6172 7261 6e67 6520 636f 6c75 6d6e  e-arrange column
+00018a90: 7320 666f 7220 7265 6e64 6572 696e 670d  s for rendering.
+00018aa0: 0a20 2020 2064 6174 6173 7263 2e73 6361  .    datasrc.sca
+00018ab0: 6c65 5f63 6f6c 7320 3d20 5b31 2c20 325d  le_cols = [1, 2]
+00018ac0: 2023 2073 6361 6c65 2062 7920 626f 7468   # scale by both
+00018ad0: 2062 6173 656c 696e 6520 616e 6420 766f   baseline and vo
+00018ae0: 6c75 6d65 0d0a 0d0a 0d0a 6465 6620 5f70  lume......def _p
+00018af0: 7265 6164 6a75 7374 5f68 6f72 697a 5f64  readjust_horiz_d
+00018b00: 6174 6173 7263 2864 6174 6173 7263 293a  atasrc(datasrc):
+00018b10: 0d0a 2020 2020 6172 7261 7969 6679 203d  ..    arrayify =
+00018b20: 206c 616d 6264 6120 643a 2064 2e76 616c   lambda d: d.val
+00018b30: 7565 7320 6966 2074 7970 6528 6429 203d  ues if type(d) =
+00018b40: 3d20 7064 2e44 6174 6146 7261 6d65 2065  = pd.DataFrame e
+00018b50: 6c73 6520 640d 0a20 2020 2023 2063 7265  lse d..    # cre
+00018b60: 6174 6520 6120 6461 7461 6672 616d 6520  ate a dataframe 
+00018b70: 6672 6f6d 2074 6865 2069 6e70 7574 2061  from the input a
+00018b80: 7272 6179 0d0a 2020 2020 7469 6d65 7320  rray..    times 
+00018b90: 3d20 5b74 2066 6f72 2074 2c72 6f77 2069  = [t for t,row i
+00018ba0: 6e20 6461 7461 7372 635d 0d0a 2020 2020  n datasrc]..    
+00018bb0: 6966 206c 656e 2874 696d 6573 2920 3d3d  if len(times) ==
+00018bc0: 2031 3a20 2320 6164 6420 616e 2065 6d70   1: # add an emp
+00018bd0: 7479 2074 696d 6520 736c 6f74 0d0a 2020  ty time slot..  
+00018be0: 2020 2020 2020 7469 6d65 7320 3d20 5b74        times = [t
+00018bf0: 696d 6573 5b30 5d2c 2074 696d 6573 5b30  imes[0], times[0
+00018c00: 5d2b 315d 0d0a 2020 2020 2020 2020 6461  ]+1]..        da
+00018c10: 7461 7372 6320 3d20 6461 7461 7372 6320  tasrc = datasrc 
+00018c20: 2b20 5b5b 7469 6d65 735b 315d 2c20 5b28  + [[times[1], [(
+00018c30: 702c 3029 2066 6f72 2070 2c76 2069 6e20  p,0) for p,v in 
+00018c40: 6172 7261 7969 6679 2864 6174 6173 7263  arrayify(datasrc
+00018c50: 5b30 5d5b 315d 295d 5d5d 0d0a 2020 2020  [0][1])]]]..    
+00018c60: 6461 7461 203d 205b 5b65 2066 6f72 2076  data = [[e for v
+00018c70: 2069 6e20 6172 7261 7969 6679 2872 6f77   in arrayify(row
+00018c80: 2920 666f 7220 6520 696e 2076 5d20 666f  ) for e in v] fo
+00018c90: 7220 742c 726f 7720 696e 2064 6174 6173  r t,row in datas
+00018ca0: 7263 5d0d 0a20 2020 206d 6178 636f 6c73  rc]..    maxcols
+00018cb0: 203d 206d 6178 286c 656e 2872 6f77 2920   = max(len(row) 
+00018cc0: 666f 7220 726f 7720 696e 2064 6174 6129  for row in data)
+00018cd0: 0d0a 2020 2020 7265 7475 726e 2070 642e  ..    return pd.
+00018ce0: 4461 7461 4672 616d 6528 636f 6c75 6d6e  DataFrame(column
+00018cf0: 733d 7261 6e67 6528 6d61 7863 6f6c 7329  s=range(maxcols)
+00018d00: 2c20 6461 7461 3d64 6174 612c 2069 6e64  , data=data, ind
+00018d10: 6578 3d74 696d 6573 290d 0a0d 0a0d 0a64  ex=times)......d
+00018d20: 6566 205f 6164 6a75 7374 5f68 6f72 697a  ef _adjust_horiz
+00018d30: 5f64 6174 6173 7263 2864 6174 6173 7263  _datasrc(datasrc
+00018d40: 293a 0d0a 2020 2020 2320 746f 2062 6520  ):..    # to be 
+00018d50: 6162 6c65 2074 6f20 7363 616c 6520 7072  able to scale pr
+00018d60: 6f70 6572 6c79 2c20 6d6f 7665 2074 6865  operly, move the
+00018d70: 206c 6173 7420 7477 6f20 7661 6c75 6573   last two values
+00018d80: 2074 6f20 7468 6520 6c61 7374 2074 776f   to the last two
+00018d90: 2063 6f6c 756d 6e73 0d0a 2020 2020 7661   columns..    va
+00018da0: 6c75 6573 203d 2064 6174 6173 7263 2e64  lues = datasrc.d
+00018db0: 662e 696c 6f63 5b3a 2c20 313a 5d2e 7661  f.iloc[:, 1:].va
+00018dc0: 6c75 6573 0d0a 2020 2020 666f 7220 692c  lues..    for i,
+00018dd0: 6e72 6f77 2069 6e20 656e 756d 6572 6174  nrow in enumerat
+00018de0: 6528 7661 6c75 6573 293a 0d0a 2020 2020  e(values):..    
+00018df0: 2020 2020 6f72 6f77 203d 206e 726f 775b      orow = nrow[
+00018e00: 7e6e 702e 6973 6e61 6e28 6e72 6f77 295d  ~np.isnan(nrow)]
+00018e10: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00018e20: 286e 726f 7729 203d 3d20 6c65 6e28 6f72  (nrow) == len(or
+00018e30: 6f77 2920 6f72 206c 656e 286f 726f 7729  ow) or len(orow)
+00018e40: 203c 3d20 323a 0d0a 2020 2020 2020 2020   <= 2:..        
+00018e50: 2020 2020 636f 6e74 696e 7565 0d0a 2020      continue..  
+00018e60: 2020 2020 2020 6e72 6f77 5b2d 323a 5d20        nrow[-2:] 
+00018e70: 3d20 6f72 6f77 5b2d 323a 5d0d 0a20 2020  = orow[-2:]..   
+00018e80: 2020 2020 206e 726f 775b 6c65 6e28 6f72       nrow[len(or
+00018e90: 6f77 292d 323a 6c65 6e28 6f72 6f77 295d  ow)-2:len(orow)]
+00018ea0: 203d 206e 702e 6e61 6e0d 0a20 2020 2064   = np.nan..    d
+00018eb0: 6174 6173 7263 2e64 665b 6461 7461 7372  atasrc.df[datasr
+00018ec0: 632e 6466 2e63 6f6c 756d 6e73 5b31 3a5d  c.df.columns[1:]
+00018ed0: 5d20 3d20 7661 6c75 6573 0d0a 0d0a 0d0a  ] = values......
+00018ee0: 6465 6620 5f61 646a 7573 745f 6261 725f  def _adjust_bar_
+00018ef0: 6461 7461 7372 6328 6461 7461 7372 632c  datasrc(datasrc,
+00018f00: 206f 7264 6572 5f63 6f6c 733d 5472 7565   order_cols=True
+00018f10: 293a 0d0a 2020 2020 6966 206c 656e 2864  ):..    if len(d
+00018f20: 6174 6173 7263 2e64 662e 636f 6c75 6d6e  atasrc.df.column
+00018f30: 7329 203c 3d20 323a 0d0a 2020 2020 2020  s) <= 2:..      
+00018f40: 2020 5f69 6e73 6572 745f 636f 6c28 6461    _insert_col(da
+00018f50: 7461 7372 632c 2031 2c20 275f 6261 7365  tasrc, 1, '_base
+00018f60: 5f27 2c20 5b30 5d2a 6c65 6e28 6461 7461  _', [0]*len(data
+00018f70: 7372 632e 6466 2929 2023 2062 6173 650d  src.df)) # base.
+00018f80: 0a20 2020 2069 6620 6c65 6e28 6461 7461  .    if len(data
+00018f90: 7372 632e 6466 2e63 6f6c 756d 6e73 2920  src.df.columns) 
+00018fa0: 3c3d 2034 3a0d 0a20 2020 2020 2020 205f  <= 4:..        _
+00018fb0: 696e 7365 7274 5f63 6f6c 2864 6174 6173  insert_col(datas
+00018fc0: 7263 2c20 312c 2027 5f6f 7065 6e5f 272c  rc, 1, '_open_',
+00018fd0: 2020 5b30 5d2a 6c65 6e28 6461 7461 7372    [0]*len(datasr
+00018fe0: 632e 6466 2929 2023 2022 6f70 656e 2220  c.df)) # "open" 
+00018ff0: 666f 7220 636f 6c6f 720d 0a20 2020 2020  for color..     
+00019000: 2020 205f 696e 7365 7274 5f63 6f6c 2864     _insert_col(d
+00019010: 6174 6173 7263 2c20 322c 2027 5f63 6c6f  atasrc, 2, '_clo
+00019020: 7365 5f27 2c20 6461 7461 7372 632e 6466  se_', datasrc.df
+00019030: 2e69 6c6f 635b 3a2c 2033 5d29 2023 2022  .iloc[:, 3]) # "
+00019040: 636c 6f73 6522 2028 6163 7475 616c 2062  close" (actual b
+00019050: 6172 2076 616c 7565 2920 666f 7220 636f  ar value) for co
+00019060: 6c6f 720d 0a20 2020 2069 6620 6f72 6465  lor..    if orde
+00019070: 725f 636f 6c73 3a0d 0a20 2020 2020 2020  r_cols:..       
+00019080: 2064 6174 6173 7263 2e73 6574 5f64 6628   datasrc.set_df(
+00019090: 6461 7461 7372 632e 6466 2e69 6c6f 635b  datasrc.df.iloc[
+000190a0: 3a2c 5b30 2c33 2c34 2c31 2c32 5d5d 2920  :,[0,3,4,1,2]]) 
+000190b0: 2320 7265 2d61 7272 616e 6765 2063 6f6c  # re-arrange col
+000190c0: 756d 6e73 2066 6f72 2072 656e 6465 7269  umns for renderi
+000190d0: 6e67 0d0a 2020 2020 6461 7461 7372 632e  ng..    datasrc.
+000190e0: 7363 616c 655f 636f 6c73 203d 205b 312c  scale_cols = [1,
+000190f0: 2032 5d20 2320 7363 616c 6520 6279 2062   2] # scale by b
+00019100: 6f74 6820 6261 7365 6c69 6e65 2061 6e64  oth baseline and
+00019110: 2076 6f6c 756d 650d 0a0d 0a0d 0a64 6566   volume......def
+00019120: 205f 7570 6461 7465 5f64 6174 6128 7072   _update_data(pr
+00019130: 6561 646a 7573 7466 756e 632c 2061 646a  eadjustfunc, adj
+00019140: 7573 7466 756e 632c 2069 7465 6d2c 2064  ustfunc, item, d
+00019150: 732c 2067 6678 3d54 7275 6529 3a0d 0a20  s, gfx=True):.. 
+00019160: 2020 2069 6620 7072 6561 646a 7573 7466     if preadjustf
+00019170: 756e 633a 0d0a 2020 2020 2020 2020 6473  unc:..        ds
+00019180: 203d 2070 7265 6164 6a75 7374 6675 6e63   = preadjustfunc
+00019190: 2864 7329 0d0a 2020 2020 6473 203d 205f  (ds)..    ds = _
+000191a0: 6372 6561 7465 5f64 6174 6173 7263 2869  create_datasrc(i
+000191b0: 7465 6d2e 6178 2c20 6473 290d 0a20 2020  tem.ax, ds)..   
+000191c0: 2069 6620 6164 6a75 7374 6675 6e63 3a0d   if adjustfunc:.
+000191d0: 0a20 2020 2020 2020 2061 646a 7573 7466  .        adjustf
+000191e0: 756e 6328 6473 290d 0a20 2020 2063 7320  unc(ds)..    cs 
+000191f0: 3d20 6c69 7374 2869 7465 6d2e 6461 7461  = list(item.data
+00019200: 7372 632e 6466 2e63 6f6c 756d 6e73 5b3a  src.df.columns[:
+00019210: 315d 2920 2b20 6c69 7374 2869 7465 6d2e  1]) + list(item.
+00019220: 6461 7461 7372 632e 6466 2e63 6f6c 756d  datasrc.df.colum
+00019230: 6e73 5b69 7465 6d2e 6461 7461 7372 632e  ns[item.datasrc.
+00019240: 636f 6c5f 6461 7461 5f6f 6666 7365 743a  col_data_offset:
+00019250: 5d29 0d0a 2020 2020 6966 206c 656e 2863  ])..    if len(c
+00019260: 7329 203e 3d20 6c65 6e28 6473 2e64 662e  s) >= len(ds.df.
+00019270: 636f 6c75 6d6e 7329 3a0d 0a20 2020 2020  columns):..     
+00019280: 2020 2064 732e 6466 2e63 6f6c 756d 6e73     ds.df.columns
+00019290: 203d 2063 735b 3a6c 656e 2864 732e 6466   = cs[:len(ds.df
+000192a0: 2e63 6f6c 756d 6e73 295d 0d0a 2020 2020  .columns)]..    
+000192b0: 6974 656d 2e64 6174 6173 7263 2e75 7064  item.datasrc.upd
+000192c0: 6174 6528 6473 290d 0a20 2020 205f 7365  ate(ds)..    _se
+000192d0: 745f 6461 7461 7372 6328 6974 656d 2e61  t_datasrc(item.a
+000192e0: 782c 2069 7465 6d2e 6461 7461 7372 632c  x, item.datasrc,
+000192f0: 2061 6464 636f 6c73 3d46 616c 7365 290d   addcols=False).
+00019300: 0a20 2020 2069 6620 6766 783a 0d0a 2020  .    if gfx:..  
+00019310: 2020 2020 2020 6974 656d 2e75 7064 6174        item.updat
+00019320: 655f 6766 7828 290d 0a0d 0a0d 0a64 6566  e_gfx()......def
+00019330: 205f 7570 6461 7465 5f67 6678 2869 7465   _update_gfx(ite
+00019340: 6d29 3a0d 0a20 2020 205f 7374 6172 745f  m):..    _start_
+00019350: 7669 7375 616c 5f75 7064 6174 6528 6974  visual_update(it
+00019360: 656d 290d 0a20 2020 2066 6f72 2069 2069  em)..    for i i
+00019370: 6e20 6974 656d 2e61 782e 6974 656d 733a  n item.ax.items:
+00019380: 0d0a 2020 2020 2020 2020 6966 2069 203d  ..        if i =
+00019390: 3d20 6974 656d 206f 7220 6e6f 7420 6861  = item or not ha
+000193a0: 7361 7474 7228 692c 2027 6461 7461 7372  sattr(i, 'datasr
+000193b0: 6327 293a 0d0a 2020 2020 2020 2020 2020  c'):..          
+000193c0: 2020 636f 6e74 696e 7565 0d0a 2020 2020    continue..    
+000193d0: 2020 2020 6c63 203d 206c 656e 2869 7465      lc = len(ite
+000193e0: 6d2e 6461 7461 7372 632e 6466 290d 0a20  m.datasrc.df).. 
+000193f0: 2020 2020 2020 206c 6920 3d20 6c65 6e28         li = len(
+00019400: 692e 6461 7461 7372 632e 6466 290d 0a20  i.datasrc.df).. 
+00019410: 2020 2020 2020 2069 6620 6c63 2061 6e64         if lc and
+00019420: 206c 6920 616e 6420 6d61 7828 6c63 2c6c   li and max(lc,l
+00019430: 6929 2f6d 696e 286c 632c 6c69 2920 3e20  i)/min(lc,li) > 
+00019440: 3130 303a 2023 2054 4f44 4f3a 2073 686f  100: # TODO: sho
+00019450: 756c 6420 6265 2074 7970 6564 2069 6e73  uld be typed ins
+00019460: 7465 6164 0d0a 2020 2020 2020 2020 2020  tead..          
+00019470: 2020 636f 6e74 696e 7565 0d0a 2020 2020    continue..    
+00019480: 2020 2020 6363 203d 2069 7465 6d2e 6461      cc = item.da
+00019490: 7461 7372 632e 6466 2e63 6f6c 756d 6e73  tasrc.df.columns
+000194a0: 0d0a 2020 2020 2020 2020 6369 203d 2069  ..        ci = i
+000194b0: 2e64 6174 6173 7263 2e64 662e 636f 6c75  .datasrc.df.colu
+000194c0: 6d6e 730d 0a20 2020 2020 2020 2063 3020  mns..        c0 
+000194d0: 3d20 5b63 2066 6f72 2063 2069 6e20 6369  = [c for c in ci
+000194e0: 2069 6620 6320 696e 2063 635d 0d0a 2020   if c in cc]..  
+000194f0: 2020 2020 2020 6331 203d 205b 6320 666f        c1 = [c fo
+00019500: 7220 6320 696e 2063 6920 6966 206e 6f74  r c in ci if not
+00019510: 2063 2069 6e20 6363 5d0d 0a20 2020 2020   c in cc]..     
+00019520: 2020 2064 665f 636c 6970 7065 6420 3d20     df_clipped = 
+00019530: 6974 656d 2e64 6174 6173 7263 2e64 665b  item.datasrc.df[
+00019540: 6330 5d0d 0a20 2020 2020 2020 2069 6620  c0]..        if 
+00019550: 6331 3a0d 0a20 2020 2020 2020 2020 2020  c1:..           
+00019560: 2064 665f 636c 6970 7065 6420 3d20 6466   df_clipped = df
+00019570: 5f63 6c69 7070 6564 2e63 6f70 7928 290d  _clipped.copy().
+00019580: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00019590: 2063 2069 6e20 6331 3a0d 0a20 2020 2020   c in c1:..     
+000195a0: 2020 2020 2020 2020 2020 2064 665f 636c             df_cl
+000195b0: 6970 7065 645b 635d 203d 2069 2e64 6174  ipped[c] = i.dat
+000195c0: 6173 7263 2e64 665b 635d 0d0a 2020 2020  asrc.df[c]..    
+000195d0: 2020 2020 692e 6461 7461 7372 632e 7365      i.datasrc.se
+000195e0: 745f 6466 2864 665f 636c 6970 7065 6429  t_df(df_clipped)
+000195f0: 0d0a 2020 2020 2020 2020 6272 6561 6b0d  ..        break.
+00019600: 0a20 2020 2075 7064 6174 655f 7369 6764  .    update_sigd
+00019610: 6967 203d 2046 616c 7365 0d0a 2020 2020  ig = False..    
+00019620: 6966 206e 6f74 2069 7465 6d2e 6461 7461  if not item.data
+00019630: 7372 632e 7374 616e 6461 6c6f 6e65 2061  src.standalone a
+00019640: 6e64 206e 6f74 2069 7465 6d2e 6178 2e76  nd not item.ax.v
+00019650: 622e 7769 6e2e 5f69 734d 6f75 7365 4c65  b.win._isMouseLe
+00019660: 6674 4472 6167 3a0d 0a20 2020 2020 2020  ftDrag:..       
+00019670: 2023 206e 6577 206c 696d 6974 7320 7768   # new limits wh
+00019680: 656e 2065 7874 656e 6469 6e67 2f72 6564  en extending/red
+00019690: 7563 696e 6720 616d 6f75 6e74 206f 6620  ucing amount of 
+000196a0: 6461 7461 0d0a 2020 2020 2020 2020 785f  data..        x_
+000196b0: 6d69 6e2c 7831 203d 205f 7365 745f 785f  min,x1 = _set_x_
+000196c0: 6c69 6d69 7473 2869 7465 6d2e 6178 2c20  limits(item.ax, 
+000196d0: 6974 656d 2e64 6174 6173 7263 290d 0a20  item.datasrc).. 
+000196e0: 2020 2020 2020 2023 2073 6372 6f6c 6c20         # scroll 
+000196f0: 616c 6c20 706c 6f74 7320 6966 2077 6527  all plots if we'
+00019700: 7265 2061 7420 7468 6520 6661 7220 7269  re at the far ri
+00019710: 6768 740d 0a20 2020 2020 2020 2074 7220  ght..        tr 
+00019720: 3d20 6974 656d 2e61 782e 7662 2e74 6172  = item.ax.vb.tar
+00019730: 6765 7452 6563 7428 290d 0a20 2020 2020  getRect()..     
+00019740: 2020 2078 3020 3d20 7831 202d 2074 722e     x0 = x1 - tr.
+00019750: 7769 6474 6828 290d 0a20 2020 2020 2020  width()..       
+00019760: 2069 6620 7830 203c 2072 6967 6874 5f6d   if x0 < right_m
+00019770: 6172 6769 6e5f 6361 6e64 6c65 7320 2b20  argin_candles + 
+00019780: 7369 6465 5f6d 6172 6769 6e3a 0d0a 2020  side_margin:..  
+00019790: 2020 2020 2020 2020 2020 7830 203d 202d            x0 = -
+000197a0: 7369 6465 5f6d 6172 6769 6e0d 0a20 2020  side_margin..   
+000197b0: 2020 2020 2069 6620 7472 2e72 6967 6874       if tr.right
+000197c0: 2829 203c 2078 3120 2d20 3520 2d20 322a  () < x1 - 5 - 2*
+000197d0: 7269 6768 745f 6d61 7267 696e 5f63 616e  right_margin_can
+000197e0: 646c 6573 3a0d 0a20 2020 2020 2020 2020  dles:..         
+000197f0: 2020 2078 3020 3d20 7831 203d 204e 6f6e     x0 = x1 = Non
+00019800: 650d 0a20 2020 2020 2020 2070 7265 765f  e..        prev_
+00019810: 746f 7020 3d20 6974 656d 2e61 782e 7662  top = item.ax.vb
+00019820: 2e74 6172 6765 7452 6563 7428 292e 746f  .targetRect().to
+00019830: 7028 290d 0a20 2020 2020 2020 2069 7465  p()..        ite
+00019840: 6d2e 6178 2e76 622e 7570 6461 7465 5f79  m.ax.vb.update_y
+00019850: 5f7a 6f6f 6d28 7830 2c20 7831 290d 0a20  _zoom(x0, x1).. 
+00019860: 2020 2020 2020 2074 6869 735f 746f 7020         this_top 
+00019870: 3d20 6974 656d 2e61 782e 7662 2e74 6172  = item.ax.vb.tar
+00019880: 6765 7452 6563 7428 292e 746f 7028 290d  getRect().top().
+00019890: 0a20 2020 2020 2020 2069 6620 7468 6973  .        if this
+000198a0: 5f74 6f70 2061 6e64 206e 6f74 2028 302e  _top and not (0.
+000198b0: 3939 203c 2061 6273 2870 7265 765f 746f  99 < abs(prev_to
+000198c0: 702f 7468 6973 5f74 6f70 2920 3c20 312e  p/this_top) < 1.
+000198d0: 3031 293a 0d0a 2020 2020 2020 2020 2020  01):..          
+000198e0: 2020 7570 6461 7465 5f73 6967 6469 6720    update_sigdig 
+000198f0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00019900: 6966 2069 7465 6d2e 6178 2e61 7865 735b  if item.ax.axes[
+00019910: 2762 6f74 746f 6d27 5d5b 2769 7465 6d27  'bottom']['item'
+00019920: 5d2e 6973 5669 7369 626c 6528 293a 2023  ].isVisible(): #
+00019930: 2075 7064 6174 6520 6178 6573 2069 6620   update axes if 
+00019940: 7669 7369 626c 650d 0a20 2020 2020 2020  visible..       
+00019950: 2020 2020 2069 7465 6d2e 6178 2e61 7865       item.ax.axe
+00019960: 735b 2762 6f74 746f 6d27 5d5b 2769 7465  s['bottom']['ite
+00019970: 6d27 5d2e 6869 6465 2829 0d0a 2020 2020  m'].hide()..    
+00019980: 2020 2020 2020 2020 6974 656d 2e61 782e          item.ax.
+00019990: 6178 6573 5b27 626f 7474 6f6d 275d 5b27  axes['bottom']['
+000199a0: 6974 656d 275d 2e73 686f 7728 290d 0a20  item'].show().. 
+000199b0: 2020 205f 656e 645f 7669 7375 616c 5f75     _end_visual_u
+000199c0: 7064 6174 6528 6974 656d 290d 0a20 2020  pdate(item)..   
+000199d0: 2069 6620 7570 6461 7465 5f73 6967 6469   if update_sigdi
+000199e0: 673a 0d0a 2020 2020 2020 2020 5f75 7064  g:..        _upd
+000199f0: 6174 655f 7369 676e 6966 6963 616e 7473  ate_significants
+00019a00: 2869 7465 6d2e 6178 2c20 6974 656d 2e61  (item.ax, item.a
+00019a10: 782e 7662 2e64 6174 6173 7263 2c20 666f  x.vb.datasrc, fo
+00019a20: 7263 653d 5472 7565 290d 0a0d 0a0d 0a64  rce=True)......d
+00019a30: 6566 205f 7374 6172 745f 7669 7375 616c  ef _start_visual
+00019a40: 5f75 7064 6174 6528 6974 656d 293a 0d0a  _update(item):..
+00019a50: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00019a60: 6528 6974 656d 2c20 4669 6e50 6c6f 7449  e(item, FinPlotI
+00019a70: 7465 6d29 3a0d 0a20 2020 2020 2020 2069  tem):..        i
+00019a80: 7465 6d2e 6178 2e72 656d 6f76 6549 7465  tem.ax.removeIte
+00019a90: 6d28 6974 656d 290d 0a20 2020 2020 2020  m(item)..       
+00019aa0: 2069 7465 6d2e 6469 7274 7920 3d20 5472   item.dirty = Tr
+00019ab0: 7565 0d0a 2020 2020 656c 7365 3a0d 0a20  ue..    else:.. 
+00019ac0: 2020 2020 2020 2079 203d 2069 7465 6d2e         y = item.
+00019ad0: 6461 7461 7372 632e 7920 2f20 6974 656d  datasrc.y / item
+00019ae0: 2e61 782e 7662 2e79 7363 616c 652e 7363  .ax.vb.yscale.sc
+00019af0: 616c 6566 0d0a 2020 2020 2020 2020 6966  alef..        if
+00019b00: 2069 7465 6d2e 6178 2e76 622e 7973 6361   item.ax.vb.ysca
+00019b10: 6c65 2e73 6361 6c65 7479 7065 203d 3d20  le.scaletype == 
+00019b20: 276c 6f67 273a 0d0a 2020 2020 2020 2020  'log':..        
+00019b30: 2020 2020 7920 3d20 7920 2b20 6c6f 675f      y = y + log_
+00019b40: 706c 6f74 5f6f 6666 7365 740d 0a20 2020  plot_offset..   
+00019b50: 2020 2020 2078 203d 2069 7465 6d2e 6461       x = item.da
+00019b60: 7461 7372 632e 696e 6465 7820 6966 2069  tasrc.index if i
+00019b70: 7465 6d2e 6178 2e76 622e 785f 696e 6465  tem.ax.vb.x_inde
+00019b80: 7865 6420 656c 7365 2069 7465 6d2e 6461  xed else item.da
+00019b90: 7461 7372 632e 780d 0a20 2020 2020 2020  tasrc.x..       
+00019ba0: 2069 7465 6d2e 7365 7444 6174 6128 782c   item.setData(x,
+00019bb0: 2079 290d 0a0d 0a0d 0a64 6566 205f 656e   y)......def _en
+00019bc0: 645f 7669 7375 616c 5f75 7064 6174 6528  d_visual_update(
+00019bd0: 6974 656d 293a 0d0a 2020 2020 6966 2069  item):..    if i
+00019be0: 7369 6e73 7461 6e63 6528 6974 656d 2c20  sinstance(item, 
+00019bf0: 4669 6e50 6c6f 7449 7465 6d29 3a0d 0a20  FinPlotItem):.. 
+00019c00: 2020 2020 2020 2069 7465 6d2e 6178 2e61         item.ax.a
+00019c10: 6464 4974 656d 2869 7465 6d29 0d0a 2020  ddItem(item)..  
+00019c20: 2020 2020 2020 6974 656d 2e72 6570 6169        item.repai
+00019c30: 6e74 2829 0d0a 0d0a 0d0a 6465 6620 5f73  nt()......def _s
+00019c40: 6574 5f78 5f6c 696d 6974 7328 6178 2c20  et_x_limits(ax, 
+00019c50: 6461 7461 7372 6329 3a0d 0a20 2020 2078  datasrc):..    x
+00019c60: 302c 7831 203d 205f 786d 696e 6d61 7828  0,x1 = _xminmax(
+00019c70: 6461 7461 7372 632c 2078 5f69 6e64 6578  datasrc, x_index
+00019c80: 6564 3d61 782e 7662 2e78 5f69 6e64 6578  ed=ax.vb.x_index
+00019c90: 6564 290d 0a20 2020 2061 782e 7365 744c  ed)..    ax.setL
+00019ca0: 696d 6974 7328 784d 696e 3d78 302c 2078  imits(xMin=x0, x
+00019cb0: 4d61 783d 7831 290d 0a20 2020 2072 6574  Max=x1)..    ret
+00019cc0: 7572 6e20 7830 2c78 310d 0a0d 0a0d 0a64  urn x0,x1......d
+00019cd0: 6566 205f 786d 696e 6d61 7828 6461 7461  ef _xminmax(data
+00019ce0: 7372 632c 2078 5f69 6e64 6578 6564 2c20  src, x_indexed, 
+00019cf0: 696e 6974 5f73 7465 7073 3d4e 6f6e 652c  init_steps=None,
+00019d00: 2065 7874 7261 5f6d 6172 6769 6e3d 3029   extra_margin=0)
+00019d10: 3a0d 0a20 2020 2069 6620 785f 696e 6465  :..    if x_inde
+00019d20: 7865 6420 616e 6420 696e 6974 5f73 7465  xed and init_ste
+00019d30: 7073 3a0d 0a20 2020 2020 2020 2023 2069  ps:..        # i
+00019d40: 6e69 7469 616c 207a 6f6f 6d0d 0a20 2020  nitial zoom..   
+00019d50: 2020 2020 2078 3020 3d20 6d61 7828 6461       x0 = max(da
+00019d60: 7461 7372 632e 786c 656e 2d69 6e69 745f  tasrc.xlen-init_
+00019d70: 7374 6570 732c 2030 2920 2d20 7369 6465  steps, 0) - side
+00019d80: 5f6d 6172 6769 6e20 2d20 6578 7472 615f  _margin - extra_
+00019d90: 6d61 7267 696e 0d0a 2020 2020 2020 2020  margin..        
+00019da0: 7831 203d 2064 6174 6173 7263 2e78 6c65  x1 = datasrc.xle
+00019db0: 6e20 2b20 7269 6768 745f 6d61 7267 696e  n + right_margin
+00019dc0: 5f63 616e 646c 6573 202b 2073 6964 655f  _candles + side_
+00019dd0: 6d61 7267 696e 202b 2065 7874 7261 5f6d  margin + extra_m
+00019de0: 6172 6769 6e0d 0a20 2020 2065 6c69 6620  argin..    elif 
+00019df0: 785f 696e 6465 7865 643a 0d0a 2020 2020  x_indexed:..    
+00019e00: 2020 2020 2320 746f 7461 6c20 7820 7369      # total x si
+00019e10: 7a65 2066 6f72 2069 6e64 6578 6564 2064  ze for indexed d
+00019e20: 6174 610d 0a20 2020 2020 2020 2078 3020  ata..        x0 
+00019e30: 3d20 2d73 6964 655f 6d61 7267 696e 202d  = -side_margin -
+00019e40: 2065 7874 7261 5f6d 6172 6769 6e0d 0a20   extra_margin.. 
+00019e50: 2020 2020 2020 2078 3120 3d20 6461 7461         x1 = data
+00019e60: 7372 632e 786c 656e 202b 2072 6967 6874  src.xlen + right
+00019e70: 5f6d 6172 6769 6e5f 6361 6e64 6c65 7320  _margin_candles 
+00019e80: 2d20 3120 2b20 7369 6465 5f6d 6172 6769  - 1 + side_margi
+00019e90: 6e20 2b20 6578 7472 615f 6d61 7267 696e  n + extra_margin
+00019ea0: 2023 2061 6464 2061 6e6f 7468 6572 206d   # add another m
+00019eb0: 6172 6769 6e20 746f 2067 6574 2074 6865  argin to get the
+00019ec0: 2022 736e 6170 2062 6163 6b22 2073 656e   "snap back" sen
+00019ed0: 7361 7469 6f6e 0d0a 2020 2020 656c 7365  sation..    else
+00019ee0: 3a0d 0a20 2020 2020 2020 2023 2078 2073  :..        # x s
+00019ef0: 697a 6520 666f 7220 706c 6169 6e20 592d  ize for plain Y-
+00019f00: 6f76 6572 2d58 2064 6174 6120 2869 2e65  over-X data (i.e
+00019f10: 2e20 6e6f 7420 696e 6465 7865 6429 0d0a  . not indexed)..
+00019f20: 2020 2020 2020 2020 7830 203d 2064 6174          x0 = dat
+00019f30: 6173 7263 2e78 2e6d 696e 2829 0d0a 2020  asrc.x.min()..  
+00019f40: 2020 2020 2020 7831 203d 2064 6174 6173        x1 = datas
+00019f50: 7263 2e78 2e6d 6178 2829 0d0a 2020 2020  rc.x.max()..    
+00019f60: 2020 2020 2320 6578 7465 6e64 206d 6172      # extend mar
+00019f70: 6769 6e20 6f6e 2064 6563 6f75 706c 6564  gin on decoupled
+00019f80: 2070 6c6f 7473 0d0a 2020 2020 2020 2020   plots..        
+00019f90: 6420 3d20 2878 312d 7830 2920 2a20 2830  d = (x1-x0) * (0
+00019fa0: 2e32 2b65 7874 7261 5f6d 6172 6769 6e29  .2+extra_margin)
+00019fb0: 0d0a 2020 2020 2020 2020 7830 202d 3d20  ..        x0 -= 
+00019fc0: 640d 0a20 2020 2020 2020 2078 3120 2b3d  d..        x1 +=
+00019fd0: 2064 0d0a 2020 2020 7265 7475 726e 2078   d..    return x
+00019fe0: 302c 7831 0d0a 0d0a 0d0a 6465 6620 5f72  0,x1......def _r
+00019ff0: 6570 6169 6e74 5f63 616e 646c 6573 2829  epaint_candles()
+0001a000: 3a0d 0a20 2020 2027 2727 4361 6e64 6c65  :..    '''Candle
+0001a010: 7320 6172 6520 6f6e 6c79 2070 6172 7469  s are only parti
+0001a020: 616c 6c79 2064 7261 776e 2c20 616e 6420  ally drawn, and 
+0001a030: 7468 6572 6566 6f72 6520 6e65 6564 7320  therefore needs 
+0001a040: 6d61 6e75 616c 2064 6972 7479 2072 656d  manual dirty rem
+0001a050: 696e 6465 7220 7768 656e 6576 6572 2069  inder whenever i
+0001a060: 7420 676f 6573 206f 6666 2d73 6372 6565  t goes off-scree
+0001a070: 6e2e 2727 270d 0a20 2020 2061 7873 203d  n.'''..    axs =
+0001a080: 205b 6178 2066 6f72 2077 696e 2069 6e20   [ax for win in 
+0001a090: 7769 6e64 6f77 7320 666f 7220 6178 2069  windows for ax i
+0001a0a0: 6e20 7769 6e2e 6178 735d 202b 206f 7665  n win.axs] + ove
+0001a0b0: 726c 6179 5f61 7873 0d0a 2020 2020 666f  rlay_axs..    fo
+0001a0c0: 7220 6178 2069 6e20 6178 733a 0d0a 2020  r ax in axs:..  
+0001a0d0: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
+0001a0e0: 6e20 6c69 7374 2861 782e 6974 656d 7329  n list(ax.items)
+0001a0f0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0001a100: 6620 6973 696e 7374 616e 6365 2869 7465  f isinstance(ite
+0001a110: 6d2c 2046 696e 506c 6f74 4974 656d 293a  m, FinPlotItem):
+0001a120: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001a130: 2020 5f73 7461 7274 5f76 6973 7561 6c5f    _start_visual_
+0001a140: 7570 6461 7465 2869 7465 6d29 0d0a 2020  update(item)..  
+0001a150: 2020 2020 2020 2020 2020 2020 2020 5f65                _e
+0001a160: 6e64 5f76 6973 7561 6c5f 7570 6461 7465  nd_visual_update
+0001a170: 2869 7465 6d29 0d0a 0d0a 0d0a 6465 6620  (item)......def 
+0001a180: 5f70 6169 6e74 5f73 6361 7474 6572 2869  _paint_scatter(i
+0001a190: 7465 6d2c 2070 2c20 2a61 7267 7329 3a0d  tem, p, *args):.
+0001a1a0: 0a20 2020 2077 6974 6820 6e70 2e65 7272  .    with np.err
+0001a1b0: 7374 6174 6528 696e 7661 6c69 643d 2769  state(invalid='i
+0001a1c0: 676e 6f72 6527 293a 2023 206d 616b 6520  gnore'): # make 
+0001a1d0: 7067 2773 206d 6173 6b20 6372 6561 7469  pg's mask creati
+0001a1e0: 6f6e 2063 616c 6c73 2074 6f20 6e75 6d70  on calls to nump
+0001a1f0: 7920 7368 7574 2075 700d 0a20 2020 2020  y shut up..     
+0001a200: 2020 2069 7465 6d2e 5f64 6f70 6169 6e74     item._dopaint
+0001a210: 2870 2c20 2a61 7267 7329 0d0a 0d0a 0d0a  (p, *args)......
+0001a220: 6465 6620 5f6b 6579 5f70 7265 7373 6564  def _key_pressed
+0001a230: 2876 622c 2065 7629 3a0d 0a20 2020 2069  (vb, ev):..    i
+0001a240: 6620 6576 2e74 6578 7428 2920 3d3d 2027  f ev.text() == '
+0001a250: 6727 3a20 2320 6772 6964 0d0a 2020 2020  g': # grid..    
+0001a260: 2020 2020 676c 6f62 616c 2063 6c61 6d70      global clamp
+0001a270: 5f67 7269 640d 0a20 2020 2020 2020 2063  _grid..        c
+0001a280: 6c61 6d70 5f67 7269 6420 3d20 6e6f 7420  lamp_grid = not 
+0001a290: 636c 616d 705f 6772 6964 0d0a 2020 2020  clamp_grid..    
+0001a2a0: 2020 2020 666f 7220 7769 6e20 696e 2077      for win in w
+0001a2b0: 696e 646f 7773 3a0d 0a20 2020 2020 2020  indows:..       
+0001a2c0: 2020 2020 2066 6f72 2061 7820 696e 2077       for ax in w
+0001a2d0: 696e 2e61 7873 3a0d 0a20 2020 2020 2020  in.axs:..       
+0001a2e0: 2020 2020 2020 2020 2061 782e 6372 6f73           ax.cros
+0001a2f0: 7368 6169 722e 7570 6461 7465 2829 0d0a  shair.update()..
+0001a300: 2020 2020 656c 6966 2065 762e 7465 7874      elif ev.text
+0001a310: 2829 203d 3d20 2769 273a 2023 2069 6e76  () == 'i': # inv
+0001a320: 6572 7420 792d 6178 6573 0d0a 2020 2020  ert y-axes..    
+0001a330: 2020 2020 666f 7220 7769 6e20 696e 2077      for win in w
+0001a340: 696e 646f 7773 3a0d 0a20 2020 2020 2020  indows:..       
+0001a350: 2020 2020 2066 6f72 2061 7820 696e 2077       for ax in w
+0001a360: 696e 2e61 7873 3a0d 0a20 2020 2020 2020  in.axs:..       
+0001a370: 2020 2020 2020 2020 2061 782e 696e 7665           ax.inve
+0001a380: 7274 5f79 2829 0d0a 2020 2020 656c 6966  rt_y()..    elif
+0001a390: 2065 762e 7465 7874 2829 203d 3d20 2766   ev.text() == 'f
+0001a3a0: 273a 2023 2066 6f63 7573 2f65 7870 616e  ': # focus/expan
+0001a3b0: 6420 6163 7469 7665 2061 7869 730d 0a20  d active axis.. 
+0001a3c0: 2020 2020 2020 2076 622e 7061 7265 6e74         vb.parent
+0001a3d0: 2829 2e65 7870 616e 6428 290d 0a20 2020  ().expand()..   
+0001a3e0: 2065 6c69 6620 6576 2e74 6578 7428 2920   elif ev.text() 
+0001a3f0: 696e 2028 275c 7227 2c20 2720 2729 3a20  in ('\r', ' '): 
+0001a400: 2320 656e 7465 722c 2073 7061 6365 0d0a  # enter, space..
+0001a410: 2020 2020 2020 2020 7662 2e73 6574 5f64          vb.set_d
+0001a420: 7261 775f 6c69 6e65 5f63 6f6c 6f72 2864  raw_line_color(d
+0001a430: 7261 775f 646f 6e65 5f63 6f6c 6f72 290d  raw_done_color).
+0001a440: 0a20 2020 2020 2020 2076 622e 6472 6177  .        vb.draw
+0001a450: 5f6c 696e 6520 3d20 4e6f 6e65 0d0a 2020  _line = None..  
+0001a460: 2020 656c 6966 2065 762e 7465 7874 2829    elif ev.text()
+0001a470: 2069 6e20 2827 5c78 3766 272c 2027 5c62   in ('\x7f', '\b
+0001a480: 2729 3a20 2320 6465 6c2c 2062 6163 6b73  '): # del, backs
+0001a490: 7061 6365 0d0a 2020 2020 2020 2020 6966  pace..        if
+0001a4a0: 206e 6f74 2076 622e 7265 6d6f 7665 5f6c   not vb.remove_l
+0001a4b0: 6173 745f 726f 6928 293a 0d0a 2020 2020  ast_roi():..    
+0001a4c0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001a4d0: 616c 7365 0d0a 2020 2020 656c 6966 2065  alse..    elif e
+0001a4e0: 762e 6b65 7928 2920 3d3d 2051 7443 6f72  v.key() == QtCor
+0001a4f0: 652e 5174 2e4b 6579 2e4b 6579 5f4c 6566  e.Qt.Key.Key_Lef
+0001a500: 743a 0d0a 2020 2020 2020 2020 7662 2e70  t:..        vb.p
+0001a510: 616e 5f78 2870 6572 6365 6e74 3d2d 3135  an_x(percent=-15
+0001a520: 290d 0a20 2020 2065 6c69 6620 6576 2e6b  )..    elif ev.k
+0001a530: 6579 2829 203d 3d20 5174 436f 7265 2e51  ey() == QtCore.Q
+0001a540: 742e 4b65 792e 4b65 795f 5269 6768 743a  t.Key.Key_Right:
+0001a550: 0d0a 2020 2020 2020 2020 7662 2e70 616e  ..        vb.pan
+0001a560: 5f78 2870 6572 6365 6e74 3d2b 3135 290d  _x(percent=+15).
+0001a570: 0a20 2020 2065 6c69 6620 6576 2e6b 6579  .    elif ev.key
+0001a580: 2829 203d 3d20 5174 436f 7265 2e51 742e  () == QtCore.Qt.
+0001a590: 4b65 792e 4b65 795f 486f 6d65 3a0d 0a20  Key.Key_Home:.. 
+0001a5a0: 2020 2020 2020 2076 622e 7061 6e5f 7828         vb.pan_x(
+0001a5b0: 7374 6570 733d 2d31 6531 3029 0d0a 2020  steps=-1e10)..  
+0001a5c0: 2020 2020 2020 5f72 6570 6169 6e74 5f63        _repaint_c
+0001a5d0: 616e 646c 6573 2829 0d0a 2020 2020 656c  andles()..    el
+0001a5e0: 6966 2065 762e 6b65 7928 2920 3d3d 2051  if ev.key() == Q
+0001a5f0: 7443 6f72 652e 5174 2e4b 6579 2e4b 6579  tCore.Qt.Key.Key
+0001a600: 5f45 6e64 3a0d 0a20 2020 2020 2020 2076  _End:..        v
+0001a610: 622e 7061 6e5f 7828 7374 6570 733d 2b31  b.pan_x(steps=+1
+0001a620: 6531 3029 0d0a 2020 2020 2020 2020 5f72  e10)..        _r
+0001a630: 6570 6169 6e74 5f63 616e 646c 6573 2829  epaint_candles()
+0001a640: 0d0a 2020 2020 656c 6966 2065 762e 6b65  ..    elif ev.ke
+0001a650: 7928 2920 3d3d 2051 7443 6f72 652e 5174  y() == QtCore.Qt
+0001a660: 2e4b 6579 2e4b 6579 5f45 7363 6170 6520  .Key.Key_Escape 
+0001a670: 616e 6420 6b65 795f 6573 635f 636c 6f73  and key_esc_clos
+0001a680: 653a 0d0a 2020 2020 2020 2020 7662 2e77  e:..        vb.w
+0001a690: 696e 2e63 6c6f 7365 2829 0d0a 2020 2020  in.close()..    
+0001a6a0: 656c 7365 3a0d 0a20 2020 2020 2020 2072  else:..        r
+0001a6b0: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+0001a6c0: 2072 6574 7572 6e20 5472 7565 0d0a 0d0a   return True....
+0001a6d0: 0d0a 6465 6620 5f6d 6f75 7365 5f63 6c69  ..def _mouse_cli
+0001a6e0: 636b 6564 2876 622c 2065 7629 3a0d 0a20  cked(vb, ev):.. 
+0001a6f0: 2020 2069 6620 6576 2e62 7574 746f 6e28     if ev.button(
+0001a700: 2920 3d3d 2038 3a20 2320 6261 636b 0d0a  ) == 8: # back..
+0001a710: 2020 2020 2020 2020 7662 2e70 616e 5f78          vb.pan_x
+0001a720: 2870 6572 6365 6e74 3d2d 3330 290d 0a20  (percent=-30).. 
+0001a730: 2020 2065 6c69 6620 6576 2e62 7574 746f     elif ev.butto
+0001a740: 6e28 2920 3d3d 2031 363a 2023 2066 7764  n() == 16: # fwd
+0001a750: 0d0a 2020 2020 2020 2020 7662 2e70 616e  ..        vb.pan
+0001a760: 5f78 2870 6572 6365 6e74 3d2b 3330 290d  _x(percent=+30).
+0001a770: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
+0001a780: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001a790: 0d0a 2020 2020 7265 7475 726e 2054 7275  ..    return Tru
+0001a7a0: 650d 0a0d 0a0d 0a64 6566 205f 6d6f 7573  e......def _mous
+0001a7b0: 655f 6d6f 7665 6428 6d61 7374 6572 2c20  e_moved(master, 
+0001a7c0: 7662 2c20 6576 7329 3a0d 0a20 2020 2069  vb, evs):..    i
+0001a7d0: 6620 6861 7361 7474 7228 6d61 7374 6572  f hasattr(master
+0001a7e0: 2c20 2763 6c6f 7369 6e67 2729 2061 6e64  , 'closing') and
+0001a7f0: 206d 6173 7465 722e 636c 6f73 696e 673a   master.closing:
+0001a800: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001a810: 0d0a 2020 2020 6d64 203d 206d 6173 7465  ..    md = maste
+0001a820: 725f 6461 7461 5b6d 6173 7465 725d 2e67  r_data[master].g
+0001a830: 6574 2876 6229 206f 7220 6d61 7374 6572  et(vb) or master
+0001a840: 5f64 6174 615b 6d61 7374 6572 5d2e 6765  _data[master].ge
+0001a850: 7428 2764 6566 6175 6c74 2729 0d0a 2020  t('default')..  
+0001a860: 2020 6966 206d 6420 6973 204e 6f6e 653a    if md is None:
+0001a870: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001a880: 0d0a 2020 2020 6966 206e 6f74 2065 7673  ..    if not evs
+0001a890: 3a0d 0a20 2020 2020 2020 2065 7673 203d  :..        evs =
+0001a8a0: 206d 645b 276c 6173 745f 6d6f 7573 655f   md['last_mouse_
+0001a8b0: 6576 7327 5d0d 0a20 2020 2020 2020 2069  evs']..        i
+0001a8c0: 6620 6e6f 7420 6576 733a 0d0a 2020 2020  f not evs:..    
+0001a8d0: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
+0001a8e0: 2020 2020 6d64 5b27 6c61 7374 5f6d 6f75      md['last_mou
+0001a8f0: 7365 5f65 7673 275d 203d 2065 7673 0d0a  se_evs'] = evs..
+0001a900: 2020 2020 706f 7320 3d20 6576 735b 2d31      pos = evs[-1
+0001a910: 5d0d 0a20 2020 2023 2061 6c6c 6f77 2069  ]..    # allow i
+0001a920: 6e74 6572 2d70 6978 656c 206d 6f76 6573  nter-pixel moves
+0001a930: 2069 6620 6d6f 7669 6e67 206d 6f75 7365   if moving mouse
+0001a940: 2073 6c6f 776c 790d 0a20 2020 2079 203d   slowly..    y =
+0001a950: 2070 6f73 2e79 2829 0d0a 2020 2020 6479   pos.y()..    dy
+0001a960: 203d 2079 202d 206d 645b 276c 6173 745f   = y - md['last_
+0001a970: 6d6f 7573 655f 7927 5d0d 0a20 2020 2069  mouse_y']..    i
+0001a980: 6620 3020 3c20 6162 7328 6479 2920 3c3d  f 0 < abs(dy) <=
+0001a990: 2031 3a0d 0a20 2020 2020 2020 2070 6f73   1:..        pos
+0001a9a0: 2e73 6574 5928 706f 732e 7928 2920 2d20  .setY(pos.y() - 
+0001a9b0: 6479 2f32 290d 0a20 2020 206d 645b 276c  dy/2)..    md['l
+0001a9c0: 6173 745f 6d6f 7573 655f 7927 5d20 3d20  ast_mouse_y'] = 
+0001a9d0: 790d 0a20 2020 2023 2061 7070 6c79 2074  y..    # apply t
+0001a9e0: 6f20 616c 6c20 6372 6f73 7368 6169 7273  o all crosshairs
+0001a9f0: 0d0a 2020 2020 666f 7220 6178 2069 6e20  ..    for ax in 
+0001aa00: 6d61 7374 6572 2e61 7873 3a0d 0a20 2020  master.axs:..   
+0001aa10: 2020 2020 2069 6620 6178 2e69 7356 6973       if ax.isVis
+0001aa20: 6962 6c65 2829 2061 6e64 2061 782e 6372  ible() and ax.cr
+0001aa30: 6f73 7368 6169 723a 0d0a 2020 2020 2020  osshair:..      
+0001aa40: 2020 2020 2020 706f 696e 7420 3d20 6178        point = ax
+0001aa50: 2e76 622e 6d61 7053 6365 6e65 546f 5669  .vb.mapSceneToVi
+0001aa60: 6577 2870 6f73 290d 0a20 2020 2020 2020  ew(pos)..       
+0001aa70: 2020 2020 2061 782e 6372 6f73 7368 6169       ax.crosshai
+0001aa80: 722e 7570 6461 7465 2870 6f69 6e74 290d  r.update(point).
+0001aa90: 0a0d 0a0d 0a64 6566 205f 7768 6565 6c5f  .....def _wheel_
+0001aaa0: 6576 656e 745f 7772 6170 7065 7228 7365  event_wrapper(se
+0001aab0: 6c66 2c20 6f72 6967 5f66 756e 632c 2065  lf, orig_func, e
+0001aac0: 7629 3a0d 0a20 2020 2023 2073 6372 6f6c  v):..    # scrol
+0001aad0: 6c69 6e67 206f 6e20 7468 6520 626f 7264  ling on the bord
+0001aae0: 6572 2069 7320 7369 6d70 6c79 2061 6e6e  er is simply ann
+0001aaf0: 6f79 696e 672c 2070 6f70 2069 6e20 6120  oying, pop in a 
+0001ab00: 636f 7570 6c65 206f 6620 7069 7865 6c73  couple of pixels
+0001ab10: 2074 6f20 6d61 6b65 2073 7572 650d 0a20   to make sure.. 
+0001ab20: 2020 2064 203d 2051 7443 6f72 652e 5150     d = QtCore.QP
+0001ab30: 6f69 6e74 4628 2d32 2c30 290d 0a20 2020  ointF(-2,0)..   
+0001ab40: 2065 7620 3d20 5174 4775 692e 5157 6865   ev = QtGui.QWhe
+0001ab50: 656c 4576 656e 7428 6576 2e70 6f73 6974  elEvent(ev.posit
+0001ab60: 696f 6e28 292b 642c 2065 762e 676c 6f62  ion()+d, ev.glob
+0001ab70: 616c 506f 7369 7469 6f6e 2829 2b64 2c20  alPosition()+d, 
+0001ab80: 6576 2e70 6978 656c 4465 6c74 6128 292c  ev.pixelDelta(),
+0001ab90: 2065 762e 616e 676c 6544 656c 7461 2829   ev.angleDelta()
+0001aba0: 2c20 6576 2e62 7574 746f 6e73 2829 2c20  , ev.buttons(), 
+0001abb0: 6576 2e6d 6f64 6966 6965 7273 2829 2c20  ev.modifiers(), 
+0001abc0: 6576 2e70 6861 7365 2829 2c20 4661 6c73  ev.phase(), Fals
+0001abd0: 6529 0d0a 2020 2020 6f72 6967 5f66 756e  e)..    orig_fun
+0001abe0: 6328 7365 6c66 2c20 6576 290d 0a0d 0a0d  c(self, ev).....
+0001abf0: 0a64 6566 205f 6d63 616c 6c62 6163 6b5f  .def _mcallback_
+0001ac00: 636c 6963 6b28 6178 2c20 6361 6c6c 6261  click(ax, callba
+0001ac10: 636b 2c20 7768 656e 2c20 6576 7329 3a0d  ck, when, evs):.
+0001ac20: 0a20 2020 2069 6620 6576 735b 2d31 5d2e  .    if evs[-1].
+0001ac30: 6163 6365 7074 6564 3a0d 0a20 2020 2020  accepted:..     
+0001ac40: 2020 2072 6574 7572 6e0d 0a20 2020 2069     return..    i
+0001ac50: 6620 7768 656e 203d 3d20 2764 636c 6963  f when == 'dclic
+0001ac60: 6b27 2061 6e64 2065 7673 5b2d 315d 2e64  k' and evs[-1].d
+0001ac70: 6f75 626c 6528 293a 0d0a 2020 2020 2020  ouble():..      
+0001ac80: 2020 7061 7373 0d0a 2020 2020 656c 6966    pass..    elif
+0001ac90: 2077 6865 6e20 3d3d 2027 6c63 6c69 636b   when == 'lclick
+0001aca0: 2720 616e 6420 6576 735b 2d31 5d2e 6275  ' and evs[-1].bu
+0001acb0: 7474 6f6e 2829 203d 3d20 5174 436f 7265  tton() == QtCore
+0001acc0: 2e51 742e 4d6f 7573 6542 7574 746f 6e2e  .Qt.MouseButton.
+0001acd0: 4c65 6674 4275 7474 6f6e 3a0d 0a20 2020  LeftButton:..   
+0001ace0: 2020 2020 2070 6173 730d 0a20 2020 2065       pass..    e
+0001acf0: 6c69 6620 7768 656e 203d 3d20 276d 636c  lif when == 'mcl
+0001ad00: 6963 6b27 2061 6e64 2065 7673 5b2d 315d  ick' and evs[-1]
+0001ad10: 2e62 7574 746f 6e28 2920 3d3d 2051 7443  .button() == QtC
+0001ad20: 6f72 652e 5174 2e4d 6f75 7365 4275 7474  ore.Qt.MouseButt
+0001ad30: 6f6e 2e4d 6964 646c 6542 7574 746f 6e3a  on.MiddleButton:
+0001ad40: 0d0a 2020 2020 2020 2020 7061 7373 0d0a  ..        pass..
+0001ad50: 2020 2020 656c 6966 2077 6865 6e20 3d3d      elif when ==
+0001ad60: 2027 7263 6c69 636b 2720 616e 6420 6576   'rclick' and ev
+0001ad70: 735b 2d31 5d2e 6275 7474 6f6e 2829 203d  s[-1].button() =
+0001ad80: 3d20 5174 436f 7265 2e51 742e 4d6f 7573  = QtCore.Qt.Mous
+0001ad90: 6542 7574 746f 6e2e 5269 6768 7442 7574  eButton.RightBut
+0001ada0: 746f 6e3a 0d0a 2020 2020 2020 2020 7061  ton:..        pa
+0001adb0: 7373 0d0a 2020 2020 656c 6966 2077 6865  ss..    elif whe
+0001adc0: 6e20 3d3d 2027 616e 7927 3a0d 0a20 2020  n == 'any':..   
+0001add0: 2020 2020 2070 6173 730d 0a20 2020 2065       pass..    e
+0001ade0: 6c73 653a 0d0a 2020 2020 2020 2020 7265  lse:..        re
+0001adf0: 7475 726e 0d0a 2020 2020 706f 7320 3d20  turn..    pos = 
+0001ae00: 6576 735b 2d31 5d2e 7363 656e 6550 6f73  evs[-1].scenePos
+0001ae10: 2829 0d0a 2020 2020 7265 7475 726e 205f  ()..    return _
+0001ae20: 6d63 616c 6c62 6163 6b5f 706f 7328 6178  mcallback_pos(ax
+0001ae30: 2c20 6361 6c6c 6261 636b 2c20 2870 6f73  , callback, (pos
+0001ae40: 2c29 290d 0a0d 0a0d 0a64 6566 205f 6d63  ,))......def _mc
+0001ae50: 616c 6c62 6163 6b5f 706f 7328 6178 2c20  allback_pos(ax, 
+0001ae60: 6361 6c6c 6261 636b 2c20 706f 7373 293a  callback, poss):
+0001ae70: 0d0a 2020 2020 6966 206e 6f74 2061 782e  ..    if not ax.
+0001ae80: 7662 2e64 6174 6173 7263 3a0d 0a20 2020  vb.datasrc:..   
+0001ae90: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
+0001aea0: 2070 6f69 6e74 203d 2061 782e 7662 2e6d   point = ax.vb.m
+0001aeb0: 6170 5363 656e 6554 6f56 6965 7728 706f  apSceneToView(po
+0001aec0: 7373 5b2d 315d 290d 0a20 2020 2074 203d  ss[-1])..    t =
+0001aed0: 2070 6f69 6e74 2e78 2829 202b 2030 2e35   point.x() + 0.5
+0001aee0: 0d0a 2020 2020 7472 793a 0d0a 2020 2020  ..    try:..    
+0001aef0: 2020 2020 7420 3d20 6178 2e76 622e 6461      t = ax.vb.da
+0001af00: 7461 7372 632e 636c 6f73 6573 745f 7469  tasrc.closest_ti
+0001af10: 6d65 2874 290d 0a20 2020 2065 7863 6570  me(t)..    excep
+0001af20: 7420 4b65 7945 7272 6f72 3a20 2320 7768  t KeyError: # wh
+0001af30: 656e 2063 6c69 636b 696e 6720 6265 796f  en clicking beyo
+0001af40: 6e64 2072 6967 6874 5f6d 6172 6769 6e5f  nd right_margin_
+0001af50: 6361 6e64 6c65 730d 0a20 2020 2020 2020  candles..       
+0001af60: 2069 6620 636c 616d 705f 6772 6964 3a0d   if clamp_grid:.
+0001af70: 0a20 2020 2020 2020 2020 2020 2074 203d  .            t =
+0001af80: 2061 782e 7662 2e64 6174 6173 7263 2e78   ax.vb.datasrc.x
+0001af90: 2e69 6c6f 635b 2d31 2069 6620 7420 3e20  .iloc[-1 if t > 
+0001afa0: 3020 656c 7365 2030 5d0d 0a20 2020 2074  0 else 0]..    t
+0001afb0: 7279 3a0d 0a20 2020 2020 2020 2063 616c  ry:..        cal
+0001afc0: 6c62 6163 6b28 742c 2070 6f69 6e74 2e79  lback(t, point.y
+0001afd0: 2829 290d 0a20 2020 2065 7863 6570 7420  ())..    except 
+0001afe0: 4f53 4572 726f 7220 6173 2065 3a0d 0a20  OSError as e:.. 
+0001aff0: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
+0001b000: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+0001b010: 6e20 6173 2065 3a0d 0a20 2020 2020 2020  n as e:..       
+0001b020: 2070 7269 6e74 2827 496e 7370 6563 7469   print('Inspecti
+0001b030: 6f6e 2065 7272 6f72 3a27 2c20 7479 7065  on error:', type
+0001b040: 2865 292c 2065 290d 0a0d 0a0d 0a64 6566  (e), e)......def
+0001b050: 2062 7269 6768 7465 6e28 636f 6c6f 722c   brighten(color,
+0001b060: 2066 293a 0d0a 2020 2020 6966 206e 6f74   f):..    if not
+0001b070: 2063 6f6c 6f72 3a0d 0a20 2020 2020 2020   color:..       
+0001b080: 2072 6574 7572 6e20 636f 6c6f 720d 0a20   return color.. 
+0001b090: 2020 2072 6574 7572 6e20 7067 2e6d 6b43     return pg.mkC
+0001b0a0: 6f6c 6f72 2863 6f6c 6f72 292e 6c69 6768  olor(color).ligh
+0001b0b0: 7465 7228 696e 7428 662a 3130 3029 290d  ter(int(f*100)).
+0001b0c0: 0a0d 0a0d 0a64 6566 205f 6765 745f 636f  .....def _get_co
+0001b0d0: 6c6f 7228 6178 2c20 7374 796c 652c 2077  lor(ax, style, w
+0001b0e0: 616e 7465 645f 636f 6c6f 7229 3a0d 0a20  anted_color):.. 
+0001b0f0: 2020 2069 6620 7479 7065 2877 616e 7465     if type(wante
+0001b100: 645f 636f 6c6f 7229 2069 6e20 2873 7472  d_color) in (str
+0001b110: 2c20 5174 4775 692e 5143 6f6c 6f72 293a  , QtGui.QColor):
+0001b120: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001b130: 2077 616e 7465 645f 636f 6c6f 720d 0a20   wanted_color.. 
+0001b140: 2020 2069 6e64 6578 203d 2077 616e 7465     index = wante
+0001b150: 645f 636f 6c6f 7220 6966 2074 7970 6528  d_color if type(
+0001b160: 7761 6e74 6564 5f63 6f6c 6f72 2920 3d3d  wanted_color) ==
+0001b170: 2069 6e74 2065 6c73 6520 4e6f 6e65 0d0a   int else None..
+0001b180: 2020 2020 6973 5f6c 696e 6520 3d20 6c61      is_line = la
+0001b190: 6d62 6461 2073 7479 6c65 3a20 7374 796c  mbda style: styl
+0001b1a0: 6520 6973 204e 6f6e 6520 6f72 2061 6e79  e is None or any
+0001b1b0: 2863 6820 696e 2073 7479 6c65 2066 6f72  (ch in style for
+0001b1c0: 2063 6820 696e 2027 2d5f 2e27 290d 0a20   ch in '-_.').. 
+0001b1d0: 2020 2067 6574 5f68 616e 6465 645f 636f     get_handed_co
+0001b1e0: 6c6f 7220 3d20 6c61 6d62 6461 2069 7465  lor = lambda ite
+0001b1f0: 6d3a 2069 7465 6d2e 6f70 7473 2e67 6574  m: item.opts.get
+0001b200: 2827 6861 6e64 6564 5f63 6f6c 6f72 2729  ('handed_color')
+0001b210: 0d0a 2020 2020 7468 6973 5f6c 696e 6520  ..    this_line 
+0001b220: 3d20 6973 5f6c 696e 6528 7374 796c 6529  = is_line(style)
+0001b230: 0d0a 2020 2020 6966 2074 6869 735f 6c69  ..    if this_li
+0001b240: 6e65 3a0d 0a20 2020 2020 2020 2063 6f6c  ne:..        col
+0001b250: 6f72 7320 3d20 736f 6674 5f63 6f6c 6f72  ors = soft_color
+0001b260: 730d 0a20 2020 2065 6c73 653a 0d0a 2020  s..    else:..  
+0001b270: 2020 2020 2020 636f 6c6f 7273 203d 2068        colors = h
+0001b280: 6172 645f 636f 6c6f 7273 0d0a 2020 2020  ard_colors..    
+0001b290: 6966 2069 6e64 6578 2069 7320 4e6f 6e65  if index is None
+0001b2a0: 3a0d 0a20 2020 2020 2020 2061 766f 6964  :..        avoid
+0001b2b0: 203d 2073 6574 2869 2e6f 7074 735b 2768   = set(i.opts['h
+0001b2c0: 616e 6465 645f 636f 6c6f 7227 5d20 666f  anded_color'] fo
+0001b2d0: 7220 6920 696e 2061 782e 6974 656d 7320  r i in ax.items 
+0001b2e0: 6966 2069 7369 6e73 7461 6e63 6528 692c  if isinstance(i,
+0001b2f0: 7067 2e50 6c6f 7444 6174 6149 7465 6d29  pg.PlotDataItem)
+0001b300: 2061 6e64 2067 6574 5f68 616e 6465 645f   and get_handed_
+0001b310: 636f 6c6f 7228 6929 2069 7320 6e6f 7420  color(i) is not 
+0001b320: 4e6f 6e65 2061 6e64 2074 6869 735f 6c69  None and this_li
+0001b330: 6e65 3d3d 6973 5f6c 696e 6528 692e 6f70  ne==is_line(i.op
+0001b340: 7473 5b27 7379 6d62 6f6c 275d 2929 0d0a  ts['symbol']))..
+0001b350: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
+0001b360: 6c65 6e28 5b69 2066 6f72 2069 2069 6e20  len([i for i in 
+0001b370: 6178 2e69 7465 6d73 2069 6620 6973 696e  ax.items if isin
+0001b380: 7374 616e 6365 2869 2c70 672e 506c 6f74  stance(i,pg.Plot
+0001b390: 4461 7461 4974 656d 2920 616e 6420 6765  DataItem) and ge
+0001b3a0: 745f 6861 6e64 6564 5f63 6f6c 6f72 2869  t_handed_color(i
+0001b3b0: 2920 6973 204e 6f6e 6520 616e 6420 7468  ) is None and th
+0001b3c0: 6973 5f6c 696e 653d 3d69 735f 6c69 6e65  is_line==is_line
+0001b3d0: 2869 2e6f 7074 735b 2773 796d 626f 6c27  (i.opts['symbol'
+0001b3e0: 5d29 5d29 0d0a 2020 2020 2020 2020 7768  ])])..        wh
+0001b3f0: 696c 6520 696e 6465 7820 696e 2061 766f  ile index in avo
+0001b400: 6964 3a0d 0a20 2020 2020 2020 2020 2020  id:..           
+0001b410: 2069 6e64 6578 202b 3d20 310d 0a20 2020   index += 1..   
+0001b420: 2072 6574 7572 6e20 636f 6c6f 7273 5b69   return colors[i
+0001b430: 6e64 6578 256c 656e 2863 6f6c 6f72 7329  ndex%len(colors)
+0001b440: 5d0d 0a0d 0a0d 0a64 6566 205f 7064 7469  ]......def _pdti
+0001b450: 6d65 3265 706f 6368 2874 293a 0d0a 2020  me2epoch(t):..  
+0001b460: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001b470: 742c 2070 642e 5365 7269 6573 293a 0d0a  t, pd.Series):..
+0001b480: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0001b490: 7461 6e63 6528 742e 696c 6f63 5b30 5d2c  tance(t.iloc[0],
+0001b4a0: 2070 642e 5469 6d65 7374 616d 7029 3a0d   pd.Timestamp):.
+0001b4b0: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
+0001b4c0: 7065 203d 2073 7472 2874 2e64 7479 7065  pe = str(t.dtype
+0001b4d0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0001b4e0: 6620 6474 7970 652e 656e 6473 7769 7468  f dtype.endswith
+0001b4f0: 2827 5b73 5d27 293a 0d0a 2020 2020 2020  ('[s]'):..      
+0001b500: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001b510: 2074 2e61 7374 7970 6528 2769 6e74 3634   t.astype('int64
+0001b520: 2729 202a 2069 6e74 2831 6539 290d 0a20  ') * int(1e9).. 
+0001b530: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001b540: 6474 7970 652e 656e 6473 7769 7468 2827  dtype.endswith('
+0001b550: 5b6d 735d 2729 3a0d 0a20 2020 2020 2020  [ms]'):..       
+0001b560: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001b570: 742e 6173 7479 7065 2827 696e 7436 3427  t.astype('int64'
+0001b580: 2920 2a20 696e 7428 3165 3629 0d0a 2020  ) * int(1e6)..  
+0001b590: 2020 2020 2020 2020 2020 656c 6966 2064            elif d
+0001b5a0: 7479 7065 2e65 6e64 7377 6974 6828 2775  type.endswith('u
+0001b5b0: 7327 293a 0d0a 2020 2020 2020 2020 2020  s'):..          
+0001b5c0: 2020 2020 2020 7265 7475 726e 2074 2e61        return t.a
+0001b5d0: 7374 7970 6528 2769 6e74 3634 2729 202a  stype('int64') *
+0001b5e0: 2069 6e74 2831 6533 290d 0a20 2020 2020   int(1e3)..     
+0001b5f0: 2020 2020 2020 2072 6574 7572 6e20 742e         return t.
+0001b600: 6173 7479 7065 2827 696e 7436 3427 290d  astype('int64').
+0001b610: 0a20 2020 2020 2020 2068 203d 206e 702e  .        h = np.
+0001b620: 6e61 6e6d 6178 2874 2e76 616c 7565 7329  nanmax(t.values)
+0001b630: 0d0a 2020 2020 2020 2020 6966 2068 203c  ..        if h <
+0001b640: 2031 6531 303a 2023 2068 616e 646c 6520   1e10: # handle 
+0001b650: 7320 6570 6f63 6873 0d0a 2020 2020 2020  s epochs..      
+0001b660: 2020 2020 2020 7265 7475 726e 2028 742a        return (t*
+0001b670: 3165 3929 2e61 7374 7970 6528 2769 6e74  1e9).astype('int
+0001b680: 3634 2729 0d0a 2020 2020 2020 2020 6966  64')..        if
+0001b690: 2068 203c 2031 6531 333a 2023 2068 616e   h < 1e13: # han
+0001b6a0: 646c 6520 6d73 2065 706f 6368 730d 0a20  dle ms epochs.. 
+0001b6b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001b6c0: 6e20 2874 2a31 6536 292e 6173 7479 7065  n (t*1e6).astype
+0001b6d0: 2827 696e 7436 3427 290d 0a20 2020 2020  ('int64')..     
+0001b6e0: 2020 2069 6620 6820 3c20 3165 3136 3a20     if h < 1e16: 
+0001b6f0: 2320 6861 6e64 6c65 2075 7320 6570 6f63  # handle us epoc
+0001b700: 6873 0d0a 2020 2020 2020 2020 2020 2020  hs..            
+0001b710: 7265 7475 726e 2028 742a 3165 3329 2e61  return (t*1e3).a
+0001b720: 7374 7970 6528 2769 6e74 3634 2729 0d0a  stype('int64')..
+0001b730: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+0001b740: 2e61 7374 7970 6528 2769 6e74 3634 2729  .astype('int64')
+0001b750: 0d0a 2020 2020 7265 7475 726e 2074 0d0a  ..    return t..
+0001b760: 0d0a 0d0a 6465 6620 5f70 6474 696d 6532  ....def _pdtime2
+0001b770: 696e 6465 7828 6178 2c20 7473 2c20 616e  index(ax, ts, an
+0001b780: 795f 656e 643d 4661 6c73 652c 2072 6571  y_end=False, req
+0001b790: 7569 7265 5f74 696d 653d 4661 6c73 6529  uire_time=False)
+0001b7a0: 3a0d 0a20 2020 2069 6620 6973 696e 7374  :..    if isinst
+0001b7b0: 616e 6365 2874 732e 696c 6f63 5b30 5d2c  ance(ts.iloc[0],
+0001b7c0: 2070 642e 5469 6d65 7374 616d 7029 3a0d   pd.Timestamp):.
+0001b7d0: 0a20 2020 2020 2020 2074 7320 3d20 7473  .        ts = ts
+0001b7e0: 2e61 7374 7970 6528 2769 6e74 3634 2729  .astype('int64')
+0001b7f0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+0001b800: 2020 2020 2068 203d 206e 702e 6e61 6e6d       h = np.nanm
+0001b810: 6178 2874 732e 7661 6c75 6573 290d 0a20  ax(ts.values).. 
+0001b820: 2020 2020 2020 2069 6620 6820 3c20 3165         if h < 1e
+0001b830: 373a 0d0a 2020 2020 2020 2020 2020 2020  7:..            
+0001b840: 6966 2072 6571 7569 7265 5f74 696d 653a  if require_time:
+0001b850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001b860: 2020 6173 7365 7274 2046 616c 7365 2c20    assert False, 
+0001b870: 276e 6f74 2061 2074 696d 6520 7365 7269  'not a time seri
+0001b880: 6573 270d 0a20 2020 2020 2020 2020 2020  es'..           
+0001b890: 2072 6574 7572 6e20 7473 0d0a 2020 2020   return ts..    
+0001b8a0: 2020 2020 6966 2068 203c 2031 6531 303a      if h < 1e10:
+0001b8b0: 2023 2068 616e 646c 6520 7320 6570 6f63   # handle s epoc
+0001b8c0: 6873 0d0a 2020 2020 2020 2020 2020 2020  hs..            
+0001b8d0: 7473 203d 2074 732e 6173 7479 7065 2827  ts = ts.astype('
+0001b8e0: 666c 6f61 7436 3427 2920 2a20 3165 390d  float64') * 1e9.
+0001b8f0: 0a20 2020 2020 2020 2065 6c69 6620 6820  .        elif h 
+0001b900: 3c20 3165 3133 3a20 2320 6861 6e64 6c65  < 1e13: # handle
+0001b910: 206d 7320 6570 6f63 6873 0d0a 2020 2020   ms epochs..    
+0001b920: 2020 2020 2020 2020 7473 203d 2074 732e          ts = ts.
+0001b930: 6173 7479 7065 2827 666c 6f61 7436 3427  astype('float64'
+0001b940: 2920 2a20 3165 360d 0a20 2020 2020 2020  ) * 1e6..       
+0001b950: 2065 6c69 6620 6820 3c20 3165 3136 3a20   elif h < 1e16: 
+0001b960: 2320 6861 6e64 6c65 2075 7320 6570 6f63  # handle us epoc
+0001b970: 6873 0d0a 2020 2020 2020 2020 2020 2020  hs..            
+0001b980: 7473 203d 2074 732e 6173 7479 7065 2827  ts = ts.astype('
+0001b990: 666c 6f61 7436 3427 2920 2a20 3165 330d  float64') * 1e3.
+0001b9a0: 0a20 2020 200d 0a20 2020 2064 6174 6173  .    ..    datas
+0001b9b0: 7263 203d 205f 6765 745f 6461 7461 7372  rc = _get_datasr
+0001b9c0: 6328 6178 290d 0a20 2020 2078 7320 3d20  c(ax)..    xs = 
+0001b9d0: 6461 7461 7372 632e 780d 0a0d 0a20 2020  datasrc.x....   
+0001b9e0: 2023 2074 7279 2065 7861 6374 206d 6174   # try exact mat
+0001b9f0: 6368 2062 6566 6f72 6520 6170 7072 6f78  ch before approx
+0001ba00: 696d 6174 6520 6d61 7463 680d 0a20 2020  imate match..   
+0001ba10: 2069 6620 616c 6c28 7873 2e69 7369 6e28   if all(xs.isin(
+0001ba20: 7473 2929 3a0d 0a20 2020 2020 2020 2065  ts)):..        e
+0001ba30: 7861 6374 203d 2064 6174 6173 7263 2e69  xact = datasrc.i
+0001ba40: 6e64 6578 5b74 735d 2e74 6f5f 6c69 7374  ndex[ts].to_list
+0001ba50: 2829 0d0a 2020 2020 2020 2020 6966 206c  ()..        if l
+0001ba60: 656e 2865 7861 6374 2920 3d3d 206c 656e  en(exact) == len
+0001ba70: 2874 7329 3a0d 0a20 2020 2020 2020 2020  (ts):..         
+0001ba80: 2020 2072 6574 7572 6e20 6578 6163 740d     return exact.
+0001ba90: 0a0d 0a20 2020 2072 203d 205b 5d0d 0a20  ...    r = [].. 
+0001baa0: 2020 2066 6f72 2069 2c74 2069 6e20 656e     for i,t in en
+0001bab0: 756d 6572 6174 6528 7473 293a 0d0a 2020  umerate(ts):..  
+0001bac0: 2020 2020 2020 7873 7320 3d20 7873 2e6c        xss = xs.l
+0001bad0: 6f63 5b78 733e 745d 0d0a 2020 2020 2020  oc[xs>t]..      
+0001bae0: 2020 6966 206c 656e 2878 7373 2920 3d3d    if len(xss) ==
+0001baf0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+0001bb00: 2074 3020 3d20 7873 2e69 6c6f 635b 2d31   t0 = xs.iloc[-1
+0001bb10: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+0001bb20: 6620 616e 795f 656e 6420 6f72 2074 3020  f any_end or t0 
+0001bb30: 3d3d 2074 3a0d 0a20 2020 2020 2020 2020  == t:..         
+0001bb40: 2020 2020 2020 2072 2e61 7070 656e 6428         r.append(
+0001bb50: 6c65 6e28 7873 292d 3129 0d0a 2020 2020  len(xs)-1)..    
+0001bb60: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001bb70: 696e 7565 0d0a 2020 2020 2020 2020 2020  inue..          
+0001bb80: 2020 6966 2069 203e 2030 3a0d 0a20 2020    if i > 0:..   
+0001bb90: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001bba0: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
+0001bbb0: 2020 2061 7373 6572 7420 7420 3c3d 2074     assert t <= t
+0001bbc0: 302c 2027 6d75 7374 2070 6c6f 7420 7468  0, 'must plot th
+0001bbd0: 6973 2070 7269 6d69 7469 7665 2069 6e20  is primitive in 
+0001bbe0: 7072 696f 7220 7469 6d65 2d72 616e 6765  prior time-range
+0001bbf0: 270d 0a20 2020 2020 2020 2069 3120 3d20  '..        i1 = 
+0001bc00: 7873 732e 696e 6465 785b 305d 0d0a 2020  xss.index[0]..  
+0001bc10: 2020 2020 2020 6930 203d 2069 312d 310d        i0 = i1-1.
+0001bc20: 0a20 2020 2020 2020 2069 6620 6930 203c  .        if i0 <
+0001bc30: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+0001bc40: 2069 302c 6931 203d 2030 2c31 0d0a 2020   i0,i1 = 0,1..  
+0001bc50: 2020 2020 2020 7430 2c74 3120 3d20 7873        t0,t1 = xs
+0001bc60: 2e6c 6f63 5b69 305d 2c20 7873 2e6c 6f63  .loc[i0], xs.loc
+0001bc70: 5b69 315d 0d0a 2020 2020 2020 2020 6966  [i1]..        if
+0001bc80: 2074 3020 3d3d 2074 313a 0d0a 2020 2020   t0 == t1:..    
+0001bc90: 2020 2020 2020 2020 722e 6170 7065 6e64          r.append
+0001bca0: 2869 3029 0d0a 2020 2020 2020 2020 656c  (i0)..        el
+0001bcb0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0001bcc0: 2064 7420 3d20 2874 2d74 3029 202f 2028   dt = (t-t0) / (
+0001bcd0: 7431 2d74 3029 0d0a 2020 2020 2020 2020  t1-t0)..        
+0001bce0: 2020 2020 722e 6170 7065 6e64 286c 6572      r.append(ler
+0001bcf0: 7028 6474 2c20 6930 2c20 6931 2929 0d0a  p(dt, i0, i1))..
+0001bd00: 2020 2020 7265 7475 726e 2072 0d0a 0d0a      return r....
+0001bd10: 0d0a 6465 6620 5f69 735f 7374 725f 6d69  ..def _is_str_mi
+0001bd20: 646e 6967 6874 2873 293a 0d0a 2020 2020  dnight(s):..    
+0001bd30: 7265 7475 726e 2073 2e65 6e64 7377 6974  return s.endswit
+0001bd40: 6828 2720 3030 3a30 3027 2920 6f72 2073  h(' 00:00') or s
+0001bd50: 2e65 6e64 7377 6974 6828 2720 3030 3a30  .endswith(' 00:0
+0001bd60: 303a 3030 2729 0d0a 0d0a 0d0a 6465 6620  0:00')......def 
+0001bd70: 5f67 6574 5f64 6174 6173 7263 2861 782c  _get_datasrc(ax,
+0001bd80: 2072 6571 7569 7265 3d54 7275 6529 3a0d   require=True):.
+0001bd90: 0a20 2020 2069 6620 6178 2e76 622e 6461  .    if ax.vb.da
+0001bda0: 7461 7372 6320 6973 206e 6f74 204e 6f6e  tasrc is not Non
+0001bdb0: 6520 6f72 206e 6f74 2061 782e 7662 2e78  e or not ax.vb.x
+0001bdc0: 5f69 6e64 6578 6564 3a0d 0a20 2020 2020  _indexed:..     
+0001bdd0: 2020 2072 6574 7572 6e20 6178 2e76 622e     return ax.vb.
+0001bde0: 6461 7461 7372 630d 0a20 2020 2076 6273  datasrc..    vbs
+0001bdf0: 203d 205b 6178 2e76 6220 666f 7220 7769   = [ax.vb for wi
+0001be00: 6e20 696e 2077 696e 646f 7773 2066 6f72  n in windows for
+0001be10: 2061 7820 696e 2077 696e 2e61 7873 5d0d   ax in win.axs].
+0001be20: 0a20 2020 2066 6f72 2076 6220 696e 2076  .    for vb in v
+0001be30: 6273 3a0d 0a20 2020 2020 2020 2069 6620  bs:..        if 
+0001be40: 7662 2e64 6174 6173 7263 3a0d 0a20 2020  vb.datasrc:..   
+0001be50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001be60: 7662 2e64 6174 6173 7263 0d0a 2020 2020  vb.datasrc..    
+0001be70: 6966 2072 6571 7569 7265 3a0d 0a20 2020  if require:..   
+0001be80: 2020 2020 2061 7373 6572 7420 6178 2e76       assert ax.v
+0001be90: 622e 6461 7461 7372 632c 2027 6e6f 7420  b.datasrc, 'not 
+0001bea0: 706f 7373 6962 6c65 2074 6f20 706c 6f74  possible to plot
+0001beb0: 2074 6869 7320 7072 696d 6974 6976 6520   this primitive 
+0001bec0: 7769 7468 6f75 7420 6120 7072 696f 7220  without a prior 
+0001bed0: 7469 6d65 2d72 616e 6765 2074 6f20 636f  time-range to co
+0001bee0: 6d70 6172 6520 746f 270d 0a0d 0a0d 0a64  mpare to'......d
+0001bef0: 6566 205f 696e 7365 7274 5f63 6f6c 2864  ef _insert_col(d
+0001bf00: 6174 6173 7263 2c20 636f 6c5f 6964 782c  atasrc, col_idx,
+0001bf10: 2063 6f6c 5f6e 616d 652c 2064 6174 6129   col_name, data)
+0001bf20: 3a0d 0a20 2020 2069 6620 636f 6c5f 6e61  :..    if col_na
+0001bf30: 6d65 206e 6f74 2069 6e20 6461 7461 7372  me not in datasr
+0001bf40: 632e 6466 2e63 6f6c 756d 6e73 3a0d 0a20  c.df.columns:.. 
+0001bf50: 2020 2020 2020 2064 6174 6173 7263 2e64         datasrc.d
+0001bf60: 662e 696e 7365 7274 2863 6f6c 5f69 6478  f.insert(col_idx
+0001bf70: 2c20 636f 6c5f 6e61 6d65 2c20 6461 7461  , col_name, data
+0001bf80: 290d 0a0d 0a0d 0a64 6566 205f 6d69 6c6c  )......def _mill
+0001bf90: 6973 6563 6f6e 645f 747a 5f77 7261 7028  isecond_tz_wrap(
+0001bfa0: 7329 3a0d 0a20 2020 2069 6620 6c65 6e28  s):..    if len(
+0001bfb0: 7329 203e 2036 2061 6e64 2073 5b2d 365d  s) > 6 and s[-6]
+0001bfc0: 2069 6e20 272b 2d27 2061 6e64 2073 5b2d   in '+-' and s[-
+0001bfd0: 335d 203d 3d20 273a 273a 2023 202b 3031  3] == ':': # +01
+0001bfe0: 3a30 3020 666d 7420 7469 6d65 7a6f 6e65  :00 fmt timezone
+0001bff0: 2070 7265 7365 6e74 3f0d 0a20 2020 2020   present?..     
+0001c000: 2020 2073 203d 2073 5b3a 2d36 5d0d 0a20     s = s[:-6].. 
+0001c010: 2020 2072 6574 7572 6e20 2873 2b27 2e30     return (s+'.0
+0001c020: 3030 3030 3027 2920 6966 2027 2e27 206e  00000') if '.' n
+0001c030: 6f74 2069 6e20 7320 656c 7365 2073 0d0a  ot in s else s..
+0001c040: 0d0a 0d0a 6465 6620 5f78 326c 6f63 616c  ....def _x2local
+0001c050: 5f74 2864 6174 6173 7263 2c20 7829 3a0d  _t(datasrc, x):.
+0001c060: 0a20 2020 2069 6620 6469 7370 6c61 795f  .    if display_
+0001c070: 7469 6d65 7a6f 6e65 203d 3d20 4e6f 6e65  timezone == None
+0001c080: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+0001c090: 6e20 5f78 3275 7463 2864 6174 6173 7263  n _x2utc(datasrc
+0001c0a0: 2c20 7829 0d0a 2020 2020 7265 7475 726e  , x)..    return
+0001c0b0: 205f 7832 7428 6461 7461 7372 632c 2078   _x2t(datasrc, x
+0001c0c0: 2c20 6c61 6d62 6461 2074 3a20 5f6d 696c  , lambda t: _mil
+0001c0d0: 6c69 7365 636f 6e64 5f74 7a5f 7772 6170  lisecond_tz_wrap
+0001c0e0: 2864 6174 6574 696d 652e 6672 6f6d 7469  (datetime.fromti
+0001c0f0: 6d65 7374 616d 7028 742f 3165 392c 2074  mestamp(t/1e9, t
+0001c100: 7a3d 6469 7370 6c61 795f 7469 6d65 7a6f  z=display_timezo
+0001c110: 6e65 292e 7374 7266 7469 6d65 2874 696d  ne).strftime(tim
+0001c120: 6573 7461 6d70 5f66 6f72 6d61 7429 2929  estamp_format)))
+0001c130: 0d0a 0d0a 0d0a 6465 6620 5f78 3275 7463  ......def _x2utc
+0001c140: 2864 6174 6173 7263 2c20 7829 3a0d 0a20  (datasrc, x):.. 
+0001c150: 2020 2023 2075 7369 6e67 2070 642e 746f     # using pd.to
+0001c160: 5f64 6174 6574 696d 6520 616c 6c6f 7720  _datetime allow 
+0001c170: 666f 7220 7072 652d 3139 3730 2064 6174  for pre-1970 dat
+0001c180: 6573 0d0a 2020 2020 7265 7475 726e 205f  es..    return _
+0001c190: 7832 7428 6461 7461 7372 632c 2078 2c20  x2t(datasrc, x, 
+0001c1a0: 6c61 6d62 6461 2074 3a20 7064 2e74 6f5f  lambda t: pd.to_
+0001c1b0: 6461 7465 7469 6d65 2874 2c20 756e 6974  datetime(t, unit
+0001c1c0: 3d27 6e73 2729 2e73 7472 6674 696d 6528  ='ns').strftime(
+0001c1d0: 7469 6d65 7374 616d 705f 666f 726d 6174  timestamp_format
+0001c1e0: 2929 0d0a 0d0a 0d0a 6465 6620 5f78 3274  ))......def _x2t
+0001c1f0: 2864 6174 6173 7263 2c20 782c 2074 7332  (datasrc, x, ts2
+0001c200: 7374 7229 3a0d 0a20 2020 2069 6620 6e6f  str):..    if no
+0001c210: 7420 6461 7461 7372 633a 0d0a 2020 2020  t datasrc:..    
+0001c220: 2020 2020 7265 7475 726e 2027 272c 4661      return '',Fa
+0001c230: 6c73 650d 0a20 2020 2074 7279 3a0d 0a20  lse..    try:.. 
+0001c240: 2020 2020 2020 2078 202b 3d20 302e 350d         x += 0.5.
+0001c250: 0a20 2020 2020 2020 2074 2c5f 2c5f 2c5f  .        t,_,_,_
+0001c260: 2c63 6e74 203d 2064 6174 6173 7263 2e68  ,cnt = datasrc.h
+0001c270: 696c 6f28 782c 2078 290d 0a20 2020 2020  ilo(x, x)..     
+0001c280: 2020 2069 6620 636e 743a 0d0a 2020 2020     if cnt:..    
+0001c290: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
+0001c2a0: 6174 6173 7263 2e74 696d 6562 6173 6564  atasrc.timebased
+0001c2b0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+0001c2c0: 2020 2020 2072 6574 7572 6e20 2725 6727       return '%g'
+0001c2d0: 2025 2074 2c20 4661 6c73 650d 0a20 2020   % t, False..   
+0001c2e0: 2020 2020 2020 2020 2073 203d 2074 7332           s = ts2
+0001c2f0: 7374 7228 7429 0d0a 2020 2020 2020 2020  str(t)..        
+0001c300: 2020 2020 6966 206e 6f74 2074 7275 6e63      if not trunc
+0001c310: 6174 655f 7469 6d65 7374 616d 703a 0d0a  ate_timestamp:..
+0001c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c330: 7265 7475 726e 2073 2c54 7275 650d 0a20  return s,True.. 
+0001c340: 2020 2020 2020 2020 2020 2069 6620 6570             if ep
+0001c350: 6f63 685f 7065 7269 6f64 203e 3d20 3233  och_period >= 23
+0001c360: 2a36 302a 3630 3a20 2320 6461 796c 6967  *60*60: # daylig
+0001c370: 6874 2073 6176 696e 6773 2c20 6c65 6170  ht savings, leap
+0001c380: 2073 6563 6f6e 6473 2c20 6574 630d 0a20   seconds, etc.. 
+0001c390: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001c3a0: 203d 2073 2e69 6e64 6578 2827 2027 290d   = s.index(' ').
+0001c3b0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0001c3c0: 6620 6570 6f63 685f 7065 7269 6f64 203e  f epoch_period >
+0001c3d0: 3d20 3539 3a20 2320 636f 6e73 6964 6572  = 59: # consider
+0001c3e0: 206c 6561 7020 7365 636f 6e64 730d 0a20   leap seconds.. 
+0001c3f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001c400: 203d 2073 2e72 696e 6465 7828 273a 2729   = s.rindex(':')
+0001c410: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0001c420: 6966 2065 706f 6368 5f70 6572 696f 6420  if epoch_period 
+0001c430: 3e3d 2031 3a0d 0a20 2020 2020 2020 2020  >= 1:..         
+0001c440: 2020 2020 2020 2069 203d 2073 2e69 6e64         i = s.ind
+0001c450: 6578 2827 2e27 2920 6966 2027 2e27 2069  ex('.') if '.' i
+0001c460: 6e20 7320 656c 7365 206c 656e 2873 290d  n s else len(s).
+0001c470: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0001c480: 6620 6570 6f63 685f 7065 7269 6f64 203e  f epoch_period >
+0001c490: 3d20 302e 3030 313a 0d0a 2020 2020 2020  = 0.001:..      
+0001c4a0: 2020 2020 2020 2020 2020 6920 3d20 2d33            i = -3
+0001c4b0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0001c4c0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0001c4d0: 2020 2020 2069 203d 206c 656e 2873 290d       i = len(s).
+0001c4e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001c4f0: 7572 6e20 735b 3a69 5d2c 5472 7565 0d0a  urn s[:i],True..
+0001c500: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0001c510: 7469 6f6e 2061 7320 653a 0d0a 2020 2020  tion as e:..    
+0001c520: 2020 2020 696d 706f 7274 2074 7261 6365      import trace
+0001c530: 6261 636b 0d0a 2020 2020 2020 2020 7472  back..        tr
+0001c540: 6163 6562 6163 6b2e 7072 696e 745f 6578  aceback.print_ex
+0001c550: 6328 290d 0a20 2020 2072 6574 7572 6e20  c()..    return 
+0001c560: 2727 2c64 6174 6173 7263 2e74 696d 6562  '',datasrc.timeb
+0001c570: 6173 6564 2829 0d0a 0d0a 0d0a 6465 6620  ased()......def 
+0001c580: 5f78 3279 6561 7228 6461 7461 7372 632c  _x2year(datasrc,
+0001c590: 2078 293a 0d0a 2020 2020 742c 6861 7364   x):..    t,hasd
+0001c5a0: 7320 3d20 5f78 326c 6f63 616c 5f74 2864  s = _x2local_t(d
+0001c5b0: 6174 6173 7263 2c20 7829 0d0a 2020 2020  atasrc, x)..    
+0001c5c0: 7265 7475 726e 2074 5b3a 345d 2c68 6173  return t[:4],has
+0001c5d0: 6473 0d0a 0d0a 0d0a 6465 6620 5f72 6f75  ds......def _rou
+0001c5e0: 6e64 5f74 6f5f 7369 676e 6966 6963 616e  nd_to_significan
+0001c5f0: 7428 726e 672c 2072 6e67 6d61 782c 2078  t(rng, rngmax, x
+0001c600: 2c20 7369 676e 6966 6963 616e 745f 6465  , significant_de
+0001c610: 6369 6d61 6c73 2c20 7369 676e 6966 6963  cimals, signific
+0001c620: 616e 745f 6570 7329 3a0d 0a20 2020 2069  ant_eps):..    i
+0001c630: 735f 6869 6768 7265 7320 3d20 2872 6e67  s_highres = (rng
+0001c640: 2f73 6967 6e69 6669 6361 6e74 5f65 7073  /significant_eps
+0001c650: 203e 2031 6532 2061 6e64 2072 6e67 6d61   > 1e2 and rngma
+0001c660: 783c 3165 2d32 2920 6f72 2061 6273 2872  x<1e-2) or abs(r
+0001c670: 6e67 6d61 7829 203e 2031 6537 206f 7220  ngmax) > 1e7 or 
+0001c680: 726e 6720 3c20 3165 2d35 0d0a 2020 2020  rng < 1e-5..    
+0001c690: 7364 203d 2073 6967 6e69 6669 6361 6e74  sd = significant
+0001c6a0: 5f64 6563 696d 616c 730d 0a20 2020 2069  _decimals..    i
+0001c6b0: 6620 6973 5f68 6967 6872 6573 2061 6e64  f is_highres and
+0001c6c0: 2061 6273 2878 293e 303a 0d0a 2020 2020   abs(x)>0:..    
+0001c6d0: 2020 2020 6578 7031 3020 3d20 666c 6f6f      exp10 = floo
+0001c6e0: 7228 6e70 2e6c 6f67 3130 2861 6273 2878  r(np.log10(abs(x
+0001c6f0: 2929 290d 0a20 2020 2020 2020 2078 203d  )))..        x =
+0001c700: 2078 202f 2028 3130 2a2a 6578 7031 3029   x / (10**exp10)
+0001c710: 0d0a 2020 2020 2020 2020 726d 203d 2069  ..        rm = i
+0001c720: 6e74 2861 6273 286e 702e 6c6f 6731 3028  nt(abs(np.log10(
+0001c730: 726e 676d 6178 2929 2920 6966 2072 6e67  rngmax))) if rng
+0001c740: 6d61 783e 3020 656c 7365 2030 0d0a 2020  max>0 else 0..  
+0001c750: 2020 2020 2020 7364 203d 206d 696e 2833        sd = min(3
+0001c760: 2c20 7364 2b72 6d29 0d0a 2020 2020 2020  , sd+rm)..      
+0001c770: 2020 666d 7420 3d20 2725 2525 692e 2569    fmt = '%%%i.%i
+0001c780: 6665 2525 6927 2025 2028 7364 2c20 7364  fe%%i' % (sd, sd
+0001c790: 290d 0a20 2020 2020 2020 2072 203d 2066  )..        r = f
+0001c7a0: 6d74 2025 2028 782c 2065 7870 3130 290d  mt % (x, exp10).
+0001c7b0: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
+0001c7c0: 2020 2020 6570 7320 3d20 666d 6f64 2878      eps = fmod(x
+0001c7d0: 2c20 7369 676e 6966 6963 616e 745f 6570  , significant_ep
+0001c7e0: 7329 0d0a 2020 2020 2020 2020 6966 2061  s)..        if a
+0001c7f0: 6273 2865 7073 2920 3e3d 2073 6967 6e69  bs(eps) >= signi
+0001c800: 6669 6361 6e74 5f65 7073 2f32 3a0d 0a20  ficant_eps/2:.. 
+0001c810: 2020 2020 2020 2020 2020 2023 2072 6f75             # rou
+0001c820: 6e64 2075 700d 0a20 2020 2020 2020 2020  nd up..         
+0001c830: 2020 2065 7073 202d 3d20 6e70 2e73 6967     eps -= np.sig
+0001c840: 6e28 6570 7329 2a73 6967 6e69 6669 6361  n(eps)*significa
+0001c850: 6e74 5f65 7073 0d0a 2020 2020 2020 2020  nt_eps..        
+0001c860: 7878 203d 2078 202d 2065 7073 0d0a 2020  xx = x - eps..  
+0001c870: 2020 2020 2020 666d 7420 3d20 2725 2525        fmt = '%%%
+0001c880: 692e 2569 6627 2025 2028 7364 2c20 7364  i.%if' % (sd, sd
+0001c890: 290d 0a20 2020 2020 2020 2072 203d 2066  )..        r = f
+0001c8a0: 6d74 2025 2078 780d 0a20 2020 2020 2020  mt % xx..       
+0001c8b0: 2069 6620 6162 7328 7829 3e30 2061 6e64   if abs(x)>0 and
+0001c8c0: 2072 6e67 3c31 6534 2061 6e64 2072 2e73   rng<1e4 and r.s
+0001c8d0: 7461 7274 7377 6974 6828 2730 2e30 2729  tartswith('0.0')
+0001c8e0: 2061 6e64 2066 6c6f 6174 2872 5b3a 2d31   and float(r[:-1
+0001c8f0: 5d29 203d 3d20 303a 0d0a 2020 2020 2020  ]) == 0:..      
+0001c900: 2020 2020 2020 7220 3d20 2725 2e32 6527        r = '%.2e'
+0001c910: 2025 2078 0d0a 2020 2020 7265 7475 726e   % x..    return
+0001c920: 2072 0d0a 0d0a 0d0a 6465 6620 5f72 6f69   r......def _roi
+0001c930: 6861 6e64 6c65 5f6d 6f76 655f 736e 6170  handle_move_snap
+0001c940: 2876 622c 206f 7269 675f 6675 6e63 2c20  (vb, orig_func, 
+0001c950: 706f 732c 206d 6f64 6966 6965 7273 3d51  pos, modifiers=Q
+0001c960: 7443 6f72 652e 5174 2e4b 6579 626f 6172  tCore.Qt.Keyboar
+0001c970: 644d 6f64 6966 6965 722c 2066 696e 6973  dModifier, finis
+0001c980: 683d 5472 7565 293a 0d0a 2020 2020 706f  h=True):..    po
+0001c990: 7320 3d20 7662 2e6d 6170 4465 7669 6365  s = vb.mapDevice
+0001c9a0: 546f 5669 6577 2870 6f73 290d 0a20 2020  ToView(pos)..   
+0001c9b0: 2070 6f73 203d 205f 636c 616d 705f 706f   pos = _clamp_po
+0001c9c0: 696e 7428 7662 2e70 6172 656e 7428 292c  int(vb.parent(),
+0001c9d0: 2070 6f73 290d 0a20 2020 2070 6f73 203d   pos)..    pos =
+0001c9e0: 2076 622e 6d61 7056 6965 7754 6f44 6576   vb.mapViewToDev
+0001c9f0: 6963 6528 706f 7329 0d0a 2020 2020 6f72  ice(pos)..    or
+0001ca00: 6967 5f66 756e 6328 706f 732c 206d 6f64  ig_func(pos, mod
+0001ca10: 6966 6965 7273 3d6d 6f64 6966 6965 7273  ifiers=modifiers
+0001ca20: 2c20 6669 6e69 7368 3d66 696e 6973 6829  , finish=finish)
+0001ca30: 0d0a 0d0a 0d0a 6465 6620 5f63 6c61 6d70  ......def _clamp
+0001ca40: 5f78 7928 6178 2c20 782c 2079 293a 0d0a  _xy(ax, x, y):..
+0001ca50: 2020 2020 6966 206e 6f74 2063 6c61 6d70      if not clamp
+0001ca60: 5f67 7269 643a 0d0a 2020 2020 2020 2020  _grid:..        
+0001ca70: 7265 7475 726e 2078 2c20 790d 0a20 2020  return x, y..   
+0001ca80: 2079 203d 2061 782e 7662 2e79 7363 616c   y = ax.vb.yscal
+0001ca90: 652e 7866 6f72 6d28 7929 0d0a 2020 2020  e.xform(y)..    
+0001caa0: 2320 7363 616c 6520 780d 0a20 2020 2069  # scale x..    i
+0001cab0: 6620 6178 2e76 622e 785f 696e 6465 7865  f ax.vb.x_indexe
+0001cac0: 643a 0d0a 2020 2020 2020 2020 6473 203d  d:..        ds =
+0001cad0: 2061 782e 7662 2e64 6174 6173 7263 0d0a   ax.vb.datasrc..
+0001cae0: 2020 2020 2020 2020 6966 2078 203c 2030          if x < 0
+0001caf0: 206f 7220 2864 7320 616e 6420 7820 3e20   or (ds and x > 
+0001cb00: 6c65 6e28 6473 2e64 6629 2d31 293a 0d0a  len(ds.df)-1):..
+0001cb10: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+0001cb20: 3020 6966 2078 203c 2030 2065 6c73 6520  0 if x < 0 else 
+0001cb30: 6c65 6e28 6473 2e64 6629 2d31 0d0a 2020  len(ds.df)-1..  
+0001cb40: 2020 2020 2020 7820 3d20 5f72 6f75 6e64        x = _round
+0001cb50: 2878 290d 0a20 2020 2023 2073 6361 6c65  (x)..    # scale
+0001cb60: 2079 0d0a 2020 2020 6966 2079 203c 2030   y..    if y < 0
+0001cb70: 2e31 2061 6e64 2061 782e 7662 2e79 7363  .1 and ax.vb.ysc
+0001cb80: 616c 652e 7363 616c 6574 7970 6520 3d3d  ale.scaletype ==
+0001cb90: 2027 6c6f 6727 3a0d 0a20 2020 2020 2020   'log':..       
+0001cba0: 206d 6167 6e69 7475 6465 203d 2069 6e74   magnitude = int
+0001cbb0: 2833 202d 206e 702e 6c6f 6731 3028 7929  (3 - np.log10(y)
+0001cbc0: 2920 2320 726f 756e 6420 6c6f 6720 746f  ) # round log to
+0001cbd0: 204e 2064 6563 696d 616c 730d 0a20 2020   N decimals..   
+0001cbe0: 2020 2020 2079 203d 2072 6f75 6e64 2879       y = round(y
+0001cbf0: 2c20 6d61 676e 6974 7564 6529 0d0a 2020  , magnitude)..  
+0001cc00: 2020 656c 7365 3a20 2320 6c69 6e65 6172    else: # linear
+0001cc10: 0d0a 2020 2020 2020 2020 6570 7320 3d20  ..        eps = 
+0001cc20: 6178 2e73 6967 6e69 6669 6361 6e74 5f65  ax.significant_e
+0001cc30: 7073 0d0a 2020 2020 2020 2020 6966 2065  ps..        if e
+0001cc40: 7073 203e 2031 652d 383a 0d0a 2020 2020  ps > 1e-8:..    
+0001cc50: 2020 2020 2020 2020 6570 7332 203d 206e          eps2 = n
+0001cc60: 702e 7369 676e 2879 2920 2a20 302e 3520  p.sign(y) * 0.5 
+0001cc70: 2a20 6570 730d 0a20 2020 2020 2020 2020  * eps..         
+0001cc80: 2020 2079 202d 3d20 666d 6f64 2879 2b65     y -= fmod(y+e
+0001cc90: 7073 322c 2065 7073 2920 2d20 6570 7332  ps2, eps) - eps2
+0001cca0: 0d0a 2020 2020 7920 3d20 6178 2e76 622e  ..    y = ax.vb.
+0001ccb0: 7973 6361 6c65 2e69 6e76 7866 6f72 6d28  yscale.invxform(
+0001ccc0: 792c 2076 6572 6966 793d 5472 7565 290d  y, verify=True).
+0001ccd0: 0a20 2020 2072 6574 7572 6e20 782c 2079  .    return x, y
+0001cce0: 0d0a 0d0a 0d0a 6465 6620 5f63 6c61 6d70  ......def _clamp
+0001ccf0: 5f70 6f69 6e74 2861 782c 2070 293a 0d0a  _point(ax, p):..
+0001cd00: 2020 2020 6966 2063 6c61 6d70 5f67 7269      if clamp_gri
+0001cd10: 643a 0d0a 2020 2020 2020 2020 782c 7920  d:..        x,y 
+0001cd20: 3d20 5f63 6c61 6d70 5f78 7928 6178 2c20  = _clamp_xy(ax, 
+0001cd30: 702e 7828 292c 2070 2e79 2829 290d 0a20  p.x(), p.y()).. 
+0001cd40: 2020 2020 2020 2072 6574 7572 6e20 7067         return pg
+0001cd50: 2e50 6f69 6e74 2878 2c20 7929 0d0a 2020  .Point(x, y)..  
+0001cd60: 2020 7265 7475 726e 2070 0d0a 0d0a 0d0a    return p......
+0001cd70: 6465 6620 5f64 7261 775f 6c69 6e65 5f73  def _draw_line_s
+0001cd80: 6567 6d65 6e74 5f74 6578 7428 706f 6c79  egment_text(poly
+0001cd90: 6c69 6e65 2c20 7365 676d 656e 742c 2070  line, segment, p
+0001cda0: 6f73 302c 2070 6f73 3129 3a0d 0a20 2020  os0, pos1):..   
+0001cdb0: 2066 7365 6373 203d 204e 6f6e 650d 0a20   fsecs = None.. 
+0001cdc0: 2020 2064 6174 6173 7263 203d 2070 6f6c     datasrc = pol
+0001cdd0: 796c 696e 652e 7662 2e64 6174 6173 7263  yline.vb.datasrc
+0001cde0: 0d0a 2020 2020 6966 2064 6174 6173 7263  ..    if datasrc
+0001cdf0: 2061 6e64 2063 6c61 6d70 5f67 7269 643a   and clamp_grid:
+0001ce00: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+0001ce10: 2020 2020 2020 2020 2020 2020 7830 2c78              x0,x
+0001ce20: 3120 3d20 706f 7330 2e78 2829 2b30 2e35  1 = pos0.x()+0.5
+0001ce30: 2c20 706f 7331 2e78 2829 2b30 2e35 0d0a  , pos1.x()+0.5..
+0001ce40: 2020 2020 2020 2020 2020 2020 7430 2c5f              t0,_
+0001ce50: 2c5f 2c5f 2c63 6e74 3020 3d20 6461 7461  ,_,_,cnt0 = data
+0001ce60: 7372 632e 6869 6c6f 2878 302c 2078 3029  src.hilo(x0, x0)
+0001ce70: 0d0a 2020 2020 2020 2020 2020 2020 7431  ..            t1
+0001ce80: 2c5f 2c5f 2c5f 2c63 6e74 3120 3d20 6461  ,_,_,_,cnt1 = da
+0001ce90: 7461 7372 632e 6869 6c6f 2878 312c 2078  tasrc.hilo(x1, x
+0001cea0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+0001ceb0: 6966 2063 6e74 3020 616e 6420 636e 7431  if cnt0 and cnt1
+0001cec0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001ced0: 2020 2066 7365 6373 203d 2061 6273 2874     fsecs = abs(t
+0001cee0: 3120 2d20 7430 2920 2f20 3165 390d 0a20  1 - t0) / 1e9.. 
+0001cef0: 2020 2020 2020 2065 7863 6570 743a 0d0a         except:..
+0001cf00: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+0001cf10: 0d0a 2020 2020 6469 6666 203d 2070 6f73  ..    diff = pos
+0001cf20: 3120 2d20 706f 7330 0d0a 2020 2020 6966  1 - pos0..    if
+0001cf30: 2066 7365 6373 2069 7320 4e6f 6e65 3a0d   fsecs is None:.
+0001cf40: 0a20 2020 2020 2020 2066 7365 6373 203d  .        fsecs =
+0001cf50: 2061 6273 2864 6966 662e 7828 292a 6570   abs(diff.x()*ep
+0001cf60: 6f63 685f 7065 7269 6f64 290d 0a20 2020  och_period)..   
+0001cf70: 2073 6563 7320 3d20 696e 7428 6673 6563   secs = int(fsec
+0001cf80: 7329 0d0a 2020 2020 6d69 6e73 203d 2073  s)..    mins = s
+0001cf90: 6563 732f 2f36 300d 0a20 2020 2068 6f75  ecs//60..    hou
+0001cfa0: 7273 203d 206d 696e 732f 2f36 300d 0a20  rs = mins//60.. 
+0001cfb0: 2020 206d 696e 7320 3d20 6d69 6e73 2536     mins = mins%6
+0001cfc0: 300d 0a20 2020 2073 6563 7320 3d20 7365  0..    secs = se
+0001cfd0: 6373 2536 300d 0a20 2020 2069 6620 686f  cs%60..    if ho
+0001cfe0: 7572 733d 3d30 2061 6e64 206d 696e 733d  urs==0 and mins=
+0001cff0: 3d30 2061 6e64 2073 6563 7320 3c20 3630  =0 and secs < 60
+0001d000: 2061 6e64 2065 706f 6368 5f70 6572 696f   and epoch_perio
+0001d010: 6420 3c20 313a 0d0a 2020 2020 2020 2020  d < 1:..        
+0001d020: 6d73 6563 7320 3d20 696e 7428 2866 7365  msecs = int((fse
+0001d030: 6373 2d69 6e74 2866 7365 6373 2929 2a31  cs-int(fsecs))*1
+0001d040: 3030 3029 0d0a 2020 2020 2020 2020 7473  000)..        ts
+0001d050: 203d 2027 2530 2e32 693a 2530 2e32 692e   = '%0.2i:%0.2i.
+0001d060: 2530 2e33 6927 2025 2028 6d69 6e73 2c20  %0.3i' % (mins, 
+0001d070: 7365 6373 2c20 6d73 6563 7329 0d0a 2020  secs, msecs)..  
+0001d080: 2020 656c 6966 2068 6f75 7273 3d3d 3020    elif hours==0 
+0001d090: 616e 6420 6d69 6e73 203c 2036 3020 616e  and mins < 60 an
+0001d0a0: 6420 6570 6f63 685f 7065 7269 6f64 203c  d epoch_period <
+0001d0b0: 2036 303a 0d0a 2020 2020 2020 2020 7473   60:..        ts
+0001d0c0: 203d 2027 2530 2e32 693a 2530 2e32 693a   = '%0.2i:%0.2i:
+0001d0d0: 2530 2e32 6927 2025 2028 686f 7572 732c  %0.2i' % (hours,
+0001d0e0: 206d 696e 732c 2073 6563 7329 0d0a 2020   mins, secs)..  
+0001d0f0: 2020 656c 6966 2068 6f75 7273 203c 2032    elif hours < 2
+0001d100: 343a 0d0a 2020 2020 2020 2020 7473 203d  4:..        ts =
+0001d110: 2027 2530 2e32 693a 2530 2e32 6927 2025   '%0.2i:%0.2i' %
+0001d120: 2028 686f 7572 732c 206d 696e 7329 0d0a   (hours, mins)..
+0001d130: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0001d140: 2020 2064 6179 7320 3d20 686f 7572 7320     days = hours 
+0001d150: 2f2f 2032 340d 0a20 2020 2020 2020 2068  // 24..        h
+0001d160: 6f75 7273 2025 3d20 3234 0d0a 2020 2020  ours %= 24..    
+0001d170: 2020 2020 7473 203d 2027 2569 6420 2530      ts = '%id %0
+0001d180: 2e32 693a 2530 2e32 6927 2025 2028 6461  .2i:%0.2i' % (da
+0001d190: 7973 2c20 686f 7572 732c 206d 696e 7329  ys, hours, mins)
+0001d1a0: 0d0a 2020 2020 2020 2020 6966 2074 732e  ..        if ts.
+0001d1b0: 656e 6473 7769 7468 2827 2030 303a 3030  endswith(' 00:00
+0001d1c0: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+0001d1d0: 2074 7320 3d20 7473 2e70 6172 7469 7469   ts = ts.partiti
+0001d1e0: 6f6e 2827 2027 295b 305d 0d0a 2020 2020  on(' ')[0]..    
+0001d1f0: 7973 6320 3d20 706f 6c79 6c69 6e65 2e76  ysc = polyline.v
+0001d200: 622e 7973 6361 6c65 0d0a 2020 2020 6966  b.yscale..    if
+0001d210: 2070 6f6c 796c 696e 652e 7662 2e79 5f70   polyline.vb.y_p
+0001d220: 6f73 6974 6976 653a 0d0a 2020 2020 2020  ositive:..      
+0001d230: 2020 7930 2c79 3120 3d20 7973 632e 7866    y0,y1 = ysc.xf
+0001d240: 6f72 6d28 706f 7330 2e79 2829 292c 2079  orm(pos0.y()), y
+0001d250: 7363 2e78 666f 726d 2870 6f73 312e 7928  sc.xform(pos1.y(
+0001d260: 2929 0d0a 2020 2020 2020 2020 6966 2079  ))..        if y
+0001d270: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+0001d280: 6761 696e 203d 2079 3120 2f20 7930 202d  gain = y1 / y0 -
+0001d290: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+0001d2a0: 6966 2067 6169 6e20 3e20 3130 3a0d 0a20  if gain > 10:.. 
+0001d2b0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0001d2c0: 616c 7565 203d 2027 7825 6927 2025 2067  alue = 'x%i' % g
+0001d2d0: 6169 6e0d 0a20 2020 2020 2020 2020 2020  ain..           
+0001d2e0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0001d2f0: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
+0001d300: 2725 2b2e 3266 2025 2527 2025 2028 3130  '%+.2f %%' % (10
+0001d310: 3020 2a20 6761 696e 290d 0a20 2020 2020  0 * gain)..     
+0001d320: 2020 2065 6c69 6620 6e6f 7420 7931 3a0d     elif not y1:.
+0001d330: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+0001d340: 7565 203d 2027 3027 0d0a 2020 2020 2020  ue = '0'..      
+0001d350: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0001d360: 2020 2020 2076 616c 7565 203d 2027 2be2       value = '+.
+0001d370: 889e 2720 6966 2079 313e 3020 656c 7365  ..' if y1>0 else
+0001d380: 2027 2de2 889e 270d 0a20 2020 2065 6c73   '-...'..    els
+0001d390: 653a 0d0a 2020 2020 2020 2020 6479 203d  e:..        dy =
+0001d3a0: 2079 7363 2e78 666f 726d 2864 6966 662e   ysc.xform(diff.
+0001d3b0: 7928 2929 0d0a 2020 2020 2020 2020 6966  y())..        if
+0001d3c0: 2064 7920 616e 6420 2861 6273 2864 7929   dy and (abs(dy)
+0001d3d0: 203e 3d20 3165 3420 6f72 2061 6273 2864   >= 1e4 or abs(d
+0001d3e0: 7929 203c 3d20 3165 2d32 293a 0d0a 2020  y) <= 1e-2):..  
+0001d3f0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
+0001d400: 3d20 2725 2b33 2e33 6727 2025 2064 790d  = '%+3.3g' % dy.
+0001d410: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0001d420: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+0001d430: 6520 3d20 2725 2b32 2e32 6627 2025 2064  e = '%+2.2f' % d
+0001d440: 790d 0a20 2020 2065 7874 7261 203d 205f  y..    extra = _
+0001d450: 6472 6177 5f6c 696e 655f 6578 7472 615f  draw_line_extra_
+0001d460: 7465 7874 2870 6f6c 796c 696e 652c 2073  text(polyline, s
+0001d470: 6567 6d65 6e74 2c20 706f 7330 2c20 706f  egment, pos0, po
+0001d480: 7331 290d 0a20 2020 2072 6574 7572 6e20  s1)..    return 
+0001d490: 2725 7320 2573 2028 2573 2927 2025 2028  '%s %s (%s)' % (
+0001d4a0: 7661 6c75 652c 2065 7874 7261 2c20 7473  value, extra, ts
+0001d4b0: 290d 0a0d 0a0d 0a64 6566 205f 6472 6177  )......def _draw
+0001d4c0: 5f6c 696e 655f 6578 7472 615f 7465 7874  _line_extra_text
+0001d4d0: 2870 6f6c 796c 696e 652c 2073 6567 6d65  (polyline, segme
+0001d4e0: 6e74 2c20 706f 7330 2c20 706f 7331 293a  nt, pos0, pos1):
+0001d4f0: 0d0a 2020 2020 2727 2753 686f 7773 2074  ..    '''Shows t
+0001d500: 6865 2070 726f 706f 7274 696f 6e73 206f  he proportions o
+0001d510: 6620 7468 6973 206c 696e 6520 6865 6967  f this line heig
+0001d520: 6874 2063 6f6d 7061 7265 6420 746f 2074  ht compared to t
+0001d530: 6865 2070 7265 7669 6f75 7320 7365 676d  he previous segm
+0001d540: 656e 742e 2727 270d 0a20 2020 2070 7265  ent.'''..    pre
+0001d550: 765f 7465 7874 203d 204e 6f6e 650d 0a20  v_text = None.. 
+0001d560: 2020 2066 6f72 2074 6578 7420 696e 2070     for text in p
+0001d570: 6f6c 796c 696e 652e 7465 7874 733a 0d0a  olyline.texts:..
+0001d580: 2020 2020 2020 2020 6966 2070 7265 765f          if prev_
+0001d590: 7465 7874 2069 7320 6e6f 7420 4e6f 6e65  text is not None
+0001d5a0: 2061 6e64 2074 6578 742e 7365 676d 656e   and text.segmen
+0001d5b0: 7420 3d3d 2073 6567 6d65 6e74 3a0d 0a20  t == segment:.. 
+0001d5c0: 2020 2020 2020 2020 2020 2068 3020 3d20             h0 = 
+0001d5d0: 7072 6576 5f74 6578 742e 7365 676d 656e  prev_text.segmen
+0001d5e0: 742e 6861 6e64 6c65 735b 305d 5b27 6974  t.handles[0]['it
+0001d5f0: 656d 275d 0d0a 2020 2020 2020 2020 2020  em']..          
+0001d600: 2020 6831 203d 2070 7265 765f 7465 7874    h1 = prev_text
+0001d610: 2e73 6567 6d65 6e74 2e68 616e 646c 6573  .segment.handles
+0001d620: 5b31 5d5b 2769 7465 6d27 5d0d 0a20 2020  [1]['item']..   
+0001d630: 2020 2020 2020 2020 2070 7265 765f 6368           prev_ch
+0001d640: 616e 6765 203d 2068 312e 706f 7328 292e  ange = h1.pos().
+0001d650: 7928 2920 2d20 6830 2e70 6f73 2829 2e79  y() - h0.pos().y
+0001d660: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0001d670: 7468 6973 5f63 6861 6e67 6520 3d20 706f  this_change = po
+0001d680: 7331 2e79 2829 202d 2070 6f73 302e 7928  s1.y() - pos0.y(
+0001d690: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0001d6a0: 6620 6e6f 7420 6162 7328 7072 6576 5f63  f not abs(prev_c
+0001d6b0: 6861 6e67 6529 203e 2031 652d 3134 3a0d  hange) > 1e-14:.
+0001d6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d6d0: 2062 7265 616b 0d0a 2020 2020 2020 2020   break..        
+0001d6e0: 2020 2020 6368 616e 6765 5f70 6172 7420      change_part 
+0001d6f0: 3d20 6162 7328 7468 6973 5f63 6861 6e67  = abs(this_chang
+0001d700: 6520 2f20 7072 6576 5f63 6861 6e67 6529  e / prev_change)
+0001d710: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0001d720: 7475 726e 2027 203d 2031 3a25 2e32 6620  turn ' = 1:%.2f 
+0001d730: 2720 2520 6368 616e 6765 5f70 6172 740d  ' % change_part.
+0001d740: 0a20 2020 2020 2020 2070 7265 765f 7465  .        prev_te
+0001d750: 7874 203d 2074 6578 740d 0a20 2020 2072  xt = text..    r
+0001d760: 6574 7572 6e20 2727 0d0a 0d0a 0d0a 6465  eturn ''......de
+0001d770: 6620 5f6d 616b 6570 656e 2863 6f6c 6f72  f _makepen(color
+0001d780: 2c20 7374 796c 653d 4e6f 6e65 2c20 7769  , style=None, wi
+0001d790: 6474 683d 3129 3a0d 0a20 2020 2069 6620  dth=1):..    if 
+0001d7a0: 7374 796c 6520 6973 204e 6f6e 6520 6f72  style is None or
+0001d7b0: 2073 7479 6c65 203d 3d20 272d 273a 0d0a   style == '-':..
+0001d7c0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+0001d7d0: 672e 6d6b 5065 6e28 636f 6c6f 723d 636f  g.mkPen(color=co
+0001d7e0: 6c6f 722c 2077 6964 7468 3d77 6964 7468  lor, width=width
+0001d7f0: 290d 0a20 2020 2064 6173 6820 3d20 5b5d  )..    dash = []
+0001d800: 0d0a 2020 2020 666f 7220 6368 2069 6e20  ..    for ch in 
+0001d810: 7374 796c 653a 0d0a 2020 2020 2020 2020  style:..        
+0001d820: 6966 2063 6820 3d3d 2027 2d27 3a0d 0a20  if ch == '-':.. 
+0001d830: 2020 2020 2020 2020 2020 2064 6173 6820             dash 
+0001d840: 2b3d 205b 342c 325d 0d0a 2020 2020 2020  += [4,2]..      
+0001d850: 2020 656c 6966 2063 6820 3d3d 2027 5f27    elif ch == '_'
+0001d860: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+0001d870: 6173 6820 2b3d 205b 3130 2c32 5d0d 0a20  ash += [10,2].. 
+0001d880: 2020 2020 2020 2065 6c69 6620 6368 203d         elif ch =
+0001d890: 3d20 272e 273a 0d0a 2020 2020 2020 2020  = '.':..        
+0001d8a0: 2020 2020 6461 7368 202b 3d20 5b31 2c32      dash += [1,2
+0001d8b0: 5d0d 0a20 2020 2020 2020 2065 6c69 6620  ]..        elif 
+0001d8c0: 6368 203d 3d20 2720 273a 0d0a 2020 2020  ch == ' ':..    
+0001d8d0: 2020 2020 2020 2020 6966 2064 6173 683a          if dash:
+0001d8e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d8f0: 2020 6461 7368 5b2d 315d 202b 3d20 320d    dash[-1] += 2.
+0001d900: 0a20 2020 2072 6574 7572 6e20 7067 2e6d  .    return pg.m
+0001d910: 6b50 656e 2863 6f6c 6f72 3d63 6f6c 6f72  kPen(color=color
+0001d920: 2c20 7374 796c 653d 5174 436f 7265 2e51  , style=QtCore.Q
+0001d930: 742e 5065 6e53 7479 6c65 2e43 7573 746f  t.PenStyle.Custo
+0001d940: 6d44 6173 684c 696e 652c 2064 6173 683d  mDashLine, dash=
+0001d950: 6461 7368 2c20 7769 6474 683d 7769 6474  dash, width=widt
+0001d960: 6829 0d0a 0d0a 0d0a 6465 6620 5f72 6f75  h)......def _rou
+0001d970: 6e64 2876 293a 0d0a 2020 2020 7265 7475  nd(v):..    retu
+0001d980: 726e 2066 6c6f 6f72 2876 2b30 2e35 290d  rn floor(v+0.5).
+0001d990: 0a0d 0a0d 0a74 7279 3a0d 0a20 2020 2071  .....try:..    q
+0001d9a0: 7476 6572 203d 2027 2564 2e25 6427 2025  tver = '%d.%d' %
+0001d9b0: 2028 5174 436f 7265 2e51 545f 5645 5253   (QtCore.QT_VERS
+0001d9c0: 494f 4e2f 2f32 3536 2f2f 3235 362c 2051  ION//256//256, Q
+0001d9d0: 7443 6f72 652e 5154 5f56 4552 5349 4f4e  tCore.QT_VERSION
+0001d9e0: 2f2f 3235 3625 3235 3629 0d0a 2020 2020  //256%256)..    
+0001d9f0: 6966 2071 7476 6572 206e 6f74 2069 6e20  if qtver not in 
+0001da00: 2827 352e 3927 2c20 2735 2e31 3327 2920  ('5.9', '5.13') 
+0001da10: 616e 6420 5b69 6e74 2869 2920 666f 7220  and [int(i) for 
+0001da20: 6920 696e 2070 672e 5f5f 7665 7273 696f  i in pg.__versio
+0001da30: 6e5f 5f2e 7370 6c69 7428 272e 2729 5d20  n__.split('.')] 
+0001da40: 3c3d 205b 302c 3131 2c30 5d3a 0d0a 2020  <= [0,11,0]:..  
+0001da50: 2020 2020 2020 7072 696e 7428 2757 4152        print('WAR
+0001da60: 4e49 4e47 3a20 796f 7572 2076 6572 7369  NING: your versi
+0001da70: 6f6e 206f 6620 5174 206d 6179 206e 6f74  on of Qt may not
+0001da80: 2070 6c6f 7420 6375 7276 6573 2063 6f6e   plot curves con
+0001da90: 7461 696e 696e 6720 4e61 4e73 2061 6e64  taining NaNs and
+0001daa0: 2069 7320 6e6f 7420 7265 636f 6d6d 656e   is not recommen
+0001dab0: 6465 642e 2729 0d0a 2020 2020 2020 2020  ded.')..        
+0001dac0: 7072 696e 7428 2753 6565 2068 7474 7073  print('See https
+0001dad0: 3a2f 2f67 6974 6875 622e 636f 6d2f 7079  ://github.com/py
+0001dae0: 7174 6772 6170 682f 7079 7174 6772 6170  qtgraph/pyqtgrap
+0001daf0: 682f 6973 7375 6573 2f31 3035 3727 290d  h/issues/1057').
+0001db00: 0a65 7863 6570 743a 0d0a 2020 2020 7061  .except:..    pa
+0001db10: 7373 0d0a 0d0a 696d 706f 7274 206c 6f63  ss....import loc
+0001db20: 616c 650d 0a63 6f64 652c 5f20 3d20 6c6f  ale..code,_ = lo
+0001db30: 6361 6c65 2e67 6574 6465 6661 756c 746c  cale.getdefaultl
+0001db40: 6f63 616c 6528 290d 0a69 6620 636f 6465  ocale()..if code
+0001db50: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0001db60: 205c 0d0a 2020 2020 2861 6e79 2873 616e   \..    (any(san
+0001db70: 6374 696f 6e65 6420 696e 2063 6f64 652e  ctioned in code.
+0001db80: 6c6f 7765 7228 2920 666f 7220 7361 6e63  lower() for sanc
+0001db90: 7469 6f6e 6564 2069 6e20 275f 7275 205f  tioned in '_ru _
+0001dba0: 6279 2072 755f 2062 795f 272e 7370 6c69  by ru_ by_'.spli
+0001dbb0: 7428 2929 206f 7220 5c0d 0a20 2020 2020  t()) or \..     
+0001dbc0: 616e 7928 7361 6e63 7469 6f6e 6564 2069  any(sanctioned i
+0001dbd0: 6e20 636f 6465 2e6c 6f77 6572 2829 2066  n code.lower() f
+0001dbe0: 6f72 2073 616e 6374 696f 6e65 6420 696e  or sanctioned in
+0001dbf0: 2027 7275 2062 6527 2e73 706c 6974 2829   'ru be'.split()
+0001dc00: 2929 3a0d 0a20 2020 2069 6d70 6f72 7420  )):..    import 
+0001dc10: 6f73 0d0a 2020 2020 6f73 2e5f 6578 6974  os..    os._exit
+0001dc20: 2831 290d 0a20 2020 2061 7373 6572 7420  (1)..    assert 
+0001dc30: 4661 6c73 650d 0a0d 0a23 2064 6566 6175  False....# defau
+0001dc40: 6c74 2074 6f20 626c 6163 6b2d 6f6e 2d77  lt to black-on-w
+0001dc50: 6869 7465 0d0a 7067 2e77 6964 6765 7473  hite..pg.widgets
+0001dc60: 2e47 7261 7068 6963 7356 6965 772e 4772  .GraphicsView.Gr
+0001dc70: 6170 6869 6373 5669 6577 2e77 6865 656c  aphicsView.wheel
+0001dc80: 4576 656e 7420 3d20 7061 7274 6961 6c6d  Event = partialm
+0001dc90: 6574 686f 6428 5f77 6865 656c 5f65 7665  ethod(_wheel_eve
+0001dca0: 6e74 5f77 7261 7070 6572 2c20 7067 2e77  nt_wrapper, pg.w
+0001dcb0: 6964 6765 7473 2e47 7261 7068 6963 7356  idgets.GraphicsV
+0001dcc0: 6965 772e 4772 6170 6869 6373 5669 6577  iew.GraphicsView
+0001dcd0: 2e77 6865 656c 4576 656e 7429 0d0a 2320  .wheelEvent)..# 
+0001dce0: 7573 6520 6669 6e70 6c6f 7420 696e 7374  use finplot inst
+0001dcf0: 6561 6420 6f66 206d 6174 706c 6f74 6c69  ead of matplotli
+0001dd00: 620d 0a70 642e 7365 745f 6f70 7469 6f6e  b..pd.set_option
+0001dd10: 2827 706c 6f74 7469 6e67 2e62 6163 6b65  ('plotting.backe
+0001dd20: 6e64 272c 2027 6669 6e70 6c6f 742e 7064  nd', 'finplot.pd
+0001dd30: 706c 6f74 2729 0d0a 2320 7069 636b 2075  plot')..# pick u
+0001dd40: 7020 7769 6e20 7265 736f 6c75 7469 6f6e  p win resolution
+0001dd50: 0d0a 7472 793a 0d0a 2020 2020 696d 706f  ..try:..    impo
+0001dd60: 7274 2063 7479 7065 730d 0a20 2020 2075  rt ctypes..    u
+0001dd70: 7365 7233 3220 3d20 6374 7970 6573 2e77  ser32 = ctypes.w
+0001dd80: 696e 646c 6c2e 7573 6572 3332 0d0a 2020  indll.user32..  
+0001dd90: 2020 7573 6572 3332 2e53 6574 5072 6f63    user32.SetProc
+0001dda0: 6573 7344 5049 4177 6172 6528 290d 0a20  essDPIAware().. 
+0001ddb0: 2020 206c 6f64 5f63 616e 646c 6573 203d     lod_candles =
+0001ddc0: 2069 6e74 2875 7365 7233 322e 4765 7453   int(user32.GetS
+0001ddd0: 7973 7465 6d4d 6574 7269 6373 2830 2920  ystemMetrics(0) 
+0001dde0: 2a20 312e 3629 0d0a 2020 2020 6361 6e64  * 1.6)..    cand
+0001ddf0: 6c65 5f73 6861 646f 775f 7769 6474 6820  le_shadow_width 
+0001de00: 3d20 696e 7428 7573 6572 3332 2e47 6574  = int(user32.Get
+0001de10: 5379 7374 656d 4d65 7472 6963 7328 3029  SystemMetrics(0)
+0001de20: 202f 2f20 3231 3030 202b 2031 2920 2320   // 2100 + 1) # 
+0001de30: 3235 3630 2061 6e64 2072 6573 6f6c 7574  2560 and resolut
+0001de40: 696f 6e73 2061 626f 7665 202d 3e20 7769  ions above -> wi
+0001de50: 6465 7220 7368 6164 6f77 730d 0a65 7863  der shadows..exc
+0001de60: 6570 743a 0d0a 2020 2020 7061 7373 0d0a  ept:..    pass..
```

### Comparing `finplot-1.9.4/finplot/live.py` & `finplot-1.9.5/finplot/live.py`

 * *Files identical despite different names*

### Comparing `finplot-1.9.4/finplot/pdplot.py` & `finplot-1.9.5/finplot/pdplot.py`

 * *Files identical despite different names*

### Comparing `finplot-1.9.4/finplot.egg-info/PKG-INFO` & `finplot-1.9.5/finplot.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: finplot
-Version: 1.9.4
+Version: 1.9.5
 Summary: Finance plotting
 Home-page: https://github.com/highfestiva/finplot
 Author: Jonas Bystr√∂m
 Author-email: highfestiva@gmail.com
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: OS Independent
```

### Comparing `finplot-1.9.4/setup.py` & `finplot-1.9.5/setup.py`

 * *Files identical despite different names*

