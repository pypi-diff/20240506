# Comparing `tmp/AutoNico-1.1.3-py3-none-any.whl.zip` & `tmp/AutoNico-1.2.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,31 +1,44 @@
-Zip file size: 5335146 bytes, number of entries: 29
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-09 06:56 auto_nico/__init__.py
--rw-r--r--  2.0 unx     6321 b- defN 24-Apr-09 06:56 auto_nico/adb_utils.py
--rw-r--r--  2.0 unx      264 b- defN 24-Apr-09 06:56 auto_nico/dump_ui.py
--rw-r--r--  2.0 unx     3767 b- defN 24-Apr-09 06:56 auto_nico/get_uiautomator_xml.py
--rw-r--r--  2.0 unx      321 b- defN 24-Apr-09 06:56 auto_nico/logger_config.py
--rw-r--r--  2.0 unx     5466 b- defN 24-Apr-09 06:56 auto_nico/nico.py
--rw-r--r--  2.0 unx     8238 b- defN 24-Apr-09 06:56 auto_nico/nico_element.py
--rw-r--r--  2.0 unx     2703 b- defN 24-Apr-09 06:56 auto_nico/nico_image.py
--rw-r--r--  2.0 unx     7417 b- defN 24-Apr-09 06:56 auto_nico/nico_proxy.py
--rw-r--r--  2.0 unx     1016 b- defN 24-Apr-09 06:56 auto_nico/send_request.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-09 06:56 auto_nico/console_scripts/__init__.py
--rw-r--r--  2.0 unx      340 b- defN 24-Apr-09 06:56 auto_nico/console_scripts/dump_ui.py
--rw-r--r--  2.0 unx     1282 b- defN 24-Apr-09 06:56 auto_nico/console_scripts/screenshot.py
--rw-r--r--  2.0 unx      465 b- defN 24-Apr-09 06:56 auto_nico/console_scripts/uninstall_apk.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-09 06:56 auto_nico/console_scripts/inspector_web/__init__.py
--rw-r--r--  2.0 unx     6124 b- defN 24-Apr-09 06:56 auto_nico/console_scripts/inspector_web/nico_inspector.py
--rw-r--r--  2.0 unx     7099 b- defN 24-Apr-09 06:56 auto_nico/console_scripts/inspector_web/static/script.js
--rw-r--r--  2.0 unx      975 b- defN 24-Apr-09 06:56 auto_nico/console_scripts/inspector_web/static/styles.css
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-09 06:56 auto_nico/console_scripts/inspector_web/templates/__init__.py
--rw-r--r--  2.0 unx      729 b- defN 24-Apr-09 06:56 auto_nico/console_scripts/inspector_web/templates/xml_template.html
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-09 06:56 auto_nico/libs/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-09 06:56 auto_nico/package/__init__.py
--rw-r--r--  2.0 unx   680965 b- defN 24-Apr-09 06:56 auto_nico/package/android_test.apk
--rw-r--r--  2.0 unx  5574151 b- defN 24-Apr-09 06:56 auto_nico/package/app.apk
--rw-r--r--  2.0 unx    11479 b- defN 24-Apr-09 06:56 AutoNico-1.1.3.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Apr-09 06:56 AutoNico-1.1.3.dist-info/WHEEL
--rw-r--r--  2.0 unx      199 b- defN 24-Apr-09 06:56 AutoNico-1.1.3.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       10 b- defN 24-Apr-09 06:56 AutoNico-1.1.3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2600 b- defN 24-Apr-09 06:56 AutoNico-1.1.3.dist-info/RECORD
-29 files, 6322023 bytes uncompressed, 5330872 bytes compressed:  15.7%
+Zip file size: 5348041 bytes, number of entries: 42
+-rw-r--r--  2.0 unx        0 b- defN 24-May-06 02:31 auto_nico/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 24-May-06 02:31 auto_nico/android/__init__.py
+-rw-r--r--  2.0 unx     8251 b- defN 24-May-06 02:31 auto_nico/android/adb_utils.py
+-rw-r--r--  2.0 unx     3223 b- defN 24-May-06 02:31 auto_nico/android/nico_android.py
+-rw-r--r--  2.0 unx     7648 b- defN 24-May-06 02:31 auto_nico/android/nico_android_element.py
+-rw-r--r--  2.0 unx     2728 b- defN 24-May-06 02:31 auto_nico/android/nico_image.py
+-rw-r--r--  2.0 unx        0 b- defN 24-May-06 02:31 auto_nico/android/package/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 24-May-06 02:31 auto_nico/common/__init__.py
+-rw-r--r--  2.0 unx      288 b- defN 24-May-06 02:31 auto_nico/common/common_utils.py
+-rw-r--r--  2.0 unx      132 b- defN 24-May-06 02:31 auto_nico/common/error.py
+-rw-r--r--  2.0 unx      321 b- defN 24-May-06 02:31 auto_nico/common/logger_config.py
+-rw-r--r--  2.0 unx     3718 b- defN 24-May-06 02:31 auto_nico/common/nico_element.py
+-rw-r--r--  2.0 unx    12127 b- defN 24-May-06 02:31 auto_nico/common/nico_proxy.py
+-rw-r--r--  2.0 unx     1500 b- defN 24-May-06 02:31 auto_nico/common/running_info.py
+-rw-r--r--  2.0 unx     2190 b- defN 24-May-06 02:31 auto_nico/common/send_request.py
+-rw-r--r--  2.0 unx        0 b- defN 24-May-06 02:31 auto_nico/console_scripts/__init__.py
+-rw-r--r--  2.0 unx      356 b- defN 24-May-06 02:31 auto_nico/console_scripts/dump_ui.py
+-rw-r--r--  2.0 unx     1307 b- defN 24-May-06 02:31 auto_nico/console_scripts/screenshot.py
+-rw-r--r--  2.0 unx      376 b- defN 24-May-06 02:31 auto_nico/console_scripts/uninstall_apk.py
+-rw-r--r--  2.0 unx        0 b- defN 24-May-06 02:31 auto_nico/console_scripts/inspector_web/__init__.py
+-rw-r--r--  2.0 unx     8657 b- defN 24-May-06 02:31 auto_nico/console_scripts/inspector_web/nico_inspector.py
+-rw-r--r--  2.0 unx     8498 b- defN 24-May-06 02:31 auto_nico/console_scripts/inspector_web/static/script.js
+-rw-r--r--  2.0 unx      975 b- defN 24-May-06 02:31 auto_nico/console_scripts/inspector_web/static/styles.css
+-rw-r--r--  2.0 unx        0 b- defN 24-May-06 02:31 auto_nico/console_scripts/inspector_web/templates/__init__.py
+-rw-r--r--  2.0 unx      729 b- defN 24-May-06 02:31 auto_nico/console_scripts/inspector_web/templates/xml_template.html
+-rw-r--r--  2.0 unx     4326 b- defN 24-May-06 02:31 auto_nico/ios/XCUIElementType.py
+-rw-r--r--  2.0 unx        0 b- defN 24-May-06 02:31 auto_nico/ios/__init__.py
+-rw-r--r--  2.0 unx     5209 b- defN 24-May-06 02:31 auto_nico/ios/idb_utils.py
+-rw-r--r--  2.0 unx      161 b- defN 24-May-06 02:31 auto_nico/ios/nico_image.py
+-rw-r--r--  2.0 unx     4644 b- defN 24-May-06 02:31 auto_nico/ios/nico_ios.py
+-rw-r--r--  2.0 unx     6181 b- defN 24-May-06 02:31 auto_nico/ios/nico_ios_element.py
+-rw-r--r--  2.0 unx        0 b- defN 24-May-06 02:31 auto_nico/ios/tools/__init__.py
+-rw-r--r--  2.0 unx     6919 b- defN 24-May-06 02:31 auto_nico/ios/tools/format_converter.py
+-rw-r--r--  2.0 unx      636 b- defN 24-May-06 02:31 auto_nico/ios/tools/image_process.py
+-rw-r--r--  2.0 unx        0 b- defN 24-May-06 02:31 auto_nico/package/__init__.py
+-rw-r--r--  2.0 unx   680965 b- defN 24-May-06 02:31 auto_nico/package/android_test.apk
+-rw-r--r--  2.0 unx  5574151 b- defN 24-May-06 02:31 auto_nico/package/app.apk
+-rw-r--r--  2.0 unx    11479 b- defN 24-May-06 02:31 AutoNico-1.2.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-May-06 02:31 AutoNico-1.2.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx      265 b- defN 24-May-06 02:31 AutoNico-1.2.0.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       10 b- defN 24-May-06 02:31 AutoNico-1.2.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     3807 b- defN 24-May-06 02:31 AutoNico-1.2.0.dist-info/RECORD
+42 files, 6361869 bytes uncompressed, 5341819 bytes compressed:  16.0%
```

## zipnote {}

```diff
@@ -1,35 +1,50 @@
 Filename: auto_nico/__init__.py
 Comment: 
 
-Filename: auto_nico/adb_utils.py
+Filename: auto_nico/android/__init__.py
 Comment: 
 
-Filename: auto_nico/dump_ui.py
+Filename: auto_nico/android/adb_utils.py
 Comment: 
 
-Filename: auto_nico/get_uiautomator_xml.py
+Filename: auto_nico/android/nico_android.py
 Comment: 
 
-Filename: auto_nico/logger_config.py
+Filename: auto_nico/android/nico_android_element.py
 Comment: 
 
-Filename: auto_nico/nico.py
+Filename: auto_nico/android/nico_image.py
 Comment: 
 
-Filename: auto_nico/nico_element.py
+Filename: auto_nico/android/package/__init__.py
 Comment: 
 
-Filename: auto_nico/nico_image.py
+Filename: auto_nico/common/__init__.py
 Comment: 
 
-Filename: auto_nico/nico_proxy.py
+Filename: auto_nico/common/common_utils.py
 Comment: 
 
-Filename: auto_nico/send_request.py
+Filename: auto_nico/common/error.py
+Comment: 
+
+Filename: auto_nico/common/logger_config.py
+Comment: 
+
+Filename: auto_nico/common/nico_element.py
+Comment: 
+
+Filename: auto_nico/common/nico_proxy.py
+Comment: 
+
+Filename: auto_nico/common/running_info.py
+Comment: 
+
+Filename: auto_nico/common/send_request.py
 Comment: 
 
 Filename: auto_nico/console_scripts/__init__.py
 Comment: 
 
 Filename: auto_nico/console_scripts/dump_ui.py
 Comment: 
@@ -54,35 +69,59 @@
 
 Filename: auto_nico/console_scripts/inspector_web/templates/__init__.py
 Comment: 
 
 Filename: auto_nico/console_scripts/inspector_web/templates/xml_template.html
 Comment: 
 
-Filename: auto_nico/libs/__init__.py
+Filename: auto_nico/ios/XCUIElementType.py
+Comment: 
+
+Filename: auto_nico/ios/__init__.py
+Comment: 
+
+Filename: auto_nico/ios/idb_utils.py
+Comment: 
+
+Filename: auto_nico/ios/nico_image.py
+Comment: 
+
+Filename: auto_nico/ios/nico_ios.py
+Comment: 
+
+Filename: auto_nico/ios/nico_ios_element.py
+Comment: 
+
+Filename: auto_nico/ios/tools/__init__.py
+Comment: 
+
+Filename: auto_nico/ios/tools/format_converter.py
+Comment: 
+
+Filename: auto_nico/ios/tools/image_process.py
 Comment: 
 
 Filename: auto_nico/package/__init__.py
 Comment: 
 
 Filename: auto_nico/package/android_test.apk
 Comment: 
 
 Filename: auto_nico/package/app.apk
 Comment: 
 
-Filename: AutoNico-1.1.3.dist-info/METADATA
+Filename: AutoNico-1.2.0.dist-info/METADATA
 Comment: 
 
-Filename: AutoNico-1.1.3.dist-info/WHEEL
+Filename: AutoNico-1.2.0.dist-info/WHEEL
 Comment: 
 
-Filename: AutoNico-1.1.3.dist-info/entry_points.txt
+Filename: AutoNico-1.2.0.dist-info/entry_points.txt
 Comment: 
 
-Filename: AutoNico-1.1.3.dist-info/top_level.txt
+Filename: AutoNico-1.2.0.dist-info/top_level.txt
 Comment: 
 
-Filename: AutoNico-1.1.3.dist-info/RECORD
+Filename: AutoNico-1.2.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## auto_nico/console_scripts/dump_ui.py

```diff
@@ -1,13 +1,13 @@
-from auto_nico.nico import AdbAutoNico
+from auto_nico.android.nico_android import NicoAndroid
 
 
 def main():
     import argparse
 
     parser = argparse.ArgumentParser()
     parser.add_argument('-s', type=str, help='device_udid')
     parser.add_argument('-c', type=str, help='compressed', default="true")
 
     args = parser.parse_args()
-    nico = AdbAutoNico(args.s)
-    nico.get_root_xml(args.c)
+    nico = NicoAndroid(args.s)
+    nico().get_root_xml(True)
```

## auto_nico/console_scripts/screenshot.py

```diff
@@ -1,32 +1,33 @@
 import os
 from pathlib import Path
 from datetime import datetime
 
 import cv2
-from auto_nico.adb_utils import AdbUtils
-from auto_nico.nico import AdbAutoNico
+
+from auto_nico.android.adb_utils import AdbUtils
+from auto_nico.android.nico_android import NicoAndroid
 
 
 def main():
     import argparse
 
     parser = argparse.ArgumentParser()
     parser.add_argument('-s', type=str, help='device_udid')
 
     parser.add_argument('-m', action='store_true',
                         help='Activate special mode.')
     args = parser.parse_args()
-    adb_utils = AdbUtils(args.s)
+    adb_utils = AdbUtils(args.u)
     desktop_path = Path.home() / 'Desktop'
     timestamp = datetime.now().strftime("Screenshot_%Y-%m-%d_%H%M%S")
     pic_path = f"{desktop_path}\{timestamp}.png"
 
     if args.m:
-        nico = AdbAutoNico(args.s)
+        nico = NicoAndroid(args.s)
         eles = nico(text_matches=r'^(?=(?:.*?\d){2})').all()
         adb_utils.snapshot(timestamp, desktop_path)
         image = cv2.imread(f"{pic_path}")
         for ele in eles:
             x, y, w, h = ele.get_bounds
             if h < 10:
                 h = 50
```

## auto_nico/console_scripts/uninstall_apk.py

```diff
@@ -1,14 +1,13 @@
-from auto_nico.adb_utils import AdbUtils
+from auto_nico.android.adb_utils import AdbUtils
+
 
 def main():
     import argparse
 
     parser = argparse.ArgumentParser()
     parser.add_argument('-s', type=str, help='device_udid')
-    if parser.parse_args().s is None:
-        print("Please provide a device_udid")
-        return
+
     args = parser.parse_args()
     adb_utils = AdbUtils(args.s)
-    adb_utils.qucik_shell("pm uninstall hank.dump_hierarchy")
-    adb_utils.qucik_shell("pm uninstall hank.dump_hierarchy.test")
+    adb_utils.qucik_shell("pm uninstall nico.dump-hierarchy")
+    adb_utils.qucik_shell("pm uninstall nico.dump-hierarchy.test")
```

## auto_nico/console_scripts/inspector_web/nico_inspector.py

```diff
@@ -1,187 +1,249 @@
 import argparse
+import json
 import multiprocessing
 import os
 import random
-import socket
+import time
 
-from auto_nico.adb_utils import AdbUtils
-from auto_nico.nico import ADBServerError
-from auto_nico.send_request import send_tcp_request
-from flask import Flask, render_template
-import xml.etree.ElementTree as ET
+import lxml.etree as ET
 
 import base64
 import subprocess
 
+from flask import Flask, render_template, request
+
+from auto_nico.common.common_utils import is_port_in_use
+from auto_nico.common.send_request import send_tcp_request
+from auto_nico.ios.XCUIElementType import get_element_type_by_value
+from auto_nico.ios.tools.format_converter import converter
+
+from auto_nico.android.adb_utils import AdbUtils
+from auto_nico.ios.idb_utils import IdbUtils
+
 app = Flask(__name__)
 
 
 # 递归函数，用于将XML元素及其属性转换为HTML列表项
 def xml_to_html_list(element, depth=0):
     # 开始列表项
     random_number = random.randint(100000, 999999)
-
     html = f'<div class="node" style="text-indent: -1em; padding-left: {depth + 1}em; word-wrap: break-word;"'
     # 如果元素有属性，将它们添加到列表项中
     if element.attrib:
         html += " " + " ".join([f'{k}="{v}"' for k, v in element.attrib.items()])
-        html += f'''identifier = "nico_{random_number}"'''
+        html += f'''identifier_number = "nico_{random_number}"'''
+    if depth != 0:
+        content = element.tag
+    else:
+        html += f'''id = "Title" '''
+        html += f'''current_package_name = {os.environ.get("current_package_name")} '''
+        html += f'''nico_ui_platform = {os.environ.get('nico_ui_platform')}'''
+        content = f"{element.tag} for {os.environ.get('nico_ui_platform')}"
 
-    html += f'><strong style="font-size: 2em;">{element.tag}</strong>'
+    html += f'><strong style="font-size: 2em;">{content}</strong>'
     # 如果元素有属性，将它们作为文本添加
-
     if element.attrib:
         html += " (Attributes: "
         html += ", ".join([f'{k}="{v}"' for k, v in element.attrib.items()])
         html += ")"
     # 如果元素有文本内容，将其添加到列表项中
     if element.text and element.text.strip():
         html += f" - Text: {element.text.strip()}"
+
     html += "</div>"
     # 处理子元素
     children = list(element)
     if children:
         for child in children:
             html += xml_to_html_list(child, depth + 1)
     return html
 
 
+def dump_ui_tree():
+    platform = os.environ.get('nico_ui_platform')
+    udid = os.environ.get("nico_ui_udid")
+    idb_utils = IdbUtils(udid)
+
+    port = int(os.environ.get('RemoteServerPort'))
+    if platform == "android":
+        xml = send_tcp_request(port, "dump_true").replace("class", "class_name").replace("resource-id=", "id=").replace("content-desc=", "content_desc=")
+    else:
+        bundle_list = idb_utils.get_app_list()
+        print(bundle_list)
+        command = "get_current_bundleIdentifier"
+        for item in bundle_list:
+            if item:
+                item = item.split(" ")[0]
+                command = command + f":{item}"
+        package_name = send_tcp_request(port, command)
+        os.environ['current_package_name'] = package_name
+
+        xml = send_tcp_request(port, f"dump_tree:{package_name}")
+        xml = converter(xml)
+    root = ET.fromstring(xml.encode('utf-8'))
+    return root
+
+
 @app.route('/refresh_image')
 def refresh_image():
     port = int(os.environ.get('RemoteServerPort'))
-    new_data = send_tcp_request(port, "get_pic")
+    platform = os.environ.get('nico_ui_platform')
+    if platform == "android":
+        new_data = send_tcp_request(port, "get_pic")
+    else:
+        new_data = send_tcp_request(port, "get_jpg_pic:1.0")
     base64_data = base64.b64encode(new_data)
     return base64_data
 
 
 @app.route('/refresh_ui_xml')
 def refresh_ui_xml():
-    port = int(os.environ.get('RemoteServerPort'))
-    xml = send_tcp_request(port, "dump_true").replace("class", "class_name")
-    # 重新加载XML文件
-    root = ET.fromstring(xml.encode('utf-8'))
+    root = dump_ui_tree()
 
     # 构建HTML列表
     html_list = xml_to_html_list(root)
 
     # 渲染模板并传递构建的HTML列表
     return html_list
 
 
 @app.route('/image')
 def generate_image():
     port = int(os.environ.get('RemoteServerPort'))
-    new_data = send_tcp_request(port, "get_pic")
+    platform = os.environ.get('nico_ui_platform')
+    if platform == "android":
+        new_data = send_tcp_request(port, "get_pic")
+    else:
+        new_data = send_tcp_request(port, "get_jpg_pic:1.0")
 
     # 使用BytesIO来模拟一个文件对象，并将数据写入到这个对象中
     base64_data = base64.b64encode(new_data)
     return base64_data
 
 
-@app.route('/')
-def show_xml():
+@app.route('/get_element_attribute')
+def get_element_attribute():
+    id = request.args.get('id')
+    xpath = request.args.get("xpath")
     port = int(os.environ.get('RemoteServerPort'))
-    xml = send_tcp_request(port, "dump_true").replace("class", "class_name")
-    # 重新加载XML文件
-    root = ET.fromstring(xml.encode('utf-8'))
+    if xpath is None or xpath == "null":
+        return ""
+    new_data = send_tcp_request(port, f"find_element_by_query:{id}:xpath:{xpath}")
+    if new_data == "":
+        return ""
+    new_data_dict = dict(json.loads(new_data))
+    new_data_dict.pop('children', None)
+    for att in ["title", "label"]:
+        value = new_data_dict.pop(att)
+        text = value if value != "" else ""
+    frame = new_data_dict.pop("frame")
+    new_data_dict.update({"text": text})
+    new_data_dict.update({"class_name": get_element_type_by_value(new_data_dict.pop("elementType"))})
+    new_data_dict.update({"bounds": f'[{frame.get("X")},{frame.get("Y")}][{frame.get("Width")},{frame.get("Height")}]'})
+
+    return new_data_dict
 
+
+@app.route('/')
+def show_xml():
+    root = dump_ui_tree()
     # 构建HTML列表
     html_list = xml_to_html_list(root)
 
     # 渲染模板并传递构建的HTML列表
     return render_template('xml_template.html', xml_content=html_list)
 
 
 def run_app(port):
     app.run(debug=False, port=port)
 
 
-def check_adb_server(udid):
-    rst = os.popen("adb devices").read()
-    if udid in rst:
-        pass
-    else:
-        raise ADBServerError("no devices connect")
-
-
-def clear_tcp_forward_port(udid, port):
-    adb_utils = AdbUtils(udid)
-    adb_utils.cmd(f'''forward --remove tcp:{port}''')
-
-
 def set_tcp_forward_port(udid, port):
-    adb_utils = AdbUtils(udid)
-
+    platform = os.environ.get('nico_ui_platform')
+    if platform == "android":
+        adb_utils = AdbUtils(udid)
+        adb_utils.cmd(f'''forward tcp:{port} tcp:{port}''')
+    else:
+        commands = f"""tidevice --udid {udid} relay {port} {port}"""
+        subprocess.Popen(commands, shell=True)
     print(f'''forward tcp:{port} tcp:{port}''')
 
-    adb_utils.cmd(f'''forward tcp:{port} tcp:{port}''')
-
-
-def install_package(udid):
-    def install(udid):
-        for i in ["android_test.apk", "app.apk"]:
-            print(f"{udid}'s start install {i}")
-            lib_path = (os.path.dirname(__file__) + f"\package\{i}").replace("console_scripts\inspector_web", "")
-            rst = adb_utils.cmd(f"install -t {lib_path}")
-            if rst.find("Success") >= 0:
-                print(f"{udid}'s adb install {i} successfully")
-            else:
-                print(rst)
-
-    version = 1.1
-    adb_utils = AdbUtils(udid)
-    rst = adb_utils.qucik_shell("dumpsys package hank.dump_hierarchy | grep versionName")
-    if "versionName" not in rst:
-        install(udid)
-    elif version > float(rst.split("=")[-1]):
-        print(f"{udid}'s New version detected")
-        for i in ["hank.dump_hierarchy", "hank.dump_hierarchy.test"]:
-            print(f"{udid}'s start uninstall {i}")
-            rst = adb_utils.cmd("uninstall {i}")
-            if rst.find("Success") >= 0:
-                print(f"{udid}'s adb uninstall {i} successfully")
-            else:
-                print(rst)
-        install(udid)
-
-
-def is_port_in_use(port):
-    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
-        return s.connect_ex(('localhost', port)) == 0
-
 
 def main():
     parser = argparse.ArgumentParser()
     parser.add_argument('-p1', type=int, help='Remote port to connect to')
     parser.add_argument('-p2', type=int, help='Port to run on')
     parser.add_argument('-s', type=str, help='device_udid')
+    parser.add_argument('-plat', type=str, help='platform "i","iOS","a","android"')
+
     udid = parser.parse_args().s
+    # udid = "dbde29f994e7ed382a592d6504eb9a4e9e4eb660"
+
+    platform = parser.parse_args().plat
+    if platform is None:
+        if len(udid) > 20:
+            platform = "iOS"
+        else:
+            platform = "android"
+    elif platform in ["i", "iOS", "a", "android"]:
+        if platform == "i":
+            platform = "iOS"
+        elif platform == "a":
+            platform = "android"
+        else:
+            pass
+    else:
+        print('Please enter the correct platform "i","iOS","a","android"')
+
+    os.environ['nico_ui_platform'] = platform
+
     remote_port = parser.parse_args().p1
     inspect_port = parser.parse_args().p2
+    if remote_port is None:
+        random_number = random.randint(9000, 9999)
+        remote_port = random_number
+
+    if inspect_port is None:
+        random_number = random.randint(9000, 9999)
+        inspect_port = random_number
 
     if udid is None:
         print("Please provide a device_udid")
         return
-    check_adb_server(udid)
-    install_package(udid)
     if remote_port is None:
         print("Please provide a port to connect remote nico server!!!!")
         return
+    if inspect_port is None:
+        print("Please provide a port to run inspector UI!!!!")
+        return
+    if is_port_in_use(remote_port):
+        print(f"Port {remote_port} is already in use")
+        return
+    if is_port_in_use(inspect_port):
+        print(f"Port {inspect_port} is already in use")
+        return
+
+    if platform == "android":
+        adb_utils = AdbUtils(udid)
+        adb_utils.clear_tcp_forward_port(remote_port)
+        adb_utils.cmd(f'''forward tcp:{remote_port} tcp:{remote_port}''')
+        adb_utils.check_adb_server()
+        adb_utils.install_test_server_package(1.0)
+        commands = f"""adb -s {udid} shell am instrument -r -w -e port {remote_port} -e class nico.dump_hierarchy.HierarchyTest nico.dump_hierarchy.test/androidx.test.runner.AndroidJUnitRunner"""
+        subprocess.Popen(commands, shell=True)
     else:
-        if inspect_port is None:
-            print("Please provide a port to run inspector UI!!!!")
-            return
-        clear_tcp_forward_port(udid, remote_port)
-        if is_port_in_use(remote_port):
-            print(f"Port {remote_port} is already in use")
-            return
-        if is_port_in_use(inspect_port):
-            print(f"Port {inspect_port} is already in use")
-            return
+        idb_utils = IdbUtils(udid)
+        if idb_utils.get_tcp_forward_port():
+            remote_port = idb_utils.get_tcp_forward_port()
         else:
-            set_tcp_forward_port(udid, remote_port)
-            commands = f"""adb -s {udid} shell am instrument -r -w -e port {remote_port} -e class hank.dump_hierarchy.HierarchyTest hank.dump_hierarchy.test/androidx.test.runner.AndroidJUnitRunner"""
-            subprocess.Popen(commands, shell=True)
-            os.environ['RemoteServerPort'] = str(remote_port)
-            p = multiprocessing.Process(target=run_app, args=(inspect_port,))
-            p.start()
+            idb_utils.set_port_forward(remote_port)
+        test_server_package_dict = idb_utils.get_test_server_package()
+
+        commands = f"""tidevice  --udid {udid} xcuitest --bundle-id {test_server_package_dict.get("test_server_package")} --target-bundle-id {test_server_package_dict.get("main_package")} -e USE_PORT:{remote_port}"""
+        subprocess.Popen(commands, shell=True)
+    os.environ['RemoteServerPort'] = str(remote_port)
+    os.environ['nico_ui_udid'] = udid
+    time.sleep(5)
+
+    p = multiprocessing.Process(target=run_app, args=(inspect_port,))
+    p.start()
```

## auto_nico/console_scripts/inspector_web/static/script.js

### js-beautify {}

```diff
@@ -6,68 +6,79 @@
     var displayedHeight = img.clientHeight;
     var actualWidth = img.naturalWidth;
     var actualHeight = img.naturalHeight;
 
     var scale = Math.min(displayedWidth / actualWidth, displayedHeight / actualHeight);
     var scaledWidth = scale * actualWidth;
     var scaledHeight = scale * actualHeight;
+    // 对于iOS 需要将所有元素的宽高都 * （图像真实宽高/第一个窗口的宽高(也就是调用获取的屏幕的宽高))
+    if (listItems[0].innerText.indexOf("iOS") !== -1) {
+        console.log(listItems[1].getAttribute('bounds'))
+        h_from_api = parseInt(listItems[1].getAttribute('bounds').split(',').pop().match(/\d+/)[0])
+        scale = scale * actualHeight / h_from_api
+
+    }
 
     var blankLeft = (displayedWidth - scaledWidth) / 2;
     var blankTop = (displayedHeight - scaledHeight) / 2;
 
     for (var i = 0; i < listItems.length; i++) {
-        var bounds = listItems[i].getAttribute('bounds'); /* 获取当前被悬停元素的bounds属性 */
-        var identifier = listItems[i].getAttribute('identifier'); /* 获取当前被悬停元素的bounds属性 */
-
+        var bounds = listItems[i].getAttribute('bounds');
+        var identifier_number = listItems[i].getAttribute('identifier_number');
         if (bounds) {
             var matches = bounds.match(/\[(\d+),(\d+)\]\[(\d+),(\d+)\]/);
             if (matches) {
                 var x1 = parseInt(matches[1]) * scale + blankLeft;
                 var y1 = parseInt(matches[2]) * scale + blankTop;;
-                var x2 = parseInt(matches[3]) * scale + blankLeft;
-                var y2 = parseInt(matches[4]) * scale + blankTop;
+                if (listItems[0].innerText.indexOf("iOS") !== -1) {
+                    var x2 = parseInt(matches[3]) * scale;
+                    var y2 = parseInt(matches[4]) * scale;
+                } else {
+                    var x2 = parseInt(matches[3]) * scale + blankLeft;
+                    var y2 = parseInt(matches[4]) * scale + blankTop;
+                }
             }
         }
+
         // 添加控件元素
         var imageControl = document.createElement('div');
-        imageControl.setAttribute('img-identifier', identifier);
+        imageControl.setAttribute('img-identifier_number', identifier_number);
         imageControl.style.position = 'absolute';
         imageControl.style.left = x1 + "px"; /* 相对于目标元素左侧距离 */
         imageControl.style.top = y1 + "px"; /* 相对于目标元素顶部距离 */
-        imageControl.style.width = x2 - x1 + "px"; /* 新元素宽度 */
-        imageControl.style.height = y2 - y1 + "px"; /* 新元素高度 */
+        if (listItems[0].innerText.indexOf("iOS") !== -1) {
+            imageControl.style.width = x2 + "px"; /* 新元素宽度 */
+            imageControl.style.height = y2 + "px"; /* 新元素高度 */
+        } else {
+            imageControl.style.width = x2 - x1 + "px"; /* 新元素宽度 */
+            imageControl.style.height = y2 - y1 + "px"; /* 新元素高度 */
+        }
+
+
         imageControl.style.backgroundColor = 'rgba(144, 238, 144, 0)';
         imageControl.className = 'imageControl';
         ui_image.appendChild(imageControl);
     }
 }
 
 function addTextControlHoverListeners() {
     var listItems = document.getElementsByClassName('node');
 
     var infoList = document.getElementById('info-list'); // 获取新的ul元素
     for (var i = 0; i < listItems.length; i++) {
 
         listItems[i].addEventListener('mouseover', function() {
             this.classList.add('hovered');
-            var attrs = this.attributes; // 获取当前被悬停元素的所有属性
             infoList.innerHTML = ''; // 清空ul元素的内容
-            for (var j = 0; j < attrs.length; j++) {
-                if (attrs[j].name != 'class' && attrs[j].name != 'style' && attrs[j].name != 'identifier') {
-                    var attr = attrs[j];
-                    var li = document.createElement('li'); // 创建一个新的li元素
-                    li.textContent = attr.name + ': ' + attr.value; // 设置li元素的内容
-                    infoList.appendChild(li); // 将li元素添加到ul元素中
-                }
-            }
-            var identifier = this.getAttribute("identifier");
-            console.log('[img-identifier="${identifier}"]')
+            xpath = this.getAttribute('xpath')
+            crate_attributes_list(this)
 
-            var img_element = document.querySelector(`[img-identifier="${identifier}"]`);
-            console.log(img_element)
+            var identifier_number = this.getAttribute("identifier_number");
+
+            var img_element = document.querySelector(`[img-identifier_number="${identifier_number}"]`);
             img_element.style.backgroundColor = 'rgba(144, 238, 144, 0.5)';
 
         });
         listItems[i].addEventListener('mouseout', function() {
             this.classList.remove('hovered');
             var imageControlList = document.getElementsByClassName('imageControl'); // 获取新的ul元素
             for (var i = 0; i < imageControlList.length; i++) {
@@ -81,64 +92,96 @@
 
 window.onload = function() {
     refreshData();
 };
 
 function crate_attributes_list(text_element) {
     var infoList = document.getElementById('info-list'); // 获取新的ul元素
+    var first_node = document.getElementById('Title')
     var attrs = text_element.attributes; // 获取当前被悬停元素的所有属性
+    var platform = first_node.getAttribute("nico_ui_platform")
+
     infoList.innerHTML = ''; // 清空ul元素的内容
-    for (var j = 0; j < attrs.length; j++) {
-        console.log("hank" + attrs[j].name != 'class')
-        if (attrs[j].name != 'class' && attrs[j].name != 'style' && attrs[j].name != 'identifier') {
-            var attr = attrs[j];
+    xpath = text_element.getAttribute('xpath')
+    package_name = first_node.getAttribute('current_package_name')
+    if (platform == "iOS") {
+        url = `/get_element_attribute?id=${package_name}&xpath=${xpath}`
+        console.log(url)
+
+        var element_attribute;
+
+        $.ajax({
+            url: url,
+            type: 'GET',
+            async: false,
+            success: function(data) {
+                element_attribute = data;
+            }
+        });
+
+        // 将字典中的键值对添加到 NamedNodeMap 中
+        Object.entries(element_attribute).forEach(function([key, value]) {
             var li = document.createElement('li'); // 创建一个新的li元素
-            li.textContent = attr.name + ': ' + attr.value; // 设置li元素的内容
+            li.textContent = key + ': ' + value; // 设置li元素的内容
             infoList.appendChild(li); // 将li元素添加到ul元素中
+        });
+
+    } else {
+        var attrs = text_element.attributes; // 获取当前被悬停元素的所有属性
+        for (var j = 0; j < attrs.length; j++) {
+            console.log(attrs[j].name)
+            if (attrs[j].name != 'class' && attrs[j].name != 'style' && attrs[j].name != 'identifier_number') {
+                var attr = attrs[j];
+                var li = document.createElement('li'); // 创建一个新的li元素
+                li.textContent = attr.name + ': ' + attr.value; // 设置li元素的内容
+                infoList.appendChild(li); // 将li元素添加到ul元素中
+            }
         }
     }
+
+
 }
 
 
 function addImageListeners() {
     var imageControlList = document.getElementsByClassName('imageControl'); // 获取新的ul元素
     for (var i = 0; i < imageControlList.length; i++) {
         imageControlList[i].addEventListener('mouseover', function() {
             console.log('"mousemove" event on canvas');
 
             this.style.backgroundColor = 'rgba(144, 238, 144, 0.5)';
-            var identifier = this.getAttribute("img-identifier");
-            var text_element = document.querySelector(`[identifier="${identifier}"]`);
+            var identifier_number = this.getAttribute("img-identifier_number");
+            var text_element = document.querySelector(`[identifier_number="${identifier_number}"]`);
 
             text_element.classList.add('hovered');
             crate_attributes_list(text_element)
 
         });
 
         imageControlList[i].addEventListener('click', function() {
             console.log('"mousemove" event on canvas');
 
             this.style.backgroundColor = 'rgba(144, 238, 144, 0.5)';
-            var identifier = this.getAttribute("img-identifier");
-            var text_element = document.querySelector(`[identifier="${identifier}"]`);
+            var identifier_number = this.getAttribute("img-identifier_number");
+            var text_element = document.querySelector(`[identifier_number="${identifier_number}"]`);
             crate_attributes_list(text_element)
             text_element.classList.add('hovered');
             text_element.scrollIntoView({
                 behavior: 'smooth',
                 block: 'nearest',
                 inline: 'nearest'
             });
 
 
 
         });
         imageControlList[i].addEventListener('mouseout', function() {
             this.style.backgroundColor = 'rgba(144, 238, 144, 0)';
-            var identifier = this.getAttribute("img-identifier");
-            var text_element = document.querySelector(`[identifier="${identifier}"]`);
+            var identifier_number = this.getAttribute("img-identifier_number");
+            var text_element = document.querySelector(`[identifier_number="${identifier_number}"]`);
             text_element.classList.remove('hovered');
 
         });
     }
 
 
 }
```

## Comparing `auto_nico/adb_utils.py` & `auto_nico/android/adb_utils.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,33 +1,74 @@
 import os
 import re
 import time
 import subprocess
 
+from auto_nico.common.logger_config import logger
 
-class NicoError(Exception):
-    """
-        This is NicoError BaseError
-        When ADB have something wrong
-    """
-
-    pass
+from auto_nico.common.error import ADBServerError
 
 
 class AdbUtils:
     def __init__(self, udid):
         self.udid = udid
 
     def get_tcp_forward_port(self):
         rst = self.cmd(f'''forward --list | find "{self.udid}"''')
         port = None
         if rst != "":
             port = rst.split("tcp:")[-1]
         return port
 
+    def clear_tcp_forward_port(self, port):
+        self.cmd(f"forward --remove tcp:{port}")
+
+    def set_tcp_forward_port(self,port):
+        for _ in range(5):
+            rst = self.cmd(f'''forward --list | find "{port}"''')
+            if self.udid not in rst:
+                self.cmd(f'''forward tcp:{port} tcp:{port}''')
+            else:
+                logger.debug(f"{self.udid}'s tcp already forward tcp:{port} tcp:{port}")
+                break
+
+    def install_test_server_package(self,version):
+        def install(udid):
+            for i in ["dump_hierarchy.apk", "dump_hierarchy_androidTest.apk"]:
+                logger.debug(f"{udid}'s start install {i}")
+                lib_path = (os.path.dirname(__file__) + f"\package\{i}").replace("console_scripts\inspector_web", "")
+                rst = self.cmd(f"install -t {lib_path}")
+                if rst.find("Success") >= 0:
+                    logger.debug(f"{udid}'s adb install {i} successfully")
+                else:
+                    logger.debug(rst)
+
+        rst = self.qucik_shell("dumpsys package nico.dump_hierarchy | grep versionName")
+        if "versionName" not in rst:
+            install(self.udid)
+        elif version > float(rst.split("=")[-1]):
+            logger.debug(float(rst.split("=")[-1]))
+
+            logger.debug(f"{self.udid}'s New version detected")
+            for i in ["nico.dump_hierarchy", "nico.dump_hierarchy.test"]:
+                logger.debug(f"{self.udid}'s start uninstall {i}")
+                rst = self.cmd(f"uninstall {i}")
+                if rst.find("Success") >= 0:
+                    logger.debug(f"{self.udid}'s adb uninstall {i} successfully")
+                else:
+                    logger.debug(rst)
+            install(self.udid)
+
+    def check_adb_server(self):
+        rst = os.popen("adb devices").read()
+        if self.udid in rst:
+            pass
+        else:
+            raise ADBServerError("no devices connect")
+
     def get_screen_size(self):
         command = f'adb -s {self.udid} shell wm size'
         output = os.popen(command).read()
         size_str = output.split(': ')[-1]
         width, height = map(int, size_str.split('x'))
         return width, height
 
@@ -172,24 +213,23 @@
         self.keyevent("HOME")
 
     def snapshot(self, name, path):
         self.shell(f'screencap -p /sdcard/{name}.png', with_root=True)
         self.cmd(f'pull /sdcard/{name}.png {path}')
         self.qucik_shell(f'rm /sdcard/{name}.png')
 
-    def swipe(self,direction,scroll_time = 1,target_area=None):
+    def swipe(self, direction, scroll_time=1, target_area=None):
         x = int(self.get_screen_size()[0] / 2)
         y1 = int(self.get_screen_size()[1] / 4)
         y2 = int(self.get_screen_size()[1] / 2)
         if target_area is not None:
             x = int(self.get_screen_size()[0] * target_area.get_position()[0])
             y1 = int((self.get_screen_size()[1] * target_area.get_position()[1]) / 4)
             y2 = int((self.get_screen_size()[1] * target_area.get_position()[1]) / 2)
-        if direction not in ["down","up"]:
+        if direction not in ["down", "up"]:
             raise TypeError("Please use up or down")
         else:
             for i in range(int(scroll_time)):
                 if direction == "down":
                     self.shell(f"input swipe {x} {y1} {x} {y2}")
                 elif direction == "up":
                     self.shell(f"input swipe {x} {y2} {x} {y1}")
-
```

## Comparing `auto_nico/nico.py` & `auto_nico/ios/nico_ios.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,142 +1,121 @@
 import os
 import random
 import tempfile
 import time
 import subprocess
-from auto_nico.nico_proxy import NicoProxy
 
-from auto_nico.nico_element import NicoElement
-from auto_nico.send_request import send_tcp_request
-from auto_nico.adb_utils import AdbUtils
+from auto_nico.common.error import IDBServerError
+from auto_nico.common.running_info import RunningInfo
+from auto_nico.ios.idb_utils import IdbUtils
+from auto_nico.ios.nico_ios_element import NicoIOSElement
+from auto_nico.common.logger_config import logger
+from auto_nico.common.send_request import send_tcp_request
+from auto_nico.common.nico_proxy import NicoProxy
 
-from auto_nico.logger_config import logger
 
 
-class UIStructureError(Exception):
-    pass
 
 
-class ADBServerError(Exception):
-    pass
-
-
-class AdbAutoNico(NicoProxy):
-    def __init__(self, udid, port="random",  **query):
+class NicoIOS(NicoProxy):
+    def __init__(self, udid, package_name=None, port="random",old_port=None, **query):
         super().__init__(udid, port, **query)
         self.udid = udid
-        self.adb_utils = AdbUtils(udid)
-        self.version = 1.1
-        self.__install_package()
-        self.__check_adb_server(udid)
-        self.__set_running_port(port)
+        logger.debug(f"{self.udid}'s test server is being initialized, plaese wait")
 
-        os.environ[f"{self.udid}_action_was_taken"] = "True"
-        self.close_keyboard()
+        self.package_name = package_name
+        self.idb_utils = IdbUtils(udid)
+        self.__check_idb_server(udid)
+        self.__set_running_port(port)
+        if old_port is not None:
+            self.port = old_port
+        self.running_info = RunningInfo(udid)
+        rst = "200 OK" in send_tcp_request(self.port, "print")
+        if rst:
+            logger.debug(f"{self.udid}'s test server is ready")
+        else:
+            logger.debug(f"{self.udid} test server disconnect, restart ")
+            self.__init_adb_auto()
+        RunningInfo(self.udid).set_action_was_taken(True)
 
-    def __check_adb_server(self, udid):
-        rst = os.popen("adb devices").read()
-        if udid in rst:
+    def __check_idb_server(self, udid):
+        result = subprocess.run("tidevice list", shell=True, stdout=subprocess.PIPE).stdout
+        decoded_result = result.decode('utf-8', errors='ignore')
+        if udid in decoded_result:
             pass
         else:
-            raise ADBServerError("no devices connect")
+            raise IDBServerError("no devices connect")
 
     def __set_running_port(self, port):
-        exists_port = self.__get_tcp_forward_port()
+
+        exists_port = self.idb_utils.get_tcp_forward_port()
         if exists_port is None:
             logger.debug(f"{self.udid} no exists port")
             if port != "random":
                 self.port = port
             else:
                 random_number = random.randint(9000, 9999)
                 self.port = random_number
+            RunningInfo(self.udid).set_current_running_port(self.port)
+            return None
         else:
+            logger.debug(f"{self.udid} exists port {exists_port}")
+
             self.port = int(exists_port)
-            rst = "hierarchy rotation" in send_tcp_request(self.port, "print")
-            if rst:
-                logger.debug(f"{self.udid}'s test server is ready")
-                self.clear_sever = False
-            else:
-                self.clear_sever = True
-                logger.debug(f"{self.udid} test server disconnect, restart ")
-                self.__init_adb_auto()
-
-    def __clear_all_port_forward(self):
-        self.adb_utils.cmd(f"forward --remove tcp:{self.port}")
-
-    def __install_package(self):
-        rst = self.adb_utils.qucik_shell("dumpsys package hank.dump_hierarchy | grep versionName")
-        # print(rst)
-        if "versionName" not in rst:
-            for i in ["android_test.apk", "app.apk"]:
-                logger.debug(f"{self.udid}'s start install {i}")
-                lib_path = os.path.dirname(__file__) + f"\package\{i}"
-                rst = self.adb_utils.cmd(f"install -t {lib_path}")
-                if rst.find("Success") >= 0:
-                    logger.debug(f"{self.udid}'s adb install {i} successfully")
-                else:
-                    logger.error(rst)
-            return 1
-        if self.version > float(rst.split("=")[-1]):
-            logger.debug(f"{self.udid}'s New version detected")
-            for i in ["hank.dump_hierarchy", "hank.dump_hierarchy.test"]:
-                logger.debug(f"{self.udid}'s start uninstall {i}")
-                rst = self.adb_utils.cmd(f"uninstall {i}")
-                if rst.find("Success") >= 0:
-                    logger.debug(f"{self.udid}'s adb uninstall {i} successfully")
-                else:
-                    logger.error(rst)
-        rst = self.adb_utils.qucik_shell("dumpsys package hank.dump_hierarchy | grep versionName")
-
-
-    def __get_tcp_forward_port(self):
-        rst = self.adb_utils.cmd(f'''forward --list | find "{self.udid}"''')
-        port = None
-        if rst != "":
-            port = rst.split("tcp:")[-1]
-        return port
+            RunningInfo(self.udid).set_current_running_port(exists_port)
+
+
+    def __get_current_bundleIdentifier(self,port):
+        bundle_list = self.idb_utils.get_app_list()
+        command = "get_current_bundleIdentifier"
+        for item in bundle_list:
+            if item:
+                item = item.split(" ")[0]
+                command = command + f":{item}"
+        package_name = send_tcp_request(port, command)
+        return package_name
 
     def __set_tcp_forward_port(self):
-        for _ in range(5):
-            rst = self.adb_utils.cmd(f'''forward --list | find "{self.port}"''')
-            if self.udid not in rst:
-                self.adb_utils.cmd(f'''forward tcp:{self.port} tcp:{self.port}''')
-            else:
-                logger.debug(f"{self.udid}'s tcp already forward tcp:{self.port} tcp:{self.port}")
-                break
+        logger.debug(
+            f"""tidevice --udid {self.udid} relay {self.port} {self.port}""")
+        commands = f"""tidevice --udid {self.udid} relay {self.port} {self.port}"""
+        subprocess.Popen(commands, shell=True)
 
     def __start_test_server(self):
         logger.debug(
-            f"""adb -s {self.udid} shell am instrument -r -w -e port {self.port} -e class hank.dump_hierarchy.HierarchyTest hank.dump_hierarchy.test/androidx.test.runner.AndroidJUnitRunner""")
-        commands = f"""adb -s {self.udid} shell am instrument -r -w -e port {self.port} -e class hank.dump_hierarchy.HierarchyTest hank.dump_hierarchy.test/androidx.test.runner.AndroidJUnitRunner"""
+            f"""tidevice  --udid {self.udid} xcuitest --bundle-id nico.dump-hierarchyUITests.xctrunner --target-bundle-id nico.dump-hierarchy -e USE_PORT:{self.port}""")
+        commands = f"""tidevice  --udid {self.udid} xcuitest --bundle-id nico.dump-hierarchyUITests.xctrunner --target-bundle-id nico.dump-hierarchy -e USE_PORT:{self.port}"""
         subprocess.Popen(commands, shell=True)
         for _ in range(10):
             response = send_tcp_request(self.port, "print")
-            if "200" in response:
+
+            if "200 OK" in response:
                 logger.debug(f"{self.udid}'s test server is ready")
                 break
             time.sleep(1)
         logger.debug(f"{self.udid}'s uiautomator was initialized successfully")
 
     def __remove_ui_xml(self, udid):
         temp_folder = tempfile.gettempdir()
         path = temp_folder + f"/{udid}_ui.xml"
         os.remove(path)
 
     def __init_adb_auto(self):
         self.__set_tcp_forward_port()
         self.__start_test_server()
-
-    def close_keyboard(self):
-        adb_utils = AdbUtils(self.udid)
-        ime_list = adb_utils.qucik_shell("ime list -s").split("\n")[0:-1]
-        for ime in ime_list:
-            adb_utils.qucik_shell(f"ime disable {ime}")
+        if self.package_name is None:
+            self.package_name = self.__get_current_bundleIdentifier(self.port)
 
     def __call__(self, **query):
-        self.__check_adb_server(self.udid)
-        rst = "200" in send_tcp_request(self.port, "print")
+        self.__check_idb_server(self.udid)
+        rst = "200 OK" in send_tcp_request(self.port, "print")
         if not rst:
             logger.debug(f"{self.udid} test server disconnect, restart ")
-            self.__install_package()
             self.__init_adb_auto()
-        return NicoElement(self.udid, self.port, **query)
+        if self.package_name is None:
+            self.package_name = self.__get_current_bundleIdentifier(self.port)
+
+        NIE = NicoIOSElement(**query)
+        NIE.set_udid(self.udid)
+        NIE.set_port(self.port)
+        NIE.set_package_name(self.package_name)
+        return NIE
```

## Comparing `auto_nico/nico_image.py` & `auto_nico/android/nico_image.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,29 +1,31 @@
 import os
 import tempfile
 import time
-from auto_nico.logger_config import logger
-from auto_nico.nico import AdbAutoNico
+
+from auto_nico.android.nico_android import NicoAndroid
 from skimage.metrics import structural_similarity as ssim
 import cv2
 
+from auto_nico.common.logger_config import logger
+
 
 class NicoImage:
     def __init__(self, udid):
         self.udid = udid
         self.source_image_path = tempfile.gettempdir() + "/test.png"
 
     def pull_screenshot(self):
         os.popen(f"adb -s {self.udid} shell screencap /sdcard/screenshot.png").read()
 
         os.popen(f"adb -s {self.udid} pull /sdcard/screenshot.png {self.source_image_path}").read()
 
     def __calculate_image_similarity(self, image_path, mosaic):
         self.pull_screenshot()
-        nico = AdbAutoNico(self.udid)
+        nico = NicoAndroid(self.udid)
         img1 = cv2.imread(self.source_image_path)
         img2 = cv2.imread(image_path)
         if mosaic:
             eles = nico(text_matches=r'^(?=(?:.*?\d){2})').all()
             for ele in eles:
                 x, y, w, h = ele.get_bounds
                 if h < 10:
```

## Comparing `AutoNico-1.1.3.dist-info/METADATA` & `AutoNico-1.2.0.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: AutoNico
-Version: 1.1.3
+Version: 1.2.0
 Summary: Provide Basic Interface to conrol Mobile UI.
 Home-page: https://github.com/letmeNo1/nico
 Author: Hank Hang
 Author-email: hanhuang@jabra.com
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: OS Independent
```

## Comparing `AutoNico-1.1.3.dist-info/RECORD` & `AutoNico-1.2.0.dist-info/RECORD`

 * *Files 27% similar despite different names*

```diff
@@ -1,29 +1,42 @@
 auto_nico/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-auto_nico/adb_utils.py,sha256=bqlr2cvalmK6p-_9zJ4h_PyWIhESrwnLFX1B_fnHzyo,6321
-auto_nico/dump_ui.py,sha256=fxuODGcrULGYORlVCY_IsxbPu6jgJUqp8r5LP151gMQ,264
-auto_nico/get_uiautomator_xml.py,sha256=mvP32tYzP1yKGpln31e6Xnwf3uXGLPmlk1xu4l1k0gQ,3767
-auto_nico/logger_config.py,sha256=Jl9At9hANhoBQ4Em8Vw9eebUtwa39D_tYOeestl6goM,321
-auto_nico/nico.py,sha256=Yb6TjL8ORnEOBbtyvGbODhia5DnbMGGkjyZToqai5cI,5466
-auto_nico/nico_element.py,sha256=zJld0-t1ymm3L7ty5ynA7p9HTESWVLpbAN_9Xj_Dpho,8238
-auto_nico/nico_image.py,sha256=KEjJuWYBQLVmBjSVXC8OyU2p4l0VAaGEnNzmXLTLK6g,2703
-auto_nico/nico_proxy.py,sha256=vPoLUPLQDkGFlDpmiW5prhrNtgk1xX-7fuJNizjMWcA,7417
-auto_nico/send_request.py,sha256=zRzPJLWILkFqv4R3myxJnyH5aevidOHaS6Dc3EotEGs,1016
+auto_nico/android/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+auto_nico/android/adb_utils.py,sha256=I_Q0TmpeIgBlIeqpfvoPrHeLJmknlUDK-lCP_7EHjhM,8251
+auto_nico/android/nico_android.py,sha256=farVlD6OjWFRn3YV_tdROl-v706yhf2sba0QTEEW1XA,3223
+auto_nico/android/nico_android_element.py,sha256=KhoX_twSmNB9a_cwmA6SXYUpbTQVCJJ54WzuZ9ond-U,7648
+auto_nico/android/nico_image.py,sha256=eZ-q-KRcxnW6-FqBVc_nimX1PCA_dzti9rx4jMgEQNs,2728
+auto_nico/android/package/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+auto_nico/common/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+auto_nico/common/common_utils.py,sha256=2E6QCwLI56rCvk1MbKQw3R5ftkRbuiX62mP-ab5-TA4,288
+auto_nico/common/error.py,sha256=S9y6jF05PdZ0sY-jh29ftVAaEKztbZl0GoHOcAyfSc4,132
+auto_nico/common/logger_config.py,sha256=Jl9At9hANhoBQ4Em8Vw9eebUtwa39D_tYOeestl6goM,321
+auto_nico/common/nico_element.py,sha256=C05dEUt-wK-uB1Dv_hFx_Xu3FS7SyVJ3vRDPnAb4NO0,3718
+auto_nico/common/nico_proxy.py,sha256=DGAliMTuMBnFLQ-BQ-AY_YgrLEMf7iXowVBbkIGl1DM,12127
+auto_nico/common/running_info.py,sha256=ym0WbWQWBWkDHeMmN3ayKrHoy0sHKNSYxYK-n_z-960,1500
+auto_nico/common/send_request.py,sha256=1pQLx1rJiP1sIUApJbviXisRxypR3bSwvCtkBxc7Kos,2190
 auto_nico/console_scripts/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-auto_nico/console_scripts/dump_ui.py,sha256=263AHUmwBdfROA9OCLkDJ7M3-6inoSBnWL7oWw0jsF4,340
-auto_nico/console_scripts/screenshot.py,sha256=UlF7jEFsjjmGCtnnfeBeVuBFIoltXjSCBeaD4wqD02E,1282
-auto_nico/console_scripts/uninstall_apk.py,sha256=ghMSIIqXXGhQPsbXWzlmfYC_BIhzFEu8R52xrMbjJik,465
+auto_nico/console_scripts/dump_ui.py,sha256=cn521_AbfxG7yiRG7mcGMwjGdlBeQOQxM48jeg1R6lo,356
+auto_nico/console_scripts/screenshot.py,sha256=i3ksKGEDD6GmYmOIEpg-OvVxhE_4AAOi14c3iRQ72lI,1307
+auto_nico/console_scripts/uninstall_apk.py,sha256=2UgYXusbSecHPd9xWGHfbnkeUb-YQX1CDdkPNqHgsrg,376
 auto_nico/console_scripts/inspector_web/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-auto_nico/console_scripts/inspector_web/nico_inspector.py,sha256=BVoVULRFFmHdLzTwM3brW9ag2JhoCNnxZsLCZyt19v8,6124
-auto_nico/console_scripts/inspector_web/static/script.js,sha256=ANOvtfSNzL4s78TIo7F3VYA2md_x475RTOUmb3br9Ug,7099
+auto_nico/console_scripts/inspector_web/nico_inspector.py,sha256=-Muc2gSlguS51E4ush9-8KAo3kVZCtfT8yn687krADw,8657
+auto_nico/console_scripts/inspector_web/static/script.js,sha256=8T_q9IslyxyP8gKh-VLIjyhdV6X46LXtgajhur0MFPU,8498
 auto_nico/console_scripts/inspector_web/static/styles.css,sha256=-3gk9cwUpKIC6wCK69ZGfIxH2e-fx6b6QAD8U2Ao7oM,975
 auto_nico/console_scripts/inspector_web/templates/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 auto_nico/console_scripts/inspector_web/templates/xml_template.html,sha256=1Qq9qI9cxlkm7ugdahXljxa-Y0_YQUJmEoR2h8cvpw0,729
-auto_nico/libs/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+auto_nico/ios/XCUIElementType.py,sha256=2bwKekcQHicWIKim3_hxDPHfZ873xAGDLxAoATBj9Ac,4326
+auto_nico/ios/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+auto_nico/ios/idb_utils.py,sha256=SuQJL7Kt1JlJEILHTLMM-Qosywhes_KW4MvByXfe5dw,5209
+auto_nico/ios/nico_image.py,sha256=RX70eZr0o52tB3Y3e7Qmqj3dza34x0uVpib4V1MYsyw,161
+auto_nico/ios/nico_ios.py,sha256=HUf5X9AeQ9aF5CevqrooUI9BAGE1TNpO2dJ3ro3M6OQ,4644
+auto_nico/ios/nico_ios_element.py,sha256=Ie3L7Jj8Sn0r7QLh45qhRkvzXtXXC7wglTLpWf1Ni10,6181
+auto_nico/ios/tools/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+auto_nico/ios/tools/format_converter.py,sha256=ikyH_vj6_fFacrVBzRsU-iT5u2JbEuWuwLU-tgq2iJI,6919
+auto_nico/ios/tools/image_process.py,sha256=CqCzwzYsDBBGiQ4vbjppHt71GbCICCOlHDHmhnz97DQ,636
 auto_nico/package/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 auto_nico/package/android_test.apk,sha256=3rPtRpzApBUh-tIITl2IJx5gwtJCN-8jvEpfAb1M4nI,680965
 auto_nico/package/app.apk,sha256=q5oP2HT2Qmv8czEHgBzhOgWP9C4qnj0JvxdhXmaQ1RY,5574151
-AutoNico-1.1.3.dist-info/METADATA,sha256=Z8gpE1fFATSYZAMg1qOTpC2Xdh10kZyzdJN5fHX41P8,11479
-AutoNico-1.1.3.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-AutoNico-1.1.3.dist-info/entry_points.txt,sha256=r93eUg27sMjr0563MBHdelBjOnh7AJx9QEsEHiQZDvI,199
-AutoNico-1.1.3.dist-info/top_level.txt,sha256=P7vzPa1PG2Gex7c7gnVxunGleuKS-hA0b9Y50ic0CqE,10
-AutoNico-1.1.3.dist-info/RECORD,,
+AutoNico-1.2.0.dist-info/METADATA,sha256=UlxbvtTc8WKtttjqAfPeQYca2VOz7dZnq8BnR5AOby4,11479
+AutoNico-1.2.0.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+AutoNico-1.2.0.dist-info/entry_points.txt,sha256=_VUQQZfLZPDQQDEAjfrx6P3pPkz3IasXaH8XbW7gOLY,265
+AutoNico-1.2.0.dist-info/top_level.txt,sha256=P7vzPa1PG2Gex7c7gnVxunGleuKS-hA0b9Y50ic0CqE,10
+AutoNico-1.2.0.dist-info/RECORD,,
```

